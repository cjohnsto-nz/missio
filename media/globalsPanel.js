"use strict";(()=>{var Ve=/\{\{(\s*[\w.$-]+\s*)\}\}/g,te=/^[\w.$-]*$/;function h(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var ke=new Set(["$guid","$timestamp","$randomInt"]);function ne(e,t){return e.replace(Ve,(n,r)=>{let a=r.trim(),s=a in t.resolved,i=ke.has(a),o=t.secretKeys?.has(a)??!1,c=s||i||o,u=t.sources[a]||(o?"secret":i?"dynamic":"unknown");return t.showResolved&&s?"<span class='"+("tk-var-resolved tk-src-"+u)+"' data-var='"+h(a)+"' title='{{"+h(a)+"}} ("+u+")'>"+h(t.resolved[a])+"</span>":"<span class='"+(c?"tk-var tk-src-"+u:"tk-var tk-var-unresolved")+"' data-var='"+h(a)+"'>{{"+h(r)+"}}</span>"})}var w=[{key:"environment",label:"Environment",badge:"E",badgeClass:"var-scope-badge-E"},{key:"collection",label:"Collection",badge:"C",badgeClass:"var-scope-badge-C"},{key:"global",label:"Globals",badge:"G",badgeClass:"var-scope-badge-G"}];function se(e){return e==="environment"||e==="dotenv"?w[0]:e==="collection"||e==="folder"?w[1]:e==="global"?w[2]:w[0]}var C=null,oe=null,$=null,k=!1;function re(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function ae(e){C&&!C.contains(e.target)&&A()}function A(){C&&(C.remove(),C=null),oe=null,document.removeEventListener("click",ae)}function le(e,t,n){A(),$=null,k=!1;let r=e.getBoundingClientRect(),a=n.getResolvedVariables(),s=n.getVariableSources(),i=n.getSecretKeys?.()??new Set,o=t in a,c=i.has(t),u=s[t]||(c?"secret":""),g=c&&!o,l=document.createElement("div");l.className="var-tooltip";let p="";if(g)p+="<div class='var-name'>{{"+re(t)+"}}</div><div class='var-source tk-src-secret'>Secret Provider</div><div class='var-secret-value var-value' style='font-style:italic;opacity:0.7'>Value hidden</div><div class='var-actions'>"+(n.postMessage?"<button class='var-action-btn' data-action='reveal'>Reveal Value</button>":"")+"<button class='var-action-btn' data-action='copy'>Copy Name</button></div>";else{let f=o?a[t]:"",V=o?se(u):null;p+="<input type='text' class='var-tooltip-value-input' placeholder='Enter value' value='"+re(f).replace(/'/g,"&#39;")+"' />";let T=V||w[0];p+="<div class='var-tooltip-scope-row'><div class='var-scope-dropdown'><button class='var-scope-trigger'><span class='var-scope-badge "+T.badgeClass+"'>"+T.badge+"</span><span>Save to "+T.label+" \u25BE</span></button><div class='var-scope-menu'>"+w.map(m=>"<button class='var-scope-option' data-scope='"+m.key+"'><span class='var-scope-badge "+m.badgeClass+"'>"+m.badge+"</span><span>"+m.label+"</span></button>").join("")+"</div></div></div>"}l.innerHTML=p,l.style.left=r.left+"px",l.style.top=r.bottom+4+"px",document.body.appendChild(l),C=l;let y=(o?se(u):w[0]).key,b=l.querySelector(".var-scope-trigger"),N=l.querySelector(".var-scope-menu");b&&N&&(b.addEventListener("click",f=>{f.stopPropagation(),N.classList.toggle("open")}),l.querySelectorAll(".var-scope-option").forEach(f=>{f.addEventListener("click",V=>{V.stopPropagation();let T=f.dataset.scope;y=T;let m=w.find(O=>O.key===T)||w[0];b.innerHTML="<span class='var-scope-badge "+m.badgeClass+"'>"+m.badge+"</span><span>Save to "+m.label+" \u25BE</span>",N.classList.remove("open")})}));let P=l.querySelector(".var-tooltip-value-input");P&&(setTimeout(()=>P.focus(),0),P.addEventListener("keydown",f=>{f.key==="Enter"&&(f.preventDefault(),He()),f.key==="Escape"&&A()}));function He(){let f=P?.value??"";n.postMessage&&(n.postMessage({type:"updateVariable",varName:t,value:f,scope:y}),A())}l.querySelectorAll(".var-action-btn").forEach(f=>{f.addEventListener("click",V=>{V.stopPropagation();let T=f.dataset.action;if(T==="copy"){let O=f.dataset.secretValue??(o?a[t]:"{{"+t+"}}");navigator.clipboard.writeText(O).catch(()=>{}),A()}else if(T==="reveal"){let m=l.querySelector(".var-secret-value");$!==null?(k=!k,m&&(m.textContent=k?$:"\u2022".repeat(Math.min($.length,20))),f.textContent=k?"Hide Value":"Show Value"):(oe=t,m&&(m.textContent="Resolving\u2026",m.style.cssText="font-style:italic;opacity:0.7"),f.textContent="Resolving\u2026",n.postMessage({type:"resolveSecret",secretRef:t}))}})}),setTimeout(()=>{document.addEventListener("click",ae)},0)}var ie=()=>({});function ce(e){ie=e}var v=null,E=[],x=0,_=null,S=0,q=!1,F=null,Ae=[{name:"$guid",detail:"Generate a random UUID"},{name:"$timestamp",detail:"Current Unix timestamp"},{name:"$randomInt",detail:"Random integer 0\u20131000"}],U=[],ue=new Map;function de(e){U=e}function pe(e,t){ue.set(e,t)}function ge(e,t){let n=e.substring(0,t),r=n.lastIndexOf("{{");if(r===-1)return null;let a=n.substring(r+2);if(a.includes("}}"))return null;let s=a.trim();return te.test(s)?s:null}function ve(e,t){let n=e.selectionStart??0,r=ge(e.value,n);if(r===null){R();return}_=e,q=!1,S=e.value.lastIndexOf("{{",n-1),fe(r,e,t)}function G(e,t){let n=window.getSelection();if(!n||n.rangeCount===0)return;let r=e.textContent||"",a=n.getRangeAt(0),s=document.createRange();s.selectNodeContents(e),s.setEnd(a.startContainer,a.startOffset);let i=s.toString().length,o=ge(r,i);if(o===null){R();return}_=e,q=!0,S=r.lastIndexOf("{{",i-1),fe(o,e,t)}function fe(e,t,n){F=n;let r=e.toLowerCase(),a=[],s=ie();for(let o of Object.keys(s))a.push({name:o,detail:s[o]});for(let o of Ae)a.push(o);if(r===""||"$secret".startsWith(r))U.length>0&&a.push({name:"$secret",detail:"Secret provider"});else if(r.startsWith("$secret.")){let o=r.substring(8),c=o.indexOf(".");if(c===-1)for(let u of U)u.toLowerCase().startsWith(o)&&a.push({name:"$secret."+u,detail:"Key Vault provider"});else{let u=o.substring(0,c),g=o.substring(c+1),l=ue.get(u)||[];for(let p of l)p.toLowerCase().startsWith(g)&&a.push({name:"$secret."+u+"."+p,displayName:p,detail:"Secret"})}}let i=new Set;E=[];for(let o of a)o.name.toLowerCase().startsWith(r)&&!i.has(o.name)&&(i.add(o.name),E.push(o));if(E.length===0){R();return}x=0,v||(v=document.createElement("div"),v.className="var-autocomplete",document.body.appendChild(v)),D(),_e(t)}function D(){v&&(v.innerHTML=E.map((e,t)=>"<div class='"+(t===x?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+t+"'><span class='var-ac-name'>"+h(e.displayName||e.name)+"</span><span class='var-ac-value'>"+h(e.detail||"")+"</span></div>").join(""),v.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",t=>{t.preventDefault();let n=parseInt(e.dataset.index||"0");Ee(E[n].name)})}))}function Ie(e){let t=document.createElement("div"),n=window.getComputedStyle(e);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","paddingTop","paddingLeft","paddingRight","paddingBottom","borderWidth","boxSizing","whiteSpace","wordWrap","overflowWrap","tabSize"].forEach(u=>{t.style[u]=n.getPropertyValue(u.replace(/[A-Z]/g,g=>"-"+g.toLowerCase()))}),t.style.position="absolute",t.style.visibility="hidden",t.style.whiteSpace="pre-wrap",t.style.wordWrap="break-word",t.style.width=e.clientWidth+"px";let a=e.value.substring(0,e.selectionStart??0);t.textContent=a;let s=document.createElement("span");s.textContent="|",t.appendChild(s),document.body.appendChild(t);let i=s.getBoundingClientRect(),o=e.getBoundingClientRect(),c={top:o.top+(i.top-t.getBoundingClientRect().top)-e.scrollTop,left:o.left+(i.left-t.getBoundingClientRect().left)-e.scrollLeft};return document.body.removeChild(t),c}function _e(e){if(v){if(q){let t=window.getSelection();if(t&&t.rangeCount>0){let r=t.getRangeAt(0).getBoundingClientRect();v.style.left=r.left+"px",v.style.top=r.bottom+4+"px"}else{let n=e.getBoundingClientRect();v.style.left=n.left+"px",v.style.top=n.bottom+2+"px"}}else{let t=Ie(e);v.style.left=t.left+"px",v.style.top=t.top+18+"px"}v.style.minWidth="220px"}}var me=null,ye=null,be=null,I=null;function he(e,t,n,r){me=e,ye=t,be=n,I=r||null}function Pe(e){return!!(e==="$secret"||e.startsWith("$secret.")&&e.split(".").length===2)}function Ee(e){if(!_)return;let t=Pe(e),n=_,r=q,a=F;if(r){let s=n,i=s,o=i._getRawText?i._getRawText():s.textContent||"",c=window.getSelection(),u=o.length;if(c&&c.rangeCount>0){let p=c.getRangeAt(0),y=document.createRange();y.selectNodeContents(s),y.setEnd(p.startContainer,p.startOffset),u=y.toString().length}let g,l;if(t){g="{{"+e+".";let p=u;o.substring(u).startsWith("}}")&&(p+=2);let b=o.substring(0,S)+g+o.substring(p);l=S+g.length,i._setRawText?i._setRawText(b):I&&I(b)}else{g="{{"+e+"}}";let p=u;o.substring(u).startsWith("}}")&&(p+=2);let b=o.substring(0,S)+g+o.substring(p);l=S+g.length,i._setRawText?i._setRawText(b):I&&I(b)}if(a?a():ye?.(),be?.(s,l),t){R(),setTimeout(()=>{G(s,a||(()=>{}))},0);return}}else{let s=n,i=s.value,o=s.selectionStart??i.length,c,u;if(t){c="{{"+e+".";let g=o;i.substring(o).startsWith("}}")&&(g+=2),s.value=i.substring(0,S)+c+i.substring(g),u=S+c.length}else{c="{{"+e+"}}";let g=o;i.substring(o).startsWith("}}")&&(g+=2),s.value=i.substring(0,S)+c+i.substring(g),u=S+c.length}if(s.selectionStart=u,s.selectionEnd=u,s.focus(),a?a():me?.(),t){R(),setTimeout(()=>{ve(s,a||(()=>{}))},0);return}}R()}function R(){v&&(v.remove(),v=null),_=null,E=[],x=0,F=null}function Se(e){return!v||E.length===0?!1:e.key==="ArrowDown"?(e.preventDefault(),x=(x+1)%E.length,D(),!0):e.key==="ArrowUp"?(e.preventDefault(),x=(x-1+E.length)%E.length,D(),!0):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),Ee(E[x].name),!0):e.key==="Escape"?(e.preventDefault(),R(),!0):!1}function Te(){return v!==null}var K={},Z={},j=!1,J=new Set,$e=null,we=null;function Re(e){we=e}function X(e){return ne(e,{resolved:K,sources:Z,showResolved:j,secretKeys:J})}function z(e,t){let n=window.getSelection();if(!n)return;let r=document.createRange(),a=0,s=!1;function i(o){if(o.nodeType===Node.TEXT_NODE){let c=(o.textContent||"").length;if(a+c>=t)return r.setStart(o,t-a),r.collapse(!0),!0;a+=c}else for(let c=0;c<o.childNodes.length;c++)if(i(o.childNodes[c]))return!0;return!1}s=i(e),s||(r.selectNodeContents(e),r.collapse(!1)),n.removeAllRanges(),n.addRange(r)}function B(){document.querySelectorAll(".var-cell").forEach(e=>{let t=e.querySelector('input[type="text"]'),n=e.querySelector(".var-overlay");t&&n&&e.classList.contains("var-overlay-active")&&(n.innerHTML=X(h(t.value)))}),document.querySelectorAll(".val-ce").forEach(e=>{let t=e._getRawText;if(t&&document.activeElement!==e){let n=t();n&&(e.innerHTML=X(h(n)))}})}function xe(e,t,n){let r=t||"";e._getRawText=()=>r,e._setRawText=s=>{r=s};function a(){if(!r){e.innerHTML="";return}let s=window.getSelection(),i=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let o=s.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(o.startContainer,o.startOffset),i=c.toString().length}e.innerHTML=X(h(r)),s&&document.activeElement===e&&z(e,i)}a(),e.addEventListener("input",()=>{if(j){j=!1,B(),$e?.();return}let s=window.getSelection(),i=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let o=s.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(o.startContainer,o.startOffset),i=c.toString().length}r=e.textContent||"",a(),z(e,i),n(),G(e,a)}),e.addEventListener("keydown",s=>{Te()&&Se(s)}),e.addEventListener("blur",()=>{R()}),e.addEventListener("click",s=>{let i=s.target.closest(".tk-var, .tk-var-resolved");i&&i.dataset.var&&le(i,i.dataset.var,{getResolvedVariables:()=>K,getVariableSources:()=>Z,getSecretKeys:()=>J,postMessage:we??void 0})})}function Le(e){if(e.type!=="variablesResolved")return!1;K=e.variables||{},Z=e.sources||{},de(e.secretProviderNames||[]);let t=e.secretNames||{},n=new Set;for(let[r,a]of Object.entries(t)){pe(r,a);for(let s of a)n.add(`$secret.${r}.${s}`)}return J=n,B(),!0}var qe=null;document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&qe?.()});function Ce(e){ce(()=>K),he(()=>{B(),e?.extraSyncHighlight?.()},()=>{B(),e?.extraSyncUrlHighlight?.()},z,e?.setRawUrl)}var L=acquireVsCodeApi(),ee=e=>document.getElementById(e);function Me(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var Y="secure:";function Be(){let e=()=>Math.floor(Math.random()*16).toString(16),t=n=>Array.from({length:n},e).join("");return Y+t(8)+"-"+t(4)+"-4"+t(3)+"-"+t(4)+"-"+t(12)}function M(e){if(e&&e.startsWith(Y))return e.slice(Y.length)}var d=[],Q=null;function H(){Q&&clearTimeout(Q),Q=setTimeout(()=>{let e=d.map(t=>{if(t.secret&&t.secure){let{value:n,...r}=t;return r}return t});L.postMessage({type:"updateVariables",variables:e})},300)}function W(){let e=ee("varsBody");e.innerHTML="",d.forEach((t,n)=>We(e,n)),Ke()}function Ke(){let e=document.getElementById("hiddenWarning");if(!e)return;let t=d.some(n=>n.secret===!0&&!n.secure);e.style.display=t?"block":"none"}function We(e,t){let n=d[t],r=document.createElement("tr"),a=n.secret===!0,s=a&&n.secure===!0,i=n.disabled?"":"checked",o=a&&s?"":n.value||"";if(r.innerHTML=`<td><input type="checkbox" ${i} data-field="disabled" /></td><td><input type="text" value="${Me(n.name||"")}" data-field="name" /></td>${a?'<td><div class="secret-value-wrap"><input type="password" value="'+(s?"":Me(o))+'"'+(s?' placeholder="\u2022\u2022\u2022\u2022\u2022\u2022"':"")+' data-field="value" /><button class="secret-toggle" title="Show/hide">&#9673;</button></div></td>':'<td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="value" data-field="value"></div></td>'}<td><select class="type-select select-borderless" data-field="type"><option value="var"${a?"":" selected"}>var</option><option value="hidden"${a&&!s?" selected":""}>hidden</option><option value="secure"${s?" selected":""}>secure</option></select></td><td><button class="row-delete">\xD7</button></td>`,r.querySelectorAll("input[data-field]").forEach(l=>{let p=l.dataset.field;if(l.type==="checkbox")l.addEventListener("change",()=>{d[t].disabled=!l.checked,H()});else if(s&&p==="value"){let y=null;l.addEventListener("input",()=>{y&&clearTimeout(y),y=setTimeout(()=>{let b=M(d[t].value);b&&L.postMessage({type:"storeSecureValue",secureId:b,value:l.value})},500)})}else l.addEventListener("input",()=>{d[t][p]=l.value,H()})}),!a){let l=r.querySelector('.val-ce[data-field="value"]');l&&xe(l,o,()=>{d[t].value=l._getRawText?l._getRawText():l.textContent||"",H()})}let c=r.querySelector(".type-select");c?.addEventListener("change",()=>{let l=c.value;if(l==="hidden")d[t].secret=!0,delete d[t].secure;else if(l==="secure")d[t].secret=!0,d[t].secure=!0,M(d[t].value)||(d[t].value=Be());else{let p=M(d[t].value);p&&L.postMessage({type:"deleteSecureValue",secureId:p}),delete d[t].secret,delete d[t].secure,d[t].value=""}W(),H()}),r.querySelector(".secret-toggle")?.addEventListener("click",()=>{let l=r.querySelector('input[data-field="value"]');l&&(l.type=l.type==="password"?"text":"password")}),r.querySelector(".row-delete")?.addEventListener("click",()=>{let l=M(d[t].value);l&&L.postMessage({type:"deleteSecureValue",secureId:l}),d.splice(t,1),W(),H()});let g=M(n.value);s&&g&&L.postMessage({type:"getSecureStatus",secureId:g}),e.appendChild(r)}window.addEventListener("message",e=>{let t=e.data;if(t.type==="load"&&(d=t.variables||[],W()),t.type==="variablesResolved"&&Le(t),t.type==="secureValueStored"||t.type==="secureStatus"){let n=ee("varsBody").children;for(let r=0;r<n.length;r++)if(r<d.length&&M(d[r].value)===t.secureId){let a=n[r].querySelector('input[data-field="value"]');if(a&&a.type==="password"){let s=t.type==="secureValueStored"||t.hasValue;a.placeholder=s?"\u2022\u2022\u2022\u2022\u2022\u2022 (stored)":"Enter secret value"}}}});Ce();Re(e=>L.postMessage(e));ee("addVarBtn").addEventListener("click",()=>{d.push({name:"",value:""}),W(),H()});L.postMessage({type:"ready"});})();
