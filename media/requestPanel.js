"use strict";(()=>{var E=acquireVsCodeApi(),C=null,He={},Re={},Ce=!1,D=null,ue=!1,U="none",P="json";function Ie(e){C=e}function Oe(e){He=e}function Be(e){Re=e}function pe(e){Ce=e}function I(){return He}function Z(){return Re}function M(){return Ce}function fe(e){D=e}function ee(e){ue=e}function qe(e){U=e}function te(e){P=e}function r(e){return document.getElementById(e)}function v(e){return document.getElementById(e)}function F(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}var bt=/\{\{(\s*[\w.$-]+\s*)\}\}/g,$e=/^[\w.$-]*$/;function p(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Tt=new Set(["$guid","$timestamp","$randomInt"]);function De(e,t){return e.replace(bt,(n,o)=>{let s=o.trim(),a=s in t.resolved,i=Tt.has(s),l=t.sources[s]||(i?"dynamic":"unknown");return t.showResolved&&a?"<span class='"+("tk-var-resolved tk-src-"+l)+"' data-var='"+p(s)+"' title='{{"+p(s)+"}} ("+l+")'>"+p(t.resolved[s])+"</span>":"<span class='"+(a||i?"tk-var tk-src-"+l:"tk-var tk-var-unresolved")+"' data-var='"+p(s)+"'>{{"+p(o)+"}}</span>"})}function Et(e){let t=p(e);return t=t.replace(/(")((?:[^"\\]|\\.)*)(")\s*:/g,"<span class='tk-key'>&quot;$2&quot;</span>:"),t=t.replace(/(")((?:[^"\\]|\\.)*)(")/g,"<span class='tk-str'>&quot;$2&quot;</span>"),t=t.replace(/\b(-?\d+\.?\d*(?:e[+-]?\d+)?)\b/gi,"<span class='tk-num'>$1</span>"),t=t.replace(/\b(true|false|null)\b/g,"<span class='tk-kw'>$1</span>"),t}function Lt(e){let t=p(e);return t=t.replace(/(&lt;\/?)([\w:-]+)/g,"$1<span class='tk-tag'>$2</span>"),t=t.replace(/([\w:-]+)(=)(")((?:[^"]*))(")/g,"<span class='tk-attr'>$1</span>$2<span class='tk-str'>&quot;$4&quot;</span>"),t}function O(e){return De(e,{resolved:I(),sources:Z(),showResolved:M()})}function ne(e,t){let n;return t==="json"?n=Et(e):t==="xml"||t==="html"?n=Lt(e):n=p(e),O(n)}function y(e,t,n,o="text"){let s=`<input type="${o}" id="${e}" placeholder="${t}" />`;return n?`<span class="auth-input-wrap">${s}</span>`:s}function Ue(e,t){let{prefix:n,fieldsContainer:o,onChange:s,wrapInputs:a,showTokenStatus:i}=t;if(o.innerHTML="",e==="bearer")o.innerHTML=`<div class="auth-row"><label>Token</label>${y(n+"Token","{{token}}",a)}</div>`;else if(e==="basic")o.innerHTML=`<div class="auth-row"><label>Username</label>${y(n+"Username","username",a)}</div><div class="auth-row"><label>Password</label>${y(n+"Password","password",a,"password")}</div>`;else if(e==="apikey")o.innerHTML=`<div class="auth-row"><label>Key</label>${y(n+"Key","X-Api-Key",a)}</div><div class="auth-row"><label>Value</label>${y(n+"Value","{{apiKey}}",a)}</div><div class="auth-row"><label>In</label><select id="${n}Placement" class="auth-select"><option value="header">Header</option><option value="query">Query</option></select></div>`;else if(e==="oauth2"){o.innerHTML=`<div class="auth-row"><label>Grant Type</label><select id="${n}OAuth2Flow" class="auth-select"><option value="client_credentials">Client Credentials</option><option value="password">Password</option><option value="authorization_code">Authorization Code</option></select></div><div class="auth-row"><label>Access Token URL</label>${y(n+"OAuth2AccessTokenUrl","{{authUrl}}/token",a)}</div><div class="auth-row"><label>Client ID</label>${y(n+"OAuth2ClientId","{{clientId}}",a)}</div><div class="auth-row"><label>Client Secret</label>${y(n+"OAuth2ClientSecret","{{clientSecret}}",a)}</div><div class="auth-row"><label>Scope</label>${y(n+"OAuth2Scope","openid profile",a)}</div><div id="${n}OAuth2PasswordFields" style="display:none;"><div class="auth-row"><label>Username</label>${y(n+"OAuth2Username","{{username}}",a)}</div><div class="auth-row"><label>Password</label>${y(n+"OAuth2Password","password",a,"password")}</div></div><div id="${n}OAuth2AuthCodeFields" style="display:none;"><div class="auth-row"><label>Auth URL</label>${y(n+"OAuth2AuthorizationUrl","{{authUrl}}/authorize",a)}</div><div class="auth-row"><label>Callback URL</label>${y(n+"OAuth2CallbackUrl","https://localhost/callback",a)}</div></div><div class="auth-row"><label>Refresh URL</label>${y(n+"OAuth2RefreshTokenUrl","(optional)",a)}</div><div class="auth-row"><label>Credentials In</label><select id="${n}OAuth2CredentialsPlacement" class="auth-select"><option value="basic_auth_header">Header</option><option value="body">Body</option></select></div><div class="auth-row"><label>Auto Fetch</label><input type="checkbox" id="${n}OAuth2AutoFetch" checked /></div><div class="auth-row"><label>Auto Refresh</label><input type="checkbox" id="${n}OAuth2AutoRefresh" checked /></div>`+(i?`<div class="oauth2-token-status" id="${n}OAuth2TokenStatus"></div>`:"");let l=document.getElementById(n+"OAuth2Flow"),c=document.getElementById(n+"OAuth2PasswordFields"),d=document.getElementById(n+"OAuth2AuthCodeFields"),u=()=>{let b=l.value;c.style.display=b==="password"?"":"none",d.style.display=b==="authorization_code"?"":"none"};l.addEventListener("change",()=>{u(),s()}),u()}if(o.querySelectorAll("input").forEach(l=>{l.addEventListener("input",s),l.addEventListener("change",s)}),o.querySelectorAll("select").forEach(l=>l.addEventListener("change",s)),t.onFieldsRendered){let l=Array.from(o.querySelectorAll('input[type="text"]'));t.onFieldsRendered(l)}}function Pe(e,t){let n=t,o=a=>document.getElementById(a),s=a=>document.getElementById(a);switch(e){case"bearer":return{type:"bearer",token:o(n+"Token")?.value||""};case"basic":return{type:"basic",username:o(n+"Username")?.value||"",password:o(n+"Password")?.value||""};case"apikey":return{type:"apikey",key:o(n+"Key")?.value||"",value:o(n+"Value")?.value||"",placement:s(n+"Placement")?.value||"header"};case"oauth2":{let a=s(n+"OAuth2Flow")?.value||"client_credentials",i={type:"oauth2",flow:a,accessTokenUrl:o(n+"OAuth2AccessTokenUrl")?.value||"",clientId:o(n+"OAuth2ClientId")?.value||"",clientSecret:o(n+"OAuth2ClientSecret")?.value||"",scope:o(n+"OAuth2Scope")?.value||"",refreshTokenUrl:o(n+"OAuth2RefreshTokenUrl")?.value||"",credentialsPlacement:s(n+"OAuth2CredentialsPlacement")?.value||"basic_auth_header",autoFetchToken:o(n+"OAuth2AutoFetch")?.checked!==!1,autoRefreshToken:o(n+"OAuth2AutoRefresh")?.checked!==!1};return a==="password"?(i.username=o(n+"OAuth2Username")?.value||"",i.password=o(n+"OAuth2Password")?.value||""):a==="authorization_code"&&(i.authorizationUrl=o(n+"OAuth2AuthorizationUrl")?.value||"",i.callbackUrl=o(n+"OAuth2CallbackUrl")?.value||""),i.refreshTokenUrl||delete i.refreshTokenUrl,i.scope||delete i.scope,i.clientSecret||delete i.clientSecret,i}case"inherit":return"inherit";default:return}}function Fe(e,t){let n=t,o=a=>document.getElementById(a),s=a=>document.getElementById(a);if(!(!e||e==="inherit")&&!(typeof e!="object"||!e.type))switch(e.type){case"bearer":{let a=o(n+"Token");a&&(a.value=e.token||"");break}case"basic":{let a=o(n+"Username");a&&(a.value=e.username||"");let i=o(n+"Password");i&&(i.value=e.password||"");break}case"apikey":{let a=o(n+"Key");a&&(a.value=e.key||"");let i=o(n+"Value");i&&(i.value=e.value||"");let l=s(n+"Placement");l&&(l.value=e.placement||"header");break}case"oauth2":{let a=s(n+"OAuth2Flow");a&&(a.value=e.flow||"client_credentials",a.dispatchEvent(new Event("change")));let i=o(n+"OAuth2AccessTokenUrl");i&&(i.value=e.accessTokenUrl||"");let l=o(n+"OAuth2ClientId");l&&(l.value=e.clientId||"");let c=o(n+"OAuth2ClientSecret");c&&(c.value=e.clientSecret||"");let d=o(n+"OAuth2Scope");d&&(d.value=e.scope||"");let u=o(n+"OAuth2RefreshTokenUrl");u&&(u.value=e.refreshTokenUrl||"");let b=s(n+"OAuth2CredentialsPlacement");b&&(b.value=e.credentialsPlacement||"basic_auth_header");let g=o(n+"OAuth2AutoFetch");g&&(g.checked=e.autoFetchToken!==!1);let S=o(n+"OAuth2AutoRefresh");if(S&&(S.checked=e.autoRefreshToken!==!1),e.flow==="password"){let T=o(n+"OAuth2Username");T&&(T.value=e.username||"");let z=o(n+"OAuth2Password");z&&(z.value=e.password||"")}else if(e.flow==="authorization_code"){let T=o(n+"OAuth2AuthorizationUrl");T&&(T.value=e.authorizationUrl||"");let z=o(n+"OAuth2CallbackUrl");z&&(z.value=e.callbackUrl||"")}break}}}var Ve=()=>({});function _e(e){Ve=e}var f=null,L=[],H=0,G=null,x=0,se=!1,he=null,xt=[{name:"$guid",detail:"Generate a random UUID"},{name:"$timestamp",detail:"Current Unix timestamp"},{name:"$randomInt",detail:"Random integer 0\u20131000"}],me=[],Ne=new Map;function Ke(e){me=e}function We(e,t){Ne.set(e,t)}function ze(e,t){let n=e.substring(0,t),o=n.lastIndexOf("{{");if(o===-1)return null;let s=n.substring(o+2);if(s.includes("}}"))return null;let a=s.trim();return $e.test(a)?a:null}function oe(e,t){let n=e.selectionStart??0,o=ze(e.value,n);if(o===null){k();return}G=e,se=!1,x=e.value.lastIndexOf("{{",n-1),je(o,e,t)}function ae(e,t){let n=window.getSelection();if(!n||n.rangeCount===0)return;let o=e.textContent||"",s=n.getRangeAt(0),a=document.createRange();a.selectNodeContents(e),a.setEnd(s.startContainer,s.startOffset);let i=a.toString().length,l=ze(o,i);if(l===null){k();return}G=e,se=!0,x=o.lastIndexOf("{{",i-1),je(l,e,t)}function je(e,t,n){he=n;let o=e.toLowerCase(),s=[],a=Ve();for(let l of Object.keys(a))s.push({name:l,detail:a[l]});for(let l of xt)s.push(l);if(o===""||"$secret".startsWith(o))me.length>0&&s.push({name:"$secret",detail:"Secret provider"});else if(o.startsWith("$secret.")){let l=o.substring(8),c=l.indexOf(".");if(c===-1)for(let d of me)d.toLowerCase().startsWith(l)&&s.push({name:"$secret."+d,detail:"Key Vault provider"});else{let d=l.substring(0,c),u=l.substring(c+1),b=Ne.get(d)||[];for(let g of b)g.toLowerCase().startsWith(u)&&s.push({name:"$secret."+d+"."+g,displayName:g,detail:"Secret"})}}let i=new Set;L=[];for(let l of s)l.name.toLowerCase().startsWith(o)&&!i.has(l.name)&&(i.add(l.name),L.push(l));if(L.length===0){k();return}H=0,f||(f=document.createElement("div"),f.className="var-autocomplete",document.body.appendChild(f)),ve(),wt(t)}function ve(){f&&(f.innerHTML=L.map((e,t)=>"<div class='"+(t===H?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+t+"'><span class='var-ac-name'>"+p(e.displayName||e.name)+"</span><span class='var-ac-value'>"+p(e.detail||"")+"</span></div>").join(""),f.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",t=>{t.preventDefault();let n=parseInt(e.dataset.index||"0");Qe(L[n].name)})}))}function kt(e){let t=document.createElement("div"),n=window.getComputedStyle(e);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","paddingTop","paddingLeft","paddingRight","paddingBottom","borderWidth","boxSizing","whiteSpace","wordWrap","overflowWrap","tabSize"].forEach(d=>{t.style[d]=n.getPropertyValue(d.replace(/[A-Z]/g,u=>"-"+u.toLowerCase()))}),t.style.position="absolute",t.style.visibility="hidden",t.style.whiteSpace="pre-wrap",t.style.wordWrap="break-word",t.style.width=e.clientWidth+"px";let s=e.value.substring(0,e.selectionStart??0);t.textContent=s;let a=document.createElement("span");a.textContent="|",t.appendChild(a),document.body.appendChild(t);let i=a.getBoundingClientRect(),l=e.getBoundingClientRect(),c={top:l.top+(i.top-t.getBoundingClientRect().top)-e.scrollTop,left:l.left+(i.left-t.getBoundingClientRect().left)-e.scrollLeft};return document.body.removeChild(t),c}function wt(e){if(f){if(se){let t=window.getSelection();if(t&&t.rangeCount>0){let o=t.getRangeAt(0).getBoundingClientRect();f.style.left=o.left+"px",f.style.top=o.bottom+4+"px"}else{let n=e.getBoundingClientRect();f.style.left=n.left+"px",f.style.top=n.bottom+2+"px"}}else{let t=kt(e);f.style.left=t.left+"px",f.style.top=t.top+18+"px"}f.style.minWidth="220px"}}var Ge=null,Xe=null,Je=null,j=null;function Ye(e,t,n,o){Ge=e,Xe=t,Je=n,j=o||null}function At(e){return!!(e==="$secret"||e.startsWith("$secret.")&&e.split(".").length===2)}function Qe(e){if(!G)return;let t=At(e),n=G,o=se,s=he;if(o){let a=n,i=a,l=i._getRawText?i._getRawText():a.textContent||"",c=window.getSelection(),d=l.length;if(c&&c.rangeCount>0){let g=c.getRangeAt(0),S=document.createRange();S.selectNodeContents(a),S.setEnd(g.startContainer,g.startOffset),d=S.toString().length}let u,b;if(t){u="{{"+e+".";let g=d;l.substring(d).startsWith("}}")&&(g+=2);let T=l.substring(0,x)+u+l.substring(g);b=x+u.length,i._setRawText?i._setRawText(T):j&&j(T)}else{u="{{"+e+"}}";let g=d;l.substring(d).startsWith("}}")&&(g+=2);let T=l.substring(0,x)+u+l.substring(g);b=x+u.length,i._setRawText?i._setRawText(T):j&&j(T)}if(s?s():Xe?.(),Je?.(a,b),t){k(),setTimeout(()=>{ae(a,s||(()=>{}))},0);return}}else{let a=n,i=a.value,l=a.selectionStart??i.length,c,d;if(t){c="{{"+e+".";let u=l;i.substring(l).startsWith("}}")&&(u+=2),a.value=i.substring(0,x)+c+i.substring(u),d=x+c.length}else{c="{{"+e+"}}";let u=l;i.substring(l).startsWith("}}")&&(u+=2),a.value=i.substring(0,x)+c+i.substring(u),d=x+c.length}if(a.selectionStart=d,a.selectionEnd=d,a.focus(),s?s():Ge?.(),t){k(),setTimeout(()=>{oe(a,s||(()=>{}))},0);return}}k()}function k(){f&&(f.remove(),f=null),G=null,L=[],H=0,he=null}function X(e){return!f||L.length===0?!1:e.key==="ArrowDown"?(e.preventDefault(),H=(H+1)%L.length,ve(),!0):e.key==="ArrowUp"?(e.preventDefault(),H=(H-1+L.length)%L.length,ve(),!0):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),Qe(L[H].name),!0):e.key==="Escape"?(e.preventDefault(),k(),!0):!1}function re(){return f!==null}var St=[{name:"$select",description:"Choose which properties to return"},{name:"$filter",description:"Filter results based on conditions"},{name:"$orderby",description:"Sort results by properties"},{name:"$top",description:"Limit the number of results"},{name:"$skip",description:"Skip a number of results"},{name:"$count",description:"Include total count of results"},{name:"$expand",description:"Include related entities inline"},{name:"$search",description:"Free-text search expression"},{name:"$format",description:"Response format (json, xml, etc.)"},{name:"$compute",description:"Define computed properties"},{name:"$index",description:"Positional insert index"},{name:"$schemaversion",description:"Target a specific schema version"},{name:"$apply",description:"Aggregation and grouping"},{name:"$skiptoken",description:"Server-driven paging token"},{name:"$deltatoken",description:"Delta tracking token"}],h=null,w=[],R=0,V=null;function Mt(e,t){let n=e.substring(0,t),o=n.lastIndexOf("$");if(o===-1||o>0&&/\w/.test(n[o-1]))return null;let s=n.substring(o);return/^\$[\w]*$/.test(s)?s:null}function Ze(e){let t=e.selectionStart??0,n=Mt(e.value,t);if(n===null){_();return}V=e;let o=n.toLowerCase();if(w=St.filter(s=>s.name.toLowerCase().startsWith(o)),w.length===0){_();return}R=0,h||(h=document.createElement("div"),h.className="var-autocomplete",document.body.appendChild(h)),ge(),Ht(e)}function ge(){h&&(h.innerHTML=w.map((e,t)=>"<div class='"+(t===R?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+t+"'><span class='var-ac-name'>"+p(e.name)+"</span><span class='var-ac-value'>"+p(e.description)+"</span></div>").join(""),h.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",t=>{t.preventDefault();let n=parseInt(e.dataset.index||"0");et(w[n].name)})}))}function Ht(e){if(!h)return;let t=e.getBoundingClientRect();h.style.left=t.left+"px",h.style.top=t.bottom+2+"px",h.style.minWidth="280px"}function et(e){V&&(V.value=e,V.focus(),V.dispatchEvent(new Event("input",{bubbles:!0})),_())}function _(){h&&(h.remove(),h=null),V=null,w=[],R=0}function tt(e){return!h||w.length===0?!1:e.key==="ArrowDown"?(e.preventDefault(),R=(R+1)%w.length,ge(),!0):e.key==="ArrowUp"?(e.preventDefault(),R=(R-1+w.length)%w.length,ge(),!0):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),et(w[R].name),!0):e.key==="Escape"?(e.preventDefault(),_(),!0):!1}function nt(){return h!==null}var ye=null,be="";function Te(){return ye}function ot(){return be}function at(e){r("respLoading").style.display="flex",r("respEmpty").style.display="none",r("respBodyWrap").style.display="none",r("responseBar").style.display="none",r("respTabs").style.display="none",e&&Ee(e)}function Ee(e){let t=r("respLoading").querySelector("span");t&&(t.textContent=e)}function Le(){r("respLoading").style.display="none"}function rt(){r("responseBar").style.display="none",r("respTabs").style.display="none",r("respBodyWrap").style.display="none",r("respEmpty").style.display="block",ye=null,be=""}function Rt(){let e=r("respLineNumbers"),n=r("respBodyPre").querySelectorAll(":scope > .code-line"),o=n.length||1,s="";for(let i=1;i<=o;i++)s+="<span>"+i+"</span>";e.innerHTML=s;let a=e.children;for(let i=0;i<a.length;i++){let l=n[i];l&&(a[i].style.height=l.offsetHeight+"px")}}function Ct(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}function st(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function xe(e){Le(),ye=e,r("sendBtn").classList.remove("sending"),r("sendBtn").disabled=!1,r("sendBtn").textContent="Send",r("responseBar").style.display="flex",r("respTabs").style.display="flex",r("respEmpty").style.display="none",r("respBodyWrap").style.display="block";let t=r("statusBadge");t.textContent=e.status+" "+e.statusText;let n=Math.floor(e.status/100);t.className="status-badge s"+n+"xx",r("responseMeta").textContent=e.duration+"ms \u2022 "+Ct(e.size);let o=e.body||"",s="";if(e.headers){for(let c of Object.keys(e.headers))if(c.toLowerCase()==="content-type"){s=e.headers[c];break}}let a="text";if(s.includes("json")){a="json";try{o=JSON.stringify(JSON.parse(o),null,2)}catch{}}else s.includes("xml")?a="xml":s.includes("html")&&(a="html");be=o;let i=o.split(`
`);r("respBodyPre").innerHTML=i.map(c=>'<div class="code-line">'+ne(c,a)+`
</div>`).join(""),Rt();let l=r("respHeadersBody");l.innerHTML="",e.headers&&Object.entries(e.headers).forEach(([c,d])=>{let u=document.createElement("tr");u.innerHTML="<td>"+st(c)+"</td><td>"+st(String(d))+"</td>",l.appendChild(u)})}function m(){D&&clearTimeout(D),fe(setTimeout(()=>{ee(!0);let e=de();E.postMessage({type:"updateDocument",request:e})},300))}var It=["body","auth","headers","params","settings"],Ot=["resp-body","resp-headers"];function ct(e,t,n){e.querySelectorAll(".tab").forEach(s=>s.classList.remove("active"));let o=e.querySelector(`[data-tab="${t}"]`);o&&o.classList.add("active"),n.forEach(s=>{let a=document.getElementById("panel-"+s);a&&a.classList.toggle("active",s===t)})}r("reqTabs").querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{ct(r("reqTabs"),e.dataset.tab,It)})});r("respTabs").querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{ct(r("respTabs"),e.dataset.tab,Ot)})});var ke=r("divider"),lt=r("requestSection"),it=r("responseSection"),Me=!1;ke.addEventListener("mousedown",()=>{Me=!0,ke.classList.add("dragging"),document.body.style.cursor="ns-resize",document.body.style.userSelect="none"});document.addEventListener("mousemove",e=>{if(!Me)return;let n=document.querySelector(".main-content").getBoundingClientRect(),o=e.clientY-n.top,s=n.height,a=Math.max(15,Math.min(85,o/s*100));lt.style.flex="none",lt.style.height=a+"%",it.style.flex="none",it.style.height=100-a+"%"});document.addEventListener("mouseup",()=>{Me=!1,ke.classList.remove("dragging"),document.body.style.cursor="",document.body.style.userSelect=""});var W=r("method");function dt(){W.className="method-select "+W.value.toLowerCase()}W.addEventListener("change",()=>{dt(),m(),E.postMessage({type:"methodChanged",method:W.value})});function ut(e="",t="",n="query",o=!1){let s=r("paramsBody"),a=document.createElement("tr");a.innerHTML='<td><input type="checkbox" class="p-enabled" '+(o?"":"checked")+' /></td><td><input type="text" class="p-name" value="'+F(e)+'" placeholder="name" /></td><td class="val-cell"><div class="val-ce p-value" contenteditable="true" data-placeholder="value"></div></td><td><select class="p-type select-borderless"><option value="query"'+(n==="query"?" selected":"")+'>query</option><option value="path"'+(n==="path"?" selected":"")+'>path</option></select></td><td><button class="row-delete">\xD7</button></td>',a.querySelector(".row-delete").addEventListener("click",()=>{a.remove(),Y(),m()}),a.addEventListener("change",m);let i=a.querySelector(".p-name");J(i),i.addEventListener("input",()=>{Ze(i),m()}),i.addEventListener("keydown",l=>{nt()&&tt(l)}),i.addEventListener("blur",()=>_()),ft(a.querySelector(".p-value"),t),s.appendChild(a),Y()}function pt(e="",t="",n=!1){let o=r("headersBody"),s=document.createElement("tr");s.innerHTML='<td><input type="checkbox" class="h-enabled" '+(n?"":"checked")+' /></td><td><input type="text" class="h-name" value="'+F(e)+'" placeholder="name" /></td><td class="val-cell"><div class="val-ce h-value" contenteditable="true" data-placeholder="value"></div></td><td><button class="row-delete">\xD7</button></td>',s.querySelector(".row-delete").addEventListener("click",()=>{s.remove(),Y(),m()}),s.addEventListener("change",m);let a=s.querySelector(".h-name");J(a),a.addEventListener("input",m),ft(s.querySelector(".h-value"),t),o.appendChild(s),Y()}function ft(e,t){let n=t||"";e._getRawText=()=>n,e._setRawText=s=>{n=s};function o(){if(!n){e.innerHTML="";return}let s=window.getSelection(),a=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let i=s.getRangeAt(0),l=document.createRange();l.selectNodeContents(e),l.setEnd(i.startContainer,i.startOffset),a=l.toString().length}e.innerHTML=O(p(n)),s&&document.activeElement===e&&B(e,a)}o(),e.addEventListener("input",()=>{if(M()){ce(),B(e,n.length);return}let s=window.getSelection(),a=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let i=s.getRangeAt(0),l=document.createRange();l.selectNodeContents(e),l.setEnd(i.startContainer,i.startOffset),a=l.toString().length}n=e.textContent||"",o(),B(e,a),ae(e,o),m()}),e.addEventListener("click",s=>{let a=s.target.closest(".tk-var, .tk-var-resolved");a&&a.dataset.var&&Q(a,a.dataset.var)}),e.addEventListener("keydown",s=>{re()&&X(s)})}function J(e){let t=e.parentElement;t.classList.add("var-cell");let n=document.createElement("div");n.className="var-overlay",t.appendChild(n);function o(){n.innerHTML=O(p(e.value))}function s(){t.classList.add("var-overlay-active"),o()}function a(){t.classList.remove("var-overlay-active")}e.addEventListener("input",()=>{M()&&ce(),o(),oe(e,o)}),e.addEventListener("keydown",i=>{X(i)}),e.addEventListener("focus",a),e.addEventListener("blur",s),n.addEventListener("click",i=>{let l=i.target.closest(".tk-var, .tk-var-resolved");l&&l.dataset.var?Q(l,l.dataset.var):(a(),e.focus())}),document.activeElement!==e&&s()}function ie(){document.querySelectorAll(".var-cell").forEach(e=>{let t=e.querySelector('input[type="text"]'),n=e.querySelector(".var-overlay");t&&n&&e.classList.contains("var-overlay-active")&&(n.innerHTML=O(p(t.value)))}),document.querySelectorAll(".val-ce").forEach(e=>{let t=e._getRawText;if(t&&document.activeElement!==e){let n=t();n&&(e.innerHTML=O(p(n)))}})}function ce(){pe(!1),r("varToggleBtn").classList.remove("active"),A(),$(),ie()}function mt(e="",t="",n=!1){let o=r("bodyFormBody"),s=document.createElement("tr");s.innerHTML='<td><input type="checkbox" class="f-enabled" '+(n?"":"checked")+' /></td><td><input type="text" class="f-name" value="'+F(e)+'" placeholder="name" /></td><td><input type="text" class="f-value" value="'+F(t)+'" placeholder="value" /></td><td><button class="row-delete">\xD7</button></td>',s.querySelector(".row-delete").addEventListener("click",()=>{s.remove(),m()}),s.addEventListener("input",m),s.addEventListener("change",m),J(s.querySelector(".f-name")),J(s.querySelector(".f-value")),o.appendChild(s)}function Y(){let e=document.querySelectorAll("#paramsBody tr"),t=document.querySelectorAll("#headersBody tr");r("paramsBadge").textContent=String(e.length),r("headersBadge").textContent=String(t.length)}function le(e){qe(e),document.querySelectorAll("#bodyTypePills .pill").forEach(s=>{s.classList.toggle("active",s.dataset.bodyType===e)});let t=r("bodyRawEditor"),n=r("bodyFormEditor"),o=r("bodyLangMode");e==="none"?(t.style.display="none",n.style.display="none",o.style.display="none"):e==="form-urlencoded"||e==="multipart-form"?(t.style.display="none",n.style.display="block",o.style.display="none"):(t.style.display="flex",t.style.flexDirection="column",t.style.flex="1",n.style.display="none",o.style.display="block")}document.querySelectorAll("#bodyTypePills .pill").forEach(e=>{e.addEventListener("click",()=>{le(e.dataset.bodyType)})});function vt(){let e=r("bodyData"),t=r("lineNumbers"),o=r("bodyHighlight").querySelectorAll(":scope > .code-line"),s=o.length||1;if(t.children.length!==s){let l="";for(let c=1;c<=s;c++)l+="<span>"+c+"</span>";t.innerHTML=l}let i=t.children;for(let l=0;l<i.length;l++){let c=o[l];c&&(i[l].style.height=c.offsetHeight+"px")}t.style.top=-e.scrollTop+"px"}function A(){try{let e=r("bodyData"),t=r("bodyHighlight"),n=e.value.split(`
`);t.innerHTML=n.map(o=>'<div class="code-line">'+ne(o,P)+`
</div>`).join(""),vt()}catch{}}var K=null;function Q(e,t){we();let n=e.getBoundingClientRect(),o=t in I(),s=document.createElement("div");s.className="var-tooltip";let a=Z()[t]||"unknown",i=a.charAt(0).toUpperCase()+a.slice(1);s.innerHTML="<div class='var-name'>{{"+p(t)+"}}</div>"+(o?"<div class='var-source tk-src-"+a+"'>"+i+"</div><div class='var-value'>"+p(I()[t])+"</div>":"<div class='var-unresolved'>Unresolved variable</div>")+"<div class='var-actions'><button class='var-action-btn' data-action='edit'>Edit Variable</button><button class='var-action-btn' data-action='copy'>"+(o?"Copy Value":"Copy Name")+"</button></div>",s.style.left=n.left+"px",s.style.top=n.bottom+4+"px",document.body.appendChild(s),K=s,s.querySelectorAll(".var-action-btn").forEach(l=>{l.addEventListener("click",()=>{let c=l.dataset.action;if(c==="edit")E.postMessage({type:"editVariable",variableName:t});else if(c==="copy"){let d=o?I()[t]:"{{"+t+"}}";navigator.clipboard.writeText(d).catch(()=>{})}we()})}),setTimeout(()=>{document.addEventListener("click",ht)},0)}function we(){K&&(K.remove(),K=null),document.removeEventListener("click",ht)}function ht(e){K&&!K.contains(e.target)&&we()}r("bodyHighlight").addEventListener("click",e=>{let t=e.target.closest(".tk-var, .tk-var-resolved");t&&t.dataset.var&&Q(t,t.dataset.var)});var q="";function Bt(){return q}function qt(e){q=e,$()}function $(){let e=r("url");if(!q){e.innerHTML="";return}let t=window.getSelection(),n=0;if(t&&t.rangeCount>0&&e.contains(t.anchorNode)){let o=t.getRangeAt(0),s=document.createRange();s.selectNodeContents(e),s.setEnd(o.startContainer,o.startOffset),n=s.toString().length}e.innerHTML=O(p(q)),t&&document.activeElement===e&&B(e,n)}function B(e,t){let n=window.getSelection();if(!n)return;let o=document.createRange(),s=0,a=!1;function i(l){if(l.nodeType===Node.TEXT_NODE){let c=(l.textContent||"").length;if(s+c>=t)return o.setStart(l,t-s),o.collapse(!0),!0;s+=c}else for(let c=0;c<l.childNodes.length;c++)if(i(l.childNodes[c]))return!0;return!1}a=i(e),a||(o.selectNodeContents(e),o.collapse(!1)),n.removeAllRanges(),n.addRange(o)}_e(I);Ye(A,$,B,e=>{q=e});r("url").addEventListener("click",e=>{let t=e.target.closest(".tk-var, .tk-var-resolved");t&&t.dataset.var&&Q(t,t.dataset.var)});r("url").addEventListener("input",()=>{if(M()){ce(),B(r("url"),q.length);return}let e=r("url"),t=window.getSelection(),n=0;if(t&&t.rangeCount>0&&e.contains(t.anchorNode)){let o=t.getRangeAt(0),s=document.createRange();s.selectNodeContents(e),s.setEnd(o.startContainer,o.startOffset),n=s.toString().length}q=e.textContent||"",$(),B(e,n),ae(e,$),m()});function $t(){let e=r("bodyData"),t=r("bodyHighlight");t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft,vt()}r("bodyData").addEventListener("input",()=>{M()&&ce(),A(),oe(r("bodyData"),A),m()});r("bodyData").addEventListener("scroll",$t);r("bodyData").addEventListener("click",e=>{let t=e,n=r("bodyData");n.style.pointerEvents="none";let o=document.elementFromPoint(t.clientX,t.clientY);if(n.style.pointerEvents="",o){let s=o.closest(".tk-var");s&&s.dataset.var&&Q(s,s.dataset.var)}});r("bodyData").addEventListener("keydown",e=>{re()&&X(e)});r("url").addEventListener("keydown",e=>{if(re()){X(e);return}e.key==="Enter"&&e.preventDefault()});r("bodyData").addEventListener("blur",()=>{setTimeout(k,150)});r("url").addEventListener("blur",()=>{setTimeout(k,150)});var Dt={prefix:"auth",get fieldsContainer(){return r("authFields")},onChange:()=>m(),showInherit:!0,wrapInputs:!0,showTokenStatus:!0,onFieldsRendered:e=>e.forEach(J)};function gt(){let e=r("authType").value;Ue(e,Dt)}function Ae(){let e=r("oauth2Flow")?.value||"client_credentials",t={type:"oauth2",flow:e,accessTokenUrl:v("oauth2AccessTokenUrl")?.value||"",clientId:v("oauth2ClientId")?.value||"",clientSecret:v("oauth2ClientSecret")?.value||"",scope:v("oauth2Scope")?.value||"",refreshTokenUrl:v("oauth2RefreshTokenUrl")?.value||"",credentialsPlacement:r("oauth2CredentialsPlacement")?.value||"basic_auth_header",credentialsId:C?.http?.auth?.credentialsId,autoFetchToken:r("oauth2AutoFetch")?.checked!==!1,autoRefreshToken:r("oauth2AutoRefresh")?.checked!==!1};return e==="password"&&(t.username=v("oauth2Username")?.value||"",t.password=v("oauth2Password")?.value||""),t}function Se(){if(r("authType")?.value!=="oauth2")return;let e=Ae();e.accessTokenUrl&&E.postMessage({type:"getTokenStatus",auth:e})}function Ut(e){if(e<=0)return"expired";let t=Math.floor(e/1e3);if(t<60)return`${t}s`;let n=Math.floor(t/60);return n<60?`${n}m ${t%60}s`:`${Math.floor(n/60)}h ${n%60}m`}var N=null;function Pt(e){let t=document.getElementById("oauth2TokenStatus");if(!t)return;if(N&&(clearInterval(N),N=null),!e.hasToken){t.innerHTML='<div class="token-status token-none"><span class="token-dot dot-none"></span> No token<button class="token-btn" id="oauth2GetTokenBtn">Get Token</button></div>',t.querySelector("#oauth2GetTokenBtn")?.addEventListener("click",()=>{let o=Ae();E.postMessage({type:"getToken",auth:o})});return}let n=()=>{let o=Date.now(),s=e.expiresAt?e.expiresAt-o:void 0,a=s!==void 0&&s<=0,i=a?"dot-expired":"dot-valid",l=a?"Expired":s!==void 0?`Expires in ${Ut(s)}`:"Valid (no expiry)",c=e.expiresAt?new Date(e.expiresAt).toLocaleTimeString():"";t.innerHTML='<div class="token-status '+(a?"token-expired":"token-valid")+'"><span class="token-dot '+i+'"></span> '+l+(c?'<span class="token-expiry-time"> ('+c+")</span>":"")+'<button class="token-btn" id="oauth2RefreshTokenBtn">'+(a?"Get Token":"Refresh")+"</button></div>",t.querySelector("#oauth2RefreshTokenBtn")?.addEventListener("click",()=>{let d=Ae();E.postMessage({type:"getToken",auth:d})})};n(),e.expiresAt&&(N=setInterval(()=>{n(),e.expiresAt&&Date.now()>e.expiresAt&&(clearInterval(N),N=null)},1e3))}function Ft(e){let t=document.getElementById("oauth2TokenStatus");if(t&&e){let n=e.startsWith("Error:");t.innerHTML='<div class="token-status '+(n?"token-error":"token-progress")+'">'+(n?'<span class="token-dot dot-expired"></span> ':'<span class="token-spinner"></span> ')+F(e)+"</div>"}}function de(){let e=C?JSON.parse(JSON.stringify(C)):{};e.info||(e.info={type:"http"}),e.http||(e.http={}),e.settings||(e.settings={}),e.http.method=W.value,e.http.url=Bt();let t=[];document.querySelectorAll("#paramsBody tr").forEach(a=>{t.push({name:a.querySelector(".p-name").value,value:a.querySelector(".p-value")._getRawText?a.querySelector(".p-value")._getRawText():a.querySelector(".p-value").textContent||"",type:a.querySelector(".p-type").value,disabled:!a.querySelector(".p-enabled").checked})}),e.http.params=t;let n=[];if(document.querySelectorAll("#headersBody tr").forEach(a=>{n.push({name:a.querySelector(".h-name").value,value:a.querySelector(".h-value")._getRawText?a.querySelector(".h-value")._getRawText():a.querySelector(".h-value").textContent||"",disabled:!a.querySelector(".h-enabled").checked})}),e.http.headers=n,U!=="none")if(U==="form-urlencoded"||U==="multipart-form"){let a=[];document.querySelectorAll("#bodyFormBody tr").forEach(i=>{a.push({name:i.querySelector(".f-name").value,value:i.querySelector(".f-value").value,disabled:!i.querySelector(".f-enabled").checked})}),e.http.body={type:U,data:a}}else e.http.body={type:P,data:r("bodyData").value};else delete e.http.body;let o=r("authType").value,s=Pe(o,"auth");return s!==void 0?e.http.auth=s:delete e.http.auth,e.settings.timeout=parseInt(v("settingTimeout").value)||3e4,e.settings.encodeUrl=v("settingEncodeUrl").checked,e.settings.followRedirects=v("settingFollowRedirects").checked,e.settings.maxRedirects=parseInt(v("settingMaxRedirects").value)||5,e}function yt(){let e=de();r("sendBtn").classList.add("sending"),r("sendBtn").disabled=!0,r("sendBtn").textContent="Sending...",at(),E.postMessage({type:"sendRequest",request:e})}function Vt(){D&&(clearTimeout(D),fe(null)),ee(!0);let e=de();E.postMessage({type:"saveDocument",request:e})}function _t(e){Ie(e),r("exampleIndicator").style.display="none";let t=e.http||{};if(W.value=(t.method||"GET").toUpperCase(),dt(),qt(t.url||""),r("paramsBody").innerHTML="",(t.params||[]).forEach(s=>ut(s.name,s.value,s.type||"query",s.disabled)),r("headersBody").innerHTML="",(t.headers||[]).forEach(s=>pt(s.name,s.value,s.disabled)),t.body){let s=Array.isArray(t.body)?(t.body.find(a=>a.selected)||t.body[0])?.body:t.body;s&&(s.type==="form-urlencoded"||s.type==="multipart-form"?(le(s.type),r("bodyFormBody").innerHTML="",(s.data||[]).forEach(a=>mt(a.name,a.value,a.disabled))):(le("raw"),te(s.type||"json"),r("bodyLangMode").value=P,s.data&&(r("bodyData").value=s.data),A()))}else le("none");let n=t.auth;n==="inherit"?r("authType").value="inherit":n&&n.type?r("authType").value=n.type:r("authType").value="none",gt(),n&&n!=="inherit"&&n.type&&setTimeout(()=>{Fe(n,"auth"),ie(),Se()},0);let o=e.settings||{};v("settingTimeout").value=o.timeout!==void 0&&o.timeout!=="inherit"?o.timeout:"30000",v("settingEncodeUrl").checked=o.encodeUrl!==void 0&&o.encodeUrl!=="inherit"?o.encodeUrl:!0,v("settingFollowRedirects").checked=o.followRedirects!==void 0&&o.followRedirects!=="inherit"?o.followRedirects:!0,v("settingMaxRedirects").value=o.maxRedirects!==void 0&&o.maxRedirects!=="inherit"?o.maxRedirects:"5",Y()}window.addEventListener("message",e=>{let t=e.data;switch(t.type){case"requestLoaded":if(ue){ee(!1);break}_t(t.request);break;case"response":r("exampleIndicator").style.display="none",xe(t.response),Se();break;case"sending":r("sendBtn").classList.add("sending"),r("sendBtn").disabled=!0,r("sendBtn").textContent="Sending...",t.message&&Ee(t.message);break;case"saved":break;case"error":Le(),r("sendBtn").classList.remove("sending"),r("sendBtn").disabled=!1,r("sendBtn").textContent="Send";break;case"languageChanged":te(t.language),r("bodyLangMode").value=P,A();break;case"bodyUpdated":r("bodyData").value=t.content,A();break;case"examplesUpdated":C&&(C.examples=t.examples||[]);break;case"loadExample":{let n=t.example;if(n.response){let s={};if(n.response.headers)for(let a of n.response.headers)s[a.name]=a.value;xe({status:n.response.status,statusText:n.response.statusText,headers:s,body:n.response.body?.data??"",duration:0,size:(n.response.body?.data??"").length})}let o=r("exampleIndicator");o.textContent=t.exampleName||"Example",o.style.display="inline-block";break}case"clearExample":rt(),r("exampleIndicator").style.display="none";break;case"variablesResolved":{Oe(t.variables||{}),Be(t.sources||{}),Ke(t.secretProviderNames||[]);let n=t.secretNames||{};for(let[o,s]of Object.entries(n))We(o,s);A(),$(),ie(),Se();break}case"oauth2TokenStatus":Pt(t.status);break;case"oauth2Progress":Ft(t.message);break}});r("varToggleBtn").addEventListener("click",()=>{let e=!M();pe(e),r("varToggleBtn").classList.toggle("active",e),A(),$(),ie()});r("sendBtn").addEventListener("click",yt);document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="Enter"&&(e.preventDefault(),yt())});r("copyRespBtn").addEventListener("click",()=>{let e=ot();e&&navigator.clipboard.writeText(e).then(()=>{let t=r("copyRespBtn");t.textContent="Copied!",setTimeout(()=>{t.textContent="Copy"},1500)})});r("saveExampleBtn").addEventListener("click",()=>{if(!Te())return;let e=de();E.postMessage({type:"saveExample",request:e,response:Te()})});r("addParamBtn").addEventListener("click",()=>ut());r("addHeaderBtn").addEventListener("click",()=>pt());r("addFormFieldBtn").addEventListener("click",()=>mt());r("authType").addEventListener("change",()=>{gt(),m()});r("panel-auth").addEventListener("input",m);r("panel-auth").addEventListener("change",m);r("panel-settings").addEventListener("input",m);r("panel-settings").addEventListener("change",m);r("bodyLangMode").addEventListener("change",()=>{te(r("bodyLangMode").value),A(),m()});document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&(e.preventDefault(),Vt())});E.postMessage({type:"ready"});})();
