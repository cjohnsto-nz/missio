"use strict";(()=>{var L=acquireVsCodeApi(),$=null,P=null,ye=!1,F="none",_="json";function De(e){$=e}function be(e){P=e}function ie(e){ye=e}function Pe(e){F=e}function ce(e){_=e}function r(e){return document.getElementById(e)}function h(e){return document.getElementById(e)}function K(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}var qt=/\{\{(\s*[\w.$-]+\s*)\}\}/g,Fe=/^[\w.$-]*$/;function v(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var $t=new Set(["$guid","$timestamp","$randomInt"]);function _e(e,t){return e.replace(qt,(n,s)=>{let o=s.trim(),a=o in t.resolved,l=$t.has(o),i=t.secretKeys?.has(o)??!1,c=a||l||i,d=t.sources[o]||(i?"secret":l?"dynamic":"unknown");return t.showResolved&&a?"<span class='"+("tk-var-resolved tk-src-"+d)+"' data-var='"+v(o)+"' title='{{"+v(o)+"}} ("+d+")'>"+v(t.resolved[o])+"</span>":"<span class='"+(c?"tk-var tk-src-"+d:"tk-var tk-var-unresolved")+"' data-var='"+v(o)+"'>{{"+v(s)+"}}</span>"})}var A=null,Te=null;function de(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function Ke(e){A&&!A.contains(e.target)&&ue()}function ue(){A&&(A.remove(),A=null),Te=null,document.removeEventListener("click",Ke)}function Ne(e){if(!A||e.secretRef!==Te)return;let t=A.querySelector(".var-secret-value"),n=A.querySelector('.var-action-btn[data-action="reveal"]');if(e.error){t&&(t.textContent=e.error,t.style.color="#f48771",t.style.fontStyle="normal"),n&&(n.textContent="Reveal Value");return}let s=e.value??"";Z=s,t&&(t.textContent=s,t.style.cssText=""),n&&(n.textContent="Hide Value"),N=!0;let o=A.querySelector('.var-action-btn[data-action="copy"]');o&&(o.textContent="Copy Value",o.dataset.secretValue=s)}var Z=null,N=!1;function V(e,t,n){ue(),Z=null,N=!1;let s=e.getBoundingClientRect(),o=n.getResolvedVariables(),a=n.getVariableSources(),l=n.getSecretKeys?.()??new Set,i=t in o,c=l.has(t),d=a[t]||(c?"secret":"unknown"),u=d.charAt(0).toUpperCase()+d.slice(1),b=i||c,p=document.createElement("div");p.className="var-tooltip";let E;i?E="<div class='var-source tk-src-"+de(d)+"'>"+de(u)+"</div><div class='var-value'>"+de(o[t])+"</div>":c?E="<div class='var-source tk-src-secret'>Secret</div><div class='var-secret-value var-value' style='font-style:italic;opacity:0.7'>Value hidden</div>":E="<div class='var-unresolved'>Unresolved variable</div>";let g=[];n.onEditVariable&&!c&&g.push("<button class='var-action-btn' data-action='edit'>Edit</button>"),c&&!i&&n.postMessage&&g.push("<button class='var-action-btn' data-action='reveal'>Reveal Value</button>"),g.push("<button class='var-action-btn' data-action='copy'>"+(i?"Copy Value":"Copy Name")+"</button>"),p.innerHTML="<div class='var-name'>{{"+de(t)+"}}</div>"+E+"<div class='var-actions'>"+g.join("")+"</div>",p.style.left=s.left+"px",p.style.top=s.bottom+4+"px",document.body.appendChild(p),A=p,p.querySelectorAll(".var-action-btn").forEach(k=>{k.addEventListener("click",Bt=>{Bt.stopPropagation();let he=k.dataset.action;if(he==="edit"&&n.onEditVariable)n.onEditVariable(t),ue();else if(he==="copy"){let Ot=k.dataset.secretValue??(i?o[t]:"{{"+t+"}}");navigator.clipboard.writeText(Ot).catch(()=>{}),ue()}else if(he==="reveal"){let R=p.querySelector(".var-secret-value");Z!==null?(N=!N,R&&(N?(R.textContent=Z,R.style.cssText=""):(R.textContent="\u2022".repeat(Math.min(Z.length,20)),R.style.cssText="")),k.textContent=N?"Hide Value":"Show Value"):(Te=t,R&&(R.textContent="Resolving\u2026",R.style.cssText="font-style:italic;opacity:0.7"),k.textContent="Resolving\u2026",n.postMessage({type:"resolveSecret",secretRef:t}))}})}),setTimeout(()=>{document.addEventListener("click",Ke)},0)}var We=()=>({});function ze(e){We=e}var m=null,w=[],I=0,te=null,M=0,pe=!1,xe=null,Vt=[{name:"$guid",detail:"Generate a random UUID"},{name:"$timestamp",detail:"Current Unix timestamp"},{name:"$randomInt",detail:"Random integer 0\u20131000"}],Ee=[],je=new Map;function Ge(e){Ee=e}function Xe(e,t){je.set(e,t)}function Je(e,t){let n=e.substring(0,t),s=n.lastIndexOf("{{");if(s===-1)return null;let o=n.substring(s+2);if(o.includes("}}"))return null;let a=o.trim();return Fe.test(a)?a:null}function ne(e,t){let n=e.selectionStart??0,s=Je(e.value,n);if(s===null){x();return}te=e,pe=!1,M=e.value.lastIndexOf("{{",n-1),Ye(s,e,t)}function se(e,t){let n=window.getSelection();if(!n||n.rangeCount===0)return;let s=e.textContent||"",o=n.getRangeAt(0),a=document.createRange();a.selectNodeContents(e),a.setEnd(o.startContainer,o.startOffset);let l=a.toString().length,i=Je(s,l);if(i===null){x();return}te=e,pe=!0,M=s.lastIndexOf("{{",l-1),Ye(i,e,t)}function Ye(e,t,n){xe=n;let s=e.toLowerCase(),o=[],a=We();for(let i of Object.keys(a))o.push({name:i,detail:a[i]});for(let i of Vt)o.push(i);if(s===""||"$secret".startsWith(s))Ee.length>0&&o.push({name:"$secret",detail:"Secret provider"});else if(s.startsWith("$secret.")){let i=s.substring(8),c=i.indexOf(".");if(c===-1)for(let d of Ee)d.toLowerCase().startsWith(i)&&o.push({name:"$secret."+d,detail:"Key Vault provider"});else{let d=i.substring(0,c),u=i.substring(c+1),b=je.get(d)||[];for(let p of b)p.toLowerCase().startsWith(u)&&o.push({name:"$secret."+d+"."+p,displayName:p,detail:"Secret"})}}let l=new Set;w=[];for(let i of o)i.name.toLowerCase().startsWith(s)&&!l.has(i.name)&&(l.add(i.name),w.push(i));if(w.length===0){x();return}I=0,m||(m=document.createElement("div"),m.className="var-autocomplete",document.body.appendChild(m)),Le(),Dt(t)}function Le(){m&&(m.innerHTML=w.map((e,t)=>"<div class='"+(t===I?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+t+"'><span class='var-ac-name'>"+v(e.displayName||e.name)+"</span><span class='var-ac-value'>"+v(e.detail||"")+"</span></div>").join(""),m.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",t=>{t.preventDefault();let n=parseInt(e.dataset.index||"0");nt(w[n].name)})}))}function Ut(e){let t=document.createElement("div"),n=window.getComputedStyle(e);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","paddingTop","paddingLeft","paddingRight","paddingBottom","borderWidth","boxSizing","whiteSpace","wordWrap","overflowWrap","tabSize"].forEach(d=>{t.style[d]=n.getPropertyValue(d.replace(/[A-Z]/g,u=>"-"+u.toLowerCase()))}),t.style.position="absolute",t.style.visibility="hidden",t.style.whiteSpace="pre-wrap",t.style.wordWrap="break-word",t.style.width=e.clientWidth+"px";let o=e.value.substring(0,e.selectionStart??0);t.textContent=o;let a=document.createElement("span");a.textContent="|",t.appendChild(a),document.body.appendChild(t);let l=a.getBoundingClientRect(),i=e.getBoundingClientRect(),c={top:i.top+(l.top-t.getBoundingClientRect().top)-e.scrollTop,left:i.left+(l.left-t.getBoundingClientRect().left)-e.scrollLeft};return document.body.removeChild(t),c}function Dt(e){if(m){if(pe){let t=window.getSelection();if(t&&t.rangeCount>0){let s=t.getRangeAt(0).getBoundingClientRect();m.style.left=s.left+"px",m.style.top=s.bottom+4+"px"}else{let n=e.getBoundingClientRect();m.style.left=n.left+"px",m.style.top=n.bottom+2+"px"}}else{let t=Ut(e);m.style.left=t.left+"px",m.style.top=t.top+18+"px"}m.style.minWidth="220px"}}var Qe=null,Ze=null,et=null,ee=null;function tt(e,t,n,s){Qe=e,Ze=t,et=n,ee=s||null}function Pt(e){return!!(e==="$secret"||e.startsWith("$secret.")&&e.split(".").length===2)}function nt(e){if(!te)return;let t=Pt(e),n=te,s=pe,o=xe;if(s){let a=n,l=a,i=l._getRawText?l._getRawText():a.textContent||"",c=window.getSelection(),d=i.length;if(c&&c.rangeCount>0){let p=c.getRangeAt(0),E=document.createRange();E.selectNodeContents(a),E.setEnd(p.startContainer,p.startOffset),d=E.toString().length}let u,b;if(t){u="{{"+e+".";let p=d;i.substring(d).startsWith("}}")&&(p+=2);let g=i.substring(0,M)+u+i.substring(p);b=M+u.length,l._setRawText?l._setRawText(g):ee&&ee(g)}else{u="{{"+e+"}}";let p=d;i.substring(d).startsWith("}}")&&(p+=2);let g=i.substring(0,M)+u+i.substring(p);b=M+u.length,l._setRawText?l._setRawText(g):ee&&ee(g)}if(o?o():Ze?.(),et?.(a,b),t){x(),setTimeout(()=>{se(a,o||(()=>{}))},0);return}}else{let a=n,l=a.value,i=a.selectionStart??l.length,c,d;if(t){c="{{"+e+".";let u=i;l.substring(i).startsWith("}}")&&(u+=2),a.value=l.substring(0,M)+c+l.substring(u),d=M+c.length}else{c="{{"+e+"}}";let u=i;l.substring(i).startsWith("}}")&&(u+=2),a.value=l.substring(0,M)+c+l.substring(u),d=M+c.length}if(a.selectionStart=d,a.selectionEnd=d,a.focus(),o?o():Qe?.(),t){x(),setTimeout(()=>{ne(a,o||(()=>{}))},0);return}}x()}function x(){m&&(m.remove(),m=null),te=null,w=[],I=0,xe=null}function W(e){return!m||w.length===0?!1:e.key==="ArrowDown"?(e.preventDefault(),I=(I+1)%w.length,Le(),!0):e.key==="ArrowUp"?(e.preventDefault(),I=(I-1+w.length)%w.length,Le(),!0):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),nt(w[I].name),!0):e.key==="Escape"?(e.preventDefault(),x(),!0):!1}function z(){return m!==null}var j={},ae={},oe=!1,re=new Set,st=null,ke=null;function ot(e){st=e}function at(e){ke=e}function rt(){return j}function lt(){return ae}function ve(){return oe}function we(e){oe=e}function it(){return re}function C(e){return _e(e,{resolved:j,sources:ae,showResolved:oe,secretKeys:re})}function U(e,t){let n=window.getSelection();if(!n)return;let s=document.createRange(),o=0,a=!1;function l(i){if(i.nodeType===Node.TEXT_NODE){let c=(i.textContent||"").length;if(o+c>=t)return s.setStart(i,t-o),s.collapse(!0),!0;o+=c}else for(let c=0;c<i.childNodes.length;c++)if(l(i.childNodes[c]))return!0;return!1}a=l(e),a||(s.selectNodeContents(e),s.collapse(!1)),n.removeAllRanges(),n.addRange(s)}function B(){document.querySelectorAll(".var-cell").forEach(e=>{let t=e.querySelector('input[type="text"]'),n=e.querySelector(".var-overlay");t&&n&&e.classList.contains("var-overlay-active")&&(n.innerHTML=C(v(t.value)))}),document.querySelectorAll(".val-ce").forEach(e=>{let t=e._getRawText;if(t&&document.activeElement!==e){let n=t();n&&(e.innerHTML=C(v(n)))}})}function G(e){let t=e.parentElement;t.classList.add("var-cell");let n=document.createElement("div");n.className="var-overlay",t.appendChild(n);function s(){n.innerHTML=C(v(e.value))}function o(){t.classList.add("var-overlay-active"),s()}function a(){t.classList.remove("var-overlay-active")}e.addEventListener("input",()=>{s(),ne(e,s)}),e.addEventListener("focus",a),e.addEventListener("blur",()=>{o(),x()}),e.addEventListener("keydown",l=>{z()&&W(l)}),n.addEventListener("click",l=>{let i=l.target.closest(".tk-var, .tk-var-resolved");i&&i.dataset.var?V(i,i.dataset.var,{getResolvedVariables:()=>j,getVariableSources:()=>ae,getSecretKeys:()=>re,postMessage:ke??void 0}):(a(),e.focus())}),document.activeElement!==e&&o()}function Se(e,t,n){let s=t||"";e._getRawText=()=>s,e._setRawText=a=>{s=a};function o(){if(!s){e.innerHTML="";return}let a=window.getSelection(),l=0;if(a&&a.rangeCount>0&&e.contains(a.anchorNode)){let i=a.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(i.startContainer,i.startOffset),l=c.toString().length}e.innerHTML=C(v(s)),a&&document.activeElement===e&&U(e,l)}o(),e.addEventListener("input",()=>{if(oe){oe=!1,B(),st?.();return}let a=window.getSelection(),l=0;if(a&&a.rangeCount>0&&e.contains(a.anchorNode)){let i=a.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(i.startContainer,i.startOffset),l=c.toString().length}s=e.textContent||"",o(),U(e,l),n(),se(e,o)}),e.addEventListener("keydown",a=>{z()&&W(a)}),e.addEventListener("blur",()=>{x()}),e.addEventListener("click",a=>{let l=a.target.closest(".tk-var, .tk-var-resolved");l&&l.dataset.var&&V(l,l.dataset.var,{getResolvedVariables:()=>j,getVariableSources:()=>ae,getSecretKeys:()=>re,postMessage:ke??void 0})})}function ct(e){if(e.type!=="variablesResolved")return!1;j=e.variables||{},ae=e.sources||{},Ge(e.secretProviderNames||[]);let t=e.secretNames||{},n=new Set;for(let[s,o]of Object.entries(t)){Xe(s,o);for(let a of o)n.add(`$secret.${s}.${a}`)}return re=n,B(),!0}var Ft=null;document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&Ft?.()});function dt(e){ze(()=>j),tt(()=>{B(),e?.extraSyncHighlight?.()},()=>{B(),e?.extraSyncUrlHighlight?.()},U,e?.setRawUrl)}function _t(e){let t=v(e);return t=t.replace(/(")((?:[^"\\]|\\.)*)(")\s*:/g,"<span class='tk-key'>&quot;$2&quot;</span>:"),t=t.replace(/(")((?:[^"\\]|\\.)*)(")/g,"<span class='tk-str'>&quot;$2&quot;</span>"),t=t.replace(/\b(-?\d+\.?\d*(?:e[+-]?\d+)?)\b/gi,"<span class='tk-num'>$1</span>"),t=t.replace(/\b(true|false|null)\b/g,"<span class='tk-kw'>$1</span>"),t}function Kt(e){let t=v(e);return t=t.replace(/(&lt;\/?)([\w:-]+)/g,"$1<span class='tk-tag'>$2</span>"),t=t.replace(/([\w:-]+)(=)(")((?:[^"]*))(")/g,"<span class='tk-attr'>$1</span>$2<span class='tk-str'>&quot;$4&quot;</span>"),t}function fe(e,t){let n;return t==="json"?n=_t(e):t==="xml"||t==="html"?n=Kt(e):n=v(e),C(n)}function T(e,t,n,s="text"){let o=`<input type="${s}" id="${e}" placeholder="${t}" />`;return n?`<span class="auth-input-wrap">${o}</span>`:o}function ut(e,t){let{prefix:n,fieldsContainer:s,onChange:o,wrapInputs:a,showTokenStatus:l}=t;if(s.innerHTML="",e==="bearer")s.innerHTML=`<div class="auth-row"><label>Token</label>${T(n+"Token","{{token}}",a)}</div>`;else if(e==="basic")s.innerHTML=`<div class="auth-row"><label>Username</label>${T(n+"Username","username",a)}</div><div class="auth-row"><label>Password</label>${T(n+"Password","password",a,"password")}</div>`;else if(e==="apikey")s.innerHTML=`<div class="auth-row"><label>Key</label>${T(n+"Key","X-Api-Key",a)}</div><div class="auth-row"><label>Value</label>${T(n+"Value","{{apiKey}}",a)}</div><div class="auth-row"><label>In</label><select id="${n}Placement" class="auth-select"><option value="header">Header</option><option value="query">Query</option></select></div>`;else if(e==="oauth2"){s.innerHTML=`<div class="auth-row"><label>Grant Type</label><select id="${n}OAuth2Flow" class="auth-select"><option value="client_credentials">Client Credentials</option><option value="password">Password</option><option value="authorization_code">Authorization Code</option></select></div><div class="auth-row"><label>Access Token URL</label>${T(n+"OAuth2AccessTokenUrl","{{authUrl}}/token",a)}</div><div class="auth-row"><label>Client ID</label>${T(n+"OAuth2ClientId","{{clientId}}",a)}</div><div class="auth-row"><label>Client Secret</label>${T(n+"OAuth2ClientSecret","{{clientSecret}}",a)}</div><div class="auth-row"><label>Scope</label>${T(n+"OAuth2Scope","openid profile",a)}</div><div id="${n}OAuth2PasswordFields" style="display:none;"><div class="auth-row"><label>Username</label>${T(n+"OAuth2Username","{{username}}",a)}</div><div class="auth-row"><label>Password</label>${T(n+"OAuth2Password","password",a,"password")}</div></div><div id="${n}OAuth2AuthCodeFields" style="display:none;"><div class="auth-row"><label>Auth URL</label>${T(n+"OAuth2AuthorizationUrl","{{authUrl}}/authorize",a)}</div><div class="auth-row"><label>Callback URL</label>${T(n+"OAuth2CallbackUrl","https://localhost/callback",a)}</div></div><div class="auth-row"><label>Refresh URL</label>${T(n+"OAuth2RefreshTokenUrl","(optional)",a)}</div><div class="auth-row"><label>Credentials In</label><select id="${n}OAuth2CredentialsPlacement" class="auth-select"><option value="basic_auth_header">Header</option><option value="body">Body</option></select></div><div class="auth-row"><label>Auto Fetch</label><input type="checkbox" id="${n}OAuth2AutoFetch" checked /></div><div class="auth-row"><label>Auto Refresh</label><input type="checkbox" id="${n}OAuth2AutoRefresh" checked /></div>`+(l?`<div class="oauth2-token-status" id="${n}OAuth2TokenStatus"></div>`:"");let i=document.getElementById(n+"OAuth2Flow"),c=document.getElementById(n+"OAuth2PasswordFields"),d=document.getElementById(n+"OAuth2AuthCodeFields"),u=()=>{let b=i.value;c.style.display=b==="password"?"":"none",d.style.display=b==="authorization_code"?"":"none"};i.addEventListener("change",()=>{u(),o()}),u()}if(s.querySelectorAll("input").forEach(i=>{i.addEventListener("input",o),i.addEventListener("change",o)}),s.querySelectorAll("select").forEach(i=>i.addEventListener("change",o)),t.onFieldsRendered){let i=Array.from(s.querySelectorAll('input[type="text"]'));t.onFieldsRendered(i)}}function pt(e,t){let n=t,s=a=>document.getElementById(a),o=a=>document.getElementById(a);switch(e){case"bearer":return{type:"bearer",token:s(n+"Token")?.value||""};case"basic":return{type:"basic",username:s(n+"Username")?.value||"",password:s(n+"Password")?.value||""};case"apikey":return{type:"apikey",key:s(n+"Key")?.value||"",value:s(n+"Value")?.value||"",placement:o(n+"Placement")?.value||"header"};case"oauth2":{let a=o(n+"OAuth2Flow")?.value||"client_credentials",l={type:"oauth2",flow:a,accessTokenUrl:s(n+"OAuth2AccessTokenUrl")?.value||"",clientId:s(n+"OAuth2ClientId")?.value||"",clientSecret:s(n+"OAuth2ClientSecret")?.value||"",scope:s(n+"OAuth2Scope")?.value||"",refreshTokenUrl:s(n+"OAuth2RefreshTokenUrl")?.value||"",credentialsPlacement:o(n+"OAuth2CredentialsPlacement")?.value||"basic_auth_header",autoFetchToken:s(n+"OAuth2AutoFetch")?.checked!==!1,autoRefreshToken:s(n+"OAuth2AutoRefresh")?.checked!==!1};return a==="password"?(l.username=s(n+"OAuth2Username")?.value||"",l.password=s(n+"OAuth2Password")?.value||""):a==="authorization_code"&&(l.authorizationUrl=s(n+"OAuth2AuthorizationUrl")?.value||"",l.callbackUrl=s(n+"OAuth2CallbackUrl")?.value||""),l.refreshTokenUrl||delete l.refreshTokenUrl,l.scope||delete l.scope,l.clientSecret||delete l.clientSecret,l}case"inherit":return"inherit";default:return}}function vt(e,t){let n=t,s=a=>document.getElementById(a),o=a=>document.getElementById(a);if(!(!e||e==="inherit")&&!(typeof e!="object"||!e.type))switch(e.type){case"bearer":{let a=s(n+"Token");a&&(a.value=e.token||"");break}case"basic":{let a=s(n+"Username");a&&(a.value=e.username||"");let l=s(n+"Password");l&&(l.value=e.password||"");break}case"apikey":{let a=s(n+"Key");a&&(a.value=e.key||"");let l=s(n+"Value");l&&(l.value=e.value||"");let i=o(n+"Placement");i&&(i.value=e.placement||"header");break}case"oauth2":{let a=o(n+"OAuth2Flow");a&&(a.value=e.flow||"client_credentials",a.dispatchEvent(new Event("change")));let l=s(n+"OAuth2AccessTokenUrl");l&&(l.value=e.accessTokenUrl||"");let i=s(n+"OAuth2ClientId");i&&(i.value=e.clientId||"");let c=s(n+"OAuth2ClientSecret");c&&(c.value=e.clientSecret||"");let d=s(n+"OAuth2Scope");d&&(d.value=e.scope||"");let u=s(n+"OAuth2RefreshTokenUrl");u&&(u.value=e.refreshTokenUrl||"");let b=o(n+"OAuth2CredentialsPlacement");b&&(b.value=e.credentialsPlacement||"basic_auth_header");let p=s(n+"OAuth2AutoFetch");p&&(p.checked=e.autoFetchToken!==!1);let E=s(n+"OAuth2AutoRefresh");if(E&&(E.checked=e.autoRefreshToken!==!1),e.flow==="password"){let g=s(n+"OAuth2Username");g&&(g.value=e.username||"");let k=s(n+"OAuth2Password");k&&(k.value=e.password||"")}else if(e.flow==="authorization_code"){let g=s(n+"OAuth2AuthorizationUrl");g&&(g.value=e.authorizationUrl||"");let k=s(n+"OAuth2CallbackUrl");k&&(k.value=e.callbackUrl||"")}break}}}var Nt=[{name:"$select",description:"Choose which properties to return"},{name:"$filter",description:"Filter results based on conditions"},{name:"$orderby",description:"Sort results by properties"},{name:"$top",description:"Limit the number of results"},{name:"$skip",description:"Skip a number of results"},{name:"$count",description:"Include total count of results"},{name:"$expand",description:"Include related entities inline"},{name:"$search",description:"Free-text search expression"},{name:"$format",description:"Response format (json, xml, etc.)"},{name:"$compute",description:"Define computed properties"},{name:"$index",description:"Positional insert index"},{name:"$schemaversion",description:"Target a specific schema version"},{name:"$apply",description:"Aggregation and grouping"},{name:"$skiptoken",description:"Server-driven paging token"},{name:"$deltatoken",description:"Delta tracking token"}],y=null,H=[],O=0,X=null;function Wt(e,t){let n=e.substring(0,t),s=n.lastIndexOf("$");if(s===-1||s>0&&/\w/.test(n[s-1]))return null;let o=n.substring(s);return/^\$[\w]*$/.test(o)?o:null}function ft(e){let t=e.selectionStart??0,n=Wt(e.value,t);if(n===null){J();return}X=e;let s=n.toLowerCase();if(H=Nt.filter(o=>o.name.toLowerCase().startsWith(s)),H.length===0){J();return}O=0,y||(y=document.createElement("div"),y.className="var-autocomplete",document.body.appendChild(y)),Ae(),zt(e)}function Ae(){y&&(y.innerHTML=H.map((e,t)=>"<div class='"+(t===O?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+t+"'><span class='var-ac-name'>"+v(e.name)+"</span><span class='var-ac-value'>"+v(e.description)+"</span></div>").join(""),y.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",t=>{t.preventDefault();let n=parseInt(e.dataset.index||"0");mt(H[n].name)})}))}function zt(e){if(!y)return;let t=e.getBoundingClientRect();y.style.left=t.left+"px",y.style.top=t.bottom+2+"px",y.style.minWidth="280px"}function mt(e){X&&(X.value=e,X.focus(),X.dispatchEvent(new Event("input",{bubbles:!0})),J())}function J(){y&&(y.remove(),y=null),X=null,H=[],O=0}function gt(e){return!y||H.length===0?!1:e.key==="ArrowDown"?(e.preventDefault(),O=(O+1)%H.length,Ae(),!0):e.key==="ArrowUp"?(e.preventDefault(),O=(O-1+H.length)%H.length,Ae(),!0):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),mt(H[O].name),!0):e.key==="Escape"?(e.preventDefault(),J(),!0):!1}function ht(){return y!==null}var Me=null,He="";function Re(){return Me}function bt(){return He}function Tt(e){r("respLoading").style.display="flex",r("respEmpty").style.display="none",r("respBodyWrap").style.display="none",r("responseBar").style.display="none",r("respTabs").style.display="none",e&&Ce(e)}function Ce(e){let t=r("respLoading").querySelector("span");t&&(t.textContent=e)}function Ie(){r("respLoading").style.display="none"}function Et(){r("responseBar").style.display="none",r("respTabs").style.display="none",r("respBodyWrap").style.display="none",r("respEmpty").style.display="block",Me=null,He=""}function jt(){let e=r("respLineNumbers"),n=r("respBodyPre").querySelectorAll(":scope > .code-line"),s=n.length||1,o="";for(let l=1;l<=s;l++)o+="<span>"+l+"</span>";e.innerHTML=o;let a=e.children;for(let l=0;l<a.length;l++){let i=n[l];i&&(a[l].style.height=i.offsetHeight+"px")}}function Gt(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}function yt(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function Be(e){Ie(),Me=e,r("sendBtn").classList.remove("sending"),r("sendBtn").disabled=!1,r("sendBtn").textContent="Send",r("responseBar").style.display="flex",r("respTabs").style.display="flex",r("respEmpty").style.display="none",r("respBodyWrap").style.display="block";let t=r("statusBadge");t.textContent=e.status+" "+e.statusText;let n=Math.floor(e.status/100);t.className="status-badge s"+n+"xx",r("responseMeta").textContent=e.duration+"ms \u2022 "+Gt(e.size);let s=e.body||"",o="";if(e.headers){for(let c of Object.keys(e.headers))if(c.toLowerCase()==="content-type"){o=e.headers[c];break}}let a="text";if(o.includes("json")){a="json";try{s=JSON.stringify(JSON.parse(s),null,2)}catch{}}else o.includes("xml")?a="xml":o.includes("html")&&(a="html");He=s;let l=s.split(`
`);r("respBodyPre").innerHTML=l.map(c=>'<div class="code-line">'+fe(c,a)+`
</div>`).join(""),jt();let i=r("respHeadersBody");i.innerHTML="",e.headers&&Object.entries(e.headers).forEach(([c,d])=>{let u=document.createElement("tr");u.innerHTML="<td>"+yt(c)+"</td><td>"+yt(String(d))+"</td>",i.appendChild(u)})}function f(){P&&clearTimeout(P),be(setTimeout(()=>{ie(!0);let e=ge();L.postMessage({type:"updateDocument",request:e})},300))}var Xt=["body","auth","headers","params","settings"],Jt=["resp-body","resp-headers"];function kt(e,t,n){e.querySelectorAll(".tab").forEach(o=>o.classList.remove("active"));let s=e.querySelector(`[data-tab="${t}"]`);s&&s.classList.add("active"),n.forEach(o=>{let a=document.getElementById("panel-"+o);a&&a.classList.toggle("active",o===t)})}r("reqTabs").querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{kt(r("reqTabs"),e.dataset.tab,Xt)})});r("respTabs").querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{kt(r("respTabs"),e.dataset.tab,Jt)})});var Oe=r("divider"),Lt=r("requestSection"),xt=r("responseSection"),Ve=!1;Oe.addEventListener("mousedown",()=>{Ve=!0,Oe.classList.add("dragging"),document.body.style.cursor="ns-resize",document.body.style.userSelect="none"});document.addEventListener("mousemove",e=>{if(!Ve)return;let n=document.querySelector(".main-content").getBoundingClientRect(),s=e.clientY-n.top,o=n.height,a=Math.max(15,Math.min(85,s/o*100));Lt.style.flex="none",Lt.style.height=a+"%",xt.style.flex="none",xt.style.height=100-a+"%"});document.addEventListener("mouseup",()=>{Ve=!1,Oe.classList.remove("dragging"),document.body.style.cursor="",document.body.style.userSelect=""});var Q=r("method");function wt(){Q.className="method-select "+Q.value.toLowerCase()}Q.addEventListener("change",()=>{wt(),f(),L.postMessage({type:"methodChanged",method:Q.value})});function St(e="",t="",n="query",s=!1){let o=r("paramsBody"),a=document.createElement("tr");a.innerHTML='<td><input type="checkbox" class="p-enabled" '+(s?"":"checked")+' /></td><td><input type="text" class="p-name" value="'+K(e)+'" placeholder="name" /></td><td class="val-cell"><div class="val-ce p-value" contenteditable="true" data-placeholder="value"></div></td><td><select class="p-type select-borderless"><option value="query"'+(n==="query"?" selected":"")+'>query</option><option value="path"'+(n==="path"?" selected":"")+'>path</option></select></td><td><button class="row-delete">\xD7</button></td>',a.querySelector(".row-delete").addEventListener("click",()=>{a.remove(),le(),f()}),a.addEventListener("change",f);let l=a.querySelector(".p-name");G(l),l.addEventListener("input",()=>{ft(l),f()}),l.addEventListener("keydown",i=>{ht()&&gt(i)}),l.addEventListener("blur",()=>J()),Se(a.querySelector(".p-value"),t,f),o.appendChild(a),le()}function At(e="",t="",n=!1){let s=r("headersBody"),o=document.createElement("tr");o.innerHTML='<td><input type="checkbox" class="h-enabled" '+(n?"":"checked")+' /></td><td><input type="text" class="h-name" value="'+K(e)+'" placeholder="name" /></td><td class="val-cell"><div class="val-ce h-value" contenteditable="true" data-placeholder="value"></div></td><td><button class="row-delete">\xD7</button></td>',o.querySelector(".row-delete").addEventListener("click",()=>{o.remove(),le(),f()}),o.addEventListener("change",f);let a=o.querySelector(".h-name");G(a),a.addEventListener("input",f),Se(o.querySelector(".h-value"),t,f),s.appendChild(o),le()}function Mt(){we(!1),r("varToggleBtn").classList.remove("active"),S(),q(),B()}function Ht(e="",t="",n=!1){let s=r("bodyFormBody"),o=document.createElement("tr");o.innerHTML='<td><input type="checkbox" class="f-enabled" '+(n?"":"checked")+' /></td><td><input type="text" class="f-name" value="'+K(e)+'" placeholder="name" /></td><td><input type="text" class="f-value" value="'+K(t)+'" placeholder="value" /></td><td><button class="row-delete">\xD7</button></td>',o.querySelector(".row-delete").addEventListener("click",()=>{o.remove(),f()}),o.addEventListener("input",f),o.addEventListener("change",f),G(o.querySelector(".f-name")),G(o.querySelector(".f-value")),s.appendChild(o)}function le(){let e=document.querySelectorAll("#paramsBody tr"),t=document.querySelectorAll("#headersBody tr");r("paramsBadge").textContent=String(e.length),r("headersBadge").textContent=String(t.length)}function me(e){Pe(e),document.querySelectorAll("#bodyTypePills .pill").forEach(o=>{o.classList.toggle("active",o.dataset.bodyType===e)});let t=r("bodyRawEditor"),n=r("bodyFormEditor"),s=r("bodyLangMode");e==="none"?(t.style.display="none",n.style.display="none",s.style.display="none"):e==="form-urlencoded"||e==="multipart-form"?(t.style.display="none",n.style.display="block",s.style.display="none"):(t.style.display="flex",t.style.flexDirection="column",t.style.flex="1",n.style.display="none",s.style.display="block")}document.querySelectorAll("#bodyTypePills .pill").forEach(e=>{e.addEventListener("click",()=>{me(e.dataset.bodyType)})});function Rt(){let e=r("bodyData"),t=r("lineNumbers"),s=r("bodyHighlight").querySelectorAll(":scope > .code-line"),o=s.length||1;if(t.children.length!==o){let i="";for(let c=1;c<=o;c++)i+="<span>"+c+"</span>";t.innerHTML=i}let l=t.children;for(let i=0;i<l.length;i++){let c=s[i];c&&(l[i].style.height=c.offsetHeight+"px")}t.style.top=-e.scrollTop+"px"}function S(){try{let e=r("bodyData"),t=r("bodyHighlight"),n=e.value.split(`
`);t.innerHTML=n.map(s=>'<div class="code-line">'+fe(s,_)+`
</div>`).join(""),Rt()}catch{}}function Ue(){return{getResolvedVariables:rt,getVariableSources:lt,getSecretKeys:it,postMessage:e=>L.postMessage(e),onEditVariable:e=>L.postMessage({type:"editVariable",variableName:e})}}r("bodyHighlight").addEventListener("click",e=>{let t=e.target.closest(".tk-var, .tk-var-resolved");t&&t.dataset.var&&V(t,t.dataset.var,Ue())});var D="";function Yt(){return D}function Qt(e){D=e,q()}function q(){let e=r("url");if(!D){e.innerHTML="";return}let t=window.getSelection(),n=0;if(t&&t.rangeCount>0&&e.contains(t.anchorNode)){let s=t.getRangeAt(0),o=document.createRange();o.selectNodeContents(e),o.setEnd(s.startContainer,s.startOffset),n=o.toString().length}e.innerHTML=C(v(D)),t&&document.activeElement===e&&U(e,n)}dt({extraSyncHighlight:S,extraSyncUrlHighlight:q,setRawUrl:e=>{D=e}});at(e=>L.postMessage(e));ot(()=>{r("varToggleBtn").classList.remove("active"),S(),q()});r("url").addEventListener("click",e=>{let t=e.target.closest(".tk-var, .tk-var-resolved");t&&t.dataset.var&&V(t,t.dataset.var,Ue())});r("url").addEventListener("input",()=>{if(ve()){Mt(),U(r("url"),D.length);return}let e=r("url"),t=window.getSelection(),n=0;if(t&&t.rangeCount>0&&e.contains(t.anchorNode)){let s=t.getRangeAt(0),o=document.createRange();o.selectNodeContents(e),o.setEnd(s.startContainer,s.startOffset),n=o.toString().length}D=e.textContent||"",q(),U(e,n),se(e,q),f()});function Zt(){let e=r("bodyData"),t=r("bodyHighlight");t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft,Rt()}r("bodyData").addEventListener("input",()=>{ve()&&Mt(),S(),ne(r("bodyData"),S),f()});r("bodyData").addEventListener("scroll",Zt);r("bodyData").addEventListener("click",e=>{let t=e,n=r("bodyData");n.style.pointerEvents="none";let s=document.elementFromPoint(t.clientX,t.clientY);if(n.style.pointerEvents="",s){let o=s.closest(".tk-var");o&&o.dataset.var&&V(o,o.dataset.var,Ue())}});r("bodyData").addEventListener("keydown",e=>{z()&&W(e)});r("url").addEventListener("keydown",e=>{if(z()){W(e);return}e.key==="Enter"&&e.preventDefault()});r("bodyData").addEventListener("blur",()=>{setTimeout(x,150)});r("url").addEventListener("blur",()=>{setTimeout(x,150)});var en={prefix:"auth",get fieldsContainer(){return r("authFields")},onChange:()=>f(),showInherit:!0,wrapInputs:!0,showTokenStatus:!0,onFieldsRendered:e=>e.forEach(G)};function Ct(){let e=r("authType").value;ut(e,en)}function qe(){let e=r("oauth2Flow")?.value||"client_credentials",t={type:"oauth2",flow:e,accessTokenUrl:h("oauth2AccessTokenUrl")?.value||"",clientId:h("oauth2ClientId")?.value||"",clientSecret:h("oauth2ClientSecret")?.value||"",scope:h("oauth2Scope")?.value||"",refreshTokenUrl:h("oauth2RefreshTokenUrl")?.value||"",credentialsPlacement:r("oauth2CredentialsPlacement")?.value||"basic_auth_header",credentialsId:$?.http?.auth?.credentialsId,autoFetchToken:r("oauth2AutoFetch")?.checked!==!1,autoRefreshToken:r("oauth2AutoRefresh")?.checked!==!1};return e==="password"&&(t.username=h("oauth2Username")?.value||"",t.password=h("oauth2Password")?.value||""),t}function $e(){if(r("authType")?.value!=="oauth2")return;let e=qe();e.accessTokenUrl&&L.postMessage({type:"getTokenStatus",auth:e})}function tn(e){if(e<=0)return"expired";let t=Math.floor(e/1e3);if(t<60)return`${t}s`;let n=Math.floor(t/60);return n<60?`${n}m ${t%60}s`:`${Math.floor(n/60)}h ${n%60}m`}var Y=null;function nn(e){let t=document.getElementById("oauth2TokenStatus");if(!t)return;if(Y&&(clearInterval(Y),Y=null),!e.hasToken){t.innerHTML='<div class="token-status token-none"><span class="token-dot dot-none"></span> No token<button class="token-btn" id="oauth2GetTokenBtn">Get Token</button></div>',t.querySelector("#oauth2GetTokenBtn")?.addEventListener("click",()=>{let s=qe();L.postMessage({type:"getToken",auth:s})});return}let n=()=>{let s=Date.now(),o=e.expiresAt?e.expiresAt-s:void 0,a=o!==void 0&&o<=0,l=a?"dot-expired":"dot-valid",i=a?"Expired":o!==void 0?`Expires in ${tn(o)}`:"Valid (no expiry)",c=e.expiresAt?new Date(e.expiresAt).toLocaleTimeString():"";t.innerHTML='<div class="token-status '+(a?"token-expired":"token-valid")+'"><span class="token-dot '+l+'"></span> '+i+(c?'<span class="token-expiry-time"> ('+c+")</span>":"")+'<button class="token-btn" id="oauth2RefreshTokenBtn">'+(a?"Get Token":"Refresh")+"</button></div>",t.querySelector("#oauth2RefreshTokenBtn")?.addEventListener("click",()=>{let d=qe();L.postMessage({type:"getToken",auth:d})})};n(),e.expiresAt&&(Y=setInterval(()=>{n(),e.expiresAt&&Date.now()>e.expiresAt&&(clearInterval(Y),Y=null)},1e3))}function sn(e){let t=document.getElementById("oauth2TokenStatus");if(t&&e){let n=e.startsWith("Error:");t.innerHTML='<div class="token-status '+(n?"token-error":"token-progress")+'">'+(n?'<span class="token-dot dot-expired"></span> ':'<span class="token-spinner"></span> ')+K(e)+"</div>"}}function ge(){let e=$?JSON.parse(JSON.stringify($)):{};e.info||(e.info={type:"http"}),e.http||(e.http={}),e.settings||(e.settings={}),e.http.method=Q.value,e.http.url=Yt();let t=[];document.querySelectorAll("#paramsBody tr").forEach(a=>{t.push({name:a.querySelector(".p-name").value,value:a.querySelector(".p-value")._getRawText?a.querySelector(".p-value")._getRawText():a.querySelector(".p-value").textContent||"",type:a.querySelector(".p-type").value,disabled:!a.querySelector(".p-enabled").checked})}),e.http.params=t;let n=[];if(document.querySelectorAll("#headersBody tr").forEach(a=>{n.push({name:a.querySelector(".h-name").value,value:a.querySelector(".h-value")._getRawText?a.querySelector(".h-value")._getRawText():a.querySelector(".h-value").textContent||"",disabled:!a.querySelector(".h-enabled").checked})}),e.http.headers=n,F!=="none")if(F==="form-urlencoded"||F==="multipart-form"){let a=[];document.querySelectorAll("#bodyFormBody tr").forEach(l=>{a.push({name:l.querySelector(".f-name").value,value:l.querySelector(".f-value").value,disabled:!l.querySelector(".f-enabled").checked})}),e.http.body={type:F,data:a}}else e.http.body={type:_,data:r("bodyData").value};else delete e.http.body;let s=r("authType").value,o=pt(s,"auth");return o!==void 0?e.http.auth=o:delete e.http.auth,e.settings.timeout=parseInt(h("settingTimeout").value)||3e4,e.settings.encodeUrl=h("settingEncodeUrl").checked,e.settings.followRedirects=h("settingFollowRedirects").checked,e.settings.maxRedirects=parseInt(h("settingMaxRedirects").value)||5,e}function It(){let e=ge();r("sendBtn").classList.add("sending"),r("sendBtn").disabled=!0,r("sendBtn").textContent="Sending...",Tt(),L.postMessage({type:"sendRequest",request:e})}function on(){P&&(clearTimeout(P),be(null)),ie(!0);let e=ge();L.postMessage({type:"saveDocument",request:e})}function an(e){De(e),r("exampleIndicator").style.display="none";let t=e.http||{};if(Q.value=(t.method||"GET").toUpperCase(),wt(),Qt(t.url||""),r("paramsBody").innerHTML="",(t.params||[]).forEach(o=>St(o.name,o.value,o.type||"query",o.disabled)),r("headersBody").innerHTML="",(t.headers||[]).forEach(o=>At(o.name,o.value,o.disabled)),t.body){let o=Array.isArray(t.body)?(t.body.find(a=>a.selected)||t.body[0])?.body:t.body;o&&(o.type==="form-urlencoded"||o.type==="multipart-form"?(me(o.type),r("bodyFormBody").innerHTML="",(o.data||[]).forEach(a=>Ht(a.name,a.value,a.disabled))):(me("raw"),ce(o.type||"json"),r("bodyLangMode").value=_,o.data&&(r("bodyData").value=o.data),S()))}else me("none");let n=t.auth;n==="inherit"?r("authType").value="inherit":n&&n.type?r("authType").value=n.type:r("authType").value="none",Ct(),n&&n!=="inherit"&&n.type&&setTimeout(()=>{vt(n,"auth"),B(),$e()},0);let s=e.settings||{};h("settingTimeout").value=s.timeout!==void 0&&s.timeout!=="inherit"?s.timeout:"30000",h("settingEncodeUrl").checked=s.encodeUrl!==void 0&&s.encodeUrl!=="inherit"?s.encodeUrl:!0,h("settingFollowRedirects").checked=s.followRedirects!==void 0&&s.followRedirects!=="inherit"?s.followRedirects:!0,h("settingMaxRedirects").value=s.maxRedirects!==void 0&&s.maxRedirects!=="inherit"?s.maxRedirects:"5",le()}window.addEventListener("message",e=>{let t=e.data;switch(t.type){case"requestLoaded":if(ye){ie(!1);break}an(t.request);break;case"response":r("exampleIndicator").style.display="none",Be(t.response),$e();break;case"sending":r("sendBtn").classList.add("sending"),r("sendBtn").disabled=!0,r("sendBtn").textContent="Sending...",t.message&&Ce(t.message);break;case"saved":break;case"error":Ie(),r("sendBtn").classList.remove("sending"),r("sendBtn").disabled=!1,r("sendBtn").textContent="Send";break;case"languageChanged":ce(t.language),r("bodyLangMode").value=_,S();break;case"bodyUpdated":r("bodyData").value=t.content,S();break;case"examplesUpdated":$&&($.examples=t.examples||[]);break;case"loadExample":{let n=t.example;if(n.response){let o={};if(n.response.headers)for(let a of n.response.headers)o[a.name]=a.value;Be({status:n.response.status,statusText:n.response.statusText,headers:o,body:n.response.body?.data??"",duration:0,size:(n.response.body?.data??"").length})}let s=r("exampleIndicator");s.textContent=t.exampleName||"Example",s.style.display="inline-block";break}case"clearExample":Et(),r("exampleIndicator").style.display="none";break;case"variablesResolved":{ct(t),S(),q(),$e();break}case"secretValueResolved":Ne(t);break;case"oauth2TokenStatus":nn(t.status);break;case"oauth2Progress":sn(t.message);break}});r("varToggleBtn").addEventListener("click",()=>{let e=!ve();we(e),r("varToggleBtn").classList.toggle("active",e),S(),q(),B()});r("sendBtn").addEventListener("click",It);document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="Enter"&&(e.preventDefault(),It())});r("copyRespBtn").addEventListener("click",()=>{let e=bt();e&&navigator.clipboard.writeText(e).then(()=>{let t=r("copyRespBtn");t.textContent="Copied!",setTimeout(()=>{t.textContent="Copy"},1500)})});r("saveExampleBtn").addEventListener("click",()=>{if(!Re())return;let e=ge();L.postMessage({type:"saveExample",request:e,response:Re()})});r("addParamBtn").addEventListener("click",()=>St());r("addHeaderBtn").addEventListener("click",()=>At());r("addFormFieldBtn").addEventListener("click",()=>Ht());r("authType").addEventListener("change",()=>{Ct(),f()});r("panel-auth").addEventListener("input",f);r("panel-auth").addEventListener("change",f);r("panel-settings").addEventListener("input",f);r("panel-settings").addEventListener("change",f);r("bodyLangMode").addEventListener("change",()=>{ce(r("bodyLangMode").value),S(),f()});document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&(e.preventDefault(),on())});L.postMessage({type:"ready"});})();
