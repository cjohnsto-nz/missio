"use strict";(()=>{var y=acquireVsCodeApi(),w=null,Te={},Ee={},Le=!1,C=null,ee=!1,R="none",B="json";function ke(e){w=e}function xe(e){Te=e}function we(e){Ee=e}function te(e){Le=e}function E(){return Te}function N(){return Ee}function A(){return Le}function ne(e){C=e}function _(e){ee=e}function Ae(e){R=e}function K(e){B=e}function l(e){return document.getElementById(e)}function h(e){return document.getElementById(e)}function k(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function p(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function et(e){let t=p(e);return t=t.replace(/(")((?:[^"\\]|\\.)*)(")\s*:/g,"<span class='tk-key'>&quot;$2&quot;</span>:"),t=t.replace(/(")((?:[^"\\]|\\.)*)(")/g,"<span class='tk-str'>&quot;$2&quot;</span>"),t=t.replace(/\b(-?\d+\.?\d*(?:e[+-]?\d+)?)\b/gi,"<span class='tk-num'>$1</span>"),t=t.replace(/\b(true|false|null)\b/g,"<span class='tk-kw'>$1</span>"),t}function tt(e){let t=p(e);return t=t.replace(/(&lt;\/?)([\w:-]+)/g,"$1<span class='tk-tag'>$2</span>"),t=t.replace(/([\w:-]+)(=)(")((?:[^"]*))(")/g,"<span class='tk-attr'>$1</span>$2<span class='tk-str'>&quot;$4&quot;</span>"),t}function P(e){let t=E(),n=N(),s=A();return e.replace(/\{\{(\s*[\w.]+\s*)\}\}/g,(o,a)=>{let r=a.trim(),i=r in t,c=n[r]||"unknown";return s&&i?"<span class='"+("tk-var-resolved tk-src-"+c)+"' data-var='"+p(r)+"' title='{{"+p(r)+"}} ("+c+")'>"+p(t[r])+"</span>":"<span class='"+(i?"tk-var tk-src-"+c:"tk-var tk-var-unresolved")+"' data-var='"+p(r)+"'>{{"+p(a)+"}}</span>"})}function z(e,t){let n;return t==="json"?n=et(e):t==="xml"||t==="html"?n=tt(e):n=p(e),P(n)}function m(e,t,n,s="text"){let o=`<input type="${s}" id="${e}" placeholder="${t}" />`;return n?`<span class="auth-input-wrap">${o}</span>`:o}function Me(e,t){let{prefix:n,fieldsContainer:s,onChange:o,wrapInputs:a,showTokenStatus:r}=t;if(s.innerHTML="",e==="bearer")s.innerHTML=`<div class="auth-row"><label>Token</label>${m(n+"Token","{{token}}",a)}</div>`;else if(e==="basic")s.innerHTML=`<div class="auth-row"><label>Username</label>${m(n+"Username","username",a)}</div><div class="auth-row"><label>Password</label>${m(n+"Password","password",a,"password")}</div>`;else if(e==="apikey")s.innerHTML=`<div class="auth-row"><label>Key</label>${m(n+"Key","X-Api-Key",a)}</div><div class="auth-row"><label>Value</label>${m(n+"Value","{{apiKey}}",a)}</div><div class="auth-row"><label>In</label><select id="${n}Placement" class="auth-select"><option value="header">Header</option><option value="query">Query</option></select></div>`;else if(e==="oauth2"){s.innerHTML=`<div class="auth-row"><label>Grant Type</label><select id="${n}OAuth2Flow" class="auth-select"><option value="client_credentials">Client Credentials</option><option value="password">Password</option><option value="authorization_code">Authorization Code</option></select></div><div class="auth-row"><label>Access Token URL</label>${m(n+"OAuth2AccessTokenUrl","{{authUrl}}/token",a)}</div><div class="auth-row"><label>Client ID</label>${m(n+"OAuth2ClientId","{{clientId}}",a)}</div><div class="auth-row"><label>Client Secret</label>${m(n+"OAuth2ClientSecret","{{clientSecret}}",a)}</div><div class="auth-row"><label>Scope</label>${m(n+"OAuth2Scope","openid profile",a)}</div><div id="${n}OAuth2PasswordFields" style="display:none;"><div class="auth-row"><label>Username</label>${m(n+"OAuth2Username","{{username}}",a)}</div><div class="auth-row"><label>Password</label>${m(n+"OAuth2Password","password",a,"password")}</div></div><div id="${n}OAuth2AuthCodeFields" style="display:none;"><div class="auth-row"><label>Auth URL</label>${m(n+"OAuth2AuthorizationUrl","{{authUrl}}/authorize",a)}</div><div class="auth-row"><label>Callback URL</label>${m(n+"OAuth2CallbackUrl","https://localhost/callback",a)}</div></div><div class="auth-row"><label>Refresh URL</label>${m(n+"OAuth2RefreshTokenUrl","(optional)",a)}</div><div class="auth-row"><label>Credentials In</label><select id="${n}OAuth2CredentialsPlacement" class="auth-select"><option value="basic_auth_header">Header</option><option value="body">Body</option></select></div><div class="auth-row"><label>Auto Fetch</label><input type="checkbox" id="${n}OAuth2AutoFetch" checked /></div><div class="auth-row"><label>Auto Refresh</label><input type="checkbox" id="${n}OAuth2AutoRefresh" checked /></div>`+(r?`<div class="oauth2-token-status" id="${n}OAuth2TokenStatus"></div>`:"");let i=document.getElementById(n+"OAuth2Flow"),c=document.getElementById(n+"OAuth2PasswordFields"),v=document.getElementById(n+"OAuth2AuthCodeFields"),f=()=>{let T=i.value;c.style.display=T==="password"?"":"none",v.style.display=T==="authorization_code"?"":"none"};i.addEventListener("change",()=>{f(),o()}),f()}if(s.querySelectorAll("input").forEach(i=>{i.addEventListener("input",o),i.addEventListener("change",o)}),s.querySelectorAll("select").forEach(i=>i.addEventListener("change",o)),t.onFieldsRendered){let i=Array.from(s.querySelectorAll('input[type="text"]'));t.onFieldsRendered(i)}}function Se(e,t){let n=t,s=a=>document.getElementById(a),o=a=>document.getElementById(a);switch(e){case"bearer":return{type:"bearer",token:s(n+"Token")?.value||""};case"basic":return{type:"basic",username:s(n+"Username")?.value||"",password:s(n+"Password")?.value||""};case"apikey":return{type:"apikey",key:s(n+"Key")?.value||"",value:s(n+"Value")?.value||"",placement:o(n+"Placement")?.value||"header"};case"oauth2":{let a=o(n+"OAuth2Flow")?.value||"client_credentials",r={type:"oauth2",flow:a,accessTokenUrl:s(n+"OAuth2AccessTokenUrl")?.value||"",clientId:s(n+"OAuth2ClientId")?.value||"",clientSecret:s(n+"OAuth2ClientSecret")?.value||"",scope:s(n+"OAuth2Scope")?.value||"",refreshTokenUrl:s(n+"OAuth2RefreshTokenUrl")?.value||"",credentialsPlacement:o(n+"OAuth2CredentialsPlacement")?.value||"basic_auth_header",autoFetchToken:s(n+"OAuth2AutoFetch")?.checked!==!1,autoRefreshToken:s(n+"OAuth2AutoRefresh")?.checked!==!1};return a==="password"?(r.username=s(n+"OAuth2Username")?.value||"",r.password=s(n+"OAuth2Password")?.value||""):a==="authorization_code"&&(r.authorizationUrl=s(n+"OAuth2AuthorizationUrl")?.value||"",r.callbackUrl=s(n+"OAuth2CallbackUrl")?.value||""),r.refreshTokenUrl||delete r.refreshTokenUrl,r.scope||delete r.scope,r.clientSecret||delete r.clientSecret,r}case"inherit":return"inherit";default:return}}function He(e,t){let n=t,s=a=>document.getElementById(a),o=a=>document.getElementById(a);if(!(!e||e==="inherit")&&!(typeof e!="object"||!e.type))switch(e.type){case"bearer":{let a=s(n+"Token");a&&(a.value=e.token||"");break}case"basic":{let a=s(n+"Username");a&&(a.value=e.username||"");let r=s(n+"Password");r&&(r.value=e.password||"");break}case"apikey":{let a=s(n+"Key");a&&(a.value=e.key||"");let r=s(n+"Value");r&&(r.value=e.value||"");let i=o(n+"Placement");i&&(i.value=e.placement||"header");break}case"oauth2":{let a=o(n+"OAuth2Flow");a&&(a.value=e.flow||"client_credentials",a.dispatchEvent(new Event("change")));let r=s(n+"OAuth2AccessTokenUrl");r&&(r.value=e.accessTokenUrl||"");let i=s(n+"OAuth2ClientId");i&&(i.value=e.clientId||"");let c=s(n+"OAuth2ClientSecret");c&&(c.value=e.clientSecret||"");let v=s(n+"OAuth2Scope");v&&(v.value=e.scope||"");let f=s(n+"OAuth2RefreshTokenUrl");f&&(f.value=e.refreshTokenUrl||"");let T=o(n+"OAuth2CredentialsPlacement");T&&(T.value=e.credentialsPlacement||"basic_auth_header");let ge=s(n+"OAuth2AutoFetch");ge&&(ge.checked=e.autoFetchToken!==!1);let be=s(n+"OAuth2AutoRefresh");if(be&&(be.checked=e.autoRefreshToken!==!1),e.flow==="password"){let F=s(n+"OAuth2Username");F&&(F.value=e.username||"");let D=s(n+"OAuth2Password");D&&(D.value=e.password||"")}else if(e.flow==="authorization_code"){let F=s(n+"OAuth2AuthorizationUrl");F&&(F.value=e.authorizationUrl||"");let D=s(n+"OAuth2CallbackUrl");D&&(D.value=e.callbackUrl||"")}break}}}var d=null,g=[],x=0,q=null,I=0,j=!1,W=null;function Ce(e,t){let n=e.substring(0,t),s=n.lastIndexOf("{{");if(s===-1)return null;let o=n.substring(s+2);if(o.includes("}}"))return null;let a=o.trim();return/^[\w.]*$/.test(a)?a:null}function oe(e,t){let n=e.selectionStart??0,s=Ce(e.value,n);if(s===null){L();return}q=e,j=!1,I=e.value.lastIndexOf("{{",n-1),Be(s,e,t)}function Re(e,t){let n=window.getSelection();if(!n||n.rangeCount===0)return;let s=e.textContent||"",o=n.getRangeAt(0),a=document.createRange();a.selectNodeContents(e),a.setEnd(o.startContainer,o.startOffset);let r=a.toString().length,i=Ce(s,r);if(i===null){L();return}q=e,j=!0,I=s.lastIndexOf("{{",r-1),Be(i,e,t)}function Be(e,t,n){W=n;let s=Object.keys(E());if(s.length===0){L();return}let o=e.toLowerCase();if(g=s.filter(a=>a.toLowerCase().startsWith(o)),g.length===0){L();return}x=0,d||(d=document.createElement("div"),d.className="var-autocomplete",document.body.appendChild(d)),se(),st(t)}function se(){d&&(d.innerHTML=g.map((e,t)=>{let n=E()[e]||"";return"<div class='"+(t===x?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+t+"'><span class='var-ac-name'>"+p(e)+"</span><span class='var-ac-value'>"+p(n)+"</span></div>"}).join(""),d.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",t=>{t.preventDefault();let n=parseInt(e.dataset.index||"0");Fe(g[n])})}))}function nt(e){let t=document.createElement("div"),n=window.getComputedStyle(e);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","paddingTop","paddingLeft","paddingRight","paddingBottom","borderWidth","boxSizing","whiteSpace","wordWrap","overflowWrap","tabSize"].forEach(v=>{t.style[v]=n.getPropertyValue(v.replace(/[A-Z]/g,f=>"-"+f.toLowerCase()))}),t.style.position="absolute",t.style.visibility="hidden",t.style.whiteSpace="pre-wrap",t.style.wordWrap="break-word",t.style.width=e.clientWidth+"px";let o=e.value.substring(0,e.selectionStart??0);t.textContent=o;let a=document.createElement("span");a.textContent="|",t.appendChild(a),document.body.appendChild(t);let r=a.getBoundingClientRect(),i=e.getBoundingClientRect(),c={top:i.top+(r.top-t.getBoundingClientRect().top)-e.scrollTop,left:i.left+(r.left-t.getBoundingClientRect().left)-e.scrollLeft};return document.body.removeChild(t),c}function st(e){if(d){if(j){let t=window.getSelection();if(t&&t.rangeCount>0){let s=t.getRangeAt(0).getBoundingClientRect();d.style.left=s.left+"px",d.style.top=s.bottom+4+"px"}else{let n=e.getBoundingClientRect();d.style.left=n.left+"px",d.style.top=n.bottom+2+"px"}}else{let t=nt(e);d.style.left=t.left+"px",d.style.top=t.top+18+"px"}d.style.minWidth="220px"}}var Ie=null,qe=null,Oe=null,Ue=null;function $e(e,t,n,s){Ie=e,qe=t,Oe=n,Ue=s||null}function Fe(e){if(q){if(j){let t=q,n=t.textContent||"",s=window.getSelection(),o=n.length;if(s&&s.rangeCount>0){let f=s.getRangeAt(0),T=document.createRange();T.selectNodeContents(t),T.setEnd(f.startContainer,f.startOffset),o=T.toString().length}let a="{{"+e+"}}",r=o;n.substring(o).startsWith("}}")&&(r+=2);let c=n.substring(0,I)+a+n.substring(r);Ue?.(c),qe?.();let v=I+a.length;Oe?.(t,v)}else{let t=q,n=t.value,s=t.selectionStart??n.length,o="{{"+e+"}}",a=s;n.substring(s).startsWith("}}")&&(a+=2),t.value=n.substring(0,I)+o+n.substring(a);let i=I+o.length;t.selectionStart=i,t.selectionEnd=i,t.focus(),W?W():Ie?.()}L()}}function L(){d&&(d.remove(),d=null),q=null,g=[],x=0,W=null}function G(e){return!d||g.length===0?!1:e.key==="ArrowDown"?(e.preventDefault(),x=(x+1)%g.length,se(),!0):e.key==="ArrowUp"?(e.preventDefault(),x=(x-1+g.length)%g.length,se(),!0):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),Fe(g[x]),!0):e.key==="Escape"?(e.preventDefault(),L(),!0):!1}function ae(){return d!==null}var le=null,re="";function ie(){return le}function Pe(){return re}function Ve(e){l("respLoading").style.display="flex",l("respEmpty").style.display="none",l("respBodyWrap").style.display="none",l("responseBar").style.display="none",l("respTabs").style.display="none",e&&ce(e)}function ce(e){let t=l("respLoading").querySelector("span");t&&(t.textContent=e)}function de(){l("respLoading").style.display="none"}function Ne(){l("responseBar").style.display="none",l("respTabs").style.display="none",l("respBodyWrap").style.display="none",l("respEmpty").style.display="block",le=null,re=""}function ot(){let e=l("respLineNumbers"),n=l("respBodyPre").querySelectorAll(":scope > .code-line"),s=n.length||1,o="";for(let r=1;r<=s;r++)o+="<span>"+r+"</span>";e.innerHTML=o;let a=e.children;for(let r=0;r<a.length;r++){let i=n[r];i&&(a[r].style.height=i.offsetHeight+"px")}}function at(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}function De(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function ue(e){de(),le=e,l("sendBtn").classList.remove("sending"),l("sendBtn").disabled=!1,l("sendBtn").textContent="Send",l("responseBar").style.display="flex",l("respTabs").style.display="flex",l("respEmpty").style.display="none",l("respBodyWrap").style.display="block";let t=l("statusBadge");t.textContent=e.status+" "+e.statusText;let n=Math.floor(e.status/100);t.className="status-badge s"+n+"xx",l("responseMeta").textContent=e.duration+"ms \u2022 "+at(e.size);let s=e.body||"",o="";if(e.headers){for(let c of Object.keys(e.headers))if(c.toLowerCase()==="content-type"){o=e.headers[c];break}}let a="text";if(o.includes("json")){a="json";try{s=JSON.stringify(JSON.parse(s),null,2)}catch{}}else o.includes("xml")?a="xml":o.includes("html")&&(a="html");re=s;let r=s.split(`
`);l("respBodyPre").innerHTML=r.map(c=>'<div class="code-line">'+z(c,a)+`
</div>`).join(""),ot();let i=l("respHeadersBody");i.innerHTML="",e.headers&&Object.entries(e.headers).forEach(([c,v])=>{let f=document.createElement("tr");f.innerHTML="<td>"+De(c)+"</td><td>"+De(String(v))+"</td>",i.appendChild(f)})}function u(){C&&clearTimeout(C),ne(setTimeout(()=>{_(!0);let e=Z();y.postMessage({type:"updateDocument",request:e})},300))}var lt=["body","auth","headers","params","settings"],rt=["resp-body","resp-headers"];function ze(e,t,n){e.querySelectorAll(".tab").forEach(o=>o.classList.remove("active"));let s=e.querySelector(`[data-tab="${t}"]`);s&&s.classList.add("active"),n.forEach(o=>{let a=document.getElementById("panel-"+o);a&&a.classList.toggle("active",o===t)})}l("reqTabs").querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{ze(l("reqTabs"),e.dataset.tab,lt)})});l("respTabs").querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{ze(l("respTabs"),e.dataset.tab,rt)})});var pe=l("divider"),_e=l("requestSection"),Ke=l("responseSection"),me=!1;pe.addEventListener("mousedown",()=>{me=!0,pe.classList.add("dragging"),document.body.style.cursor="ns-resize",document.body.style.userSelect="none"});document.addEventListener("mousemove",e=>{if(!me)return;let n=document.querySelector(".main-content").getBoundingClientRect(),s=e.clientY-n.top,o=n.height,a=Math.max(15,Math.min(85,s/o*100));_e.style.flex="none",_e.style.height=a+"%",Ke.style.flex="none",Ke.style.height=100-a+"%"});document.addEventListener("mouseup",()=>{me=!1,pe.classList.remove("dragging"),document.body.style.cursor="",document.body.style.userSelect=""});var $=l("method");function We(){$.className="method-select "+$.value.toLowerCase()}$.addEventListener("change",()=>{We(),u(),y.postMessage({type:"methodChanged",method:$.value})});function je(e="",t="",n="query",s=!1){let o=l("paramsBody"),a=document.createElement("tr");a.innerHTML='<td><input type="checkbox" class="p-enabled" '+(s?"":"checked")+' /></td><td><input type="text" class="p-name" value="'+k(e)+'" placeholder="name" /></td><td><input type="text" class="p-value" value="'+k(t)+'" placeholder="value" /></td><td><select class="p-type auth-select" style="margin:0;"><option value="query"'+(n==="query"?" selected":"")+'>query</option><option value="path"'+(n==="path"?" selected":"")+'>path</option></select></td><td><button class="row-delete">\xD7</button></td>',a.querySelector(".row-delete").addEventListener("click",()=>{a.remove(),V(),u()}),a.addEventListener("input",u),a.addEventListener("change",u),M(a.querySelector(".p-name")),M(a.querySelector(".p-value")),o.appendChild(a),V()}function Ge(e="",t="",n=!1){let s=l("headersBody"),o=document.createElement("tr");o.innerHTML='<td><input type="checkbox" class="h-enabled" '+(n?"":"checked")+' /></td><td><input type="text" class="h-name" value="'+k(e)+'" placeholder="name" /></td><td><input type="text" class="h-value" value="'+k(t)+'" placeholder="value" /></td><td><button class="row-delete">\xD7</button></td>',o.querySelector(".row-delete").addEventListener("click",()=>{o.remove(),V(),u()}),o.addEventListener("input",u),o.addEventListener("change",u),M(o.querySelector(".h-name")),M(o.querySelector(".h-value")),s.appendChild(o),V()}function M(e){let t=e.parentElement;t.classList.add("var-cell");let n=document.createElement("div");n.className="var-overlay",t.appendChild(n);function s(){n.innerHTML=P(p(e.value))}function o(){t.classList.add("var-overlay-active"),s()}function a(){t.classList.remove("var-overlay-active")}e.addEventListener("input",()=>{A()&&ye(),s(),oe(e,s)}),e.addEventListener("keydown",r=>{G(r)}),e.addEventListener("focus",a),e.addEventListener("blur",o),n.addEventListener("click",r=>{let i=r.target.closest(".tk-var, .tk-var-resolved");i&&i.dataset.var?Q(i,i.dataset.var):(a(),e.focus())}),document.activeElement!==e&&o()}function Y(){document.querySelectorAll(".var-cell").forEach(e=>{let t=e.querySelector('input[type="text"]'),n=e.querySelector(".var-overlay");t&&n&&e.classList.contains("var-overlay-active")&&(n.innerHTML=P(p(t.value)))})}function ye(){te(!1),l("varToggleBtn").classList.remove("active"),b(),H(),Y()}function Je(e="",t="",n=!1){let s=l("bodyFormBody"),o=document.createElement("tr");o.innerHTML='<td><input type="checkbox" class="f-enabled" '+(n?"":"checked")+' /></td><td><input type="text" class="f-name" value="'+k(e)+'" placeholder="name" /></td><td><input type="text" class="f-value" value="'+k(t)+'" placeholder="value" /></td><td><button class="row-delete">\xD7</button></td>',o.querySelector(".row-delete").addEventListener("click",()=>{o.remove(),u()}),o.addEventListener("input",u),o.addEventListener("change",u),M(o.querySelector(".f-name")),M(o.querySelector(".f-value")),s.appendChild(o)}function V(){let e=document.querySelectorAll("#paramsBody tr"),t=document.querySelectorAll("#headersBody tr");l("paramsBadge").textContent=String(e.length),l("headersBadge").textContent=String(t.length)}function J(e){Ae(e),document.querySelectorAll("#bodyTypePills .pill").forEach(o=>{o.classList.toggle("active",o.dataset.bodyType===e)});let t=l("bodyRawEditor"),n=l("bodyFormEditor"),s=l("bodyLangMode");e==="none"?(t.style.display="none",n.style.display="none",s.style.display="none"):e==="form-urlencoded"||e==="multipart-form"?(t.style.display="none",n.style.display="block",s.style.display="none"):(t.style.display="flex",t.style.flexDirection="column",t.style.flex="1",n.style.display="none",s.style.display="block")}document.querySelectorAll("#bodyTypePills .pill").forEach(e=>{e.addEventListener("click",()=>{J(e.dataset.bodyType)})});function Xe(){let e=l("bodyData"),t=l("lineNumbers"),s=l("bodyHighlight").querySelectorAll(":scope > .code-line"),o=s.length||1;if(t.children.length!==o){let i="";for(let c=1;c<=o;c++)i+="<span>"+c+"</span>";t.innerHTML=i}let r=t.children;for(let i=0;i<r.length;i++){let c=s[i];c&&(r[i].style.height=c.offsetHeight+"px")}t.style.top=-e.scrollTop+"px"}function b(){try{let e=l("bodyData"),t=l("bodyHighlight"),n=e.value.split(`
`);t.innerHTML=n.map(s=>'<div class="code-line">'+z(s,B)+`
</div>`).join(""),Xe()}catch{}}var U=null;function Q(e,t){ve();let n=e.getBoundingClientRect(),s=t in E(),o=document.createElement("div");o.className="var-tooltip";let a=N()[t]||"unknown",r=a.charAt(0).toUpperCase()+a.slice(1);o.innerHTML="<div class='var-name'>{{"+p(t)+"}}</div>"+(s?"<div class='var-source tk-src-"+a+"'>"+r+"</div><div class='var-value'>"+p(E()[t])+"</div>":"<div class='var-unresolved'>Unresolved variable</div>")+"<div class='var-actions'><button class='var-action-btn' data-action='edit'>Edit Variable</button><button class='var-action-btn' data-action='copy'>"+(s?"Copy Value":"Copy Name")+"</button></div>",o.style.left=n.left+"px",o.style.top=n.bottom+4+"px",document.body.appendChild(o),U=o,o.querySelectorAll(".var-action-btn").forEach(i=>{i.addEventListener("click",()=>{let c=i.dataset.action;if(c==="edit")y.postMessage({type:"editVariable",variableName:t});else if(c==="copy"){let v=s?E()[t]:"{{"+t+"}}";navigator.clipboard.writeText(v).catch(()=>{})}ve()})}),setTimeout(()=>{document.addEventListener("click",Ye)},0)}function ve(){U&&(U.remove(),U=null),document.removeEventListener("click",Ye)}function Ye(e){U&&!U.contains(e.target)&&ve()}l("bodyHighlight").addEventListener("click",e=>{let t=e.target.closest(".tk-var, .tk-var-resolved");t&&t.dataset.var&&Q(t,t.dataset.var)});var S="";function it(){return S}function ct(e){S=e,H()}function H(){let e=l("url");if(!S){e.innerHTML="";return}let t=window.getSelection(),n=0;if(t&&t.rangeCount>0&&e.contains(t.anchorNode)){let s=t.getRangeAt(0),o=document.createRange();o.selectNodeContents(e),o.setEnd(s.startContainer,s.startOffset),n=o.toString().length}e.innerHTML=P(p(S)),t&&document.activeElement===e&&X(e,n)}function X(e,t){let n=window.getSelection();if(!n)return;let s=document.createRange(),o=0,a=!1;function r(i){if(i.nodeType===Node.TEXT_NODE){let c=(i.textContent||"").length;if(o+c>=t)return s.setStart(i,t-o),s.collapse(!0),!0;o+=c}else for(let c=0;c<i.childNodes.length;c++)if(r(i.childNodes[c]))return!0;return!1}a=r(e),a||(s.selectNodeContents(e),s.collapse(!1)),n.removeAllRanges(),n.addRange(s)}$e(b,H,X,e=>{S=e});l("url").addEventListener("click",e=>{let t=e.target.closest(".tk-var, .tk-var-resolved");t&&t.dataset.var&&Q(t,t.dataset.var)});l("url").addEventListener("input",()=>{if(A()){ye(),X(l("url"),S.length);return}let e=l("url"),t=window.getSelection(),n=0;if(t&&t.rangeCount>0&&e.contains(t.anchorNode)){let s=t.getRangeAt(0),o=document.createRange();o.selectNodeContents(e),o.setEnd(s.startContainer,s.startOffset),n=o.toString().length}S=e.textContent||"",H(),X(e,n),Re(e,H),u()});function dt(){let e=l("bodyData"),t=l("bodyHighlight");t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft,Xe()}l("bodyData").addEventListener("input",()=>{A()&&ye(),b(),oe(l("bodyData"),b),u()});l("bodyData").addEventListener("scroll",dt);l("bodyData").addEventListener("click",e=>{let t=e,n=l("bodyData");n.style.pointerEvents="none";let s=document.elementFromPoint(t.clientX,t.clientY);if(n.style.pointerEvents="",s){let o=s.closest(".tk-var");o&&o.dataset.var&&Q(o,o.dataset.var)}});l("bodyData").addEventListener("keydown",e=>{ae()&&G(e)});l("url").addEventListener("keydown",e=>{if(ae()){G(e);return}e.key==="Enter"&&e.preventDefault()});l("bodyData").addEventListener("blur",()=>{setTimeout(L,150)});l("url").addEventListener("blur",()=>{setTimeout(L,150)});var ut={prefix:"auth",get fieldsContainer(){return l("authFields")},onChange:()=>u(),showInherit:!0,wrapInputs:!0,showTokenStatus:!0,onFieldsRendered:e=>e.forEach(M)};function Qe(){let e=l("authType").value;Me(e,ut)}function he(){let e=l("oauth2Flow")?.value||"client_credentials",t={type:"oauth2",flow:e,accessTokenUrl:h("oauth2AccessTokenUrl")?.value||"",clientId:h("oauth2ClientId")?.value||"",clientSecret:h("oauth2ClientSecret")?.value||"",scope:h("oauth2Scope")?.value||"",refreshTokenUrl:h("oauth2RefreshTokenUrl")?.value||"",credentialsPlacement:l("oauth2CredentialsPlacement")?.value||"basic_auth_header",credentialsId:w?.http?.auth?.credentialsId,autoFetchToken:l("oauth2AutoFetch")?.checked!==!1,autoRefreshToken:l("oauth2AutoRefresh")?.checked!==!1};return e==="password"&&(t.username=h("oauth2Username")?.value||"",t.password=h("oauth2Password")?.value||""),t}function fe(){if(l("authType")?.value!=="oauth2")return;let e=he();e.accessTokenUrl&&y.postMessage({type:"getTokenStatus",auth:e})}function pt(e){if(e<=0)return"expired";let t=Math.floor(e/1e3);if(t<60)return`${t}s`;let n=Math.floor(t/60);return n<60?`${n}m ${t%60}s`:`${Math.floor(n/60)}h ${n%60}m`}var O=null;function vt(e){let t=document.getElementById("oauth2TokenStatus");if(!t)return;if(O&&(clearInterval(O),O=null),!e.hasToken){t.innerHTML='<div class="token-status token-none"><span class="token-dot dot-none"></span> No token<button class="token-btn" id="oauth2GetTokenBtn">Get Token</button></div>',t.querySelector("#oauth2GetTokenBtn")?.addEventListener("click",()=>{let s=he();y.postMessage({type:"getToken",auth:s})});return}let n=()=>{let s=Date.now(),o=e.expiresAt?e.expiresAt-s:void 0,a=o!==void 0&&o<=0,r=a?"dot-expired":"dot-valid",i=a?"Expired":o!==void 0?`Expires in ${pt(o)}`:"Valid (no expiry)",c=e.expiresAt?new Date(e.expiresAt).toLocaleTimeString():"";t.innerHTML='<div class="token-status '+(a?"token-expired":"token-valid")+'"><span class="token-dot '+r+'"></span> '+i+(c?'<span class="token-expiry-time"> ('+c+")</span>":"")+'<button class="token-btn" id="oauth2RefreshTokenBtn">'+(a?"Get Token":"Refresh")+"</button></div>",t.querySelector("#oauth2RefreshTokenBtn")?.addEventListener("click",()=>{let v=he();y.postMessage({type:"getToken",auth:v})})};n(),e.expiresAt&&(O=setInterval(()=>{n(),e.expiresAt&&Date.now()>e.expiresAt&&(clearInterval(O),O=null)},1e3))}function ht(e){let t=document.getElementById("oauth2TokenStatus");if(t&&e){let n=e.startsWith("Error:");t.innerHTML='<div class="token-status '+(n?"token-error":"token-progress")+'">'+(n?'<span class="token-dot dot-expired"></span> ':'<span class="token-spinner"></span> ')+k(e)+"</div>"}}function Z(){let e=w?JSON.parse(JSON.stringify(w)):{};e.info||(e.info={type:"http"}),e.http||(e.http={}),e.settings||(e.settings={}),e.http.method=$.value,e.http.url=it();let t=[];document.querySelectorAll("#paramsBody tr").forEach(a=>{t.push({name:a.querySelector(".p-name").value,value:a.querySelector(".p-value").value,type:a.querySelector(".p-type").value,disabled:!a.querySelector(".p-enabled").checked})}),e.http.params=t;let n=[];if(document.querySelectorAll("#headersBody tr").forEach(a=>{n.push({name:a.querySelector(".h-name").value,value:a.querySelector(".h-value").value,disabled:!a.querySelector(".h-enabled").checked})}),e.http.headers=n,R!=="none")if(R==="form-urlencoded"||R==="multipart-form"){let a=[];document.querySelectorAll("#bodyFormBody tr").forEach(r=>{a.push({name:r.querySelector(".f-name").value,value:r.querySelector(".f-value").value,disabled:!r.querySelector(".f-enabled").checked})}),e.http.body={type:R,data:a}}else e.http.body={type:B,data:l("bodyData").value};else delete e.http.body;let s=l("authType").value,o=Se(s,"auth");return o!==void 0?e.http.auth=o:delete e.http.auth,e.settings.timeout=parseInt(h("settingTimeout").value)||3e4,e.settings.encodeUrl=h("settingEncodeUrl").checked,e.settings.followRedirects=h("settingFollowRedirects").checked,e.settings.maxRedirects=parseInt(h("settingMaxRedirects").value)||5,e}function Ze(){let e=Z();l("sendBtn").classList.add("sending"),l("sendBtn").disabled=!0,l("sendBtn").textContent="Sending...",Ve(),y.postMessage({type:"sendRequest",request:e})}function ft(){C&&(clearTimeout(C),ne(null)),_(!0);let e=Z();y.postMessage({type:"saveDocument",request:e})}function mt(e){ke(e),l("exampleIndicator").style.display="none";let t=e.http||{};if($.value=(t.method||"GET").toUpperCase(),We(),ct(t.url||""),l("paramsBody").innerHTML="",(t.params||[]).forEach(o=>je(o.name,o.value,o.type||"query",o.disabled)),l("headersBody").innerHTML="",(t.headers||[]).forEach(o=>Ge(o.name,o.value,o.disabled)),t.body){let o=Array.isArray(t.body)?(t.body.find(a=>a.selected)||t.body[0])?.body:t.body;o&&(o.type==="form-urlencoded"||o.type==="multipart-form"?(J(o.type),l("bodyFormBody").innerHTML="",(o.data||[]).forEach(a=>Je(a.name,a.value,a.disabled))):(J("raw"),K(o.type||"json"),l("bodyLangMode").value=B,o.data&&(l("bodyData").value=o.data),b()))}else J("none");let n=t.auth;n==="inherit"?l("authType").value="inherit":n&&n.type?l("authType").value=n.type:l("authType").value="none",Qe(),n&&n!=="inherit"&&n.type&&setTimeout(()=>{He(n,"auth"),Y(),fe()},0);let s=e.settings||{};h("settingTimeout").value=s.timeout!==void 0&&s.timeout!=="inherit"?s.timeout:"30000",h("settingEncodeUrl").checked=s.encodeUrl!==void 0&&s.encodeUrl!=="inherit"?s.encodeUrl:!0,h("settingFollowRedirects").checked=s.followRedirects!==void 0&&s.followRedirects!=="inherit"?s.followRedirects:!0,h("settingMaxRedirects").value=s.maxRedirects!==void 0&&s.maxRedirects!=="inherit"?s.maxRedirects:"5",V()}window.addEventListener("message",e=>{let t=e.data;switch(t.type){case"requestLoaded":if(ee){_(!1);break}mt(t.request);break;case"response":l("exampleIndicator").style.display="none",ue(t.response),fe();break;case"sending":l("sendBtn").classList.add("sending"),l("sendBtn").disabled=!0,l("sendBtn").textContent="Sending...",t.message&&ce(t.message);break;case"saved":break;case"error":de(),l("sendBtn").classList.remove("sending"),l("sendBtn").disabled=!1,l("sendBtn").textContent="Send";break;case"languageChanged":K(t.language),l("bodyLangMode").value=B,b();break;case"bodyUpdated":l("bodyData").value=t.content,b();break;case"examplesUpdated":w&&(w.examples=t.examples||[]);break;case"loadExample":{let n=t.example;if(n.response){let o={};if(n.response.headers)for(let a of n.response.headers)o[a.name]=a.value;ue({status:n.response.status,statusText:n.response.statusText,headers:o,body:n.response.body?.data??"",duration:0,size:(n.response.body?.data??"").length})}let s=l("exampleIndicator");s.textContent=t.exampleName||"Example",s.style.display="inline-block";break}case"clearExample":Ne(),l("exampleIndicator").style.display="none";break;case"variablesResolved":xe(t.variables||{}),we(t.sources||{}),b(),H(),Y(),fe();break;case"oauth2TokenStatus":vt(t.status);break;case"oauth2Progress":ht(t.message);break}});l("varToggleBtn").addEventListener("click",()=>{let e=!A();te(e),l("varToggleBtn").classList.toggle("active",e),b(),H(),Y()});l("sendBtn").addEventListener("click",Ze);document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="Enter"&&(e.preventDefault(),Ze())});l("copyRespBtn").addEventListener("click",()=>{let e=Pe();e&&navigator.clipboard.writeText(e).then(()=>{let t=l("copyRespBtn");t.textContent="Copied!",setTimeout(()=>{t.textContent="Copy"},1500)})});l("saveExampleBtn").addEventListener("click",()=>{if(!ie())return;let e=Z();y.postMessage({type:"saveExample",request:e,response:ie()})});l("addParamBtn").addEventListener("click",()=>je());l("addHeaderBtn").addEventListener("click",()=>Ge());l("addFormFieldBtn").addEventListener("click",()=>Je());l("authType").addEventListener("change",()=>{Qe(),u()});l("panel-auth").addEventListener("input",u);l("panel-auth").addEventListener("change",u);l("panel-settings").addEventListener("input",u);l("panel-settings").addEventListener("change",u);l("bodyLangMode").addEventListener("change",()=>{K(l("bodyLangMode").value),b(),u()});document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&(e.preventDefault(),ft())});y.postMessage({type:"ready"});})();
