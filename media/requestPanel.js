"use strict";(()=>{var h=acquireVsCodeApi(),M=null,b={},A=!1;function i(){A||(A=!0,h.postMessage({type:"dirtyChanged",dirty:!0}))}function O(){A&&(A=!1,h.postMessage({type:"dirtyChanged",dirty:!1}))}function s(e){return document.getElementById(e)}function c(e){return document.getElementById(e)}function g(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}var le=["body","auth","headers","params","settings"],re=["resp-body","resp-headers"];function W(e,t,n){e.querySelectorAll(".tab").forEach(a=>a.classList.remove("active"));let o=e.querySelector(`[data-tab="${t}"]`);o&&o.classList.add("active"),n.forEach(a=>{let l=document.getElementById("panel-"+a);l&&l.classList.toggle("active",a===t)})}s("reqTabs").querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{W(s("reqTabs"),e.dataset.tab,le)})});s("respTabs").querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{W(s("respTabs"),e.dataset.tab,re)})});var P=s("divider"),F=s("requestSection"),$=s("responseSection"),N=!1;P.addEventListener("mousedown",()=>{N=!0,P.classList.add("dragging"),document.body.style.cursor="ns-resize",document.body.style.userSelect="none"});document.addEventListener("mousemove",e=>{if(!N)return;let n=document.querySelector(".main-content").getBoundingClientRect(),o=e.clientY-n.top,a=n.height,l=Math.max(15,Math.min(85,o/a*100));F.style.flex="none",F.style.height=l+"%",$.style.flex="none",$.style.height=100-l+"%"});document.addEventListener("mouseup",()=>{N=!1,P.classList.remove("dragging"),document.body.style.cursor="",document.body.style.userSelect=""});var H=s("method");function j(){H.className="method-select "+H.value.toLowerCase()}H.addEventListener("change",()=>{j(),i(),h.postMessage({type:"methodChanged",method:H.value})});function z(e="",t="",n="query",o=!1){let a=s("paramsBody"),l=document.createElement("tr");l.innerHTML='<td><input type="checkbox" class="p-enabled" '+(o?"":"checked")+' /></td><td><input type="text" class="p-name" value="'+g(e)+'" placeholder="name" /></td><td><input type="text" class="p-value" value="'+g(t)+'" placeholder="value" /></td><td><select class="p-type auth-select" style="margin:0;"><option value="query"'+(n==="query"?" selected":"")+'>query</option><option value="path"'+(n==="path"?" selected":"")+'>path</option></select></td><td><button class="row-delete">\xD7</button></td>',l.querySelector(".row-delete").addEventListener("click",()=>{l.remove(),w(),i()}),l.addEventListener("input",i),l.addEventListener("change",i),a.appendChild(l),w(),i()}function J(e="",t="",n=!1){let o=s("headersBody"),a=document.createElement("tr");a.innerHTML='<td><input type="checkbox" class="h-enabled" '+(n?"":"checked")+' /></td><td><input type="text" class="h-name" value="'+g(e)+'" placeholder="name" /></td><td><input type="text" class="h-value" value="'+g(t)+'" placeholder="value" /></td><td><button class="row-delete">\xD7</button></td>',a.querySelector(".row-delete").addEventListener("click",()=>{a.remove(),w(),i()}),a.addEventListener("input",i),a.addEventListener("change",i),o.appendChild(a),w(),i()}function X(e="",t="",n=!1){let o=s("bodyFormBody"),a=document.createElement("tr");a.innerHTML='<td><input type="checkbox" class="f-enabled" '+(n?"":"checked")+' /></td><td><input type="text" class="f-name" value="'+g(e)+'" placeholder="name" /></td><td><input type="text" class="f-value" value="'+g(t)+'" placeholder="value" /></td><td><button class="row-delete">\xD7</button></td>',a.querySelector(".row-delete").addEventListener("click",()=>{a.remove(),i()}),a.addEventListener("input",i),a.addEventListener("change",i),o.appendChild(a),i()}function w(){let e=document.querySelectorAll("#paramsBody tr"),t=document.querySelectorAll("#headersBody tr");s("paramsBadge").textContent=String(e.length),s("headersBadge").textContent=String(t.length)}var S="none",L="json";function B(e){S=e,document.querySelectorAll("#bodyTypePills .pill").forEach(a=>{a.classList.toggle("active",a.dataset.bodyType===e)});let t=s("bodyRawEditor"),n=s("bodyFormEditor"),o=s("bodyLangMode");e==="none"?(t.style.display="none",n.style.display="none",o.style.display="none"):e==="form-urlencoded"||e==="multipart-form"?(t.style.display="none",n.style.display="block",o.style.display="none"):(t.style.display="flex",t.style.flexDirection="column",t.style.flex="1",n.style.display="none",o.style.display="block")}document.querySelectorAll("#bodyTypePills .pill").forEach(e=>{e.addEventListener("click",()=>{B(e.dataset.bodyType)})});function m(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function ie(e){let t=m(e);return t=t.replace(/(")((?:[^"\\]|\\.)*)(")\s*:/g,"<span class='tk-key'>&quot;$2&quot;</span>:"),t=t.replace(/(")((?:[^"\\]|\\.)*)(")/g,"<span class='tk-str'>&quot;$2&quot;</span>"),t=t.replace(/\b(-?\d+\.?\d*(?:e[+-]?\d+)?)\b/gi,"<span class='tk-num'>$1</span>"),t=t.replace(/\b(true|false|null)\b/g,"<span class='tk-kw'>$1</span>"),t}function de(e){let t=m(e);return t=t.replace(/(&lt;\/?)([\w:-]+)/g,"$1<span class='tk-tag'>$2</span>"),t=t.replace(/([\w:-]+)(=)(")((?:[^"]*))(")/g,"<span class='tk-attr'>$1</span>$2<span class='tk-str'>&quot;$4&quot;</span>"),t}function _(e){return e.replace(/\{\{(\s*[\w.]+\s*)\}\}/g,(t,n)=>{let o=n.trim();return"<span class='"+(o in b?"tk-var":"tk-var tk-var-unresolved")+"' data-var='"+m(o)+"'>{{"+m(n)+"}}</span>"})}function ce(e,t){let n;return t==="json"?n=ie(e):t==="xml"||t==="html"?n=de(e):n=m(e),_(n)}function G(){let e=s("bodyData"),t=s("lineNumbers"),n=(e.value.match(/\n/g)||[]).length+1;if(t.children.length!==n){let a="";for(let l=1;l<=n;l++)a+="<span>"+l+"</span>";t.innerHTML=a}t.style.top=-e.scrollTop+"px"}function E(){try{let e=s("bodyData"),t=s("bodyHighlight");t.innerHTML=ce(e.value,L)+`
`,G()}catch{}}var x=null;function Q(e,t){V();let n=e.getBoundingClientRect(),o=t in b,a=document.createElement("div");a.className="var-tooltip",a.innerHTML="<div class='var-name'>{{"+m(t)+"}}</div>"+(o?"<div class='var-value'>"+m(b[t])+"</div>":"<div class='var-unresolved'>Unresolved variable</div>")+"<div class='var-actions'><button class='var-action-btn' data-action='edit'>Edit Variable</button><button class='var-action-btn' data-action='copy'>"+(o?"Copy Value":"Copy Name")+"</button></div>",a.style.left=n.left+"px",a.style.top=n.bottom+4+"px",document.body.appendChild(a),x=a,a.querySelectorAll(".var-action-btn").forEach(l=>{l.addEventListener("click",()=>{let d=l.dataset.action;if(d==="edit")h.postMessage({type:"editVariable",variableName:t});else if(d==="copy"){let u=o?b[t]:"{{"+t+"}}";navigator.clipboard.writeText(u).catch(()=>{})}V()})}),setTimeout(()=>{document.addEventListener("click",Y)},0)}function V(){x&&(x.remove(),x=null),document.removeEventListener("click",Y)}function Y(e){x&&!x.contains(e.target)&&V()}s("bodyHighlight").addEventListener("click",e=>{let t=e.target.closest(".tk-var");t&&t.dataset.var&&Q(t,t.dataset.var)});function ue(){return s("url").textContent||""}function pe(e){s("url").textContent=e,R()}function R(){let e=s("url"),t=e.textContent||"";if(!t){e.innerHTML="";return}let n=window.getSelection(),o=0;if(n&&n.rangeCount>0){let a=n.getRangeAt(0),l=document.createRange();l.selectNodeContents(e),l.setEnd(a.startContainer,a.startOffset),o=l.toString().length}e.innerHTML=_(m(t)),n&&document.activeElement===e&&Z(e,o)}function Z(e,t){let n=window.getSelection();if(!n)return;let o=document.createRange(),a=0,l=!1;function d(u){if(u.nodeType===Node.TEXT_NODE){let p=(u.textContent||"").length;if(a+p>=t)return o.setStart(u,t-a),o.collapse(!0),!0;a+=p}else for(let p=0;p<u.childNodes.length;p++)if(d(u.childNodes[p]))return!0;return!1}l=d(e),l||(o.selectNodeContents(e),o.collapse(!1)),n.removeAllRanges(),n.addRange(o)}s("url").addEventListener("click",e=>{let t=e.target.closest(".tk-var");t&&t.dataset.var&&Q(t,t.dataset.var)});s("url").addEventListener("input",()=>{R(),ve(s("url")),i()});function ye(){let e=s("bodyData"),t=s("bodyHighlight");t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft,G()}s("bodyData").addEventListener("input",()=>{E(),me(s("bodyData")),i()});s("bodyData").addEventListener("scroll",ye);var r=null,y=[],v=0,k=null,T=0,D=!1;function ee(e,t){let n=e.substring(0,t),o=n.lastIndexOf("{{");if(o===-1)return null;let a=n.substring(o+2);if(a.includes("}}"))return null;let l=a.trim();return/^[\w.]*$/.test(l)?l:null}function me(e){let t=e.selectionStart??0,n=ee(e.value,t);if(n===null){f();return}k=e,D=!1,T=e.value.lastIndexOf("{{",t-1),te(n,e)}function ve(e){let t=window.getSelection();if(!t||t.rangeCount===0)return;let n=e.textContent||"",o=t.getRangeAt(0),a=document.createRange();a.selectNodeContents(e),a.setEnd(o.startContainer,o.startOffset);let l=a.toString().length,d=ee(n,l);if(d===null){f();return}k=e,D=!0,T=n.lastIndexOf("{{",l-1),te(d,e)}function te(e,t){let n=Object.keys(b);if(n.length===0){f();return}let o=e.toLowerCase();if(y=n.filter(a=>a.toLowerCase().startsWith(o)),y.length===0){f();return}v=0,r||(r=document.createElement("div"),r.className="var-autocomplete",document.body.appendChild(r)),U(),fe(t)}function U(){r&&(r.innerHTML=y.map((e,t)=>{let n=b[e]||"";return"<div class='"+(t===v?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+t+"'><span class='var-ac-name'>"+m(e)+"</span><span class='var-ac-value'>"+m(n)+"</span></div>"}).join(""),r.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",t=>{t.preventDefault();let n=parseInt(e.dataset.index||"0");ne(y[n])})}))}function ge(e){let t=document.createElement("div"),n=window.getComputedStyle(e);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","paddingTop","paddingLeft","paddingRight","paddingBottom","borderWidth","boxSizing","whiteSpace","wordWrap","overflowWrap","tabSize"].forEach(C=>{t.style[C]=n.getPropertyValue(C.replace(/[A-Z]/g,q=>"-"+q.toLowerCase()))}),t.style.position="absolute",t.style.visibility="hidden",t.style.whiteSpace="pre-wrap",t.style.wordWrap="break-word",t.style.width=e.clientWidth+"px";let a=e.value.substring(0,e.selectionStart??0);t.textContent=a;let l=document.createElement("span");l.textContent="|",t.appendChild(l),document.body.appendChild(t);let d=l.getBoundingClientRect(),u=e.getBoundingClientRect(),p={top:u.top+(d.top-t.getBoundingClientRect().top)-e.scrollTop,left:u.left+(d.left-t.getBoundingClientRect().left)-e.scrollLeft};return document.body.removeChild(t),p}function fe(e){if(r){if(D){let t=window.getSelection();if(t&&t.rangeCount>0){let o=t.getRangeAt(0).getBoundingClientRect();r.style.left=o.left+"px",r.style.top=o.bottom+4+"px"}else{let n=e.getBoundingClientRect();r.style.left=n.left+"px",r.style.top=n.bottom+2+"px"}}else{let t=ge(e);r.style.left=t.left+"px",r.style.top=t.top+18+"px"}r.style.minWidth="220px"}}function ne(e){if(k){if(D){let t=k,n=t.textContent||"",o=window.getSelection(),a=n.length;if(o&&o.rangeCount>0){let q=o.getRangeAt(0),I=document.createRange();I.selectNodeContents(t),I.setEnd(q.startContainer,q.startOffset),a=I.toString().length}let l="{{"+e+"}}",d=a;n.substring(a).startsWith("}}")&&(d+=2);let p=n.substring(0,T)+l+n.substring(d);t.textContent=p,R();let C=T+l.length;Z(t,C)}else{let t=k,n=t.value,o=t.selectionStart??n.length,a="{{"+e+"}}",l=o;n.substring(o).startsWith("}}")&&(l+=2),t.value=n.substring(0,T)+a+n.substring(l);let u=T+a.length;t.selectionStart=u,t.selectionEnd=u,t.focus(),E()}f()}}function f(){r&&(r.remove(),r=null),k=null,y=[],v=0}function ae(e){!r||y.length===0||(e.key==="ArrowDown"?(e.preventDefault(),v=(v+1)%y.length,U()):e.key==="ArrowUp"?(e.preventDefault(),v=(v-1+y.length)%y.length,U()):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),ne(y[v])):e.key==="Escape"&&(e.preventDefault(),f()))}s("bodyData").addEventListener("keydown",e=>{r&&ae(e)});s("url").addEventListener("keydown",e=>{if(r){ae(e);return}e.key==="Enter"&&e.preventDefault()});s("bodyData").addEventListener("blur",()=>{setTimeout(f,150)});s("url").addEventListener("blur",()=>{setTimeout(f,150)});function K(){let e=s("authType").value,t=s("authFields");t.innerHTML="",e==="bearer"?t.innerHTML='<div class="auth-row"><label>Token</label><input type="text" id="authToken" placeholder="{{token}}" /></div>':e==="basic"?t.innerHTML='<div class="auth-row"><label>Username</label><input type="text" id="authUsername" placeholder="username" /></div><div class="auth-row"><label>Password</label><input type="password" id="authPassword" placeholder="password" /></div>':e==="apikey"&&(t.innerHTML='<div class="auth-row"><label>Key</label><input type="text" id="authKey" placeholder="X-Api-Key" /></div><div class="auth-row"><label>Value</label><input type="text" id="authValue" placeholder="{{apiKey}}" /></div><div class="auth-row"><label>In</label><select id="authPlacement" class="auth-select" style="margin:0;"><option value="header">Header</option><option value="query">Query</option></select></div>')}function se(){let e={info:M?M.info:{type:"http"},http:{method:H.value,url:ue(),headers:[],params:[]},settings:{timeout:parseInt(c("settingTimeout").value)||3e4,encodeUrl:c("settingEncodeUrl").checked,followRedirects:c("settingFollowRedirects").checked,maxRedirects:parseInt(c("settingMaxRedirects").value)||5}};if(document.querySelectorAll("#paramsBody tr").forEach(n=>{e.http.params.push({name:n.querySelector(".p-name").value,value:n.querySelector(".p-value").value,type:n.querySelector(".p-type").value,disabled:!n.querySelector(".p-enabled").checked})}),document.querySelectorAll("#headersBody tr").forEach(n=>{e.http.headers.push({name:n.querySelector(".h-name").value,value:n.querySelector(".h-value").value,disabled:!n.querySelector(".h-enabled").checked})}),S!=="none")if(S==="form-urlencoded"||S==="multipart-form"){let n=[];document.querySelectorAll("#bodyFormBody tr").forEach(o=>{n.push({name:o.querySelector(".f-name").value,value:o.querySelector(".f-value").value,disabled:!o.querySelector(".f-enabled").checked})}),e.http.body={type:S,data:n}}else e.http.body={type:L,data:s("bodyData").value};let t=s("authType").value;return t==="bearer"?e.http.auth={type:"bearer",token:c("authToken")?.value||""}:t==="basic"?e.http.auth={type:"basic",username:c("authUsername")?.value||"",password:c("authPassword")?.value||""}:t==="apikey"?e.http.auth={type:"apikey",key:c("authKey")?.value||"",value:c("authValue")?.value||"",placement:s("authPlacement")?.value||"header"}:t==="inherit"&&(e.http.auth="inherit"),e}function he(){let e=se();s("sendBtn").classList.add("sending"),s("sendBtn").disabled=!0,s("sendBtn").textContent="Sending...",h.postMessage({type:"sendRequest",request:e})}function oe(){let e=se();h.postMessage({type:"saveRequest",request:e})}function be(e){M=e;let t=e.http||{};if(H.value=(t.method||"GET").toUpperCase(),j(),pe(t.url||""),s("paramsBody").innerHTML="",(t.params||[]).forEach(a=>z(a.name,a.value,a.type||"query",a.disabled)),s("headersBody").innerHTML="",(t.headers||[]).forEach(a=>J(a.name,a.value,a.disabled)),t.body){let a=Array.isArray(t.body)?(t.body.find(l=>l.selected)||t.body[0])?.body:t.body;a&&(a.type==="form-urlencoded"||a.type==="multipart-form"?(B(a.type),s("bodyFormBody").innerHTML="",(a.data||[]).forEach(l=>X(l.name,l.value,l.disabled))):(B("raw"),L=a.type||"json",s("bodyLangMode").value=L,a.data&&(s("bodyData").value=a.data),E()))}else B("none");let n=t.auth;n==="inherit"?s("authType").value="inherit":n&&n.type?(s("authType").value=n.type,K(),n.type==="bearer"?setTimeout(()=>{let a=c("authToken");a&&(a.value=n.token||"")},0):n.type==="basic"?setTimeout(()=>{let a=c("authUsername");a&&(a.value=n.username||"");let l=c("authPassword");l&&(l.value=n.password||"")},0):n.type==="apikey"&&setTimeout(()=>{let a=c("authKey");a&&(a.value=n.key||"");let l=c("authValue");l&&(l.value=n.value||"");let d=s("authPlacement");d&&(d.value=n.placement||"header")},0)):s("authType").value="none",K();let o=e.settings||{};c("settingTimeout").value=o.timeout!==void 0&&o.timeout!=="inherit"?o.timeout:"30000",c("settingEncodeUrl").checked=o.encodeUrl!==void 0&&o.encodeUrl!=="inherit"?o.encodeUrl:!0,c("settingFollowRedirects").checked=o.followRedirects!==void 0&&o.followRedirects!=="inherit"?o.followRedirects:!0,c("settingMaxRedirects").value=o.maxRedirects!==void 0&&o.maxRedirects!=="inherit"?o.maxRedirects:"5",w()}function Ee(e){s("sendBtn").classList.remove("sending"),s("sendBtn").disabled=!1,s("sendBtn").textContent="Send",s("responseBar").style.display="flex",s("respTabs").style.display="flex",s("respEmpty").style.display="none",s("respBodyPre").style.display="block";let t=s("statusBadge");t.textContent=e.status+" "+e.statusText;let n=Math.floor(e.status/100);t.className="status-badge s"+n+"xx",s("responseMeta").textContent=e.duration+"ms \u2022 "+Le(e.size);let o=e.body||"";if((e.headers&&e.headers["content-type"]||"").includes("json"))try{o=JSON.stringify(JSON.parse(o),null,2)}catch{}s("respBodyPre").textContent=o;let l=s("respHeadersBody");l.innerHTML="",e.headers&&Object.entries(e.headers).forEach(([d,u])=>{let p=document.createElement("tr");p.innerHTML="<td>"+g(d)+"</td><td>"+g(String(u))+"</td>",l.appendChild(p)})}function Le(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}window.addEventListener("message",e=>{let t=e.data;switch(t.type){case"requestLoaded":be(t.request),O();break;case"response":Ee(t.response);break;case"sending":s("sendBtn").classList.add("sending"),s("sendBtn").disabled=!0,s("sendBtn").textContent="Sending...";break;case"saved":O(),s("saveBtn").textContent="Saved \u2713",setTimeout(()=>{s("saveBtn").textContent="Save"},1500);break;case"error":s("sendBtn").classList.remove("sending"),s("sendBtn").disabled=!1,s("sendBtn").textContent="Send";break;case"languageChanged":L=t.language,s("bodyLangMode").value=L,E();break;case"bodyUpdated":s("bodyData").value=t.content,E();break;case"variablesResolved":b=t.variables||{},E(),R();break;case"renamed":M&&M.info&&(M.info.name=t.name);break;case"setState":h.setState(t.state);break}});s("sendBtn").addEventListener("click",he);s("saveBtn").addEventListener("click",oe);s("addParamBtn").addEventListener("click",()=>z());s("addHeaderBtn").addEventListener("click",()=>J());s("addFormFieldBtn").addEventListener("click",()=>X());s("authType").addEventListener("change",()=>{K(),i()});s("panel-auth").addEventListener("input",i);s("panel-auth").addEventListener("change",i);s("panel-settings").addEventListener("input",i);s("panel-settings").addEventListener("change",i);s("bodyLangMode").addEventListener("change",()=>{L=s("bodyLangMode").value,E(),i()});document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&(e.preventDefault(),oe())});h.postMessage({type:"ready"});})();
