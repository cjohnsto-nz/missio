"use strict";(()=>{function T(e,n,t,o="text"){let a=`<input type="${o}" id="${e}" placeholder="${n}" />`;return t?`<span class="auth-input-wrap">${a}</span>`:a}function he(e,n){let{prefix:t,fieldsContainer:o,onChange:a,wrapInputs:s,showTokenStatus:l}=n;if(o.innerHTML="",e==="bearer")o.innerHTML=`<div class="auth-row"><label>Token</label>${T(t+"Token","{{token}}",s)}</div>`;else if(e==="basic")o.innerHTML=`<div class="auth-row"><label>Username</label>${T(t+"Username","username",s)}</div><div class="auth-row"><label>Password</label>${T(t+"Password","password",s,"password")}</div>`;else if(e==="apikey")o.innerHTML=`<div class="auth-row"><label>Key</label>${T(t+"Key","X-Api-Key",s)}</div><div class="auth-row"><label>Value</label>${T(t+"Value","{{apiKey}}",s)}</div><div class="auth-row"><label>In</label><select id="${t}Placement" class="auth-select"><option value="header">Header</option><option value="query">Query</option></select></div>`;else if(e==="oauth2"){o.innerHTML=`<div class="auth-row"><label>Grant Type</label><select id="${t}OAuth2Flow" class="auth-select"><option value="client_credentials">Client Credentials</option><option value="password">Password</option><option value="authorization_code">Authorization Code</option></select></div><div class="auth-row"><label>Access Token URL</label>${T(t+"OAuth2AccessTokenUrl","{{authUrl}}/token",s)}</div><div class="auth-row"><label>Client ID</label>${T(t+"OAuth2ClientId","{{clientId}}",s)}</div><div class="auth-row"><label>Client Secret</label>${T(t+"OAuth2ClientSecret","{{clientSecret}}",s)}</div><div class="auth-row"><label>Scope</label>${T(t+"OAuth2Scope","openid profile",s)}</div><div id="${t}OAuth2PasswordFields" style="display:none;"><div class="auth-row"><label>Username</label>${T(t+"OAuth2Username","{{username}}",s)}</div><div class="auth-row"><label>Password</label>${T(t+"OAuth2Password","password",s,"password")}</div></div><div id="${t}OAuth2AuthCodeFields" style="display:none;"><div class="auth-row"><label>Auth URL</label>${T(t+"OAuth2AuthorizationUrl","{{authUrl}}/authorize",s)}</div><div class="auth-row"><label>Callback URL</label>${T(t+"OAuth2CallbackUrl","https://localhost/callback",s)}</div></div><div class="auth-row"><label>Refresh URL</label>${T(t+"OAuth2RefreshTokenUrl","(optional)",s)}</div><div class="auth-row"><label>Credentials In</label><select id="${t}OAuth2CredentialsPlacement" class="auth-select"><option value="basic_auth_header">Header</option><option value="body">Body</option></select></div><div class="auth-row"><label>Auto Fetch</label><input type="checkbox" id="${t}OAuth2AutoFetch" checked /></div><div class="auth-row"><label>Auto Refresh</label><input type="checkbox" id="${t}OAuth2AutoRefresh" checked /></div>`+(l?`<div class="oauth2-token-status" id="${t}OAuth2TokenStatus"></div>`:"");let r=document.getElementById(t+"OAuth2Flow"),i=document.getElementById(t+"OAuth2PasswordFields"),u=document.getElementById(t+"OAuth2AuthCodeFields"),c=()=>{let v=r.value;i.style.display=v==="password"?"":"none",u.style.display=v==="authorization_code"?"":"none"};r.addEventListener("change",()=>{c(),a()}),c()}if(o.querySelectorAll("input").forEach(r=>{r.addEventListener("input",a),r.addEventListener("change",a)}),o.querySelectorAll("select").forEach(r=>r.addEventListener("change",a)),n.onFieldsRendered){let r=Array.from(o.querySelectorAll('input[type="text"]'));n.onFieldsRendered(r)}}function ee(e,n){let t=n,o=s=>document.getElementById(s),a=s=>document.getElementById(s);switch(e){case"bearer":return{type:"bearer",token:o(t+"Token")?.value||""};case"basic":return{type:"basic",username:o(t+"Username")?.value||"",password:o(t+"Password")?.value||""};case"apikey":return{type:"apikey",key:o(t+"Key")?.value||"",value:o(t+"Value")?.value||"",placement:a(t+"Placement")?.value||"header"};case"oauth2":{let s=a(t+"OAuth2Flow")?.value||"client_credentials",l={type:"oauth2",flow:s,accessTokenUrl:o(t+"OAuth2AccessTokenUrl")?.value||"",clientId:o(t+"OAuth2ClientId")?.value||"",clientSecret:o(t+"OAuth2ClientSecret")?.value||"",scope:o(t+"OAuth2Scope")?.value||"",refreshTokenUrl:o(t+"OAuth2RefreshTokenUrl")?.value||"",credentialsPlacement:a(t+"OAuth2CredentialsPlacement")?.value||"basic_auth_header",autoFetchToken:o(t+"OAuth2AutoFetch")?.checked!==!1,autoRefreshToken:o(t+"OAuth2AutoRefresh")?.checked!==!1};return s==="password"?(l.username=o(t+"OAuth2Username")?.value||"",l.password=o(t+"OAuth2Password")?.value||""):s==="authorization_code"&&(l.authorizationUrl=o(t+"OAuth2AuthorizationUrl")?.value||"",l.callbackUrl=o(t+"OAuth2CallbackUrl")?.value||""),l.refreshTokenUrl||delete l.refreshTokenUrl,l.scope||delete l.scope,l.clientSecret||delete l.clientSecret,l}case"inherit":return"inherit";default:return}}function ge(e,n){let t=n,o=s=>document.getElementById(s),a=s=>document.getElementById(s);if(!(!e||e==="inherit")&&!(typeof e!="object"||!e.type))switch(e.type){case"bearer":{let s=o(t+"Token");s&&(s.value=e.token||"");break}case"basic":{let s=o(t+"Username");s&&(s.value=e.username||"");let l=o(t+"Password");l&&(l.value=e.password||"");break}case"apikey":{let s=o(t+"Key");s&&(s.value=e.key||"");let l=o(t+"Value");l&&(l.value=e.value||"");let r=a(t+"Placement");r&&(r.value=e.placement||"header");break}case"oauth2":{let s=a(t+"OAuth2Flow");s&&(s.value=e.flow||"client_credentials",s.dispatchEvent(new Event("change")));let l=o(t+"OAuth2AccessTokenUrl");l&&(l.value=e.accessTokenUrl||"");let r=o(t+"OAuth2ClientId");r&&(r.value=e.clientId||"");let i=o(t+"OAuth2ClientSecret");i&&(i.value=e.clientSecret||"");let u=o(t+"OAuth2Scope");u&&(u.value=e.scope||"");let c=o(t+"OAuth2RefreshTokenUrl");c&&(c.value=e.refreshTokenUrl||"");let v=a(t+"OAuth2CredentialsPlacement");v&&(v.value=e.credentialsPlacement||"basic_auth_header");let p=o(t+"OAuth2AutoFetch");p&&(p.checked=e.autoFetchToken!==!1);let m=o(t+"OAuth2AutoRefresh");if(m&&(m.checked=e.autoRefreshToken!==!1),e.flow==="password"){let h=o(t+"OAuth2Username");h&&(h.value=e.username||"");let y=o(t+"OAuth2Password");y&&(y.value=e.password||"")}else if(e.flow==="authorization_code"){let h=o(t+"OAuth2AuthorizationUrl");h&&(h.value=e.authorizationUrl||"");let y=o(t+"OAuth2CallbackUrl");y&&(y.value=e.callbackUrl||"")}break}}}function Ge(e){if(e<=0)return"expired";let n=Math.floor(e/1e3);if(n<60)return`${n}s`;let t=Math.floor(n/60);return t<60?`${t}m ${n%60}s`:`${Math.floor(t/60)}h ${t%60}m`}function me(e){let n=`${e.prefix}OAuth2TokenStatus`,t=null,o=null;function a(){return document.getElementById(n)}function s(){t&&(clearInterval(t),t=null)}function l(){let v=e.buildAuth();!v||v.type!=="oauth2"||!v.accessTokenUrl||e.postMessage({type:"getTokenStatus",auth:v})}function r(v){let p=a();if(!p)return;if(!v?.hasToken){p.innerHTML=`<div class="token-status token-none"><span class="token-dot dot-none"></span> No token<button class="token-btn" id="${n}-get">Get Token</button></div>`,p.querySelector(`#${n}-get`)?.addEventListener("click",()=>{let $=e.buildAuth();e.postMessage({type:"getToken",auth:$})});return}let m=Date.now(),h=v.expiresAt?v.expiresAt-m:void 0,y=h!==void 0&&h<=0,Z=y?"dot-expired":"dot-valid",q=y?"Expired":h!==void 0?`Expires in ${Ge(h)}`:"Valid (no expiry)",x=v.expiresAt?new Date(v.expiresAt).toLocaleTimeString():"";p.innerHTML='<div class="token-status '+(y?"token-expired":"token-valid")+'"><span class="token-dot '+Z+'"></span> '+q+(x?'<span class="token-expiry-time"> ('+e.esc(x)+")</span>":"")+`<button class="token-btn" id="${n}-refresh">${y?"Get Token":"Refresh"}</button></div>`,p.querySelector(`#${n}-refresh`)?.addEventListener("click",()=>{let $=e.buildAuth();e.postMessage({type:"getToken",auth:$})})}function i(v){o=v,s(),r(v),v?.expiresAt&&(t=setInterval(()=>{r(o),o?.expiresAt&&Date.now()>o.expiresAt&&s()},1e3))}function u(v){let p=a();if(!p||!v)return;s();let m=v.startsWith("Error:");p.innerHTML='<div class="token-status '+(m?"token-error":"token-progress")+'">'+(m?'<span class="token-dot dot-expired"></span> ':'<span class="token-spinner"></span> ')+e.esc(v)+"</div>"}function c(){s()}return{requestStatus:l,handleStatus:i,handleProgress:u,dispose:c}}var Je=/\{\{(\s*[\w.$-]+\s*)\}\}/g,ye=/^[\w.$-]*$/;function S(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Xe=new Set(["$guid","$timestamp","$randomInt"]);function be(e,n){return e.replace(Je,(t,o)=>{let a=o.trim(),s=a in n.resolved,l=Xe.has(a),r=n.secretKeys?.has(a)??!1,i=s||l||r,u=n.sources[a]||(r?"secret":l?"dynamic":"unknown");return n.showResolved&&s?"<span class='"+("tk-var-resolved tk-src-"+u)+"' data-var='"+S(a)+"' title='{{"+S(a)+"}} ("+u+")'>"+S(n.resolved[a])+"</span>":"<span class='"+(i?"tk-var tk-src-"+u:"tk-var tk-var-unresolved")+"' data-var='"+S(a)+"'>{{"+S(o)+"}}</span>"})}var Ee=()=>({});function Te(e){Ee=e}var g=null,w=[],H=0,B=null,L=0,W=!1,se=null,Ye=[{name:"$guid",detail:"Generate a random UUID"},{name:"$timestamp",detail:"Current Unix timestamp"},{name:"$randomInt",detail:"Random integer 0\u20131000"}],te=[],Se=new Map;function xe(e){te=e}function _(e,n){Se.set(e,n)}function we(e,n){let t=e.substring(0,n),o=t.lastIndexOf("{{");if(o===-1)return null;let a=t.substring(o+2);if(a.includes("}}"))return null;let s=a.trim();return ye.test(s)?s:null}function oe(e,n){let t=e.selectionStart??0,o=we(e.value,t);if(o===null){k();return}B=e,W=!1,L=e.value.lastIndexOf("{{",t-1),Le(o,e,n)}function ae(e,n){let t=window.getSelection();if(!t||t.rangeCount===0)return;let o=e.textContent||"",a=t.getRangeAt(0),s=document.createRange();s.selectNodeContents(e),s.setEnd(a.startContainer,a.startOffset);let l=s.toString().length,r=we(o,l);if(r===null){k();return}B=e,W=!0,L=o.lastIndexOf("{{",l-1),Le(r,e,n)}function Le(e,n,t){se=t;let o=e.toLowerCase(),a=[],s=Ee();for(let r of Object.keys(s))a.push({name:r,detail:s[r]});for(let r of Ye)a.push(r);if(o===""||"$secret".startsWith(o))te.length>0&&a.push({name:"$secret",detail:"Secret provider"});else if(o.startsWith("$secret.")){let r=o.substring(8),i=r.indexOf(".");if(i===-1)for(let u of te)u.toLowerCase().startsWith(r)&&a.push({name:"$secret."+u,detail:"Key Vault provider"});else{let u=r.substring(0,i),c=r.substring(i+1),v=Se.get(u)||[];for(let p of v)p.toLowerCase().startsWith(c)&&a.push({name:"$secret."+u+"."+p,displayName:p,detail:"Secret"})}}let l=new Set;w=[];for(let r of a)r.name.toLowerCase().startsWith(o)&&!l.has(r.name)&&(l.add(r.name),w.push(r));if(w.length===0){k();return}H=0,g||(g=document.createElement("div"),g.className="var-autocomplete",document.body.appendChild(g)),ne(),Ze(n)}function ne(){g&&(g.innerHTML=w.map((e,n)=>"<div class='"+(n===H?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+n+"'><span class='var-ac-name'>"+S(e.displayName||e.name)+"</span><span class='var-ac-value'>"+S(e.detail||"")+"</span></div>").join(""),g.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",n=>{n.preventDefault();let t=parseInt(e.dataset.index||"0");Me(w[t].name)})}))}function Qe(e){let n=document.createElement("div"),t=window.getComputedStyle(e);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","paddingTop","paddingLeft","paddingRight","paddingBottom","borderWidth","boxSizing","whiteSpace","wordWrap","overflowWrap","tabSize"].forEach(u=>{n.style[u]=t.getPropertyValue(u.replace(/[A-Z]/g,c=>"-"+c.toLowerCase()))}),n.style.position="absolute",n.style.visibility="hidden",n.style.whiteSpace="pre-wrap",n.style.wordWrap="break-word",n.style.width=e.clientWidth+"px";let a=e.value.substring(0,e.selectionStart??0);n.textContent=a;let s=document.createElement("span");s.textContent="|",n.appendChild(s),document.body.appendChild(n);let l=s.getBoundingClientRect(),r=e.getBoundingClientRect(),i={top:r.top+(l.top-n.getBoundingClientRect().top)-e.scrollTop,left:r.left+(l.left-n.getBoundingClientRect().left)-e.scrollLeft};return document.body.removeChild(n),i}function Ze(e){if(g){if(W){let n=window.getSelection();if(n&&n.rangeCount>0){let o=n.getRangeAt(0).getBoundingClientRect();g.style.left=o.left+"px",g.style.top=o.bottom+4+"px"}else{let t=e.getBoundingClientRect();g.style.left=t.left+"px",g.style.top=t.bottom+2+"px"}}else{let n=Qe(e);g.style.left=n.left+"px",g.style.top=n.top+18+"px"}g.style.minWidth="220px"}}var ke=null,Ae=null,Ce=null,P=null;function He(e,n,t,o){ke=e,Ae=n,Ce=t,P=o||null}function et(e){return!!(e==="$secret"||e.startsWith("$secret.")&&e.split(".").length===2)}function Me(e){if(!B)return;let n=et(e),t=B,o=W,a=se;if(o){let s=t,l=s,r=l._getRawText?l._getRawText():s.textContent||"",i=window.getSelection(),u=r.length;if(i&&i.rangeCount>0){let p=i.getRangeAt(0),m=document.createRange();m.selectNodeContents(s),m.setEnd(p.startContainer,p.startOffset),u=m.toString().length}let c,v;if(n){c="{{"+e+".";let p=u;r.substring(u).startsWith("}}")&&(p+=2);let h=r.substring(0,L)+c+r.substring(p);v=L+c.length,l._setRawText?l._setRawText(h):P&&P(h)}else{c="{{"+e+"}}";let p=u;r.substring(u).startsWith("}}")&&(p+=2);let h=r.substring(0,L)+c+r.substring(p);v=L+c.length,l._setRawText?l._setRawText(h):P&&P(h)}if(a?a():Ae?.(),Ce?.(s,v),n){k(),setTimeout(()=>{ae(s,a||(()=>{}))},0);return}}else{let s=t,l=s.value,r=s.selectionStart??l.length,i,u;if(n){i="{{"+e+".";let c=r;l.substring(r).startsWith("}}")&&(c+=2),s.value=l.substring(0,L)+i+l.substring(c),u=L+i.length}else{i="{{"+e+"}}";let c=r;l.substring(r).startsWith("}}")&&(c+=2),s.value=l.substring(0,L)+i+l.substring(c),u=L+i.length}if(s.selectionStart=u,s.selectionEnd=u,s.focus(),a?a():ke?.(),n){k(),setTimeout(()=>{oe(s,a||(()=>{}))},0);return}}k()}function k(){g&&(g.remove(),g=null),B=null,w=[],H=0,se=null}function re(e){return!g||w.length===0?!1:e.key==="ArrowDown"?(e.preventDefault(),H=(H+1)%w.length,ne(),!0):e.key==="ArrowUp"?(e.preventDefault(),H=(H-1+w.length)%w.length,ne(),!0):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),Me(w[H].name),!0):e.key==="Escape"?(e.preventDefault(),k(),!0):!1}function le(){return g!==null}var A=null,ie=null;function z(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function Re(e){A&&!A.contains(e.target)&&j()}function j(){A&&(A.remove(),A=null),ie=null,document.removeEventListener("click",Re)}function Ve(e){if(!A||e.secretRef!==ie)return;let n=A.querySelector(".var-secret-value"),t=A.querySelector('.var-action-btn[data-action="reveal"]');if(e.error){n&&(n.textContent=e.error,n.style.color="#f48771",n.style.fontStyle="normal"),t&&(t.textContent="Reveal Value");return}let o=e.value??"";U=o,n&&(n.textContent=o,n.style.cssText=""),t&&(t.textContent="Hide Value"),R=!0;let a=A.querySelector('.var-action-btn[data-action="copy"]');a&&(a.textContent="Copy Value",a.dataset.secretValue=o)}var U=null,R=!1;function ce(e,n,t){j(),U=null,R=!1;let o=e.getBoundingClientRect(),a=t.getResolvedVariables(),s=t.getVariableSources(),l=t.getSecretKeys?.()??new Set,r=n in a,i=l.has(n),u=s[n]||(i?"secret":"unknown"),c=u.charAt(0).toUpperCase()+u.slice(1),v=r||i,p=document.createElement("div");p.className="var-tooltip";let m;r?m="<div class='var-source tk-src-"+z(u)+"'>"+z(c)+"</div><div class='var-value'>"+z(a[n])+"</div>":i?m="<div class='var-source tk-src-secret'>Secret</div><div class='var-secret-value var-value' style='font-style:italic;opacity:0.7'>Value hidden</div>":m="<div class='var-unresolved'>Unresolved variable</div>";let h=[];t.onEditVariable&&!i&&h.push("<button class='var-action-btn' data-action='edit'>Edit</button>"),i&&!r&&t.postMessage&&h.push("<button class='var-action-btn' data-action='reveal'>Reveal Value</button>"),h.push("<button class='var-action-btn' data-action='copy'>"+(r?"Copy Value":"Copy Name")+"</button>"),p.innerHTML="<div class='var-name'>{{"+z(n)+"}}</div>"+m+"<div class='var-actions'>"+h.join("")+"</div>",p.style.left=o.left+"px",p.style.top=o.bottom+4+"px",document.body.appendChild(p),A=p,p.querySelectorAll(".var-action-btn").forEach(y=>{y.addEventListener("click",Z=>{Z.stopPropagation();let q=y.dataset.action;if(q==="edit"&&t.onEditVariable)t.onEditVariable(n),j();else if(q==="copy"){let $=y.dataset.secretValue??(r?a[n]:"{{"+n+"}}");navigator.clipboard.writeText($).catch(()=>{}),j()}else if(q==="reveal"){let x=p.querySelector(".var-secret-value");U!==null?(R=!R,x&&(R?(x.textContent=U,x.style.cssText=""):(x.textContent="\u2022".repeat(Math.min(U.length,20)),x.style.cssText="")),y.textContent=R?"Hide Value":"Show Value"):(ie=n,x&&(x.textContent="Resolving\u2026",x.style.cssText="font-style:italic;opacity:0.7"),y.textContent="Resolving\u2026",t.postMessage({type:"resolveSecret",secretRef:n}))}})}),setTimeout(()=>{document.addEventListener("click",Re)},0)}var F={},J={},N=!1,X=new Set,tt=null,ue=null;function Oe(e){ue=e}function ve(){return N}function Ie(e){N=e}function G(e){return be(e,{resolved:F,sources:J,showResolved:N,secretKeys:X})}function de(e,n){let t=window.getSelection();if(!t)return;let o=document.createRange(),a=0,s=!1;function l(r){if(r.nodeType===Node.TEXT_NODE){let i=(r.textContent||"").length;if(a+i>=n)return o.setStart(r,n-a),o.collapse(!0),!0;a+=i}else for(let i=0;i<r.childNodes.length;i++)if(l(r.childNodes[i]))return!0;return!1}s=l(e),s||(o.selectNodeContents(e),o.collapse(!1)),t.removeAllRanges(),t.addRange(o)}function V(){document.querySelectorAll(".var-cell").forEach(e=>{let n=e.querySelector('input[type="text"]'),t=e.querySelector(".var-overlay");n&&t&&e.classList.contains("var-overlay-active")&&(t.innerHTML=G(S(n.value)))}),document.querySelectorAll(".val-ce").forEach(e=>{let n=e._getRawText;if(n&&document.activeElement!==e){let t=n();t&&(e.innerHTML=G(S(t)))}})}function qe(e){let n=e.parentElement;n.classList.add("var-cell");let t=document.createElement("div");t.className="var-overlay",n.appendChild(t);function o(){t.innerHTML=G(S(e.value))}function a(){n.classList.add("var-overlay-active"),o()}function s(){n.classList.remove("var-overlay-active")}e.addEventListener("input",()=>{o(),oe(e,o)}),e.addEventListener("focus",s),e.addEventListener("blur",()=>{a(),k()}),e.addEventListener("keydown",l=>{le()&&re(l)}),t.addEventListener("click",l=>{let r=l.target.closest(".tk-var, .tk-var-resolved");r&&r.dataset.var?ce(r,r.dataset.var,{getResolvedVariables:()=>F,getVariableSources:()=>J,getSecretKeys:()=>X,postMessage:ue??void 0}):(s(),e.focus())}),document.activeElement!==e&&a()}function D(e,n,t){let o=n||"";e._getRawText=()=>o,e._setRawText=s=>{o=s};function a(){if(!o){e.innerHTML="";return}let s=window.getSelection(),l=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let r=s.getRangeAt(0),i=document.createRange();i.selectNodeContents(e),i.setEnd(r.startContainer,r.startOffset),l=i.toString().length}e.innerHTML=G(S(o)),s&&document.activeElement===e&&de(e,l)}a(),e.addEventListener("input",()=>{if(N){N=!1,V(),tt?.();return}let s=window.getSelection(),l=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let r=s.getRangeAt(0),i=document.createRange();i.selectNodeContents(e),i.setEnd(r.startContainer,r.startOffset),l=i.toString().length}o=e.textContent||"",a(),de(e,l),t(),ae(e,a)}),e.addEventListener("keydown",s=>{le()&&re(s)}),e.addEventListener("blur",()=>{k()}),e.addEventListener("click",s=>{let l=s.target.closest(".tk-var, .tk-var-resolved");l&&l.dataset.var&&ce(l,l.dataset.var,{getResolvedVariables:()=>F,getVariableSources:()=>J,getSecretKeys:()=>X,postMessage:ue??void 0})})}function $e(e){if(e.type!=="variablesResolved")return!1;F=e.variables||{},J=e.sources||{},xe(e.secretProviderNames||[]);let n=e.secretNames||{},t=new Set;for(let[o,a]of Object.entries(n)){_(o,a);for(let s of a)t.add(`$secret.${o}.${s}`)}return X=t,V(),!0}var Pe=null;function Be(e){Pe=e}document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&Pe?.()});function _e(e){Te(()=>F),He(()=>{V(),e?.extraSyncHighlight?.()},()=>{V(),e?.extraSyncUrlHighlight?.()},de,e?.setRawUrl)}var K=acquireVsCodeApi(),b=null,fe=!1,Q=!1,E=-1,O=null;function d(e){return document.getElementById(e)}function C(e){if(!e)return"";let n=document.createElement("div");return n.textContent=e,n.innerHTML}function f(){Q||(O&&clearTimeout(O),O=setTimeout(()=>{b&&Ue()},400))}function Ue(){let e=JSON.parse(JSON.stringify(b));e.info=e.info||{},e.info.name=d("infoName").value||void 0,e.info.version=d("infoVersion").value||void 0;let n=d("infoSummary").value;n?e.info.summary=n:delete e.info.summary;let t=[];document.querySelectorAll("#defaultHeadersBody tr").forEach(r=>{let i=r.querySelector('input[type="text"]'),u=r.querySelector(".val-ce"),c=r.querySelector('input[type="checkbox"]');if(i?.value){let v={name:i.value,value:u?._getRawText?u._getRawText():u?.textContent||""};c&&!c.checked&&(v.disabled=!0),t.push(v)}}),e.request||(e.request={}),e.request.headers=t.length>0?t:void 0;let o=d("defaultAuthType").value,a=ee(o,"dAuth");a!==void 0?e.request.auth=a:delete e.request.auth;let s=[];document.querySelectorAll("#defaultVarsBody tr").forEach(r=>{let i=r.querySelector('input[type="text"]'),u=r.querySelector(".val-ce"),c=r.querySelector('input[type="checkbox"]');if(i?.value){let v={name:i.value,value:u?._getRawText?u._getRawText():u?.textContent||""};c&&!c.checked&&(v.disabled=!0),s.push(v)}}),e.request=e.request||{},e.request.variables=s.length>0?s:void 0,e.request&&Object.keys(e.request).every(r=>e.request[r]===void 0)&&delete e.request;let l=ut();e.config||(e.config={}),e.config.secretProviders=l.length>0?l:void 0,fe=!0,K.postMessage({type:"updateDocument",collection:e})}function Ne(e){let n=d(e);n&&n.querySelectorAll(".tab").forEach(t=>{t.addEventListener("click",()=>{let o=t.dataset.tab;n.querySelectorAll(".tab").forEach(l=>l.classList.remove("active")),t.classList.add("active");let a=n.parentElement;a.querySelectorAll(":scope > .tab-content > .tab-panel").forEach(l=>l.classList.remove("active"));let s=a.querySelector(`#panel-${o}`);s&&s.classList.add("active")})})}function nt(e){let n=d("defaultHeadersBody");n.innerHTML="",(e||[]).forEach(t=>Fe(t.name,t.value,t.disabled))}function Fe(e,n,t){let o=d("defaultHeadersBody"),a=document.createElement("tr");a.innerHTML=`<td><input type="checkbox" ${t?"":"checked"} /></td><td><input type="text" value="${C(e||"")}" placeholder="Header name" /></td><td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="Header value"></div></td><td><button class="row-delete">\xD7</button></td>`,a.querySelector(".row-delete").addEventListener("click",()=>{a.remove(),f()}),a.querySelector('input[type="text"]').addEventListener("input",f),a.querySelector('input[type="checkbox"]').addEventListener("change",f),D(a.querySelector(".val-ce"),n||"",f),o.appendChild(a)}function st(e){let n=d("defaultVarsBody");n.innerHTML="",(e||[]).forEach(t=>De(t.name,t.value,t.disabled))}function De(e,n,t){let o=d("defaultVarsBody"),a=document.createElement("tr"),s=typeof n=="string"?n:n&&n.data?n.data:"";a.innerHTML=`<td><input type="checkbox" ${t?"":"checked"} /></td><td><input type="text" value="${C(e||"")}" placeholder="Variable name" /></td><td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="Variable value"></div></td><td><button class="row-delete">\xD7</button></td>`,a.querySelector(".row-delete").addEventListener("click",()=>{a.remove(),f()}),a.querySelector('input[type="text"]').addEventListener("input",f),a.querySelector('input[type="checkbox"]').addEventListener("change",f),D(a.querySelector(".val-ce"),s,f),o.appendChild(a)}var ot={prefix:"dAuth",get fieldsContainer(){return d("defaultAuthFields")},onChange:()=>f(),showInherit:!1,wrapInputs:!0,showTokenStatus:!0,onFieldsRendered:e=>e.forEach(n=>qe(n))},Y=me({prefix:"dAuth",buildAuth:()=>ee(d("defaultAuthType").value,"dAuth"),postMessage:e=>K.postMessage(e),esc:C});function Ke(){let e=d("defaultAuthType").value;he(e,ot),e==="oauth2"&&Y.requestStatus()}var We=[{token:"charts.red",hex:"var(--vscode-charts-red, #f14c4c)"},{token:"charts.orange",hex:"var(--vscode-charts-orange, #d18616)"},{token:"charts.yellow",hex:"var(--vscode-charts-yellow, #cca700)"},{token:"charts.green",hex:"var(--vscode-charts-green, #89d185)"},{token:"charts.blue",hex:"var(--vscode-charts-blue, #3794ff)"},{token:"charts.purple",hex:"var(--vscode-charts-purple, #b180d7)"},{token:"charts.foreground",hex:"var(--vscode-charts-foreground, #cccccc)"},{token:"terminal.ansiRed",hex:"var(--vscode-terminal-ansiRed, #cd3131)"},{token:"terminal.ansiGreen",hex:"var(--vscode-terminal-ansiGreen, #0dbc79)"},{token:"terminal.ansiYellow",hex:"var(--vscode-terminal-ansiYellow, #e5e510)"},{token:"terminal.ansiBlue",hex:"var(--vscode-terminal-ansiBlue, #2472c8)"},{token:"terminal.ansiMagenta",hex:"var(--vscode-terminal-ansiMagenta, #bc3fbc)"},{token:"terminal.ansiCyan",hex:"var(--vscode-terminal-ansiCyan, #11a8cd)"},{token:"terminal.ansiWhite",hex:"var(--vscode-terminal-ansiWhite, #e5e5e5)"}];function I(){let e=d("envSelector");e.innerHTML="";let n=b?.config?.environments||[];if(n.length===0){let t=document.createElement("option");t.value="-1",t.textContent="No environments",e.appendChild(t),e.disabled=!0}else e.disabled=!1,n.forEach((t,o)=>{let a=document.createElement("option");a.value=String(o),a.textContent=t.name||"Unnamed",e.appendChild(a)}),e.value=String(E)}function ze(e){E=e,I(),M()}function at(){let e=b?.config?.environments||[];E<0||E>=e.length||(e.splice(E,1),E>=e.length&&(E=e.length-1),I(),M(),f())}function rt(){b.config||(b.config={}),b.config.environments||(b.config.environments=[]),b.config.environments.push({name:"new-environment",variables:[]}),E=b.config.environments.length-1,I(),M(),f()}function pe(){let e=document.querySelector(".swatch-popover");e&&e.remove()}function lt(e,n){pe();let t=document.createElement("div");t.className="swatch-popover",We.forEach(a=>{let s=document.createElement("button");s.className="color-swatch"+(a.token===n.color?" active":""),s.style.background=a.hex,s.addEventListener("click",l=>{l.stopPropagation(),n.color=a.token,pe(),I(),M(),f()}),t.appendChild(s)});let o=e.getBoundingClientRect();t.style.top=o.bottom+4+"px",t.style.left=o.left+"px",document.body.appendChild(t),setTimeout(()=>{document.addEventListener("click",function a(){pe(),document.removeEventListener("click",a)})},0)}function M(){let e=d("envDetail"),n=b?.config?.environments||[];if(E<0||E>=n.length){e.innerHTML='<div class="env-detail-empty">Add an environment to get started</div>';return}let t=n[E],o=t.color||"",a=We.find(r=>r.token===o),s=a?a.hex:"var(--vscode-charts-foreground, #888)";e.innerHTML='<div class="env-meta"><button class="color-dot-btn" id="envColorBtn" style="background:'+s+'" title="Pick color"></button><div class="form-field name"><label>Name</label><input type="text" id="envName" value="'+C(t.name)+'" /></div><div class="form-field extends"><label>Extends</label><input type="text" id="envExtends" value="'+C(t.extends||"")+'" placeholder="parent env name" /></div></div><div class="tabs" id="envTabs"><div class="tab active" data-tab="env-vars">Variables <span class="badge" id="envVarsBadge">'+(t.variables?t.variables.length:0)+'</span></div><div class="tab" data-tab="env-settings">Settings</div></div><div class="tab-content"><div class="tab-panel active" id="panel-env-vars"><table class="kv-table"><colgroup><col style="width:32px"><col style="width:25%"><col><col style="width:70px"><col style="width:32px"></colgroup><thead><tr><th></th><th>Name</th><th>Value</th><th>Type</th><th></th></tr></thead><tbody id="envVarsBody"></tbody></table><button class="add-row-btn" id="addEnvVarBtn">+ Add Variable</button></div><div class="tab-panel" id="panel-env-settings"><div class="auth-section"><div class="auth-row"><label>dotenv File</label><input type="text" id="envDotenv" value="'+C(t.dotEnvFilePath||"")+'" placeholder=".env.local" /></div></div></div></div>',d("envName").addEventListener("input",()=>{t.name=d("envName").value,I(),f()}),d("envColorBtn").addEventListener("click",r=>{r.stopPropagation(),lt(d("envColorBtn"),t)}),d("envExtends").addEventListener("input",()=>{let r=d("envExtends").value;r?t.extends=r:delete t.extends,f()}),d("envDotenv")?.addEventListener("input",()=>{let r=d("envDotenv").value;r?t.dotEnvFilePath=r:delete t.dotEnvFilePath,f()});let l=d("envVarsBody");(t.variables||[]).forEach((r,i)=>{it(l,t,i)}),d("addEnvVarBtn").addEventListener("click",()=>{t.variables||(t.variables=[]),t.variables.push({name:"",value:""}),M(),f()}),Ne("envTabs")}function it(e,n,t){let o=n.variables[t],a=document.createElement("tr"),s=o.secret===!0,l=o.disabled?"":"checked",r=s?o.value||"":typeof o.value=="string"?o.value:o.value&&o.value.data?o.value.data:"";a.innerHTML=`<td><input type="checkbox" ${l} data-field="disabled" /></td><td><input type="text" value="${C(o.name||"")}" data-field="name" /></td>${s?'<td><div class="secret-value-wrap"><input type="password" value="'+C(r)+'" data-field="value" /><button class="secret-toggle" title="Show/hide">&#9673;</button></div></td>':'<td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="value" data-field="value"></div></td>'}<td><select class="type-select select-borderless" data-field="type"><option value="var"${s?"":" selected"}>var</option><option value="secret"${s?" selected":""}>secret</option></select></td><td><button class="row-delete">\xD7</button></td>`,a.querySelectorAll("input[data-field]").forEach(c=>{let v=c.dataset.field;c.type==="checkbox"?c.addEventListener("change",()=>{n.variables[t].disabled=!c.checked,f()}):c.addEventListener("input",()=>{n.variables[t][v]=c.value,f()})});let i=a.querySelector(".type-select");if(i?.addEventListener("change",()=>{i.value==="secret"?n.variables[t].secret=!0:delete n.variables[t].secret,M(),f()}),a.querySelector(".secret-toggle")?.addEventListener("click",()=>{let c=a.querySelector('input[data-field="value"]');c&&(c.type=c.type==="password"?"text":"password")}),a.querySelector(".row-delete")?.addEventListener("click",()=>{n.variables.splice(t,1),M(),f()}),!s){let c=a.querySelector('.val-ce[data-field="value"]');c&&D(c,r,()=>{n.variables[t].value=c._getRawText?c._getRawText():c.textContent||"",f()})}e.appendChild(a)}function ct(e){Q=!0,b=JSON.parse(JSON.stringify(e)),d("collectionName").textContent=e.info?.name||"Collection",d("infoName").value=e.info?.name||"",d("infoVersion").value=e.info?.version||"",d("infoSummary").value=e.info?.summary||"",nt(e.request?.headers||[]),st(e.request?.variables||[]);let n=e.request?.auth;n&&typeof n=="object"&&n.type?d("defaultAuthType").value=n.type:d("defaultAuthType").value="none",Ke(),n&&typeof n=="object"&&n.type&&setTimeout(()=>{ge(n,"dAuth")},0),d("headersBadge").textContent=String((e.request?.headers||[]).length),d("variablesBadge").textContent=String((e.request?.variables||[]).length),dt(e.config?.secretProviders||[]);let t=b?.config?.environments||[];d("envBadge").textContent=String(t.length),E<0&&t.length>0&&(E=0),E>=t.length&&(E=t.length-1),I(),M(),setTimeout(()=>{Q=!1},50)}window.addEventListener("message",e=>{let n=e.data;if(n.type==="collectionLoaded"){if(fe){fe=!1;return}ct(n.collection)}if($e(n)&&Y.requestStatus(),n.type==="oauth2TokenStatus"&&Y.handleStatus(n.status),n.type==="oauth2Progress"&&Y.handleProgress(n.message),n.type==="testSecretProviderResult"){let o=d("secretProvidersBody").children[n.providerIdx];if(o){let s=o.querySelector(".btn-test-vault");s&&(s.disabled=!1,s.textContent="Test")}n.success&&n.providerName&&n.secretNames&&_(n.providerName,n.secretNames);let a=d("secretTestResult");n.success?a.innerHTML=`<span style="color:var(--badge-success);">\u2713 Connected \u2014 ${n.secretCount} secret${n.secretCount===1?"":"s"} found</span>`:a.innerHTML=`<span style="color:var(--badge-error);">\u2717 ${C(n.error||"Connection failed")}</span>`,setTimeout(()=>{a.innerHTML=""},1e4)}if(n.type==="secretNamesResult"&&n.providerName&&n.secretNames&&_(n.providerName,n.secretNames),n.type==="secretValueResolved"&&Ve(n),n.type==="switchTab"){let t=n.tab,a=d("mainTabs").querySelector(`.tab[data-tab="${t}"]`);if(a&&a.click(),n.envName&&b?.config?.environments){let l=b.config.environments.findIndex(r=>r.name===n.envName);l>=0&&ze(l)}}});function dt(e){let n=d("secretProvidersBody");n.innerHTML="",(e||[]).forEach(t=>je(t.name,t.type,t.url,t.disabled)),d("secretsBadge").textContent=String((e||[]).length)}function je(e,n,t,o){let a=d("secretProvidersBody"),s=document.createElement("tr"),l=n||"azure-keyvault";s.innerHTML=`<td><input type="text" value="${C(e||"")}" placeholder="my-vault" class="sp-name" /></td><td><select class="type-select select-borderless sp-type"><option value="azure-keyvault"${l==="azure-keyvault"?" selected":""}>Azure Key Vault</option></select></td><td class="val-cell"><div class="val-ce sp-url" contenteditable="true" data-placeholder="https://{{vault-name}}.vault.azure.net"></div></td><td><button class="btn-test-vault" title="Test connection">Test</button></td><td><button class="row-delete">\xD7</button></td>`,s.querySelector(".row-delete").addEventListener("click",()=>{s.remove(),d("secretsBadge").textContent=String(a.children.length),f()}),s.querySelector(".sp-name").addEventListener("input",f),s.querySelector(".sp-type").addEventListener("change",f),D(s.querySelector(".sp-url"),t||"",f);let r=s.querySelector(".btn-test-vault");r.addEventListener("click",()=>{let i=s.querySelector(".sp-name").value,u=s.querySelector(".sp-type").value,c=s.querySelector(".sp-url"),v=c._getRawText?c._getRawText():c.textContent||"";r.disabled=!0,r.innerHTML='<span class="spinner"></span>';let p=s.querySelector(".sp-test-result");p&&p.remove(),K.postMessage({type:"testSecretProvider",providerIdx:Array.from(a.children).indexOf(s),provider:{name:i,type:u,url:v}})}),a.appendChild(s)}function ut(){let e=[];return document.querySelectorAll("#secretProvidersBody tr").forEach(n=>{let t=n.querySelector(".sp-name"),o=n.querySelector(".sp-type"),a=n.querySelector(".sp-url");t?.value&&e.push({name:t.value,type:o?.value||"azure-keyvault",url:a?._getRawText?a._getRawText():a?.textContent||""})}),e}_e();Oe(e=>K.postMessage(e));Be(()=>{O&&(clearTimeout(O),O=null),!Q&&b&&Ue()});Ne("mainTabs");d("addDefaultHeaderBtn").addEventListener("click",()=>{Fe(),f()});d("addDefaultVarBtn").addEventListener("click",()=>{De(),f()});d("defaultAuthType").addEventListener("change",Ke);d("varToggleBtn").addEventListener("click",()=>{Ie(!ve()),d("varToggleBtn").classList.toggle("active",ve()),V()});d("addSecretProviderBtn").addEventListener("click",()=>{je(),d("secretsBadge").textContent=String(d("secretProvidersBody").children.length),f()});d("addEnvBtn").addEventListener("click",rt);d("removeEnvBtn").addEventListener("click",at);d("envSelector").addEventListener("change",()=>{let e=parseInt(d("envSelector").value,10);e>=0&&ze(e)});["infoName","infoVersion"].forEach(e=>{d(e).addEventListener("input",f)});d("infoSummary").addEventListener("input",f);K.postMessage({type:"ready"});})();
