"use strict";(()=>{function E(e,n,t,a="text"){let o=`<input type="${a}" id="${e}" placeholder="${n}" />`;return t?`<span class="auth-input-wrap">${o}</span>`:o}function le(e,n){let{prefix:t,fieldsContainer:a,onChange:o,wrapInputs:s,showTokenStatus:l}=n;if(a.innerHTML="",e==="bearer")a.innerHTML=`<div class="auth-row"><label>Token</label>${E(t+"Token","{{token}}",s)}</div>`;else if(e==="basic")a.innerHTML=`<div class="auth-row"><label>Username</label>${E(t+"Username","username",s)}</div><div class="auth-row"><label>Password</label>${E(t+"Password","password",s,"password")}</div>`;else if(e==="apikey")a.innerHTML=`<div class="auth-row"><label>Key</label>${E(t+"Key","X-Api-Key",s)}</div><div class="auth-row"><label>Value</label>${E(t+"Value","{{apiKey}}",s)}</div><div class="auth-row"><label>In</label><select id="${t}Placement" class="auth-select"><option value="header">Header</option><option value="query">Query</option></select></div>`;else if(e==="oauth2"){a.innerHTML=`<div class="auth-row"><label>Grant Type</label><select id="${t}OAuth2Flow" class="auth-select"><option value="client_credentials">Client Credentials</option><option value="password">Password</option><option value="authorization_code">Authorization Code</option></select></div><div class="auth-row"><label>Access Token URL</label>${E(t+"OAuth2AccessTokenUrl","{{authUrl}}/token",s)}</div><div class="auth-row"><label>Client ID</label>${E(t+"OAuth2ClientId","{{clientId}}",s)}</div><div class="auth-row"><label>Client Secret</label>${E(t+"OAuth2ClientSecret","{{clientSecret}}",s)}</div><div class="auth-row"><label>Scope</label>${E(t+"OAuth2Scope","openid profile",s)}</div><div id="${t}OAuth2PasswordFields" style="display:none;"><div class="auth-row"><label>Username</label>${E(t+"OAuth2Username","{{username}}",s)}</div><div class="auth-row"><label>Password</label>${E(t+"OAuth2Password","password",s,"password")}</div></div><div id="${t}OAuth2AuthCodeFields" style="display:none;"><div class="auth-row"><label>Auth URL</label>${E(t+"OAuth2AuthorizationUrl","{{authUrl}}/authorize",s)}</div><div class="auth-row"><label>Callback URL</label>${E(t+"OAuth2CallbackUrl","https://localhost/callback",s)}</div></div><div class="auth-row"><label>Refresh URL</label>${E(t+"OAuth2RefreshTokenUrl","(optional)",s)}</div><div class="auth-row"><label>Credentials In</label><select id="${t}OAuth2CredentialsPlacement" class="auth-select"><option value="basic_auth_header">Header</option><option value="body">Body</option></select></div><div class="auth-row"><label>Auto Fetch</label><input type="checkbox" id="${t}OAuth2AutoFetch" checked /></div><div class="auth-row"><label>Auto Refresh</label><input type="checkbox" id="${t}OAuth2AutoRefresh" checked /></div>`+(l?`<div class="oauth2-token-status" id="${t}OAuth2TokenStatus"></div>`:"");let r=document.getElementById(t+"OAuth2Flow"),c=document.getElementById(t+"OAuth2PasswordFields"),u=document.getElementById(t+"OAuth2AuthCodeFields"),i=()=>{let v=r.value;c.style.display=v==="password"?"":"none",u.style.display=v==="authorization_code"?"":"none"};r.addEventListener("change",()=>{i(),o()}),i()}if(a.querySelectorAll("input").forEach(r=>{r.addEventListener("input",o),r.addEventListener("change",o)}),a.querySelectorAll("select").forEach(r=>r.addEventListener("change",o)),n.onFieldsRendered){let r=Array.from(a.querySelectorAll('input[type="text"]'));n.onFieldsRendered(r)}}function z(e,n){let t=n,a=s=>document.getElementById(s),o=s=>document.getElementById(s);switch(e){case"bearer":return{type:"bearer",token:a(t+"Token")?.value||""};case"basic":return{type:"basic",username:a(t+"Username")?.value||"",password:a(t+"Password")?.value||""};case"apikey":return{type:"apikey",key:a(t+"Key")?.value||"",value:a(t+"Value")?.value||"",placement:o(t+"Placement")?.value||"header"};case"oauth2":{let s=o(t+"OAuth2Flow")?.value||"client_credentials",l={type:"oauth2",flow:s,accessTokenUrl:a(t+"OAuth2AccessTokenUrl")?.value||"",clientId:a(t+"OAuth2ClientId")?.value||"",clientSecret:a(t+"OAuth2ClientSecret")?.value||"",scope:a(t+"OAuth2Scope")?.value||"",refreshTokenUrl:a(t+"OAuth2RefreshTokenUrl")?.value||"",credentialsPlacement:o(t+"OAuth2CredentialsPlacement")?.value||"basic_auth_header",autoFetchToken:a(t+"OAuth2AutoFetch")?.checked!==!1,autoRefreshToken:a(t+"OAuth2AutoRefresh")?.checked!==!1};return s==="password"?(l.username=a(t+"OAuth2Username")?.value||"",l.password=a(t+"OAuth2Password")?.value||""):s==="authorization_code"&&(l.authorizationUrl=a(t+"OAuth2AuthorizationUrl")?.value||"",l.callbackUrl=a(t+"OAuth2CallbackUrl")?.value||""),l.refreshTokenUrl||delete l.refreshTokenUrl,l.scope||delete l.scope,l.clientSecret||delete l.clientSecret,l}case"inherit":return"inherit";default:return}}function ie(e,n){let t=n,a=s=>document.getElementById(s),o=s=>document.getElementById(s);if(!(!e||e==="inherit")&&!(typeof e!="object"||!e.type))switch(e.type){case"bearer":{let s=a(t+"Token");s&&(s.value=e.token||"");break}case"basic":{let s=a(t+"Username");s&&(s.value=e.username||"");let l=a(t+"Password");l&&(l.value=e.password||"");break}case"apikey":{let s=a(t+"Key");s&&(s.value=e.key||"");let l=a(t+"Value");l&&(l.value=e.value||"");let r=o(t+"Placement");r&&(r.value=e.placement||"header");break}case"oauth2":{let s=o(t+"OAuth2Flow");s&&(s.value=e.flow||"client_credentials",s.dispatchEvent(new Event("change")));let l=a(t+"OAuth2AccessTokenUrl");l&&(l.value=e.accessTokenUrl||"");let r=a(t+"OAuth2ClientId");r&&(r.value=e.clientId||"");let c=a(t+"OAuth2ClientSecret");c&&(c.value=e.clientSecret||"");let u=a(t+"OAuth2Scope");u&&(u.value=e.scope||"");let i=a(t+"OAuth2RefreshTokenUrl");i&&(i.value=e.refreshTokenUrl||"");let v=o(t+"OAuth2CredentialsPlacement");v&&(v.value=e.credentialsPlacement||"basic_auth_header");let p=a(t+"OAuth2AutoFetch");p&&(p.checked=e.autoFetchToken!==!1);let g=a(t+"OAuth2AutoRefresh");if(g&&(g.checked=e.autoRefreshToken!==!1),e.flow==="password"){let m=a(t+"OAuth2Username");m&&(m.value=e.username||"");let w=a(t+"OAuth2Password");w&&(w.value=e.password||"")}else if(e.flow==="authorization_code"){let m=a(t+"OAuth2AuthorizationUrl");m&&(m.value=e.authorizationUrl||"");let w=a(t+"OAuth2CallbackUrl");w&&(w.value=e.callbackUrl||"")}break}}}var H=null;function V(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function ce(e){H&&!H.contains(e.target)&&K()}function K(){H&&(H.remove(),H=null),document.removeEventListener("click",ce)}function j(e,n,t){K();let a=e.getBoundingClientRect(),o=t.getResolvedVariables(),s=t.getVariableSources(),l=n in o,r=s[n]||"unknown",c=r.charAt(0).toUpperCase()+r.slice(1),u=document.createElement("div");u.className="var-tooltip";let i=[];t.onEditVariable&&i.push("<button class='var-action-btn' data-action='edit'>Edit</button>"),i.push("<button class='var-action-btn' data-action='copy'>"+(l?"Copy Value":"Copy Name")+"</button>"),u.innerHTML="<div class='var-name'>{{"+V(n)+"}}</div>"+(l?"<div class='var-source tk-src-"+V(r)+"'>"+V(c)+"</div><div class='var-value'>"+V(o[n])+"</div>":"<div class='var-unresolved'>Unresolved variable</div>")+"<div class='var-actions'>"+i.join("")+"</div>",u.style.left=a.left+"px",u.style.top=a.bottom+4+"px",document.body.appendChild(u),H=u,u.querySelectorAll(".var-action-btn").forEach(v=>{v.addEventListener("click",()=>{let p=v.dataset.action;if(p==="edit"&&t.onEditVariable)t.onEditVariable(n);else if(p==="copy"){let g=l?o[n]:"{{"+n+"}}";navigator.clipboard.writeText(g).catch(()=>{})}K()})}),setTimeout(()=>{document.addEventListener("click",ce)},0)}function Oe(e){if(e<=0)return"expired";let n=Math.floor(e/1e3);if(n<60)return`${n}s`;let t=Math.floor(n/60);return t<60?`${t}m ${n%60}s`:`${Math.floor(t/60)}h ${t%60}m`}function de(e){let n=`${e.prefix}OAuth2TokenStatus`,t=null,a=null;function o(){return document.getElementById(n)}function s(){t&&(clearInterval(t),t=null)}function l(){let v=e.buildAuth();!v||v.type!=="oauth2"||!v.accessTokenUrl||e.postMessage({type:"getTokenStatus",auth:v})}function r(v){let p=o();if(!p)return;if(!v?.hasToken){p.innerHTML=`<div class="token-status token-none"><span class="token-dot dot-none"></span> No token<button class="token-btn" id="${n}-get">Get Token</button></div>`,p.querySelector(`#${n}-get`)?.addEventListener("click",()=>{let W=e.buildAuth();e.postMessage({type:"getToken",auth:W})});return}let g=Date.now(),m=v.expiresAt?v.expiresAt-g:void 0,w=m!==void 0&&m<=0,Re=w?"dot-expired":"dot-valid",Ie=w?"Expired":m!==void 0?`Expires in ${Oe(m)}`:"Valid (no expiry)",re=v.expiresAt?new Date(v.expiresAt).toLocaleTimeString():"";p.innerHTML='<div class="token-status '+(w?"token-expired":"token-valid")+'"><span class="token-dot '+Re+'"></span> '+Ie+(re?'<span class="token-expiry-time"> ('+e.esc(re)+")</span>":"")+`<button class="token-btn" id="${n}-refresh">${w?"Get Token":"Refresh"}</button></div>`,p.querySelector(`#${n}-refresh`)?.addEventListener("click",()=>{let W=e.buildAuth();e.postMessage({type:"getToken",auth:W})})}function c(v){a=v,s(),r(v),v?.expiresAt&&(t=setInterval(()=>{r(a),a?.expiresAt&&Date.now()>a.expiresAt&&s()},1e3))}function u(v){let p=o();if(!p||!v)return;s();let g=v.startsWith("Error:");p.innerHTML='<div class="token-status '+(g?"token-error":"token-progress")+'">'+(g?'<span class="token-dot dot-expired"></span> ':'<span class="token-spinner"></span> ')+e.esc(v)+"</div>"}function i(){s()}return{requestStatus:l,handleStatus:c,handleProgress:u,dispose:i}}var qe=/\{\{(\s*[\w.$-]+\s*)\}\}/g,ue=/^[\w.$-]*$/;function T(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var $e=new Set(["$guid","$timestamp","$randomInt"]);function ve(e,n){return e.replace(qe,(t,a)=>{let o=a.trim(),s=o in n.resolved,l=$e.has(o),r=n.sources[o]||(l?"dynamic":"unknown");return n.showResolved&&s?"<span class='"+("tk-var-resolved tk-src-"+r)+"' data-var='"+T(o)+"' title='{{"+T(o)+"}} ("+r+")'>"+T(n.resolved[o])+"</span>":"<span class='"+(s||l?"tk-var tk-src-"+r:"tk-var tk-var-unresolved")+"' data-var='"+T(o)+"'>{{"+T(a)+"}}</span>"})}var pe=()=>({});function fe(e){pe=e}var h=null,L=[],A=0,O=null,x=0,P=!1,X=null,Ve=[{name:"$guid",detail:"Generate a random UUID"},{name:"$timestamp",detail:"Current Unix timestamp"},{name:"$randomInt",detail:"Random integer 0\u20131000"}],G=[],he=new Map;function me(e){G=e}function B(e,n){he.set(e,n)}function ge(e,n){let t=e.substring(0,n),a=t.lastIndexOf("{{");if(a===-1)return null;let o=t.substring(a+2);if(o.includes("}}"))return null;let s=o.trim();return ue.test(s)?s:null}function Y(e,n){let t=e.selectionStart??0,a=ge(e.value,t);if(a===null){k();return}O=e,P=!1,x=e.value.lastIndexOf("{{",t-1),ye(a,e,n)}function Q(e,n){let t=window.getSelection();if(!t||t.rangeCount===0)return;let a=e.textContent||"",o=t.getRangeAt(0),s=document.createRange();s.selectNodeContents(e),s.setEnd(o.startContainer,o.startOffset);let l=s.toString().length,r=ge(a,l);if(r===null){k();return}O=e,P=!0,x=a.lastIndexOf("{{",l-1),ye(r,e,n)}function ye(e,n,t){X=t;let a=e.toLowerCase(),o=[],s=pe();for(let r of Object.keys(s))o.push({name:r,detail:s[r]});for(let r of Ve)o.push(r);if(a===""||"$secret".startsWith(a))G.length>0&&o.push({name:"$secret",detail:"Secret provider"});else if(a.startsWith("$secret.")){let r=a.substring(8),c=r.indexOf(".");if(c===-1)for(let u of G)u.toLowerCase().startsWith(r)&&o.push({name:"$secret."+u,detail:"Key Vault provider"});else{let u=r.substring(0,c),i=r.substring(c+1),v=he.get(u)||[];for(let p of v)p.toLowerCase().startsWith(i)&&o.push({name:"$secret."+u+"."+p,displayName:p,detail:"Secret"})}}let l=new Set;L=[];for(let r of o)r.name.toLowerCase().startsWith(a)&&!l.has(r.name)&&(l.add(r.name),L.push(r));if(L.length===0){k();return}A=0,h||(h=document.createElement("div"),h.className="var-autocomplete",document.body.appendChild(h)),J(),Be(n)}function J(){h&&(h.innerHTML=L.map((e,n)=>"<div class='"+(n===A?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+n+"'><span class='var-ac-name'>"+T(e.displayName||e.name)+"</span><span class='var-ac-value'>"+T(e.detail||"")+"</span></div>").join(""),h.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",n=>{n.preventDefault();let t=parseInt(e.dataset.index||"0");we(L[t].name)})}))}function Pe(e){let n=document.createElement("div"),t=window.getComputedStyle(e);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","paddingTop","paddingLeft","paddingRight","paddingBottom","borderWidth","boxSizing","whiteSpace","wordWrap","overflowWrap","tabSize"].forEach(u=>{n.style[u]=t.getPropertyValue(u.replace(/[A-Z]/g,i=>"-"+i.toLowerCase()))}),n.style.position="absolute",n.style.visibility="hidden",n.style.whiteSpace="pre-wrap",n.style.wordWrap="break-word",n.style.width=e.clientWidth+"px";let o=e.value.substring(0,e.selectionStart??0);n.textContent=o;let s=document.createElement("span");s.textContent="|",n.appendChild(s),document.body.appendChild(n);let l=s.getBoundingClientRect(),r=e.getBoundingClientRect(),c={top:r.top+(l.top-n.getBoundingClientRect().top)-e.scrollTop,left:r.left+(l.left-n.getBoundingClientRect().left)-e.scrollLeft};return document.body.removeChild(n),c}function Be(e){if(h){if(P){let n=window.getSelection();if(n&&n.rangeCount>0){let a=n.getRangeAt(0).getBoundingClientRect();h.style.left=a.left+"px",h.style.top=a.bottom+4+"px"}else{let t=e.getBoundingClientRect();h.style.left=t.left+"px",h.style.top=t.bottom+2+"px"}}else{let n=Pe(e);h.style.left=n.left+"px",h.style.top=n.top+18+"px"}h.style.minWidth="220px"}}var be=null,Ee=null,Te=null,I=null;function Le(e,n,t,a){be=e,Ee=n,Te=t,I=a||null}function Ne(e){return!!(e==="$secret"||e.startsWith("$secret.")&&e.split(".").length===2)}function we(e){if(!O)return;let n=Ne(e),t=O,a=P,o=X;if(a){let s=t,l=s,r=l._getRawText?l._getRawText():s.textContent||"",c=window.getSelection(),u=r.length;if(c&&c.rangeCount>0){let p=c.getRangeAt(0),g=document.createRange();g.selectNodeContents(s),g.setEnd(p.startContainer,p.startOffset),u=g.toString().length}let i,v;if(n){i="{{"+e+".";let p=u;r.substring(u).startsWith("}}")&&(p+=2);let m=r.substring(0,x)+i+r.substring(p);v=x+i.length,l._setRawText?l._setRawText(m):I&&I(m)}else{i="{{"+e+"}}";let p=u;r.substring(u).startsWith("}}")&&(p+=2);let m=r.substring(0,x)+i+r.substring(p);v=x+i.length,l._setRawText?l._setRawText(m):I&&I(m)}if(o?o():Ee?.(),Te?.(s,v),n){k(),setTimeout(()=>{Q(s,o||(()=>{}))},0);return}}else{let s=t,l=s.value,r=s.selectionStart??l.length,c,u;if(n){c="{{"+e+".";let i=r;l.substring(r).startsWith("}}")&&(i+=2),s.value=l.substring(0,x)+c+l.substring(i),u=x+c.length}else{c="{{"+e+"}}";let i=r;l.substring(r).startsWith("}}")&&(i+=2),s.value=l.substring(0,x)+c+l.substring(i),u=x+c.length}if(s.selectionStart=u,s.selectionEnd=u,s.focus(),o?o():be?.(),n){k(),setTimeout(()=>{Y(s,o||(()=>{}))},0);return}}k()}function k(){h&&(h.remove(),h=null),O=null,L=[],A=0,X=null}function Z(e){return!h||L.length===0?!1:e.key==="ArrowDown"?(e.preventDefault(),A=(A+1)%L.length,J(),!0):e.key==="ArrowUp"?(e.preventDefault(),A=(A-1+L.length)%L.length,J(),!0):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),we(L[A].name),!0):e.key==="Escape"?(e.preventDefault(),k(),!0):!1}function ee(){return h!==null}var _=acquireVsCodeApi(),y=null,se=!1,ae=!1,b=-1,te=null;function d(e){return document.getElementById(e)}function S(e){if(!e)return"";let n=document.createElement("div");return n.textContent=e,n.innerHTML}var $={},F={},M=!1;function U(e){return ve(e,{resolved:$,sources:F,showResolved:M})}function Ue(e){let n=e.parentElement;n.classList.add("var-cell");let t=document.createElement("div");t.className="var-overlay",n.appendChild(t);function a(){t.innerHTML=U(T(e.value))}function o(){n.classList.add("var-overlay-active"),a()}function s(){n.classList.remove("var-overlay-active")}e.addEventListener("input",()=>{a(),Y(e,a)}),e.addEventListener("focus",s),e.addEventListener("blur",()=>{o(),k()}),e.addEventListener("keydown",l=>{ee()&&Z(l)}),t.addEventListener("click",l=>{let r=l.target.closest(".tk-var, .tk-var-resolved");r&&r.dataset.var?j(r,r.dataset.var,{getResolvedVariables:()=>$,getVariableSources:()=>F}):(s(),e.focus())}),document.activeElement!==e&&o()}function q(){document.querySelectorAll(".var-cell").forEach(e=>{let n=e.querySelector('input[type="text"]'),t=e.querySelector(".var-overlay");n&&t&&e.classList.contains("var-overlay-active")&&(t.innerHTML=U(T(n.value)))}),document.querySelectorAll(".val-ce").forEach(e=>{let n=e._getRawText;if(n&&document.activeElement!==e){let t=n();t&&(e.innerHTML=U(T(t)))}})}function oe(e,n){let t=window.getSelection();if(!t)return;let a=document.createRange(),o=0,s=!1;function l(r){if(r.nodeType===Node.TEXT_NODE){let c=(r.textContent||"").length;if(o+c>=n)return a.setStart(r,n-o),a.collapse(!0),!0;o+=c}else for(let c=0;c<r.childNodes.length;c++)if(l(r.childNodes[c]))return!0;return!1}s=l(e),s||(a.selectNodeContents(e),a.collapse(!1)),t.removeAllRanges(),t.addRange(a)}function D(e,n,t){let a=n||"";e._getRawText=()=>a,e._setRawText=s=>{a=s};function o(){if(!a){e.innerHTML="";return}let s=window.getSelection(),l=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let r=s.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(r.startContainer,r.startOffset),l=c.toString().length}e.innerHTML=U(T(a)),s&&document.activeElement===e&&oe(e,l)}o(),e.addEventListener("input",()=>{if(M){M=!1,q();return}let s=window.getSelection(),l=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let r=s.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(r.startContainer,r.startOffset),l=c.toString().length}a=e.textContent||"",o(),oe(e,l),t(),Q(e,o)}),e.addEventListener("keydown",s=>{ee()&&Z(s)}),e.addEventListener("blur",()=>{k()}),e.addEventListener("click",s=>{let l=s.target.closest(".tk-var, .tk-var-resolved");l&&l.dataset.var&&j(l,l.dataset.var,{getResolvedVariables:()=>$,getVariableSources:()=>F})})}function f(){ae||(te&&clearTimeout(te),te=setTimeout(()=>{y&&_e()},400))}function _e(){let e=JSON.parse(JSON.stringify(y));e.info=e.info||{},e.info.name=d("infoName").value||void 0,e.info.version=d("infoVersion").value||void 0;let n=d("infoSummary").value;n?e.info.summary=n:delete e.info.summary;let t=[];document.querySelectorAll("#defaultHeadersBody tr").forEach(r=>{let c=r.querySelector('input[type="text"]'),u=r.querySelector(".val-ce"),i=r.querySelector('input[type="checkbox"]');if(c?.value){let v={name:c.value,value:u?._getRawText?u._getRawText():u?.textContent||""};i&&!i.checked&&(v.disabled=!0),t.push(v)}}),e.request||(e.request={}),e.request.headers=t.length>0?t:void 0;let a=d("defaultAuthType").value,o=z(a,"dAuth");o!==void 0?e.request.auth=o:delete e.request.auth;let s=[];document.querySelectorAll("#defaultVarsBody tr").forEach(r=>{let c=r.querySelector('input[type="text"]'),u=r.querySelector(".val-ce"),i=r.querySelector('input[type="checkbox"]');if(c?.value){let v={name:c.value,value:u?._getRawText?u._getRawText():u?.textContent||""};i&&!i.checked&&(v.disabled=!0),s.push(v)}}),e.request=e.request||{},e.request.variables=s.length>0?s:void 0,e.request&&Object.keys(e.request).every(r=>e.request[r]===void 0)&&delete e.request;let l=Ye();e.config||(e.config={}),e.config.secretProviders=l.length>0?l:void 0,se=!0,_.postMessage({type:"updateDocument",collection:e})}function xe(e){let n=d(e);n&&n.querySelectorAll(".tab").forEach(t=>{t.addEventListener("click",()=>{let a=t.dataset.tab;n.querySelectorAll(".tab").forEach(l=>l.classList.remove("active")),t.classList.add("active");let o=n.parentElement;o.querySelectorAll(":scope > .tab-content > .tab-panel").forEach(l=>l.classList.remove("active"));let s=o.querySelector(`#panel-${a}`);s&&s.classList.add("active")})})}function Fe(e){let n=d("defaultHeadersBody");n.innerHTML="",(e||[]).forEach(t=>ke(t.name,t.value,t.disabled))}function ke(e,n,t){let a=d("defaultHeadersBody"),o=document.createElement("tr");o.innerHTML=`<td><input type="checkbox" ${t?"":"checked"} /></td><td><input type="text" value="${S(e||"")}" placeholder="Header name" /></td><td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="Header value"></div></td><td><button class="row-delete">\xD7</button></td>`,o.querySelector(".row-delete").addEventListener("click",()=>{o.remove(),f()}),o.querySelector('input[type="text"]').addEventListener("input",f),o.querySelector('input[type="checkbox"]').addEventListener("change",f),D(o.querySelector(".val-ce"),n||"",f),a.appendChild(o)}function De(e){let n=d("defaultVarsBody");n.innerHTML="",(e||[]).forEach(t=>Se(t.name,t.value,t.disabled))}function Se(e,n,t){let a=d("defaultVarsBody"),o=document.createElement("tr"),s=typeof n=="string"?n:n&&n.data?n.data:"";o.innerHTML=`<td><input type="checkbox" ${t?"":"checked"} /></td><td><input type="text" value="${S(e||"")}" placeholder="Variable name" /></td><td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="Variable value"></div></td><td><button class="row-delete">\xD7</button></td>`,o.querySelector(".row-delete").addEventListener("click",()=>{o.remove(),f()}),o.querySelector('input[type="text"]').addEventListener("input",f),o.querySelector('input[type="checkbox"]').addEventListener("change",f),D(o.querySelector(".val-ce"),s,f),a.appendChild(o)}var We={prefix:"dAuth",get fieldsContainer(){return d("defaultAuthFields")},onChange:()=>f(),showInherit:!1,wrapInputs:!0,showTokenStatus:!0,onFieldsRendered:e=>e.forEach(n=>Ue(n))},N=de({prefix:"dAuth",buildAuth:()=>z(d("defaultAuthType").value,"dAuth"),postMessage:e=>_.postMessage(e),esc:S});function Ae(){let e=d("defaultAuthType").value;le(e,We),e==="oauth2"&&N.requestStatus()}var Ce=[{token:"charts.red",hex:"var(--vscode-charts-red, #f14c4c)"},{token:"charts.orange",hex:"var(--vscode-charts-orange, #d18616)"},{token:"charts.yellow",hex:"var(--vscode-charts-yellow, #cca700)"},{token:"charts.green",hex:"var(--vscode-charts-green, #89d185)"},{token:"charts.blue",hex:"var(--vscode-charts-blue, #3794ff)"},{token:"charts.purple",hex:"var(--vscode-charts-purple, #b180d7)"},{token:"charts.foreground",hex:"var(--vscode-charts-foreground, #cccccc)"},{token:"terminal.ansiRed",hex:"var(--vscode-terminal-ansiRed, #cd3131)"},{token:"terminal.ansiGreen",hex:"var(--vscode-terminal-ansiGreen, #0dbc79)"},{token:"terminal.ansiYellow",hex:"var(--vscode-terminal-ansiYellow, #e5e510)"},{token:"terminal.ansiBlue",hex:"var(--vscode-terminal-ansiBlue, #2472c8)"},{token:"terminal.ansiMagenta",hex:"var(--vscode-terminal-ansiMagenta, #bc3fbc)"},{token:"terminal.ansiCyan",hex:"var(--vscode-terminal-ansiCyan, #11a8cd)"},{token:"terminal.ansiWhite",hex:"var(--vscode-terminal-ansiWhite, #e5e5e5)"}];function R(){let e=d("envSelector");e.innerHTML="";let n=y?.config?.environments||[];if(n.length===0){let t=document.createElement("option");t.value="-1",t.textContent="No environments",e.appendChild(t),e.disabled=!0}else e.disabled=!1,n.forEach((t,a)=>{let o=document.createElement("option");o.value=String(a),o.textContent=t.name||"Unnamed",e.appendChild(o)}),e.value=String(b)}function He(e){b=e,R(),C()}function ze(){let e=y?.config?.environments||[];b<0||b>=e.length||(e.splice(b,1),b>=e.length&&(b=e.length-1),R(),C(),f())}function Ke(){y.config||(y.config={}),y.config.environments||(y.config.environments=[]),y.config.environments.push({name:"new-environment",variables:[]}),b=y.config.environments.length-1,R(),C(),f()}function ne(){let e=document.querySelector(".swatch-popover");e&&e.remove()}function je(e,n){ne();let t=document.createElement("div");t.className="swatch-popover",Ce.forEach(o=>{let s=document.createElement("button");s.className="color-swatch"+(o.token===n.color?" active":""),s.style.background=o.hex,s.addEventListener("click",l=>{l.stopPropagation(),n.color=o.token,ne(),R(),C(),f()}),t.appendChild(s)});let a=e.getBoundingClientRect();t.style.top=a.bottom+4+"px",t.style.left=a.left+"px",document.body.appendChild(t),setTimeout(()=>{document.addEventListener("click",function o(){ne(),document.removeEventListener("click",o)})},0)}function C(){let e=d("envDetail"),n=y?.config?.environments||[];if(b<0||b>=n.length){e.innerHTML='<div class="env-detail-empty">Add an environment to get started</div>';return}let t=n[b],a=t.color||"",o=Ce.find(r=>r.token===a),s=o?o.hex:"var(--vscode-charts-foreground, #888)";e.innerHTML='<div class="env-meta"><button class="color-dot-btn" id="envColorBtn" style="background:'+s+'" title="Pick color"></button><div class="form-field name"><label>Name</label><input type="text" id="envName" value="'+S(t.name)+'" /></div><div class="form-field extends"><label>Extends</label><input type="text" id="envExtends" value="'+S(t.extends||"")+'" placeholder="parent env name" /></div></div><div class="tabs" id="envTabs"><div class="tab active" data-tab="env-vars">Variables <span class="badge" id="envVarsBadge">'+(t.variables?t.variables.length:0)+'</span></div><div class="tab" data-tab="env-settings">Settings</div></div><div class="tab-content"><div class="tab-panel active" id="panel-env-vars"><table class="kv-table"><colgroup><col style="width:32px"><col style="width:25%"><col><col style="width:70px"><col style="width:32px"></colgroup><thead><tr><th></th><th>Name</th><th>Value</th><th>Type</th><th></th></tr></thead><tbody id="envVarsBody"></tbody></table><button class="add-row-btn" id="addEnvVarBtn">+ Add Variable</button></div><div class="tab-panel" id="panel-env-settings"><div class="auth-section"><div class="auth-row"><label>dotenv File</label><input type="text" id="envDotenv" value="'+S(t.dotEnvFilePath||"")+'" placeholder=".env.local" /></div></div></div></div>',d("envName").addEventListener("input",()=>{t.name=d("envName").value,R(),f()}),d("envColorBtn").addEventListener("click",r=>{r.stopPropagation(),je(d("envColorBtn"),t)}),d("envExtends").addEventListener("input",()=>{let r=d("envExtends").value;r?t.extends=r:delete t.extends,f()}),d("envDotenv")?.addEventListener("input",()=>{let r=d("envDotenv").value;r?t.dotEnvFilePath=r:delete t.dotEnvFilePath,f()});let l=d("envVarsBody");(t.variables||[]).forEach((r,c)=>{Ge(l,t,c)}),d("addEnvVarBtn").addEventListener("click",()=>{t.variables||(t.variables=[]),t.variables.push({name:"",value:""}),C(),f()}),xe("envTabs")}function Ge(e,n,t){let a=n.variables[t],o=document.createElement("tr"),s=a.secret===!0,l=a.disabled?"":"checked",r=s?a.value||"":typeof a.value=="string"?a.value:a.value&&a.value.data?a.value.data:"";o.innerHTML=`<td><input type="checkbox" ${l} data-field="disabled" /></td><td><input type="text" value="${S(a.name||"")}" data-field="name" /></td>${s?'<td><div class="secret-value-wrap"><input type="password" value="'+S(r)+'" data-field="value" /><button class="secret-toggle" title="Show/hide">&#9673;</button></div></td>':'<td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="value" data-field="value"></div></td>'}<td><select class="type-select select-borderless" data-field="type"><option value="var"${s?"":" selected"}>var</option><option value="secret"${s?" selected":""}>secret</option></select></td><td><button class="row-delete">\xD7</button></td>`,o.querySelectorAll("input[data-field]").forEach(i=>{let v=i.dataset.field;i.type==="checkbox"?i.addEventListener("change",()=>{n.variables[t].disabled=!i.checked,f()}):i.addEventListener("input",()=>{n.variables[t][v]=i.value,f()})});let c=o.querySelector(".type-select");if(c?.addEventListener("change",()=>{c.value==="secret"?n.variables[t].secret=!0:delete n.variables[t].secret,C(),f()}),o.querySelector(".secret-toggle")?.addEventListener("click",()=>{let i=o.querySelector('input[data-field="value"]');i&&(i.type=i.type==="password"?"text":"password")}),o.querySelector(".row-delete")?.addEventListener("click",()=>{n.variables.splice(t,1),C(),f()}),!s){let i=o.querySelector('.val-ce[data-field="value"]');i&&D(i,r,()=>{n.variables[t].value=i._getRawText?i._getRawText():i.textContent||"",f()})}e.appendChild(o)}function Je(e){ae=!0,y=JSON.parse(JSON.stringify(e)),d("collectionName").textContent=e.info?.name||"Collection",d("infoName").value=e.info?.name||"",d("infoVersion").value=e.info?.version||"",d("infoSummary").value=e.info?.summary||"",Fe(e.request?.headers||[]),De(e.request?.variables||[]);let n=e.request?.auth;n&&typeof n=="object"&&n.type?d("defaultAuthType").value=n.type:d("defaultAuthType").value="none",Ae(),n&&typeof n=="object"&&n.type&&setTimeout(()=>{ie(n,"dAuth")},0),d("headersBadge").textContent=String((e.request?.headers||[]).length),d("variablesBadge").textContent=String((e.request?.variables||[]).length),Xe(e.config?.secretProviders||[]);let t=y?.config?.environments||[];d("envBadge").textContent=String(t.length),b<0&&t.length>0&&(b=0),b>=t.length&&(b=t.length-1),R(),C(),setTimeout(()=>{ae=!1},50)}window.addEventListener("message",e=>{let n=e.data;if(n.type==="collectionLoaded"){if(se){se=!1;return}Je(n.collection)}if(n.type==="variablesResolved"){$=n.variables||{},F=n.sources||{},me(n.secretProviderNames||[]);let t=n.secretNames||{};for(let[a,o]of Object.entries(t))B(a,o);q(),N.requestStatus()}if(n.type==="oauth2TokenStatus"&&N.handleStatus(n.status),n.type==="oauth2Progress"&&N.handleProgress(n.message),n.type==="testSecretProviderResult"){let a=d("secretProvidersBody").children[n.providerIdx];if(a){let s=a.querySelector(".btn-test-vault");s&&(s.disabled=!1,s.textContent="Test")}n.success&&n.providerName&&n.secretNames&&B(n.providerName,n.secretNames);let o=d("secretTestResult");n.success?o.innerHTML=`<span style="color:var(--badge-success);">\u2713 Connected \u2014 ${n.secretCount} secret${n.secretCount===1?"":"s"} found</span>`:o.innerHTML=`<span style="color:var(--badge-error);">\u2717 ${S(n.error||"Connection failed")}</span>`,setTimeout(()=>{o.innerHTML=""},1e4)}if(n.type==="secretNamesResult"&&n.providerName&&n.secretNames&&B(n.providerName,n.secretNames),n.type==="switchTab"){let t=n.tab,o=d("mainTabs").querySelector(`.tab[data-tab="${t}"]`);if(o&&o.click(),n.envName&&y?.config?.environments){let l=y.config.environments.findIndex(r=>r.name===n.envName);l>=0&&He(l)}}});function Xe(e){let n=d("secretProvidersBody");n.innerHTML="",(e||[]).forEach(t=>Me(t.name,t.type,t.url,t.disabled)),d("secretsBadge").textContent=String((e||[]).length)}function Me(e,n,t,a){let o=d("secretProvidersBody"),s=document.createElement("tr"),l=n||"azure-keyvault";s.innerHTML=`<td><input type="text" value="${S(e||"")}" placeholder="my-vault" class="sp-name" /></td><td><select class="type-select select-borderless sp-type"><option value="azure-keyvault"${l==="azure-keyvault"?" selected":""}>Azure Key Vault</option></select></td><td class="val-cell"><div class="val-ce sp-url" contenteditable="true" data-placeholder="https://{{vault-name}}.vault.azure.net"></div></td><td><button class="btn-test-vault" title="Test connection">Test</button></td><td><button class="row-delete">\xD7</button></td>`,s.querySelector(".row-delete").addEventListener("click",()=>{s.remove(),d("secretsBadge").textContent=String(o.children.length),f()}),s.querySelector(".sp-name").addEventListener("input",f),s.querySelector(".sp-type").addEventListener("change",f),D(s.querySelector(".sp-url"),t||"",f);let r=s.querySelector(".btn-test-vault");r.addEventListener("click",()=>{let c=s.querySelector(".sp-name").value,u=s.querySelector(".sp-type").value,i=s.querySelector(".sp-url"),v=i._getRawText?i._getRawText():i.textContent||"";r.disabled=!0,r.innerHTML='<span class="spinner"></span>';let p=s.querySelector(".sp-test-result");p&&p.remove(),_.postMessage({type:"testSecretProvider",providerIdx:Array.from(o.children).indexOf(s),provider:{name:c,type:u,url:v}})}),o.appendChild(s)}function Ye(){let e=[];return document.querySelectorAll("#secretProvidersBody tr").forEach(n=>{let t=n.querySelector(".sp-name"),a=n.querySelector(".sp-type"),o=n.querySelector(".sp-url");t?.value&&e.push({name:t.value,type:a?.value||"azure-keyvault",url:o?._getRawText?o._getRawText():o?.textContent||""})}),e}fe(()=>$);Le(q,q,oe);xe("mainTabs");d("addDefaultHeaderBtn").addEventListener("click",()=>{ke(),f()});d("addDefaultVarBtn").addEventListener("click",()=>{Se(),f()});d("defaultAuthType").addEventListener("change",Ae);d("varToggleBtn").addEventListener("click",()=>{M=!M,d("varToggleBtn").classList.toggle("active",M),q()});d("addSecretProviderBtn").addEventListener("click",()=>{Me(),d("secretsBadge").textContent=String(d("secretProvidersBody").children.length),f()});d("addEnvBtn").addEventListener("click",Ke);d("removeEnvBtn").addEventListener("click",ze);d("envSelector").addEventListener("change",()=>{let e=parseInt(d("envSelector").value,10);e>=0&&He(e)});["infoName","infoVersion"].forEach(e=>{d(e).addEventListener("input",f)});d("infoSummary").addEventListener("input",f);_.postMessage({type:"ready"});})();
