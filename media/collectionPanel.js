"use strict";(()=>{function E(e,n,t,o="text"){let a=`<input type="${o}" id="${e}" placeholder="${n}" />`;return t?`<span class="auth-input-wrap">${a}</span>`:a}function ie(e,n){let{prefix:t,fieldsContainer:o,onChange:a,wrapInputs:s,showTokenStatus:l}=n;if(o.innerHTML="",e==="bearer")o.innerHTML=`<div class="auth-row"><label>Token</label>${E(t+"Token","{{token}}",s)}</div>`;else if(e==="basic")o.innerHTML=`<div class="auth-row"><label>Username</label>${E(t+"Username","username",s)}</div><div class="auth-row"><label>Password</label>${E(t+"Password","password",s,"password")}</div>`;else if(e==="apikey")o.innerHTML=`<div class="auth-row"><label>Key</label>${E(t+"Key","X-Api-Key",s)}</div><div class="auth-row"><label>Value</label>${E(t+"Value","{{apiKey}}",s)}</div><div class="auth-row"><label>In</label><select id="${t}Placement" class="auth-select"><option value="header">Header</option><option value="query">Query</option></select></div>`;else if(e==="oauth2"){o.innerHTML=`<div class="auth-row"><label>Grant Type</label><select id="${t}OAuth2Flow" class="auth-select"><option value="client_credentials">Client Credentials</option><option value="password">Password</option><option value="authorization_code">Authorization Code</option></select></div><div class="auth-row"><label>Access Token URL</label>${E(t+"OAuth2AccessTokenUrl","{{authUrl}}/token",s)}</div><div class="auth-row"><label>Client ID</label>${E(t+"OAuth2ClientId","{{clientId}}",s)}</div><div class="auth-row"><label>Client Secret</label>${E(t+"OAuth2ClientSecret","{{clientSecret}}",s)}</div><div class="auth-row"><label>Scope</label>${E(t+"OAuth2Scope","openid profile",s)}</div><div id="${t}OAuth2PasswordFields" style="display:none;"><div class="auth-row"><label>Username</label>${E(t+"OAuth2Username","{{username}}",s)}</div><div class="auth-row"><label>Password</label>${E(t+"OAuth2Password","password",s,"password")}</div></div><div id="${t}OAuth2AuthCodeFields" style="display:none;"><div class="auth-row"><label>Auth URL</label>${E(t+"OAuth2AuthorizationUrl","{{authUrl}}/authorize",s)}</div><div class="auth-row"><label>Callback URL</label>${E(t+"OAuth2CallbackUrl","https://localhost/callback",s)}</div></div><div class="auth-row"><label>Refresh URL</label>${E(t+"OAuth2RefreshTokenUrl","(optional)",s)}</div><div class="auth-row"><label>Credentials In</label><select id="${t}OAuth2CredentialsPlacement" class="auth-select"><option value="basic_auth_header">Header</option><option value="body">Body</option></select></div><div class="auth-row"><label>Auto Fetch</label><input type="checkbox" id="${t}OAuth2AutoFetch" checked /></div><div class="auth-row"><label>Auto Refresh</label><input type="checkbox" id="${t}OAuth2AutoRefresh" checked /></div>`+(l?`<div class="oauth2-token-status" id="${t}OAuth2TokenStatus"></div>`:"");let r=document.getElementById(t+"OAuth2Flow"),c=document.getElementById(t+"OAuth2PasswordFields"),u=document.getElementById(t+"OAuth2AuthCodeFields"),i=()=>{let v=r.value;c.style.display=v==="password"?"":"none",u.style.display=v==="authorization_code"?"":"none"};r.addEventListener("change",()=>{i(),a()}),i()}if(o.querySelectorAll("input").forEach(r=>{r.addEventListener("input",a),r.addEventListener("change",a)}),o.querySelectorAll("select").forEach(r=>r.addEventListener("change",a)),n.onFieldsRendered){let r=Array.from(o.querySelectorAll('input[type="text"]'));n.onFieldsRendered(r)}}function z(e,n){let t=n,o=s=>document.getElementById(s),a=s=>document.getElementById(s);switch(e){case"bearer":return{type:"bearer",token:o(t+"Token")?.value||""};case"basic":return{type:"basic",username:o(t+"Username")?.value||"",password:o(t+"Password")?.value||""};case"apikey":return{type:"apikey",key:o(t+"Key")?.value||"",value:o(t+"Value")?.value||"",placement:a(t+"Placement")?.value||"header"};case"oauth2":{let s=a(t+"OAuth2Flow")?.value||"client_credentials",l={type:"oauth2",flow:s,accessTokenUrl:o(t+"OAuth2AccessTokenUrl")?.value||"",clientId:o(t+"OAuth2ClientId")?.value||"",clientSecret:o(t+"OAuth2ClientSecret")?.value||"",scope:o(t+"OAuth2Scope")?.value||"",refreshTokenUrl:o(t+"OAuth2RefreshTokenUrl")?.value||"",credentialsPlacement:a(t+"OAuth2CredentialsPlacement")?.value||"basic_auth_header",autoFetchToken:o(t+"OAuth2AutoFetch")?.checked!==!1,autoRefreshToken:o(t+"OAuth2AutoRefresh")?.checked!==!1};return s==="password"?(l.username=o(t+"OAuth2Username")?.value||"",l.password=o(t+"OAuth2Password")?.value||""):s==="authorization_code"&&(l.authorizationUrl=o(t+"OAuth2AuthorizationUrl")?.value||"",l.callbackUrl=o(t+"OAuth2CallbackUrl")?.value||""),l.refreshTokenUrl||delete l.refreshTokenUrl,l.scope||delete l.scope,l.clientSecret||delete l.clientSecret,l}case"inherit":return"inherit";default:return}}function ce(e,n){let t=n,o=s=>document.getElementById(s),a=s=>document.getElementById(s);if(!(!e||e==="inherit")&&!(typeof e!="object"||!e.type))switch(e.type){case"bearer":{let s=o(t+"Token");s&&(s.value=e.token||"");break}case"basic":{let s=o(t+"Username");s&&(s.value=e.username||"");let l=o(t+"Password");l&&(l.value=e.password||"");break}case"apikey":{let s=o(t+"Key");s&&(s.value=e.key||"");let l=o(t+"Value");l&&(l.value=e.value||"");let r=a(t+"Placement");r&&(r.value=e.placement||"header");break}case"oauth2":{let s=a(t+"OAuth2Flow");s&&(s.value=e.flow||"client_credentials",s.dispatchEvent(new Event("change")));let l=o(t+"OAuth2AccessTokenUrl");l&&(l.value=e.accessTokenUrl||"");let r=o(t+"OAuth2ClientId");r&&(r.value=e.clientId||"");let c=o(t+"OAuth2ClientSecret");c&&(c.value=e.clientSecret||"");let u=o(t+"OAuth2Scope");u&&(u.value=e.scope||"");let i=o(t+"OAuth2RefreshTokenUrl");i&&(i.value=e.refreshTokenUrl||"");let v=a(t+"OAuth2CredentialsPlacement");v&&(v.value=e.credentialsPlacement||"basic_auth_header");let p=o(t+"OAuth2AutoFetch");p&&(p.checked=e.autoFetchToken!==!1);let g=o(t+"OAuth2AutoRefresh");if(g&&(g.checked=e.autoRefreshToken!==!1),e.flow==="password"){let m=o(t+"OAuth2Username");m&&(m.value=e.username||"");let w=o(t+"OAuth2Password");w&&(w.value=e.password||"")}else if(e.flow==="authorization_code"){let m=o(t+"OAuth2AuthorizationUrl");m&&(m.value=e.authorizationUrl||"");let w=o(t+"OAuth2CallbackUrl");w&&(w.value=e.callbackUrl||"")}break}}}function Ue(e){if(e<=0)return"expired";let n=Math.floor(e/1e3);if(n<60)return`${n}s`;let t=Math.floor(n/60);return t<60?`${t}m ${n%60}s`:`${Math.floor(t/60)}h ${t%60}m`}function de(e){let n=`${e.prefix}OAuth2TokenStatus`,t=null,o=null;function a(){return document.getElementById(n)}function s(){t&&(clearInterval(t),t=null)}function l(){let v=e.buildAuth();!v||v.type!=="oauth2"||!v.accessTokenUrl||e.postMessage({type:"getTokenStatus",auth:v})}function r(v){let p=a();if(!p)return;if(!v?.hasToken){p.innerHTML=`<div class="token-status token-none"><span class="token-dot dot-none"></span> No token<button class="token-btn" id="${n}-get">Get Token</button></div>`,p.querySelector(`#${n}-get`)?.addEventListener("click",()=>{let W=e.buildAuth();e.postMessage({type:"getToken",auth:W})});return}let g=Date.now(),m=v.expiresAt?v.expiresAt-g:void 0,w=m!==void 0&&m<=0,Pe=w?"dot-expired":"dot-valid",Be=w?"Expired":m!==void 0?`Expires in ${Ue(m)}`:"Valid (no expiry)",le=v.expiresAt?new Date(v.expiresAt).toLocaleTimeString():"";p.innerHTML='<div class="token-status '+(w?"token-expired":"token-valid")+'"><span class="token-dot '+Pe+'"></span> '+Be+(le?'<span class="token-expiry-time"> ('+e.esc(le)+")</span>":"")+`<button class="token-btn" id="${n}-refresh">${w?"Get Token":"Refresh"}</button></div>`,p.querySelector(`#${n}-refresh`)?.addEventListener("click",()=>{let W=e.buildAuth();e.postMessage({type:"getToken",auth:W})})}function c(v){o=v,s(),r(v),v?.expiresAt&&(t=setInterval(()=>{r(o),o?.expiresAt&&Date.now()>o.expiresAt&&s()},1e3))}function u(v){let p=a();if(!p||!v)return;s();let g=v.startsWith("Error:");p.innerHTML='<div class="token-status '+(g?"token-error":"token-progress")+'">'+(g?'<span class="token-dot dot-expired"></span> ':'<span class="token-spinner"></span> ')+e.esc(v)+"</div>"}function i(){s()}return{requestStatus:l,handleStatus:c,handleProgress:u,dispose:i}}var Ne=/\{\{(\s*[\w.$-]+\s*)\}\}/g,ue=/^[\w.$-]*$/;function T(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var _e=new Set(["$guid","$timestamp","$randomInt"]);function ve(e,n){return e.replace(Ne,(t,o)=>{let a=o.trim(),s=a in n.resolved,l=_e.has(a),r=n.secretKeys?.has(a)??!1,c=s||l||r,u=n.sources[a]||(r?"secret":l?"dynamic":"unknown");return n.showResolved&&s?"<span class='"+("tk-var-resolved tk-src-"+u)+"' data-var='"+T(a)+"' title='{{"+T(a)+"}} ("+u+")'>"+T(n.resolved[a])+"</span>":"<span class='"+(c?"tk-var tk-src-"+u:"tk-var tk-var-unresolved")+"' data-var='"+T(a)+"'>{{"+T(o)+"}}</span>"})}var pe=()=>({});function fe(e){pe=e}var h=null,x=[],A=0,O=null,S=0,B=!1,G=null,Fe=[{name:"$guid",detail:"Generate a random UUID"},{name:"$timestamp",detail:"Current Unix timestamp"},{name:"$randomInt",detail:"Random integer 0\u20131000"}],K=[],he=new Map;function me(e){K=e}function V(e,n){he.set(e,n)}function ge(e,n){let t=e.substring(0,n),o=t.lastIndexOf("{{");if(o===-1)return null;let a=t.substring(o+2);if(a.includes("}}"))return null;let s=a.trim();return ue.test(s)?s:null}function J(e,n){let t=e.selectionStart??0,o=ge(e.value,t);if(o===null){L();return}O=e,B=!1,S=e.value.lastIndexOf("{{",t-1),ye(o,e,n)}function X(e,n){let t=window.getSelection();if(!t||t.rangeCount===0)return;let o=e.textContent||"",a=t.getRangeAt(0),s=document.createRange();s.selectNodeContents(e),s.setEnd(a.startContainer,a.startOffset);let l=s.toString().length,r=ge(o,l);if(r===null){L();return}O=e,B=!0,S=o.lastIndexOf("{{",l-1),ye(r,e,n)}function ye(e,n,t){G=t;let o=e.toLowerCase(),a=[],s=pe();for(let r of Object.keys(s))a.push({name:r,detail:s[r]});for(let r of Fe)a.push(r);if(o===""||"$secret".startsWith(o))K.length>0&&a.push({name:"$secret",detail:"Secret provider"});else if(o.startsWith("$secret.")){let r=o.substring(8),c=r.indexOf(".");if(c===-1)for(let u of K)u.toLowerCase().startsWith(r)&&a.push({name:"$secret."+u,detail:"Key Vault provider"});else{let u=r.substring(0,c),i=r.substring(c+1),v=he.get(u)||[];for(let p of v)p.toLowerCase().startsWith(i)&&a.push({name:"$secret."+u+"."+p,displayName:p,detail:"Secret"})}}let l=new Set;x=[];for(let r of a)r.name.toLowerCase().startsWith(o)&&!l.has(r.name)&&(l.add(r.name),x.push(r));if(x.length===0){L();return}A=0,h||(h=document.createElement("div"),h.className="var-autocomplete",document.body.appendChild(h)),j(),We(n)}function j(){h&&(h.innerHTML=x.map((e,n)=>"<div class='"+(n===A?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+n+"'><span class='var-ac-name'>"+T(e.displayName||e.name)+"</span><span class='var-ac-value'>"+T(e.detail||"")+"</span></div>").join(""),h.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",n=>{n.preventDefault();let t=parseInt(e.dataset.index||"0");we(x[t].name)})}))}function De(e){let n=document.createElement("div"),t=window.getComputedStyle(e);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","paddingTop","paddingLeft","paddingRight","paddingBottom","borderWidth","boxSizing","whiteSpace","wordWrap","overflowWrap","tabSize"].forEach(u=>{n.style[u]=t.getPropertyValue(u.replace(/[A-Z]/g,i=>"-"+i.toLowerCase()))}),n.style.position="absolute",n.style.visibility="hidden",n.style.whiteSpace="pre-wrap",n.style.wordWrap="break-word",n.style.width=e.clientWidth+"px";let a=e.value.substring(0,e.selectionStart??0);n.textContent=a;let s=document.createElement("span");s.textContent="|",n.appendChild(s),document.body.appendChild(n);let l=s.getBoundingClientRect(),r=e.getBoundingClientRect(),c={top:r.top+(l.top-n.getBoundingClientRect().top)-e.scrollTop,left:r.left+(l.left-n.getBoundingClientRect().left)-e.scrollLeft};return document.body.removeChild(n),c}function We(e){if(h){if(B){let n=window.getSelection();if(n&&n.rangeCount>0){let o=n.getRangeAt(0).getBoundingClientRect();h.style.left=o.left+"px",h.style.top=o.bottom+4+"px"}else{let t=e.getBoundingClientRect();h.style.left=t.left+"px",h.style.top=t.bottom+2+"px"}}else{let n=De(e);h.style.left=n.left+"px",h.style.top=n.top+18+"px"}h.style.minWidth="220px"}}var be=null,Ee=null,Te=null,I=null;function xe(e,n,t,o){be=e,Ee=n,Te=t,I=o||null}function ze(e){return!!(e==="$secret"||e.startsWith("$secret.")&&e.split(".").length===2)}function we(e){if(!O)return;let n=ze(e),t=O,o=B,a=G;if(o){let s=t,l=s,r=l._getRawText?l._getRawText():s.textContent||"",c=window.getSelection(),u=r.length;if(c&&c.rangeCount>0){let p=c.getRangeAt(0),g=document.createRange();g.selectNodeContents(s),g.setEnd(p.startContainer,p.startOffset),u=g.toString().length}let i,v;if(n){i="{{"+e+".";let p=u;r.substring(u).startsWith("}}")&&(p+=2);let m=r.substring(0,S)+i+r.substring(p);v=S+i.length,l._setRawText?l._setRawText(m):I&&I(m)}else{i="{{"+e+"}}";let p=u;r.substring(u).startsWith("}}")&&(p+=2);let m=r.substring(0,S)+i+r.substring(p);v=S+i.length,l._setRawText?l._setRawText(m):I&&I(m)}if(a?a():Ee?.(),Te?.(s,v),n){L(),setTimeout(()=>{X(s,a||(()=>{}))},0);return}}else{let s=t,l=s.value,r=s.selectionStart??l.length,c,u;if(n){c="{{"+e+".";let i=r;l.substring(r).startsWith("}}")&&(i+=2),s.value=l.substring(0,S)+c+l.substring(i),u=S+c.length}else{c="{{"+e+"}}";let i=r;l.substring(r).startsWith("}}")&&(i+=2),s.value=l.substring(0,S)+c+l.substring(i),u=S+c.length}if(s.selectionStart=u,s.selectionEnd=u,s.focus(),a?a():be?.(),n){L(),setTimeout(()=>{J(s,a||(()=>{}))},0);return}}L()}function L(){h&&(h.remove(),h=null),O=null,x=[],A=0,G=null}function Y(e){return!h||x.length===0?!1:e.key==="ArrowDown"?(e.preventDefault(),A=(A+1)%x.length,j(),!0):e.key==="ArrowUp"?(e.preventDefault(),A=(A-1+x.length)%x.length,j(),!0):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),we(x[A].name),!0):e.key==="Escape"?(e.preventDefault(),L(),!0):!1}function Q(){return h!==null}var H=null;function U(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function Se(e){H&&!H.contains(e.target)&&Z()}function Z(){H&&(H.remove(),H=null),document.removeEventListener("click",Se)}function ee(e,n,t){Z();let o=e.getBoundingClientRect(),a=t.getResolvedVariables(),s=t.getVariableSources(),l=n in a,r=s[n]||"unknown",c=r.charAt(0).toUpperCase()+r.slice(1),u=document.createElement("div");u.className="var-tooltip";let i=[];t.onEditVariable&&i.push("<button class='var-action-btn' data-action='edit'>Edit</button>"),i.push("<button class='var-action-btn' data-action='copy'>"+(l?"Copy Value":"Copy Name")+"</button>"),u.innerHTML="<div class='var-name'>{{"+U(n)+"}}</div>"+(l?"<div class='var-source tk-src-"+U(r)+"'>"+U(c)+"</div><div class='var-value'>"+U(a[n])+"</div>":"<div class='var-unresolved'>Unresolved variable</div>")+"<div class='var-actions'>"+i.join("")+"</div>",u.style.left=o.left+"px",u.style.top=o.bottom+4+"px",document.body.appendChild(u),H=u,u.querySelectorAll(".var-action-btn").forEach(v=>{v.addEventListener("click",()=>{let p=v.dataset.action;if(p==="edit"&&t.onEditVariable)t.onEditVariable(n);else if(p==="copy"){let g=l?a[n]:"{{"+n+"}}";navigator.clipboard.writeText(g).catch(()=>{})}Z()})}),setTimeout(()=>{document.addEventListener("click",Se)},0)}var q={},_={},$=!1,Le=new Set,Ke=null;function ne(){return $}function ke(e){$=e}function N(e){return ve(e,{resolved:q,sources:_,showResolved:$,secretKeys:Le})}function te(e,n){let t=window.getSelection();if(!t)return;let o=document.createRange(),a=0,s=!1;function l(r){if(r.nodeType===Node.TEXT_NODE){let c=(r.textContent||"").length;if(a+c>=n)return o.setStart(r,n-a),o.collapse(!0),!0;a+=c}else for(let c=0;c<r.childNodes.length;c++)if(l(r.childNodes[c]))return!0;return!1}s=l(e),s||(o.selectNodeContents(e),o.collapse(!1)),t.removeAllRanges(),t.addRange(o)}function M(){document.querySelectorAll(".var-cell").forEach(e=>{let n=e.querySelector('input[type="text"]'),t=e.querySelector(".var-overlay");n&&t&&e.classList.contains("var-overlay-active")&&(t.innerHTML=N(T(n.value)))}),document.querySelectorAll(".val-ce").forEach(e=>{let n=e._getRawText;if(n&&document.activeElement!==e){let t=n();t&&(e.innerHTML=N(T(t)))}})}function Ae(e){let n=e.parentElement;n.classList.add("var-cell");let t=document.createElement("div");t.className="var-overlay",n.appendChild(t);function o(){t.innerHTML=N(T(e.value))}function a(){n.classList.add("var-overlay-active"),o()}function s(){n.classList.remove("var-overlay-active")}e.addEventListener("input",()=>{o(),J(e,o)}),e.addEventListener("focus",s),e.addEventListener("blur",()=>{a(),L()}),e.addEventListener("keydown",l=>{Q()&&Y(l)}),t.addEventListener("click",l=>{let r=l.target.closest(".tk-var, .tk-var-resolved");r&&r.dataset.var?ee(r,r.dataset.var,{getResolvedVariables:()=>q,getVariableSources:()=>_}):(s(),e.focus())}),document.activeElement!==e&&a()}function P(e,n,t){let o=n||"";e._getRawText=()=>o,e._setRawText=s=>{o=s};function a(){if(!o){e.innerHTML="";return}let s=window.getSelection(),l=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let r=s.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(r.startContainer,r.startOffset),l=c.toString().length}e.innerHTML=N(T(o)),s&&document.activeElement===e&&te(e,l)}a(),e.addEventListener("input",()=>{if($){$=!1,M(),Ke?.();return}let s=window.getSelection(),l=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let r=s.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(r.startContainer,r.startOffset),l=c.toString().length}o=e.textContent||"",a(),te(e,l),t(),X(e,a)}),e.addEventListener("keydown",s=>{Q()&&Y(s)}),e.addEventListener("blur",()=>{L()}),e.addEventListener("click",s=>{let l=s.target.closest(".tk-var, .tk-var-resolved");l&&l.dataset.var&&ee(l,l.dataset.var,{getResolvedVariables:()=>q,getVariableSources:()=>_})})}function Ce(e){if(e.type!=="variablesResolved")return!1;q=e.variables||{},_=e.sources||{},me(e.secretProviderNames||[]);let n=e.secretNames||{},t=new Set;for(let[o,a]of Object.entries(n)){V(o,a);for(let s of a)t.add(`$secret.${o}.${s}`)}return Le=t,M(),!0}function He(e){fe(()=>q),xe(()=>{M(),e?.extraSyncHighlight?.()},()=>{M(),e?.extraSyncUrlHighlight?.()},te,e?.setRawUrl)}var D=acquireVsCodeApi(),y=null,ae=!1,re=!1,b=-1,se=null;function d(e){return document.getElementById(e)}function k(e){if(!e)return"";let n=document.createElement("div");return n.textContent=e,n.innerHTML}function f(){re||(se&&clearTimeout(se),se=setTimeout(()=>{y&&je()},400))}function je(){let e=JSON.parse(JSON.stringify(y));e.info=e.info||{},e.info.name=d("infoName").value||void 0,e.info.version=d("infoVersion").value||void 0;let n=d("infoSummary").value;n?e.info.summary=n:delete e.info.summary;let t=[];document.querySelectorAll("#defaultHeadersBody tr").forEach(r=>{let c=r.querySelector('input[type="text"]'),u=r.querySelector(".val-ce"),i=r.querySelector('input[type="checkbox"]');if(c?.value){let v={name:c.value,value:u?._getRawText?u._getRawText():u?.textContent||""};i&&!i.checked&&(v.disabled=!0),t.push(v)}}),e.request||(e.request={}),e.request.headers=t.length>0?t:void 0;let o=d("defaultAuthType").value,a=z(o,"dAuth");a!==void 0?e.request.auth=a:delete e.request.auth;let s=[];document.querySelectorAll("#defaultVarsBody tr").forEach(r=>{let c=r.querySelector('input[type="text"]'),u=r.querySelector(".val-ce"),i=r.querySelector('input[type="checkbox"]');if(c?.value){let v={name:c.value,value:u?._getRawText?u._getRawText():u?.textContent||""};i&&!i.checked&&(v.disabled=!0),s.push(v)}}),e.request=e.request||{},e.request.variables=s.length>0?s:void 0,e.request&&Object.keys(e.request).every(r=>e.request[r]===void 0)&&delete e.request;let l=st();e.config||(e.config={}),e.config.secretProviders=l.length>0?l:void 0,ae=!0,D.postMessage({type:"updateDocument",collection:e})}function Me(e){let n=d(e);n&&n.querySelectorAll(".tab").forEach(t=>{t.addEventListener("click",()=>{let o=t.dataset.tab;n.querySelectorAll(".tab").forEach(l=>l.classList.remove("active")),t.classList.add("active");let a=n.parentElement;a.querySelectorAll(":scope > .tab-content > .tab-panel").forEach(l=>l.classList.remove("active"));let s=a.querySelector(`#panel-${o}`);s&&s.classList.add("active")})})}function Ge(e){let n=d("defaultHeadersBody");n.innerHTML="",(e||[]).forEach(t=>Re(t.name,t.value,t.disabled))}function Re(e,n,t){let o=d("defaultHeadersBody"),a=document.createElement("tr");a.innerHTML=`<td><input type="checkbox" ${t?"":"checked"} /></td><td><input type="text" value="${k(e||"")}" placeholder="Header name" /></td><td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="Header value"></div></td><td><button class="row-delete">\xD7</button></td>`,a.querySelector(".row-delete").addEventListener("click",()=>{a.remove(),f()}),a.querySelector('input[type="text"]').addEventListener("input",f),a.querySelector('input[type="checkbox"]').addEventListener("change",f),P(a.querySelector(".val-ce"),n||"",f),o.appendChild(a)}function Je(e){let n=d("defaultVarsBody");n.innerHTML="",(e||[]).forEach(t=>Ie(t.name,t.value,t.disabled))}function Ie(e,n,t){let o=d("defaultVarsBody"),a=document.createElement("tr"),s=typeof n=="string"?n:n&&n.data?n.data:"";a.innerHTML=`<td><input type="checkbox" ${t?"":"checked"} /></td><td><input type="text" value="${k(e||"")}" placeholder="Variable name" /></td><td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="Variable value"></div></td><td><button class="row-delete">\xD7</button></td>`,a.querySelector(".row-delete").addEventListener("click",()=>{a.remove(),f()}),a.querySelector('input[type="text"]').addEventListener("input",f),a.querySelector('input[type="checkbox"]').addEventListener("change",f),P(a.querySelector(".val-ce"),s,f),o.appendChild(a)}var Xe={prefix:"dAuth",get fieldsContainer(){return d("defaultAuthFields")},onChange:()=>f(),showInherit:!1,wrapInputs:!0,showTokenStatus:!0,onFieldsRendered:e=>e.forEach(n=>Ae(n))},F=de({prefix:"dAuth",buildAuth:()=>z(d("defaultAuthType").value,"dAuth"),postMessage:e=>D.postMessage(e),esc:k});function Oe(){let e=d("defaultAuthType").value;ie(e,Xe),e==="oauth2"&&F.requestStatus()}var Ve=[{token:"charts.red",hex:"var(--vscode-charts-red, #f14c4c)"},{token:"charts.orange",hex:"var(--vscode-charts-orange, #d18616)"},{token:"charts.yellow",hex:"var(--vscode-charts-yellow, #cca700)"},{token:"charts.green",hex:"var(--vscode-charts-green, #89d185)"},{token:"charts.blue",hex:"var(--vscode-charts-blue, #3794ff)"},{token:"charts.purple",hex:"var(--vscode-charts-purple, #b180d7)"},{token:"charts.foreground",hex:"var(--vscode-charts-foreground, #cccccc)"},{token:"terminal.ansiRed",hex:"var(--vscode-terminal-ansiRed, #cd3131)"},{token:"terminal.ansiGreen",hex:"var(--vscode-terminal-ansiGreen, #0dbc79)"},{token:"terminal.ansiYellow",hex:"var(--vscode-terminal-ansiYellow, #e5e510)"},{token:"terminal.ansiBlue",hex:"var(--vscode-terminal-ansiBlue, #2472c8)"},{token:"terminal.ansiMagenta",hex:"var(--vscode-terminal-ansiMagenta, #bc3fbc)"},{token:"terminal.ansiCyan",hex:"var(--vscode-terminal-ansiCyan, #11a8cd)"},{token:"terminal.ansiWhite",hex:"var(--vscode-terminal-ansiWhite, #e5e5e5)"}];function R(){let e=d("envSelector");e.innerHTML="";let n=y?.config?.environments||[];if(n.length===0){let t=document.createElement("option");t.value="-1",t.textContent="No environments",e.appendChild(t),e.disabled=!0}else e.disabled=!1,n.forEach((t,o)=>{let a=document.createElement("option");a.value=String(o),a.textContent=t.name||"Unnamed",e.appendChild(a)}),e.value=String(b)}function $e(e){b=e,R(),C()}function Ye(){let e=y?.config?.environments||[];b<0||b>=e.length||(e.splice(b,1),b>=e.length&&(b=e.length-1),R(),C(),f())}function Qe(){y.config||(y.config={}),y.config.environments||(y.config.environments=[]),y.config.environments.push({name:"new-environment",variables:[]}),b=y.config.environments.length-1,R(),C(),f()}function oe(){let e=document.querySelector(".swatch-popover");e&&e.remove()}function Ze(e,n){oe();let t=document.createElement("div");t.className="swatch-popover",Ve.forEach(a=>{let s=document.createElement("button");s.className="color-swatch"+(a.token===n.color?" active":""),s.style.background=a.hex,s.addEventListener("click",l=>{l.stopPropagation(),n.color=a.token,oe(),R(),C(),f()}),t.appendChild(s)});let o=e.getBoundingClientRect();t.style.top=o.bottom+4+"px",t.style.left=o.left+"px",document.body.appendChild(t),setTimeout(()=>{document.addEventListener("click",function a(){oe(),document.removeEventListener("click",a)})},0)}function C(){let e=d("envDetail"),n=y?.config?.environments||[];if(b<0||b>=n.length){e.innerHTML='<div class="env-detail-empty">Add an environment to get started</div>';return}let t=n[b],o=t.color||"",a=Ve.find(r=>r.token===o),s=a?a.hex:"var(--vscode-charts-foreground, #888)";e.innerHTML='<div class="env-meta"><button class="color-dot-btn" id="envColorBtn" style="background:'+s+'" title="Pick color"></button><div class="form-field name"><label>Name</label><input type="text" id="envName" value="'+k(t.name)+'" /></div><div class="form-field extends"><label>Extends</label><input type="text" id="envExtends" value="'+k(t.extends||"")+'" placeholder="parent env name" /></div></div><div class="tabs" id="envTabs"><div class="tab active" data-tab="env-vars">Variables <span class="badge" id="envVarsBadge">'+(t.variables?t.variables.length:0)+'</span></div><div class="tab" data-tab="env-settings">Settings</div></div><div class="tab-content"><div class="tab-panel active" id="panel-env-vars"><table class="kv-table"><colgroup><col style="width:32px"><col style="width:25%"><col><col style="width:70px"><col style="width:32px"></colgroup><thead><tr><th></th><th>Name</th><th>Value</th><th>Type</th><th></th></tr></thead><tbody id="envVarsBody"></tbody></table><button class="add-row-btn" id="addEnvVarBtn">+ Add Variable</button></div><div class="tab-panel" id="panel-env-settings"><div class="auth-section"><div class="auth-row"><label>dotenv File</label><input type="text" id="envDotenv" value="'+k(t.dotEnvFilePath||"")+'" placeholder=".env.local" /></div></div></div></div>',d("envName").addEventListener("input",()=>{t.name=d("envName").value,R(),f()}),d("envColorBtn").addEventListener("click",r=>{r.stopPropagation(),Ze(d("envColorBtn"),t)}),d("envExtends").addEventListener("input",()=>{let r=d("envExtends").value;r?t.extends=r:delete t.extends,f()}),d("envDotenv")?.addEventListener("input",()=>{let r=d("envDotenv").value;r?t.dotEnvFilePath=r:delete t.dotEnvFilePath,f()});let l=d("envVarsBody");(t.variables||[]).forEach((r,c)=>{et(l,t,c)}),d("addEnvVarBtn").addEventListener("click",()=>{t.variables||(t.variables=[]),t.variables.push({name:"",value:""}),C(),f()}),Me("envTabs")}function et(e,n,t){let o=n.variables[t],a=document.createElement("tr"),s=o.secret===!0,l=o.disabled?"":"checked",r=s?o.value||"":typeof o.value=="string"?o.value:o.value&&o.value.data?o.value.data:"";a.innerHTML=`<td><input type="checkbox" ${l} data-field="disabled" /></td><td><input type="text" value="${k(o.name||"")}" data-field="name" /></td>${s?'<td><div class="secret-value-wrap"><input type="password" value="'+k(r)+'" data-field="value" /><button class="secret-toggle" title="Show/hide">&#9673;</button></div></td>':'<td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="value" data-field="value"></div></td>'}<td><select class="type-select select-borderless" data-field="type"><option value="var"${s?"":" selected"}>var</option><option value="secret"${s?" selected":""}>secret</option></select></td><td><button class="row-delete">\xD7</button></td>`,a.querySelectorAll("input[data-field]").forEach(i=>{let v=i.dataset.field;i.type==="checkbox"?i.addEventListener("change",()=>{n.variables[t].disabled=!i.checked,f()}):i.addEventListener("input",()=>{n.variables[t][v]=i.value,f()})});let c=a.querySelector(".type-select");if(c?.addEventListener("change",()=>{c.value==="secret"?n.variables[t].secret=!0:delete n.variables[t].secret,C(),f()}),a.querySelector(".secret-toggle")?.addEventListener("click",()=>{let i=a.querySelector('input[data-field="value"]');i&&(i.type=i.type==="password"?"text":"password")}),a.querySelector(".row-delete")?.addEventListener("click",()=>{n.variables.splice(t,1),C(),f()}),!s){let i=a.querySelector('.val-ce[data-field="value"]');i&&P(i,r,()=>{n.variables[t].value=i._getRawText?i._getRawText():i.textContent||"",f()})}e.appendChild(a)}function tt(e){re=!0,y=JSON.parse(JSON.stringify(e)),d("collectionName").textContent=e.info?.name||"Collection",d("infoName").value=e.info?.name||"",d("infoVersion").value=e.info?.version||"",d("infoSummary").value=e.info?.summary||"",Ge(e.request?.headers||[]),Je(e.request?.variables||[]);let n=e.request?.auth;n&&typeof n=="object"&&n.type?d("defaultAuthType").value=n.type:d("defaultAuthType").value="none",Oe(),n&&typeof n=="object"&&n.type&&setTimeout(()=>{ce(n,"dAuth")},0),d("headersBadge").textContent=String((e.request?.headers||[]).length),d("variablesBadge").textContent=String((e.request?.variables||[]).length),nt(e.config?.secretProviders||[]);let t=y?.config?.environments||[];d("envBadge").textContent=String(t.length),b<0&&t.length>0&&(b=0),b>=t.length&&(b=t.length-1),R(),C(),setTimeout(()=>{re=!1},50)}window.addEventListener("message",e=>{let n=e.data;if(n.type==="collectionLoaded"){if(ae){ae=!1;return}tt(n.collection)}if(Ce(n)&&F.requestStatus(),n.type==="oauth2TokenStatus"&&F.handleStatus(n.status),n.type==="oauth2Progress"&&F.handleProgress(n.message),n.type==="testSecretProviderResult"){let o=d("secretProvidersBody").children[n.providerIdx];if(o){let s=o.querySelector(".btn-test-vault");s&&(s.disabled=!1,s.textContent="Test")}n.success&&n.providerName&&n.secretNames&&V(n.providerName,n.secretNames);let a=d("secretTestResult");n.success?a.innerHTML=`<span style="color:var(--badge-success);">\u2713 Connected \u2014 ${n.secretCount} secret${n.secretCount===1?"":"s"} found</span>`:a.innerHTML=`<span style="color:var(--badge-error);">\u2717 ${k(n.error||"Connection failed")}</span>`,setTimeout(()=>{a.innerHTML=""},1e4)}if(n.type==="secretNamesResult"&&n.providerName&&n.secretNames&&V(n.providerName,n.secretNames),n.type==="switchTab"){let t=n.tab,a=d("mainTabs").querySelector(`.tab[data-tab="${t}"]`);if(a&&a.click(),n.envName&&y?.config?.environments){let l=y.config.environments.findIndex(r=>r.name===n.envName);l>=0&&$e(l)}}});function nt(e){let n=d("secretProvidersBody");n.innerHTML="",(e||[]).forEach(t=>qe(t.name,t.type,t.url,t.disabled)),d("secretsBadge").textContent=String((e||[]).length)}function qe(e,n,t,o){let a=d("secretProvidersBody"),s=document.createElement("tr"),l=n||"azure-keyvault";s.innerHTML=`<td><input type="text" value="${k(e||"")}" placeholder="my-vault" class="sp-name" /></td><td><select class="type-select select-borderless sp-type"><option value="azure-keyvault"${l==="azure-keyvault"?" selected":""}>Azure Key Vault</option></select></td><td class="val-cell"><div class="val-ce sp-url" contenteditable="true" data-placeholder="https://{{vault-name}}.vault.azure.net"></div></td><td><button class="btn-test-vault" title="Test connection">Test</button></td><td><button class="row-delete">\xD7</button></td>`,s.querySelector(".row-delete").addEventListener("click",()=>{s.remove(),d("secretsBadge").textContent=String(a.children.length),f()}),s.querySelector(".sp-name").addEventListener("input",f),s.querySelector(".sp-type").addEventListener("change",f),P(s.querySelector(".sp-url"),t||"",f);let r=s.querySelector(".btn-test-vault");r.addEventListener("click",()=>{let c=s.querySelector(".sp-name").value,u=s.querySelector(".sp-type").value,i=s.querySelector(".sp-url"),v=i._getRawText?i._getRawText():i.textContent||"";r.disabled=!0,r.innerHTML='<span class="spinner"></span>';let p=s.querySelector(".sp-test-result");p&&p.remove(),D.postMessage({type:"testSecretProvider",providerIdx:Array.from(a.children).indexOf(s),provider:{name:c,type:u,url:v}})}),a.appendChild(s)}function st(){let e=[];return document.querySelectorAll("#secretProvidersBody tr").forEach(n=>{let t=n.querySelector(".sp-name"),o=n.querySelector(".sp-type"),a=n.querySelector(".sp-url");t?.value&&e.push({name:t.value,type:o?.value||"azure-keyvault",url:a?._getRawText?a._getRawText():a?.textContent||""})}),e}He();Me("mainTabs");d("addDefaultHeaderBtn").addEventListener("click",()=>{Re(),f()});d("addDefaultVarBtn").addEventListener("click",()=>{Ie(),f()});d("defaultAuthType").addEventListener("change",Oe);d("varToggleBtn").addEventListener("click",()=>{ke(!ne()),d("varToggleBtn").classList.toggle("active",ne()),M()});d("addSecretProviderBtn").addEventListener("click",()=>{qe(),d("secretsBadge").textContent=String(d("secretProvidersBody").children.length),f()});d("addEnvBtn").addEventListener("click",Qe);d("removeEnvBtn").addEventListener("click",Ye);d("envSelector").addEventListener("change",()=>{let e=parseInt(d("envSelector").value,10);e>=0&&$e(e)});["infoName","infoVersion"].forEach(e=>{d(e).addEventListener("input",f)});d("infoSummary").addEventListener("input",f);D.postMessage({type:"ready"});})();
