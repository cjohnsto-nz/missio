"use strict";(()=>{function h(t,n,e,a="text"){let s=`<input type="${a}" id="${t}" placeholder="${n}" />`;return e?`<span class="auth-input-wrap">${s}</span>`:s}function C(t,n){let{prefix:e,fieldsContainer:a,onChange:s,wrapInputs:l,showTokenStatus:o}=n;if(a.innerHTML="",t==="bearer")a.innerHTML=`<div class="auth-row"><label>Token</label>${h(e+"Token","{{token}}",l)}</div>`;else if(t==="basic")a.innerHTML=`<div class="auth-row"><label>Username</label>${h(e+"Username","username",l)}</div><div class="auth-row"><label>Password</label>${h(e+"Password","password",l,"password")}</div>`;else if(t==="apikey")a.innerHTML=`<div class="auth-row"><label>Key</label>${h(e+"Key","X-Api-Key",l)}</div><div class="auth-row"><label>Value</label>${h(e+"Value","{{apiKey}}",l)}</div><div class="auth-row"><label>In</label><select id="${e}Placement" class="auth-select"><option value="header">Header</option><option value="query">Query</option></select></div>`;else if(t==="oauth2"){a.innerHTML=`<div class="auth-row"><label>Grant Type</label><select id="${e}OAuth2Flow" class="auth-select"><option value="client_credentials">Client Credentials</option><option value="password">Password</option><option value="authorization_code">Authorization Code</option></select></div><div class="auth-row"><label>Access Token URL</label>${h(e+"OAuth2AccessTokenUrl","{{authUrl}}/token",l)}</div><div class="auth-row"><label>Client ID</label>${h(e+"OAuth2ClientId","{{clientId}}",l)}</div><div class="auth-row"><label>Client Secret</label>${h(e+"OAuth2ClientSecret","{{clientSecret}}",l)}</div><div class="auth-row"><label>Scope</label>${h(e+"OAuth2Scope","openid profile",l)}</div><div id="${e}OAuth2PasswordFields" style="display:none;"><div class="auth-row"><label>Username</label>${h(e+"OAuth2Username","{{username}}",l)}</div><div class="auth-row"><label>Password</label>${h(e+"OAuth2Password","password",l,"password")}</div></div><div id="${e}OAuth2AuthCodeFields" style="display:none;"><div class="auth-row"><label>Auth URL</label>${h(e+"OAuth2AuthorizationUrl","{{authUrl}}/authorize",l)}</div><div class="auth-row"><label>Callback URL</label>${h(e+"OAuth2CallbackUrl","https://localhost/callback",l)}</div></div><div class="auth-row"><label>Refresh URL</label>${h(e+"OAuth2RefreshTokenUrl","(optional)",l)}</div><div class="auth-row"><label>Credentials In</label><select id="${e}OAuth2CredentialsPlacement" class="auth-select"><option value="basic_auth_header">Header</option><option value="body">Body</option></select></div><div class="auth-row"><label>Auto Fetch</label><input type="checkbox" id="${e}OAuth2AutoFetch" checked /></div><div class="auth-row"><label>Auto Refresh</label><input type="checkbox" id="${e}OAuth2AutoRefresh" checked /></div>`+(o?`<div class="oauth2-token-status" id="${e}OAuth2TokenStatus"></div>`:"");let i=document.getElementById(e+"OAuth2Flow"),u=document.getElementById(e+"OAuth2PasswordFields"),f=document.getElementById(e+"OAuth2AuthCodeFields"),d=()=>{let b=i.value;u.style.display=b==="password"?"":"none",f.style.display=b==="authorization_code"?"":"none"};i.addEventListener("change",()=>{d(),s()}),d()}if(a.querySelectorAll("input").forEach(i=>{i.addEventListener("input",s),i.addEventListener("change",s)}),a.querySelectorAll("select").forEach(i=>i.addEventListener("change",s)),n.onFieldsRendered){let i=Array.from(a.querySelectorAll('input[type="text"]'));n.onFieldsRendered(i)}}function O(t,n){let e=n,a=l=>document.getElementById(l),s=l=>document.getElementById(l);switch(t){case"bearer":return{type:"bearer",token:a(e+"Token")?.value||""};case"basic":return{type:"basic",username:a(e+"Username")?.value||"",password:a(e+"Password")?.value||""};case"apikey":return{type:"apikey",key:a(e+"Key")?.value||"",value:a(e+"Value")?.value||"",placement:s(e+"Placement")?.value||"header"};case"oauth2":{let l=s(e+"OAuth2Flow")?.value||"client_credentials",o={type:"oauth2",flow:l,accessTokenUrl:a(e+"OAuth2AccessTokenUrl")?.value||"",clientId:a(e+"OAuth2ClientId")?.value||"",clientSecret:a(e+"OAuth2ClientSecret")?.value||"",scope:a(e+"OAuth2Scope")?.value||"",refreshTokenUrl:a(e+"OAuth2RefreshTokenUrl")?.value||"",credentialsPlacement:s(e+"OAuth2CredentialsPlacement")?.value||"basic_auth_header",autoFetchToken:a(e+"OAuth2AutoFetch")?.checked!==!1,autoRefreshToken:a(e+"OAuth2AutoRefresh")?.checked!==!1};return l==="password"?(o.username=a(e+"OAuth2Username")?.value||"",o.password=a(e+"OAuth2Password")?.value||""):l==="authorization_code"&&(o.authorizationUrl=a(e+"OAuth2AuthorizationUrl")?.value||"",o.callbackUrl=a(e+"OAuth2CallbackUrl")?.value||""),o.refreshTokenUrl||delete o.refreshTokenUrl,o.scope||delete o.scope,o.clientSecret||delete o.clientSecret,o}case"inherit":return"inherit";default:return}}function I(t,n){let e=n,a=l=>document.getElementById(l),s=l=>document.getElementById(l);if(!(!t||t==="inherit")&&!(typeof t!="object"||!t.type))switch(t.type){case"bearer":{let l=a(e+"Token");l&&(l.value=t.token||"");break}case"basic":{let l=a(e+"Username");l&&(l.value=t.username||"");let o=a(e+"Password");o&&(o.value=t.password||"");break}case"apikey":{let l=a(e+"Key");l&&(l.value=t.key||"");let o=a(e+"Value");o&&(o.value=t.value||"");let i=s(e+"Placement");i&&(i.value=t.placement||"header");break}case"oauth2":{let l=s(e+"OAuth2Flow");l&&(l.value=t.flow||"client_credentials",l.dispatchEvent(new Event("change")));let o=a(e+"OAuth2AccessTokenUrl");o&&(o.value=t.accessTokenUrl||"");let i=a(e+"OAuth2ClientId");i&&(i.value=t.clientId||"");let u=a(e+"OAuth2ClientSecret");u&&(u.value=t.clientSecret||"");let f=a(e+"OAuth2Scope");f&&(f.value=t.scope||"");let d=a(e+"OAuth2RefreshTokenUrl");d&&(d.value=t.refreshTokenUrl||"");let b=s(e+"OAuth2CredentialsPlacement");b&&(b.value=t.credentialsPlacement||"basic_auth_header");let x=a(e+"OAuth2AutoFetch");x&&(x.checked=t.autoFetchToken!==!1);let M=a(e+"OAuth2AutoRefresh");if(M&&(M.checked=t.autoRefreshToken!==!1),t.flow==="password"){let E=a(e+"OAuth2Username");E&&(E.value=t.username||"");let k=a(e+"OAuth2Password");k&&(k.value=t.password||"")}else if(t.flow==="authorization_code"){let E=a(e+"OAuth2AuthorizationUrl");E&&(E.value=t.authorizationUrl||"");let k=a(e+"OAuth2CallbackUrl");k&&(k.value=t.callbackUrl||"")}break}}}var q=acquireVsCodeApi(),v=null,S=!1,H=!1,p=-1,T=null;function r(t){return document.getElementById(t)}function m(t){if(!t)return"";let n=document.createElement("div");return n.textContent=t,n.innerHTML}var $={},U={};function A(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function B(t){return t.replace(/\{\{(\s*[\w.]+\s*)\}\}/g,(n,e)=>{let a=e.trim(),s=a in $,l=U[a]||"unknown";return"<span class='"+(s?"tk-var tk-src-"+l:"tk-var tk-var-unresolved")+"' data-var='"+A(a)+"'>{{"+A(e)+"}}</span>"})}function L(t){let n=t.parentElement;n.classList.add("var-cell");let e=document.createElement("div");e.className="var-overlay",n.appendChild(e);function a(){e.innerHTML=B(A(t.value))}function s(){n.classList.add("var-overlay-active"),a()}function l(){n.classList.remove("var-overlay-active")}t.addEventListener("input",a),t.addEventListener("focus",l),t.addEventListener("blur",s),e.addEventListener("click",()=>{l(),t.focus()}),document.activeElement!==t&&s()}function _(){document.querySelectorAll(".var-cell").forEach(t=>{let n=t.querySelector('input[type="text"]'),e=t.querySelector(".var-overlay");n&&e&&t.classList.contains("var-overlay-active")&&(e.innerHTML=B(A(n.value)))})}function c(){H||(T&&clearTimeout(T),T=setTimeout(()=>{v&&z()},400))}function z(){let t=JSON.parse(JSON.stringify(v));t.info=t.info||{},t.info.name=r("infoName").value||void 0,t.info.version=r("infoVersion").value||void 0;let n=r("infoSummary").value;n?t.info.summary=n:delete t.info.summary;let e=[];document.querySelectorAll("#defaultHeadersBody tr").forEach(o=>{let i=o.querySelectorAll('input[type="text"]'),u=o.querySelector('input[type="checkbox"]');if(i[0]?.value){let f={name:i[0].value,value:i[1]?.value||""};u&&!u.checked&&(f.disabled=!0),e.push(f)}}),t.request||(t.request={}),t.request.headers=e.length>0?e:void 0;let a=r("defaultAuthType").value,s=O(a,"dAuth");s!==void 0?t.request.auth=s:delete t.request.auth;let l=[];document.querySelectorAll("#defaultVarsBody tr").forEach(o=>{let i=o.querySelectorAll('input[type="text"]'),u=o.querySelector('input[type="checkbox"]');if(i[0]?.value){let f={name:i[0].value,value:i[1]?.value||""};u&&!u.checked&&(f.disabled=!0),l.push(f)}}),t.request=t.request||{},t.request.variables=l.length>0?l:void 0,t.request&&Object.keys(t.request).every(o=>t.request[o]===void 0)&&delete t.request,S=!0,q.postMessage({type:"updateDocument",collection:t})}function F(t){let n=r(t);n&&n.querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{let a=e.dataset.tab;n.querySelectorAll(".tab").forEach(o=>o.classList.remove("active")),e.classList.add("active");let s=n.parentElement;s.querySelectorAll(":scope > .tab-content > .tab-panel").forEach(o=>o.classList.remove("active"));let l=s.querySelector(`#panel-${a}`);l&&l.classList.add("active")})})}function K(t){let n=r("defaultHeadersBody");n.innerHTML="",(t||[]).forEach(e=>V(e.name,e.value,e.disabled))}function V(t,n,e){let a=r("defaultHeadersBody"),s=document.createElement("tr");s.innerHTML=`<td><input type="checkbox" ${e?"":"checked"} /></td><td><input type="text" value="${m(t||"")}" placeholder="Header name" /></td><td><input type="text" value="${m(n||"")}" placeholder="Header value" /></td><td><button class="row-delete">\xD7</button></td>`,s.querySelector(".row-delete").addEventListener("click",()=>{s.remove(),c()}),s.querySelectorAll("input").forEach(o=>{o.addEventListener("input",c),o.addEventListener("change",c)});let l=s.querySelectorAll('input[type="text"]')[1];l&&L(l),a.appendChild(s)}function j(t){let n=r("defaultVarsBody");n.innerHTML="",(t||[]).forEach(e=>P(e.name,e.value,e.disabled))}function P(t,n,e){let a=r("defaultVarsBody"),s=document.createElement("tr"),l=typeof n=="string"?n:n&&n.data?n.data:"";s.innerHTML=`<td><input type="checkbox" ${e?"":"checked"} /></td><td><input type="text" value="${m(t||"")}" placeholder="Variable name" /></td><td><input type="text" value="${m(l)}" placeholder="Variable value" /></td><td><button class="row-delete">\xD7</button></td>`,s.querySelector(".row-delete").addEventListener("click",()=>{s.remove(),c()}),s.querySelectorAll("input").forEach(i=>{i.addEventListener("input",c),i.addEventListener("change",c)});let o=s.querySelectorAll('input[type="text"]')[1];o&&L(o),a.appendChild(s)}var J={prefix:"dAuth",get fieldsContainer(){return r("defaultAuthFields")},onChange:()=>c(),showInherit:!1,wrapInputs:!0,showTokenStatus:!0,onFieldsRendered:t=>t.forEach(n=>L(n))};function R(){let t=r("defaultAuthType").value;C(t,J)}var N=[{token:"charts.red",hex:"var(--vscode-charts-red, #f14c4c)"},{token:"charts.orange",hex:"var(--vscode-charts-orange, #d18616)"},{token:"charts.yellow",hex:"var(--vscode-charts-yellow, #cca700)"},{token:"charts.green",hex:"var(--vscode-charts-green, #89d185)"},{token:"charts.blue",hex:"var(--vscode-charts-blue, #3794ff)"},{token:"charts.purple",hex:"var(--vscode-charts-purple, #b180d7)"},{token:"charts.foreground",hex:"var(--vscode-charts-foreground, #cccccc)"},{token:"terminal.ansiRed",hex:"var(--vscode-terminal-ansiRed, #cd3131)"},{token:"terminal.ansiGreen",hex:"var(--vscode-terminal-ansiGreen, #0dbc79)"},{token:"terminal.ansiYellow",hex:"var(--vscode-terminal-ansiYellow, #e5e510)"},{token:"terminal.ansiBlue",hex:"var(--vscode-terminal-ansiBlue, #2472c8)"},{token:"terminal.ansiMagenta",hex:"var(--vscode-terminal-ansiMagenta, #bc3fbc)"},{token:"terminal.ansiCyan",hex:"var(--vscode-terminal-ansiCyan, #11a8cd)"},{token:"terminal.ansiWhite",hex:"var(--vscode-terminal-ansiWhite, #e5e5e5)"}];function g(){let t=r("envSelector");t.innerHTML="";let n=v?.config?.environments||[];if(n.length===0){let e=document.createElement("option");e.value="-1",e.textContent="No environments",t.appendChild(e),t.disabled=!0}else t.disabled=!1,n.forEach((e,a)=>{let s=document.createElement("option");s.value=String(a),s.textContent=e.name||"Unnamed",t.appendChild(s)}),t.value=String(p)}function D(t){p=t,g(),y()}function G(){let t=v?.config?.environments||[];p<0||p>=t.length||(t.splice(p,1),p>=t.length&&(p=t.length-1),g(),y(),c())}function W(){v.config||(v.config={}),v.config.environments||(v.config.environments=[]),v.config.environments.push({name:"new-environment",variables:[]}),p=v.config.environments.length-1,g(),y(),c()}function w(){let t=document.querySelector(".swatch-popover");t&&t.remove()}function Y(t,n){w();let e=document.createElement("div");e.className="swatch-popover",N.forEach(s=>{let l=document.createElement("button");l.className="color-swatch"+(s.token===n.color?" active":""),l.style.background=s.hex,l.addEventListener("click",o=>{o.stopPropagation(),n.color=s.token,w(),g(),y(),c()}),e.appendChild(l)});let a=t.getBoundingClientRect();e.style.top=a.bottom+4+"px",e.style.left=a.left+"px",document.body.appendChild(e),setTimeout(()=>{document.addEventListener("click",function s(){w(),document.removeEventListener("click",s)})},0)}function y(){let t=r("envDetail"),n=v?.config?.environments||[];if(p<0||p>=n.length){t.innerHTML='<div class="env-detail-empty">Add an environment to get started</div>';return}let e=n[p],a=e.color||"",s=N.find(i=>i.token===a),l=s?s.hex:"var(--vscode-charts-foreground, #888)";t.innerHTML='<div class="env-meta"><button class="color-dot-btn" id="envColorBtn" style="background:'+l+'" title="Pick color"></button><div class="form-field name"><label>Name</label><input type="text" id="envName" value="'+m(e.name)+'" /></div><div class="form-field extends"><label>Extends</label><input type="text" id="envExtends" value="'+m(e.extends||"")+'" placeholder="parent env name" /></div></div><div class="tabs" id="envTabs"><div class="tab active" data-tab="env-vars">Variables <span class="badge" id="envVarsBadge">'+(e.variables?e.variables.length:0)+'</span></div><div class="tab" data-tab="env-settings">Settings</div></div><div class="tab-content"><div class="tab-panel active" id="panel-env-vars"><table class="kv-table"><thead><tr><th></th><th>Name</th><th>Value</th><th>Type</th><th></th></tr></thead><tbody id="envVarsBody"></tbody></table><button class="add-row-btn" id="addEnvVarBtn">+ Add Variable</button></div><div class="tab-panel" id="panel-env-settings"><div class="auth-section"><div class="auth-row"><label>dotenv File</label><input type="text" id="envDotenv" value="'+m(e.dotEnvFilePath||"")+'" placeholder=".env.local" /></div></div></div></div>',r("envName").addEventListener("input",()=>{e.name=r("envName").value,g(),c()}),r("envColorBtn").addEventListener("click",i=>{i.stopPropagation(),Y(r("envColorBtn"),e)}),r("envExtends").addEventListener("input",()=>{let i=r("envExtends").value;i?e.extends=i:delete e.extends,c()}),r("envDotenv")?.addEventListener("input",()=>{let i=r("envDotenv").value;i?e.dotEnvFilePath=i:delete e.dotEnvFilePath,c()});let o=r("envVarsBody");(e.variables||[]).forEach((i,u)=>{Q(o,e,u)}),r("addEnvVarBtn").addEventListener("click",()=>{e.variables||(e.variables=[]),e.variables.push({name:"",value:""}),y(),c()}),F("envTabs")}function Q(t,n,e){let a=n.variables[e],s=document.createElement("tr"),l=a.secret===!0,o=a.disabled?"":"checked",i=l?a.value||"":typeof a.value=="string"?a.value:a.value&&a.value.data?a.value.data:"";s.innerHTML=`<td><input type="checkbox" ${o} data-field="disabled" /></td><td><input type="text" value="${m(a.name||"")}" data-field="name" /></td><td>${l?'<div class="secret-value-wrap"><input type="password" value="'+m(i)+'" data-field="value" /><button class="secret-toggle" title="Show/hide">&#9673;</button></div>':'<input type="text" value="'+m(i)+'" data-field="value" />'}</td><td><select class="type-select" data-field="type"><option value="var"${l?"":" selected"}>var</option><option value="secret"${l?" selected":""}>secret</option></select></td><td><button class="row-delete">\xD7</button></td>`,s.querySelectorAll("input[data-field]").forEach(d=>{let b=d.dataset.field;d.type==="checkbox"?d.addEventListener("change",()=>{n.variables[e].disabled=!d.checked,c()}):d.addEventListener("input",()=>{n.variables[e][b]=d.value,c()})});let u=s.querySelector(".type-select");if(u?.addEventListener("change",()=>{u.value==="secret"?n.variables[e].secret=!0:delete n.variables[e].secret,y(),c()}),s.querySelector(".secret-toggle")?.addEventListener("click",()=>{let d=s.querySelector('input[data-field="value"]');d&&(d.type=d.type==="password"?"text":"password")}),s.querySelector(".row-delete")?.addEventListener("click",()=>{n.variables.splice(e,1),y(),c()}),!l){let d=s.querySelector('input[data-field="value"]');d&&L(d)}t.appendChild(s)}function X(t){H=!0,v=JSON.parse(JSON.stringify(t)),r("collectionName").textContent=t.info?.name||"Collection",r("infoName").value=t.info?.name||"",r("infoVersion").value=t.info?.version||"",r("infoSummary").value=t.info?.summary||"",K(t.request?.headers||[]),j(t.request?.variables||[]);let n=t.request?.auth;n&&typeof n=="object"&&n.type?r("defaultAuthType").value=n.type:r("defaultAuthType").value="none",R(),n&&typeof n=="object"&&n.type&&setTimeout(()=>{I(n,"dAuth")},0),r("headersBadge").textContent=String((t.request?.headers||[]).length),r("variablesBadge").textContent=String((t.request?.variables||[]).length);let e=v?.config?.environments||[];r("envBadge").textContent=String(e.length),p<0&&e.length>0&&(p=0),p>=e.length&&(p=e.length-1),g(),y(),setTimeout(()=>{H=!1},50)}window.addEventListener("message",t=>{let n=t.data;if(n.type==="collectionLoaded"){if(S){S=!1;return}X(n.collection)}if(n.type==="variablesResolved"&&($=n.variables||{},U=n.sources||{},_()),n.type==="switchTab"){let e=n.tab,s=r("mainTabs").querySelector(`.tab[data-tab="${e}"]`);if(s&&s.click(),n.envName&&v?.config?.environments){let o=v.config.environments.findIndex(i=>i.name===n.envName);o>=0&&D(o)}}});F("mainTabs");r("addDefaultHeaderBtn").addEventListener("click",()=>{V(),c()});r("addDefaultVarBtn").addEventListener("click",()=>{P(),c()});r("defaultAuthType").addEventListener("change",R);r("addEnvBtn").addEventListener("click",W);r("removeEnvBtn").addEventListener("click",G);r("envSelector").addEventListener("change",()=>{let t=parseInt(r("envSelector").value,10);t>=0&&D(t)});["infoName","infoVersion"].forEach(t=>{r(t).addEventListener("input",c)});r("infoSummary").addEventListener("input",c);q.postMessage({type:"ready"});})();
