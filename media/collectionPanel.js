"use strict";(()=>{function L(e,n,t,a="text"){let o=`<input type="${a}" id="${e}" placeholder="${n}" />`;return t?`<span class="auth-input-wrap">${o}</span>`:o}function Se(e,n){let{prefix:t,fieldsContainer:a,onChange:o,wrapInputs:s,showTokenStatus:l}=n;if(a.innerHTML="",e==="bearer")a.innerHTML=`<div class="auth-row"><label>Token</label>${L(t+"Token","{{token}}",s)}</div>`;else if(e==="basic")a.innerHTML=`<div class="auth-row"><label>Username</label>${L(t+"Username","username",s)}</div><div class="auth-row"><label>Password</label>${L(t+"Password","password",s,"password")}</div>`;else if(e==="apikey")a.innerHTML=`<div class="auth-row"><label>Key</label>${L(t+"Key","X-Api-Key",s)}</div><div class="auth-row"><label>Value</label>${L(t+"Value","{{apiKey}}",s)}</div><div class="auth-row"><label>In</label><select id="${t}Placement" class="auth-select"><option value="header">Header</option><option value="query">Query</option></select></div>`;else if(e==="oauth2"){a.innerHTML=`<div class="auth-row"><label>Grant Type</label><select id="${t}OAuth2Flow" class="auth-select"><option value="client_credentials">Client Credentials</option><option value="password">Password</option><option value="authorization_code">Authorization Code</option></select></div><div class="auth-row"><label>Access Token URL</label>${L(t+"OAuth2AccessTokenUrl","{{authUrl}}/token",s)}</div><div class="auth-row"><label>Client ID</label>${L(t+"OAuth2ClientId","{{clientId}}",s)}</div><div class="auth-row"><label>Client Secret</label>${L(t+"OAuth2ClientSecret","{{clientSecret}}",s)}</div><div class="auth-row"><label>Scope</label>${L(t+"OAuth2Scope","openid profile",s)}</div><div id="${t}OAuth2PasswordFields" style="display:none;"><div class="auth-row"><label>Username</label>${L(t+"OAuth2Username","{{username}}",s)}</div><div class="auth-row"><label>Password</label>${L(t+"OAuth2Password","password",s,"password")}</div></div><div id="${t}OAuth2AuthCodeFields" style="display:none;"><div class="auth-row"><label>Auth URL</label>${L(t+"OAuth2AuthorizationUrl","{{authUrl}}/authorize",s)}</div><div class="auth-row"><label>Callback URL</label>${L(t+"OAuth2CallbackUrl","https://localhost/callback",s)}</div></div><div class="auth-row"><label>Refresh URL</label>${L(t+"OAuth2RefreshTokenUrl","(optional)",s)}</div><div class="auth-row"><label>Credentials In</label><select id="${t}OAuth2CredentialsPlacement" class="auth-select"><option value="basic_auth_header">Header</option><option value="body">Body</option></select></div><div class="auth-row"><label>Auto Fetch</label><input type="checkbox" id="${t}OAuth2AutoFetch" checked /></div><div class="auth-row"><label>Auto Refresh</label><input type="checkbox" id="${t}OAuth2AutoRefresh" checked /></div>`+(l?`<div class="oauth2-token-status" id="${t}OAuth2TokenStatus"></div>`:"");let r=document.getElementById(t+"OAuth2Flow"),c=document.getElementById(t+"OAuth2PasswordFields"),v=document.getElementById(t+"OAuth2AuthCodeFields"),p=()=>{let i=r.value;c.style.display=i==="password"?"":"none",v.style.display=i==="authorization_code"?"":"none"};r.addEventListener("change",()=>{p(),o()}),p()}if(a.querySelectorAll("input").forEach(r=>{r.addEventListener("input",o),r.addEventListener("change",o)}),a.querySelectorAll("select").forEach(r=>r.addEventListener("change",o)),n.onFieldsRendered){let r=Array.from(a.querySelectorAll('input[type="text"]'));n.onFieldsRendered(r)}}function re(e,n){let t=n,a=s=>document.getElementById(s),o=s=>document.getElementById(s);switch(e){case"bearer":return{type:"bearer",token:a(t+"Token")?.value||""};case"basic":return{type:"basic",username:a(t+"Username")?.value||"",password:a(t+"Password")?.value||""};case"apikey":return{type:"apikey",key:a(t+"Key")?.value||"",value:a(t+"Value")?.value||"",placement:o(t+"Placement")?.value||"header"};case"oauth2":{let s=o(t+"OAuth2Flow")?.value||"client_credentials",l={type:"oauth2",flow:s,accessTokenUrl:a(t+"OAuth2AccessTokenUrl")?.value||"",clientId:a(t+"OAuth2ClientId")?.value||"",clientSecret:a(t+"OAuth2ClientSecret")?.value||"",scope:a(t+"OAuth2Scope")?.value||"",refreshTokenUrl:a(t+"OAuth2RefreshTokenUrl")?.value||"",credentialsPlacement:o(t+"OAuth2CredentialsPlacement")?.value||"basic_auth_header",autoFetchToken:a(t+"OAuth2AutoFetch")?.checked!==!1,autoRefreshToken:a(t+"OAuth2AutoRefresh")?.checked!==!1};return s==="password"?(l.username=a(t+"OAuth2Username")?.value||"",l.password=a(t+"OAuth2Password")?.value||""):s==="authorization_code"&&(l.authorizationUrl=a(t+"OAuth2AuthorizationUrl")?.value||"",l.callbackUrl=a(t+"OAuth2CallbackUrl")?.value||""),l.refreshTokenUrl||delete l.refreshTokenUrl,l.scope||delete l.scope,l.clientSecret||delete l.clientSecret,l}case"inherit":return"inherit";default:return}}function we(e,n){let t=n,a=s=>document.getElementById(s),o=s=>document.getElementById(s);if(!(!e||e==="inherit")&&!(typeof e!="object"||!e.type))switch(e.type){case"bearer":{let s=a(t+"Token");s&&(s.value=e.token||"");break}case"basic":{let s=a(t+"Username");s&&(s.value=e.username||"");let l=a(t+"Password");l&&(l.value=e.password||"");break}case"apikey":{let s=a(t+"Key");s&&(s.value=e.key||"");let l=a(t+"Value");l&&(l.value=e.value||"");let r=o(t+"Placement");r&&(r.value=e.placement||"header");break}case"oauth2":{let s=o(t+"OAuth2Flow");s&&(s.value=e.flow||"client_credentials",s.dispatchEvent(new Event("change")));let l=a(t+"OAuth2AccessTokenUrl");l&&(l.value=e.accessTokenUrl||"");let r=a(t+"OAuth2ClientId");r&&(r.value=e.clientId||"");let c=a(t+"OAuth2ClientSecret");c&&(c.value=e.clientSecret||"");let v=a(t+"OAuth2Scope");v&&(v.value=e.scope||"");let p=a(t+"OAuth2RefreshTokenUrl");p&&(p.value=e.refreshTokenUrl||"");let i=o(t+"OAuth2CredentialsPlacement");i&&(i.value=e.credentialsPlacement||"basic_auth_header");let u=a(t+"OAuth2AutoFetch");u&&(u.checked=e.autoFetchToken!==!1);let m=a(t+"OAuth2AutoRefresh");if(m&&(m.checked=e.autoRefreshToken!==!1),e.flow==="password"){let h=a(t+"OAuth2Username");h&&(h.value=e.username||"");let w=a(t+"OAuth2Password");w&&(w.value=e.password||"")}else if(e.flow==="authorization_code"){let h=a(t+"OAuth2AuthorizationUrl");h&&(h.value=e.authorizationUrl||"");let w=a(t+"OAuth2CallbackUrl");w&&(w.value=e.callbackUrl||"")}break}}}function st(e){if(e<=0)return"expired";let n=Math.floor(e/1e3);if(n<60)return`${n}s`;let t=Math.floor(n/60);return t<60?`${t}m ${n%60}s`:`${Math.floor(t/60)}h ${t%60}m`}function Le(e){let n=`${e.prefix}OAuth2TokenStatus`,t=null,a=null;function o(){return document.getElementById(n)}function s(){t&&(clearInterval(t),t=null)}function l(){let i=e.buildAuth();!i||i.type!=="oauth2"||!i.accessTokenUrl||e.postMessage({type:"getTokenStatus",auth:i})}function r(i){let u=o();if(!u)return;if(!i?.hasToken){u.innerHTML=`<div class="token-status token-none"><span class="token-dot dot-none"></span> No token<button class="token-btn" id="${n}-get">Get Token</button></div>`,u.querySelector(`#${n}-get`)?.addEventListener("click",()=>{let I=e.buildAuth();e.postMessage({type:"getToken",auth:I})});return}let m=Date.now(),h=i.expiresAt?i.expiresAt-m:void 0,w=h!==void 0&&h<=0,B=w?"dot-expired":"dot-valid",ae=w?"Expired":h!==void 0?`Expires in ${st(h)}`:"Valid (no expiry)",y=i.expiresAt?new Date(i.expiresAt).toLocaleTimeString():"";u.innerHTML='<div class="token-status '+(w?"token-expired":"token-valid")+'"><span class="token-dot '+B+'"></span> '+ae+(y?'<span class="token-expiry-time"> ('+e.esc(y)+")</span>":"")+`<button class="token-btn" id="${n}-refresh">${w?"Get Token":"Refresh"}</button></div>`,u.querySelector(`#${n}-refresh`)?.addEventListener("click",()=>{let I=e.buildAuth();e.postMessage({type:"getToken",auth:I})})}function c(i){a=i,s(),r(i),i?.expiresAt&&(t=setInterval(()=>{r(a),a?.expiresAt&&Date.now()>a.expiresAt&&s()},1e3))}function v(i){let u=o();if(!u||!i)return;s();let m=i.startsWith("Error:");u.innerHTML='<div class="token-status '+(m?"token-error":"token-progress")+'">'+(m?'<span class="token-dot dot-expired"></span> ':'<span class="token-spinner"></span> ')+e.esc(i)+"</div>"}function p(){s()}return{requestStatus:l,handleStatus:c,handleProgress:v,dispose:p}}var at=/\{\{(\s*[\w.$-]+\s*)\}\}/g,ke=/^[\w.$-]*$/;function k(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var ot=new Set(["$guid","$timestamp","$randomInt"]);function xe(e,n){return e.replace(at,(t,a)=>{let o=a.trim(),s=o in n.resolved,l=ot.has(o),r=n.secretKeys?.has(o)??!1,c=s||l||r,v=n.sources[o]||(r?"secret":l?"dynamic":"unknown");return n.showResolved&&s?"<span class='"+("tk-var-resolved tk-src-"+v)+"' data-var='"+k(o)+"' title='{{"+k(o)+"}} ("+v+")'>"+k(n.resolved[o])+"</span>":"<span class='"+(c?"tk-var tk-src-"+v:"tk-var tk-var-unresolved")+"' data-var='"+k(o)+"'>{{"+k(a)+"}}</span>"})}var Ae=()=>({});function Ce(e){Ae=e}var b=null,A=[],$=0,K=null,H=0,Y=!1,ce=null,rt=[{name:"$guid",detail:"Generate a random UUID"},{name:"$timestamp",detail:"Current Unix timestamp"},{name:"$randomInt",detail:"Random integer 0\u20131000"}],le=[],Me=new Map;function He(e){le=e}function W(e,n){Me.set(e,n)}function Re(e,n){let t=e.substring(0,n),a=t.lastIndexOf("{{");if(a===-1)return null;let o=t.substring(a+2);if(o.includes("}}"))return null;let s=o.trim();return ke.test(s)?s:null}function de(e,n){let t=e.selectionStart??0,a=Re(e.value,t);if(a===null){R();return}K=e,Y=!1,H=e.value.lastIndexOf("{{",t-1),Ve(a,e,n)}function ue(e,n){let t=window.getSelection();if(!t||t.rangeCount===0)return;let a=e.textContent||"",o=t.getRangeAt(0),s=document.createRange();s.selectNodeContents(e),s.setEnd(o.startContainer,o.startOffset);let l=s.toString().length,r=Re(a,l);if(r===null){R();return}K=e,Y=!0,H=a.lastIndexOf("{{",l-1),Ve(r,e,n)}function Ve(e,n,t){ce=t;let a=e.toLowerCase(),o=[],s=Ae();for(let r of Object.keys(s))o.push({name:r,detail:s[r]});for(let r of rt)o.push(r);if(a===""||"$secret".startsWith(a))le.length>0&&o.push({name:"$secret",detail:"Secret provider"});else if(a.startsWith("$secret.")){let r=a.substring(8),c=r.indexOf(".");if(c===-1)for(let v of le)v.toLowerCase().startsWith(r)&&o.push({name:"$secret."+v,detail:"Key Vault provider"});else{let v=r.substring(0,c),p=r.substring(c+1),i=Me.get(v)||[];for(let u of i)u.toLowerCase().startsWith(p)&&o.push({name:"$secret."+v+"."+u,displayName:u,detail:"Secret"})}}let l=new Set;A=[];for(let r of o)r.name.toLowerCase().startsWith(a)&&!l.has(r.name)&&(l.add(r.name),A.push(r));if(A.length===0){R();return}$=0,b||(b=document.createElement("div"),b.className="var-autocomplete",document.body.appendChild(b)),ie(),it(n)}function ie(){b&&(b.innerHTML=A.map((e,n)=>"<div class='"+(n===$?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+n+"'><span class='var-ac-name'>"+k(e.displayName||e.name)+"</span><span class='var-ac-value'>"+k(e.detail||"")+"</span></div>").join(""),b.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",n=>{n.preventDefault();let t=parseInt(e.dataset.index||"0");Pe(A[t].name)})}))}function lt(e){let n=document.createElement("div"),t=window.getComputedStyle(e);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","paddingTop","paddingLeft","paddingRight","paddingBottom","borderWidth","boxSizing","whiteSpace","wordWrap","overflowWrap","tabSize"].forEach(v=>{n.style[v]=t.getPropertyValue(v.replace(/[A-Z]/g,p=>"-"+p.toLowerCase()))}),n.style.position="absolute",n.style.visibility="hidden",n.style.whiteSpace="pre-wrap",n.style.wordWrap="break-word",n.style.width=e.clientWidth+"px";let o=e.value.substring(0,e.selectionStart??0);n.textContent=o;let s=document.createElement("span");s.textContent="|",n.appendChild(s),document.body.appendChild(n);let l=s.getBoundingClientRect(),r=e.getBoundingClientRect(),c={top:r.top+(l.top-n.getBoundingClientRect().top)-e.scrollTop,left:r.left+(l.left-n.getBoundingClientRect().left)-e.scrollLeft};return document.body.removeChild(n),c}function it(e){if(b){if(Y){let n=window.getSelection();if(n&&n.rangeCount>0){let a=n.getRangeAt(0).getBoundingClientRect();b.style.left=a.left+"px",b.style.top=a.bottom+4+"px"}else{let t=e.getBoundingClientRect();b.style.left=t.left+"px",b.style.top=t.bottom+2+"px"}}else{let n=lt(e);b.style.left=n.left+"px",b.style.top=n.top+18+"px"}b.style.minWidth="220px"}}var Ie=null,Oe=null,qe=null,D=null;function $e(e,n,t,a){Ie=e,Oe=n,qe=t,D=a||null}function ct(e){return!!(e==="$secret"||e.startsWith("$secret.")&&e.split(".").length===2)}function Pe(e){if(!K)return;let n=ct(e),t=K,a=Y,o=ce;if(a){let s=t,l=s,r=l._getRawText?l._getRawText():s.textContent||"",c=window.getSelection(),v=r.length;if(c&&c.rangeCount>0){let u=c.getRangeAt(0),m=document.createRange();m.selectNodeContents(s),m.setEnd(u.startContainer,u.startOffset),v=m.toString().length}let p,i;if(n){p="{{"+e+".";let u=v;r.substring(v).startsWith("}}")&&(u+=2);let h=r.substring(0,H)+p+r.substring(u);i=H+p.length,l._setRawText?l._setRawText(h):D&&D(h)}else{p="{{"+e+"}}";let u=v;r.substring(v).startsWith("}}")&&(u+=2);let h=r.substring(0,H)+p+r.substring(u);i=H+p.length,l._setRawText?l._setRawText(h):D&&D(h)}if(o?o():Oe?.(),qe?.(s,i),n){R(),setTimeout(()=>{ue(s,o||(()=>{}))},0);return}}else{let s=t,l=s.value,r=s.selectionStart??l.length,c,v;if(n){c="{{"+e+".";let p=r;l.substring(r).startsWith("}}")&&(p+=2),s.value=l.substring(0,H)+c+l.substring(p),v=H+c.length}else{c="{{"+e+"}}";let p=r;l.substring(r).startsWith("}}")&&(p+=2),s.value=l.substring(0,H)+c+l.substring(p),v=H+c.length}if(s.selectionStart=v,s.selectionEnd=v,s.focus(),o?o():Ie?.(),n){R(),setTimeout(()=>{de(s,o||(()=>{}))},0);return}}R()}function R(){b&&(b.remove(),b=null),K=null,A=[],$=0,ce=null}function ve(e){return!b||A.length===0?!1:e.key==="ArrowDown"?(e.preventDefault(),$=($+1)%A.length,ie(),!0):e.key==="ArrowUp"?(e.preventDefault(),$=($-1+A.length)%A.length,ie(),!0):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),Pe(A[$].name),!0):e.key==="Escape"?(e.preventDefault(),R(),!0):!1}function pe(){return b!==null}var q=[{key:"environment",label:"Environment",badge:"E",badgeClass:"var-scope-badge-E"},{key:"collection",label:"Collection",badge:"C",badgeClass:"var-scope-badge-C"},{key:"global",label:"Globals",badge:"G",badgeClass:"var-scope-badge-G"}];function Be(e){return e==="environment"||e==="dotenv"?q[0]:e==="collection"||e==="folder"?q[1]:e==="global"?q[2]:q[0]}var V=null,fe=null,z=null,_=!1;function _e(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function Ue(e){V&&!V.contains(e.target)&&G()}function G(){V&&(V.remove(),V=null),fe=null,document.removeEventListener("click",Ue)}function Ne(e){if(!V||e.secretRef!==fe)return;let n=V.querySelector(".var-secret-value"),t=V.querySelector('.var-action-btn[data-action="reveal"]');if(e.error){n&&(n.textContent=e.error,n.style.color="#f48771",n.style.fontStyle="normal"),t&&(t.textContent="Reveal Value");return}let a=e.value??"";z=a,n&&(n.textContent=a,n.style.cssText=""),t&&(t.textContent="Hide Value"),_=!0;let o=V.querySelector('.var-action-btn[data-action="copy"]');o&&(o.textContent="Copy Value",o.dataset.secretValue=a)}function ge(e,n,t){G(),z=null,_=!1;let a=e.getBoundingClientRect(),o=t.getResolvedVariables(),s=t.getVariableSources(),l=t.getSecretKeys?.()??new Set,r=n in o,c=l.has(n),v=s[n]||(c?"secret":""),p=c&&!r,i=document.createElement("div");i.className="var-tooltip";let u="";if(p)u+="<div class='var-name'>{{"+_e(n)+"}}</div><div class='var-source tk-src-secret'>Secret Provider</div><div class='var-secret-value var-value' style='font-style:italic;opacity:0.7'>Value hidden</div><div class='var-actions'>"+(t.postMessage?"<button class='var-action-btn' data-action='reveal'>Reveal Value</button>":"")+"<button class='var-action-btn' data-action='copy'>Copy Name</button></div>";else{let y=r?o[n]:"",I=r?Be(v):null;u+="<input type='text' class='var-tooltip-value-input' placeholder='Enter value' value='"+_e(y).replace(/'/g,"&#39;")+"' />";let O=I||q[0];u+="<div class='var-tooltip-scope-row'><div class='var-scope-dropdown'><button class='var-scope-trigger'><span class='var-scope-badge "+O.badgeClass+"'>"+O.badge+"</span><span>Save to "+O.label+" \u25BE</span></button><div class='var-scope-menu'>"+q.map(S=>"<button class='var-scope-option' data-scope='"+S.key+"'><span class='var-scope-badge "+S.badgeClass+"'>"+S.badge+"</span><span>"+S.label+"</span></button>").join("")+"</div></div></div>"}i.innerHTML=u,i.style.left=a.left+"px",i.style.top=a.bottom+4+"px",document.body.appendChild(i),V=i;let m=(r?Be(v):q[0]).key,h=i.querySelector(".var-scope-trigger"),w=i.querySelector(".var-scope-menu");h&&w&&(h.addEventListener("click",y=>{y.stopPropagation(),w.classList.toggle("open")}),i.querySelectorAll(".var-scope-option").forEach(y=>{y.addEventListener("click",I=>{I.stopPropagation();let O=y.dataset.scope;m=O;let S=q.find(oe=>oe.key===O)||q[0];h.innerHTML="<span class='var-scope-badge "+S.badgeClass+"'>"+S.badge+"</span><span>Save to "+S.label+" \u25BE</span>",w.classList.remove("open")})}));let B=i.querySelector(".var-tooltip-value-input");B&&(setTimeout(()=>B.focus(),0),B.addEventListener("keydown",y=>{y.key==="Enter"&&(y.preventDefault(),ae()),y.key==="Escape"&&G()}));function ae(){let y=B?.value??"";t.postMessage&&(t.postMessage({type:"updateVariable",varName:n,value:y,scope:m}),G())}i.querySelectorAll(".var-action-btn").forEach(y=>{y.addEventListener("click",I=>{I.stopPropagation();let O=y.dataset.action;if(O==="copy"){let oe=y.dataset.secretValue??(r?o[n]:"{{"+n+"}}");navigator.clipboard.writeText(oe).catch(()=>{}),G()}else if(O==="reveal"){let S=i.querySelector(".var-secret-value");z!==null?(_=!_,S&&(S.textContent=_?z:"\u2022".repeat(Math.min(z.length,20))),y.textContent=_?"Hide Value":"Show Value"):(fe=n,S&&(S.textContent="Resolving\u2026",S.style.cssText="font-style:italic;opacity:0.7"),y.textContent="Resolving\u2026",t.postMessage({type:"resolveSecret",secretRef:n}))}})}),setTimeout(()=>{document.addEventListener("click",Ue)},0)}var X={},Z={},j=!1,ee=new Set,dt=null,me=null;function Fe(e){me=e}function ye(){return j}function De(e){j=e}function Q(e){return xe(e,{resolved:X,sources:Z,showResolved:j,secretKeys:ee})}function he(e,n){let t=window.getSelection();if(!t)return;let a=document.createRange(),o=0,s=!1;function l(r){if(r.nodeType===Node.TEXT_NODE){let c=(r.textContent||"").length;if(o+c>=n)return a.setStart(r,n-o),a.collapse(!0),!0;o+=c}else for(let c=0;c<r.childNodes.length;c++)if(l(r.childNodes[c]))return!0;return!1}s=l(e),s||(a.selectNodeContents(e),a.collapse(!1)),t.removeAllRanges(),t.addRange(a)}function U(){document.querySelectorAll(".var-cell").forEach(e=>{let n=e.querySelector('input[type="text"]'),t=e.querySelector(".var-overlay");n&&t&&e.classList.contains("var-overlay-active")&&(t.innerHTML=Q(k(n.value)))}),document.querySelectorAll(".val-ce").forEach(e=>{let n=e._getRawText;if(n&&document.activeElement!==e){let t=n();t&&(e.innerHTML=Q(k(t)))}})}function Ke(e){let n=e.parentElement;n.classList.add("var-cell");let t=document.createElement("div");t.className="var-overlay",n.appendChild(t);function a(){t.innerHTML=Q(k(e.value))}function o(){n.classList.add("var-overlay-active"),a()}function s(){n.classList.remove("var-overlay-active")}e.addEventListener("input",()=>{a(),de(e,a)}),e.addEventListener("focus",s),e.addEventListener("blur",()=>{o(),R()}),e.addEventListener("keydown",l=>{pe()&&ve(l)}),t.addEventListener("click",l=>{let r=l.target.closest(".tk-var, .tk-var-resolved");r&&r.dataset.var?ge(r,r.dataset.var,{getResolvedVariables:()=>X,getVariableSources:()=>Z,getSecretKeys:()=>ee,postMessage:me??void 0}):(s(),e.focus())}),document.activeElement!==e&&o()}function J(e,n,t){let a=n||"";e._getRawText=()=>a,e._setRawText=s=>{a=s};function o(){if(!a){e.innerHTML="";return}let s=window.getSelection(),l=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let r=s.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(r.startContainer,r.startOffset),l=c.toString().length}e.innerHTML=Q(k(a)),s&&document.activeElement===e&&he(e,l)}o(),e.addEventListener("input",()=>{if(j){j=!1,U(),dt?.();return}let s=window.getSelection(),l=0;if(s&&s.rangeCount>0&&e.contains(s.anchorNode)){let r=s.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(r.startContainer,r.startOffset),l=c.toString().length}a=e.textContent||"",o(),he(e,l),t(),ue(e,o)}),e.addEventListener("keydown",s=>{pe()&&ve(s)}),e.addEventListener("blur",()=>{R()}),e.addEventListener("click",s=>{let l=s.target.closest(".tk-var, .tk-var-resolved");l&&l.dataset.var&&ge(l,l.dataset.var,{getResolvedVariables:()=>X,getVariableSources:()=>Z,getSecretKeys:()=>ee,postMessage:me??void 0})})}function We(e){if(e.type!=="variablesResolved")return!1;X=e.variables||{},Z=e.sources||{},He(e.secretProviderNames||[]);let n=e.secretNames||{},t=new Set;for(let[a,o]of Object.entries(n)){W(a,o);for(let s of o)t.add(`$secret.${a}.${s}`)}return ee=t,U(),!0}var ze=null;function Ge(e){ze=e}document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&ze?.()});function je(e){Ce(()=>X),$e(()=>{U(),e?.extraSyncHighlight?.()},()=>{U(),e?.extraSyncUrlHighlight?.()},he,e?.setRawUrl)}var x=acquireVsCodeApi(),E=null,Ee=!1,ne=!1,T=-1,N=null;function d(e){return document.getElementById(e)}function M(e){if(!e)return"";let n=document.createElement("div");return n.textContent=e,n.innerHTML}var Te="secure:";function Xe(){let e=()=>Math.floor(Math.random()*16).toString(16),n=t=>Array.from({length:t},e).join("");return Te+n(8)+"-"+n(4)+"-4"+n(3)+"-"+n(4)+"-"+n(12)}function C(e){if(e&&e.startsWith(Te))return e.slice(Te.length)}function f(){ne||(N&&clearTimeout(N),N=setTimeout(()=>{E&&Je()},400))}function Je(){let e=JSON.parse(JSON.stringify(E));e.info=e.info||{},e.info.name=d("infoName").value||void 0,e.info.version=d("infoVersion").value||void 0;let n=d("infoSummary").value;n?e.info.summary=n:delete e.info.summary;let t=[];document.querySelectorAll("#defaultHeadersBody tr").forEach(r=>{let c=r.querySelector('input[type="text"]'),v=r.querySelector(".val-ce"),p=r.querySelector('input[type="checkbox"]');if(c?.value){let i={name:c.value,value:v?._getRawText?v._getRawText():v?.textContent||""};p&&!p.checked&&(i.disabled=!0),t.push(i)}}),e.request||(e.request={}),e.request.headers=t.length>0?t:void 0;let a=d("defaultAuthType").value,o=re(a,"dAuth");o!==void 0?e.request.auth=o:delete e.request.auth;let s=g.filter(r=>r.name).map(r=>{let c={name:r.name};return r.value!==void 0&&r.value!==""&&(c.value=r.value),r.secret&&(c.secret=!0),r.secure&&(c.secure=!0),r.disabled&&(c.disabled=!0),c});e.request=e.request||{},e.request.variables=s.length>0?s:void 0,e.request&&Object.keys(e.request).every(r=>e.request[r]===void 0)&&delete e.request;let l=St();e.config||(e.config={}),e.config.secretProviders=l.length>0?l:void 0,Ee=!0,x.postMessage({type:"updateDocument",collection:e})}function Ye(e){let n=d(e);n&&n.querySelectorAll(".tab").forEach(t=>{t.addEventListener("click",()=>{let a=t.dataset.tab;n.querySelectorAll(".tab").forEach(l=>l.classList.remove("active")),t.classList.add("active");let o=n.parentElement;o.querySelectorAll(":scope > .tab-content > .tab-panel").forEach(l=>l.classList.remove("active"));let s=o.querySelector(`#panel-${a}`);s&&s.classList.add("active")})})}function ut(e){let n=d("defaultHeadersBody");n.innerHTML="",(e||[]).forEach(t=>Qe(t.name,t.value,t.disabled))}function Qe(e,n,t){let a=d("defaultHeadersBody"),o=document.createElement("tr");o.innerHTML=`<td><input type="checkbox" ${t?"":"checked"} /></td><td><input type="text" value="${M(e||"")}" placeholder="Header name" /></td><td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="Header value"></div></td><td><button class="row-delete">\xD7</button></td>`,o.querySelector(".row-delete").addEventListener("click",()=>{o.remove(),f()}),o.querySelector('input[type="text"]').addEventListener("input",f),o.querySelector('input[type="checkbox"]').addEventListener("change",f),J(o.querySelector(".val-ce"),n||"",f),a.appendChild(o)}var g=[];function se(e){g=e||[];let n=d("defaultVarsBody");n.innerHTML="",g.forEach((t,a)=>pt(a)),vt()}function vt(){let e=document.getElementById("defaultVarsHiddenWarning");if(!e)return;let n=g.some(t=>t.secret===!0&&!t.secure);e.style.display=n?"block":"none"}function pt(e){let n=d("defaultVarsBody"),t=g[e],a=document.createElement("tr"),o=t.secret===!0,s=o&&t.secure===!0,l=t.disabled?"":"checked",r=o?s?"":t.value||"":typeof t.value=="string"?t.value:t.value&&t.value.data?t.value.data:"";if(a.innerHTML=`<td><input type="checkbox" ${l} data-field="disabled" /></td><td><input type="text" value="${M(t.name||"")}" placeholder="Variable name" data-field="name" /></td>${o?'<td><div class="secret-value-wrap"><input type="password" value="'+(s?"":M(r))+'"'+(s?' placeholder="\u2022\u2022\u2022\u2022\u2022\u2022"':"")+' data-field="value" /><button class="secret-toggle" title="Show/hide">&#9673;</button></div></td>':'<td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="Variable value" data-field="value"></div></td>'}<td><select class="type-select select-borderless" data-field="type"><option value="var"${o?"":" selected"}>var</option><option value="hidden"${o&&!s?" selected":""}>hidden</option><option value="secure"${s?" selected":""}>secure</option></select></td><td><button class="row-delete">\xD7</button></td>`,a.querySelectorAll("input[data-field]").forEach(i=>{let u=i.dataset.field;if(i.type==="checkbox")i.addEventListener("change",()=>{g[e].disabled=!i.checked,f()});else if(s&&u==="value"){let m=null;i.addEventListener("input",()=>{m&&clearTimeout(m),m=setTimeout(()=>{let h=C(g[e].value);h&&x.postMessage({type:"storeSecureValue",secureId:h,value:i.value})},500)})}else i.addEventListener("input",()=>{g[e][u]=i.value,f()})}),!o){let i=a.querySelector('.val-ce[data-field="value"]');i&&J(i,r,()=>{g[e].value=i._getRawText?i._getRawText():i.textContent||"",f()})}let c=a.querySelector(".type-select");c?.addEventListener("change",()=>{let i=c.value;if(i==="hidden")g[e].secret=!0,delete g[e].secure;else if(i==="secure")g[e].secret=!0,g[e].secure=!0,C(g[e].value)||(g[e].value=Xe());else{let u=C(g[e].value);u&&x.postMessage({type:"deleteSecureValue",secureId:u}),delete g[e].secret,delete g[e].secure,g[e].value=""}se(g),f()}),a.querySelector(".secret-toggle")?.addEventListener("click",()=>{let i=a.querySelector('input[data-field="value"]');i&&(i.type=i.type==="password"?"text":"password")}),a.querySelector(".row-delete").addEventListener("click",()=>{let i=C(g[e].value);i&&x.postMessage({type:"deleteSecureValue",secureId:i}),g.splice(e,1),se(g),f()});let p=C(t.value);s&&p&&x.postMessage({type:"getSecureStatus",secureId:p}),n.appendChild(a)}var ft={prefix:"dAuth",get fieldsContainer(){return d("defaultAuthFields")},onChange:()=>f(),showInherit:!1,wrapInputs:!0,showTokenStatus:!0,onFieldsRendered:e=>e.forEach(n=>Ke(n))},te=Le({prefix:"dAuth",buildAuth:()=>re(d("defaultAuthType").value,"dAuth"),postMessage:e=>x.postMessage(e),esc:M});function Ze(){let e=d("defaultAuthType").value;Se(e,ft),e==="oauth2"&&te.requestStatus()}var et=[{token:"charts.red",hex:"var(--vscode-charts-red, #f14c4c)"},{token:"charts.orange",hex:"var(--vscode-charts-orange, #d18616)"},{token:"charts.yellow",hex:"var(--vscode-charts-yellow, #cca700)"},{token:"charts.green",hex:"var(--vscode-charts-green, #89d185)"},{token:"charts.blue",hex:"var(--vscode-charts-blue, #3794ff)"},{token:"charts.purple",hex:"var(--vscode-charts-purple, #b180d7)"},{token:"charts.foreground",hex:"var(--vscode-charts-foreground, #cccccc)"},{token:"terminal.ansiRed",hex:"var(--vscode-terminal-ansiRed, #cd3131)"},{token:"terminal.ansiGreen",hex:"var(--vscode-terminal-ansiGreen, #0dbc79)"},{token:"terminal.ansiYellow",hex:"var(--vscode-terminal-ansiYellow, #e5e510)"},{token:"terminal.ansiBlue",hex:"var(--vscode-terminal-ansiBlue, #2472c8)"},{token:"terminal.ansiMagenta",hex:"var(--vscode-terminal-ansiMagenta, #bc3fbc)"},{token:"terminal.ansiCyan",hex:"var(--vscode-terminal-ansiCyan, #11a8cd)"},{token:"terminal.ansiWhite",hex:"var(--vscode-terminal-ansiWhite, #e5e5e5)"}];function F(){let e=d("envSelector");e.innerHTML="";let n=E?.config?.environments||[];if(n.length===0){let t=document.createElement("option");t.value="-1",t.textContent="No environments",e.appendChild(t),e.disabled=!0}else e.disabled=!1,n.forEach((t,a)=>{let o=document.createElement("option");o.value=String(a),o.textContent=t.name||"Unnamed",e.appendChild(o)}),e.value=String(T)}function tt(e){T=e,F(),P()}function gt(){let e=E?.config?.environments||[];T<0||T>=e.length||(e.splice(T,1),T>=e.length&&(T=e.length-1),F(),P(),f())}function ht(){E.config||(E.config={}),E.config.environments||(E.config.environments=[]),E.config.environments.push({name:"new-environment",variables:[]}),T=E.config.environments.length-1,F(),P(),f()}function be(){let e=document.querySelector(".swatch-popover");e&&e.remove()}function mt(e,n){be();let t=document.createElement("div");t.className="swatch-popover",et.forEach(o=>{let s=document.createElement("button");s.className="color-swatch"+(o.token===n.color?" active":""),s.style.background=o.hex,s.addEventListener("click",l=>{l.stopPropagation(),n.color=o.token,be(),F(),P(),f()}),t.appendChild(s)});let a=e.getBoundingClientRect();t.style.top=a.bottom+4+"px",t.style.left=a.left+"px",document.body.appendChild(t),setTimeout(()=>{document.addEventListener("click",function o(){be(),document.removeEventListener("click",o)})},0)}function yt(e){let n=document.getElementById("hiddenWarning");if(!n)return;let a=(e?.variables||[]).some(o=>o.secret===!0&&!o.secure);n.style.display=a?"block":"none"}function P(){let e=d("envDetail"),n=E?.config?.environments||[];if(T<0||T>=n.length){e.innerHTML='<div class="env-detail-empty">Add an environment to get started</div>';return}let t=n[T],a=t.color||"",o=et.find(r=>r.token===a),s=o?o.hex:"var(--vscode-charts-foreground, #888)";e.innerHTML='<div class="env-meta"><button class="color-dot-btn" id="envColorBtn" style="background:'+s+'" title="Pick color"></button><div class="form-field name"><label>Name</label><input type="text" id="envName" value="'+M(t.name)+'" /></div><div class="form-field extends"><label>Extends</label><input type="text" id="envExtends" value="'+M(t.extends||"")+'" placeholder="parent env name" /></div></div><div class="tabs" id="envTabs"><div class="tab active" data-tab="env-vars">Variables <span class="badge" id="envVarsBadge">'+(t.variables?t.variables.length:0)+'</span></div><div class="tab" data-tab="env-settings">Settings</div></div><div class="tab-content"><div class="tab-panel active" id="panel-env-vars"><div id="hiddenWarning" class="hidden-var-warning" style="display:none;"><strong>\u26A0 Warning:</strong> Variables set to <em>hidden</em> are stored as plain text in your collection file. They are only hidden from the UI. Use a <strong>secret provider</strong> with <em>secure</em> type for portable, encrypted secrets.</div><table class="kv-table"><colgroup><col style="width:32px"><col style="width:25%"><col><col style="width:70px"><col style="width:32px"></colgroup><thead><tr><th></th><th>Name</th><th>Value</th><th>Type</th><th></th></tr></thead><tbody id="envVarsBody"></tbody></table><button class="add-row-btn" id="addEnvVarBtn">+ Add Variable</button></div><div class="tab-panel" id="panel-env-settings"><div class="auth-section"><div class="auth-row"><label>dotenv File</label><input type="text" id="envDotenv" value="'+M(t.dotEnvFilePath||"")+'" placeholder=".env.local" /></div></div></div></div>',d("envName").addEventListener("input",()=>{t.name=d("envName").value,F(),f()}),d("envColorBtn").addEventListener("click",r=>{r.stopPropagation(),mt(d("envColorBtn"),t)}),d("envExtends").addEventListener("input",()=>{let r=d("envExtends").value;r?t.extends=r:delete t.extends,f()}),d("envDotenv")?.addEventListener("input",()=>{let r=d("envDotenv").value;r?t.dotEnvFilePath=r:delete t.dotEnvFilePath,f()});let l=d("envVarsBody");(t.variables||[]).forEach((r,c)=>{bt(l,t,c)}),yt(t),d("addEnvVarBtn").addEventListener("click",()=>{t.variables||(t.variables=[]),t.variables.push({name:"",value:""}),P(),f()}),Ye("envTabs")}function bt(e,n,t){let a=n.variables[t],o=document.createElement("tr"),s=a.secret===!0,l=s&&a.secure===!0,r=a.disabled?"":"checked",c=s?a.value||"":typeof a.value=="string"?a.value:a.value&&a.value.data?a.value.data:"";o.innerHTML=`<td><input type="checkbox" ${r} data-field="disabled" /></td><td><input type="text" value="${M(a.name||"")}" data-field="name" /></td>${s?'<td><div class="secret-value-wrap"><input type="password" value="'+(l?"":M(c))+'"'+(l?' placeholder="\u2022\u2022\u2022\u2022\u2022\u2022"':"")+' data-field="value" /><button class="secret-toggle" title="Show/hide">&#9673;</button></div></td>':'<td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="value" data-field="value"></div></td>'}<td><select class="type-select select-borderless" data-field="type"><option value="var"${s?"":" selected"}>var</option><option value="hidden"${s&&!l?" selected":""}>hidden</option><option value="secure"${l?" selected":""}>secure</option></select></td><td><button class="row-delete">\xD7</button></td>`,o.querySelectorAll("input[data-field]").forEach(i=>{let u=i.dataset.field;if(i.type==="checkbox")i.addEventListener("change",()=>{n.variables[t].disabled=!i.checked,f()});else if(l&&u==="value"){let m=null;i.addEventListener("input",()=>{m&&clearTimeout(m),m=setTimeout(()=>{let h=C(n.variables[t].value);h&&x.postMessage({type:"storeSecureValue",secureId:h,value:i.value})},500)})}else i.addEventListener("input",()=>{n.variables[t][u]=i.value,f()})});let v=o.querySelector(".type-select");if(v?.addEventListener("change",()=>{let i=v.value;if(i==="hidden")n.variables[t].secret=!0,delete n.variables[t].secure;else if(i==="secure")n.variables[t].secret=!0,n.variables[t].secure=!0,C(n.variables[t].value)||(n.variables[t].value=Xe());else{let u=C(n.variables[t].value);u&&x.postMessage({type:"deleteSecureValue",secureId:u}),delete n.variables[t].secret,delete n.variables[t].secure,n.variables[t].value=""}P(),f()}),o.querySelector(".secret-toggle")?.addEventListener("click",()=>{let i=o.querySelector('input[data-field="value"]');i&&(i.type=i.type==="password"?"text":"password")}),o.querySelector(".row-delete")?.addEventListener("click",()=>{let i=C(n.variables[t].value);i&&x.postMessage({type:"deleteSecureValue",secureId:i}),n.variables.splice(t,1),P(),f()}),!s){let i=o.querySelector('.val-ce[data-field="value"]');i&&J(i,c,()=>{n.variables[t].value=i._getRawText?i._getRawText():i.textContent||"",f()})}l&&a.name&&n.name&&x.postMessage({type:"getSecretVariable",envName:n.name,varName:a.name}),e.appendChild(o)}function Et(e){ne=!0,E=JSON.parse(JSON.stringify(e)),d("collectionName").textContent=e.info?.name||"Collection",d("infoName").value=e.info?.name||"",d("infoVersion").value=e.info?.version||"",d("infoSummary").value=e.info?.summary||"",ut(e.request?.headers||[]),se(e.request?.variables||[]);let n=e.request?.auth;n&&typeof n=="object"&&n.type?d("defaultAuthType").value=n.type:d("defaultAuthType").value="none",Ze(),n&&typeof n=="object"&&n.type&&setTimeout(()=>{we(n,"dAuth")},0),d("headersBadge").textContent=String((e.request?.headers||[]).length),d("variablesBadge").textContent=String((e.request?.variables||[]).length),Tt(e.config?.secretProviders||[]);let t=E?.config?.environments||[];d("envBadge").textContent=String(t.length),T<0&&t.length>0&&(T=0),T>=t.length&&(T=t.length-1),F(),P(),setTimeout(()=>{ne=!1},50)}window.addEventListener("message",e=>{let n=e.data;if(n.type==="collectionLoaded"){if(Ee){Ee=!1;return}Et(n.collection)}if(We(n)&&te.requestStatus(),n.type==="oauth2TokenStatus"&&te.handleStatus(n.status),n.type==="oauth2Progress"&&te.handleProgress(n.message),n.type==="testSecretProviderResult"){let a=d("secretProvidersBody").children[n.providerIdx];if(a){let s=a.querySelector(".btn-test-vault");s&&(s.disabled=!1,s.textContent="Test")}n.success&&n.providerName&&n.secretNames&&W(n.providerName,n.secretNames);let o=d("secretTestResult");n.success?o.innerHTML=`<span style="color:var(--badge-success);">\u2713 Connected \u2014 ${n.secretCount} secret${n.secretCount===1?"":"s"} found</span>`:o.innerHTML=`<span style="color:var(--badge-error);">\u2717 ${M(n.error||"Connection failed")}</span>`,setTimeout(()=>{o.innerHTML=""},1e4)}if(n.type==="secretNamesResult"&&n.providerName&&n.secretNames&&W(n.providerName,n.secretNames),n.type==="secureValueStored"||n.type==="secureStatus"){let t=n.type==="secureValueStored"||n.hasValue,o=(E?.config?.environments||[])[T];if(o?.variables){let l=d("envVarsBody")?.children;if(l){for(let r=0;r<l.length;r++)if(r<o.variables.length&&C(o.variables[r].value)===n.secureId){let c=l[r].querySelector('input[data-field="value"]');c&&c.type==="password"&&(c.placeholder=t?"\u2022\u2022\u2022\u2022\u2022\u2022 (stored)":"Enter secret value")}}}let s=d("defaultVarsBody")?.children;if(s){for(let l=0;l<s.length;l++)if(l<g.length&&C(g[l].value)===n.secureId){let r=s[l].querySelector('input[data-field="value"]');r&&r.type==="password"&&(r.placeholder=t?"\u2022\u2022\u2022\u2022\u2022\u2022 (stored)":"Enter secret value")}}}if(n.type==="secretValueResolved"&&Ne(n),n.type==="switchTab"){let t=n.tab,o=d("mainTabs").querySelector(`.tab[data-tab="${t}"]`);if(o&&o.click(),n.envName&&E?.config?.environments){let l=E.config.environments.findIndex(r=>r.name===n.envName);l>=0&&tt(l)}}});function Tt(e){let n=d("secretProvidersBody");n.innerHTML="",(e||[]).forEach(t=>nt(t.name,t.type,t.url,t.disabled)),d("secretsBadge").textContent=String((e||[]).length)}function nt(e,n,t,a){let o=d("secretProvidersBody"),s=document.createElement("tr"),l=n||"azure-keyvault";s.innerHTML=`<td><input type="text" value="${M(e||"")}" placeholder="my-vault" class="sp-name" /></td><td><select class="type-select select-borderless sp-type"><option value="azure-keyvault"${l==="azure-keyvault"?" selected":""}>Azure Key Vault</option></select></td><td class="val-cell"><div class="val-ce sp-url" contenteditable="true" data-placeholder="https://{{vault-name}}.vault.azure.net"></div></td><td><button class="btn-test-vault" title="Test connection">Test</button></td><td><button class="row-delete">\xD7</button></td>`,s.querySelector(".row-delete").addEventListener("click",()=>{s.remove(),d("secretsBadge").textContent=String(o.children.length),f()}),s.querySelector(".sp-name").addEventListener("input",f),s.querySelector(".sp-type").addEventListener("change",f),J(s.querySelector(".sp-url"),t||"",f);let r=s.querySelector(".btn-test-vault");r.addEventListener("click",()=>{let c=s.querySelector(".sp-name").value,v=s.querySelector(".sp-type").value,p=s.querySelector(".sp-url"),i=p._getRawText?p._getRawText():p.textContent||"";r.disabled=!0,r.innerHTML='<span class="spinner"></span>';let u=s.querySelector(".sp-test-result");u&&u.remove(),x.postMessage({type:"testSecretProvider",providerIdx:Array.from(o.children).indexOf(s),provider:{name:c,type:v,url:i}})}),o.appendChild(s)}function St(){let e=[];return document.querySelectorAll("#secretProvidersBody tr").forEach(n=>{let t=n.querySelector(".sp-name"),a=n.querySelector(".sp-type"),o=n.querySelector(".sp-url");t?.value&&e.push({name:t.value,type:a?.value||"azure-keyvault",url:o?._getRawText?o._getRawText():o?.textContent||""})}),e}je();Fe(e=>x.postMessage(e));Ge(()=>{N&&(clearTimeout(N),N=null),!ne&&E&&Je()});Ye("mainTabs");d("addDefaultHeaderBtn").addEventListener("click",()=>{Qe(),f()});d("addDefaultVarBtn").addEventListener("click",()=>{g.push({name:"",value:""}),se(g),f()});d("defaultAuthType").addEventListener("change",Ze);d("varToggleBtn").addEventListener("click",()=>{De(!ye()),d("varToggleBtn").classList.toggle("active",ye()),U()});d("addSecretProviderBtn").addEventListener("click",()=>{nt(),d("secretsBadge").textContent=String(d("secretProvidersBody").children.length),f()});d("addEnvBtn").addEventListener("click",ht);d("removeEnvBtn").addEventListener("click",gt);d("envSelector").addEventListener("change",()=>{let e=parseInt(d("envSelector").value,10);e>=0&&tt(e)});["infoName","infoVersion"].forEach(e=>{d(e).addEventListener("input",f)});d("infoSummary").addEventListener("input",f);x.postMessage({type:"ready"});})();
