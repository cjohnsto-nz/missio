"use strict";(()=>{function u(t,l,e,n="text"){let o=`<input type="${n}" id="${t}" placeholder="${l}" />`;return e?`<span class="auth-input-wrap">${o}</span>`:o}function H(t,l){let{prefix:e,fieldsContainer:n,onChange:o,wrapInputs:a,showTokenStatus:s}=l;if(n.innerHTML="",t==="bearer")n.innerHTML=`<div class="auth-row"><label>Token</label>${u(e+"Token","{{token}}",a)}</div>`;else if(t==="basic")n.innerHTML=`<div class="auth-row"><label>Username</label>${u(e+"Username","username",a)}</div><div class="auth-row"><label>Password</label>${u(e+"Password","password",a,"password")}</div>`;else if(t==="apikey")n.innerHTML=`<div class="auth-row"><label>Key</label>${u(e+"Key","X-Api-Key",a)}</div><div class="auth-row"><label>Value</label>${u(e+"Value","{{apiKey}}",a)}</div><div class="auth-row"><label>In</label><select id="${e}Placement" class="auth-select"><option value="header">Header</option><option value="query">Query</option></select></div>`;else if(t==="oauth2"){n.innerHTML=`<div class="auth-row"><label>Grant Type</label><select id="${e}OAuth2Flow" class="auth-select"><option value="client_credentials">Client Credentials</option><option value="password">Password</option><option value="authorization_code">Authorization Code</option></select></div><div class="auth-row"><label>Access Token URL</label>${u(e+"OAuth2AccessTokenUrl","{{authUrl}}/token",a)}</div><div class="auth-row"><label>Client ID</label>${u(e+"OAuth2ClientId","{{clientId}}",a)}</div><div class="auth-row"><label>Client Secret</label>${u(e+"OAuth2ClientSecret","{{clientSecret}}",a)}</div><div class="auth-row"><label>Scope</label>${u(e+"OAuth2Scope","openid profile",a)}</div><div id="${e}OAuth2PasswordFields" style="display:none;"><div class="auth-row"><label>Username</label>${u(e+"OAuth2Username","{{username}}",a)}</div><div class="auth-row"><label>Password</label>${u(e+"OAuth2Password","password",a,"password")}</div></div><div id="${e}OAuth2AuthCodeFields" style="display:none;"><div class="auth-row"><label>Auth URL</label>${u(e+"OAuth2AuthorizationUrl","{{authUrl}}/authorize",a)}</div><div class="auth-row"><label>Callback URL</label>${u(e+"OAuth2CallbackUrl","https://localhost/callback",a)}</div></div><div class="auth-row"><label>Refresh URL</label>${u(e+"OAuth2RefreshTokenUrl","(optional)",a)}</div><div class="auth-row"><label>Credentials In</label><select id="${e}OAuth2CredentialsPlacement" class="auth-select"><option value="basic_auth_header">Header</option><option value="body">Body</option></select></div><div class="auth-row"><label>Auto Fetch</label><input type="checkbox" id="${e}OAuth2AutoFetch" checked /></div><div class="auth-row"><label>Auto Refresh</label><input type="checkbox" id="${e}OAuth2AutoRefresh" checked /></div>`+(s?`<div class="oauth2-token-status" id="${e}OAuth2TokenStatus"></div>`:"");let r=document.getElementById(e+"OAuth2Flow"),d=document.getElementById(e+"OAuth2PasswordFields"),p=document.getElementById(e+"OAuth2AuthCodeFields"),h=()=>{let v=r.value;d.style.display=v==="password"?"":"none",p.style.display=v==="authorization_code"?"":"none"};r.addEventListener("change",()=>{h(),o()}),h()}if(n.querySelectorAll("input").forEach(r=>{r.addEventListener("input",o),r.addEventListener("change",o)}),n.querySelectorAll("select").forEach(r=>r.addEventListener("change",o)),l.onFieldsRendered){let r=Array.from(n.querySelectorAll('input[type="text"]'));l.onFieldsRendered(r)}}function O(t,l){let e=l,n=a=>document.getElementById(a),o=a=>document.getElementById(a);switch(t){case"bearer":return{type:"bearer",token:n(e+"Token")?.value||""};case"basic":return{type:"basic",username:n(e+"Username")?.value||"",password:n(e+"Password")?.value||""};case"apikey":return{type:"apikey",key:n(e+"Key")?.value||"",value:n(e+"Value")?.value||"",placement:o(e+"Placement")?.value||"header"};case"oauth2":{let a=o(e+"OAuth2Flow")?.value||"client_credentials",s={type:"oauth2",flow:a,accessTokenUrl:n(e+"OAuth2AccessTokenUrl")?.value||"",clientId:n(e+"OAuth2ClientId")?.value||"",clientSecret:n(e+"OAuth2ClientSecret")?.value||"",scope:n(e+"OAuth2Scope")?.value||"",refreshTokenUrl:n(e+"OAuth2RefreshTokenUrl")?.value||"",credentialsPlacement:o(e+"OAuth2CredentialsPlacement")?.value||"basic_auth_header",autoFetchToken:n(e+"OAuth2AutoFetch")?.checked!==!1,autoRefreshToken:n(e+"OAuth2AutoRefresh")?.checked!==!1};return a==="password"?(s.username=n(e+"OAuth2Username")?.value||"",s.password=n(e+"OAuth2Password")?.value||""):a==="authorization_code"&&(s.authorizationUrl=n(e+"OAuth2AuthorizationUrl")?.value||"",s.callbackUrl=n(e+"OAuth2CallbackUrl")?.value||""),s.refreshTokenUrl||delete s.refreshTokenUrl,s.scope||delete s.scope,s.clientSecret||delete s.clientSecret,s}case"inherit":return"inherit";default:return}}function M(t,l){let e=l,n=a=>document.getElementById(a),o=a=>document.getElementById(a);if(!(!t||t==="inherit")&&!(typeof t!="object"||!t.type))switch(t.type){case"bearer":{let a=n(e+"Token");a&&(a.value=t.token||"");break}case"basic":{let a=n(e+"Username");a&&(a.value=t.username||"");let s=n(e+"Password");s&&(s.value=t.password||"");break}case"apikey":{let a=n(e+"Key");a&&(a.value=t.key||"");let s=n(e+"Value");s&&(s.value=t.value||"");let r=o(e+"Placement");r&&(r.value=t.placement||"header");break}case"oauth2":{let a=o(e+"OAuth2Flow");a&&(a.value=t.flow||"client_credentials",a.dispatchEvent(new Event("change")));let s=n(e+"OAuth2AccessTokenUrl");s&&(s.value=t.accessTokenUrl||"");let r=n(e+"OAuth2ClientId");r&&(r.value=t.clientId||"");let d=n(e+"OAuth2ClientSecret");d&&(d.value=t.clientSecret||"");let p=n(e+"OAuth2Scope");p&&(p.value=t.scope||"");let h=n(e+"OAuth2RefreshTokenUrl");h&&(h.value=t.refreshTokenUrl||"");let v=o(e+"OAuth2CredentialsPlacement");v&&(v.value=t.credentialsPlacement||"basic_auth_header");let w=n(e+"OAuth2AutoFetch");w&&(w.checked=t.autoFetchToken!==!1);let S=n(e+"OAuth2AutoRefresh");if(S&&(S.checked=t.autoRefreshToken!==!1),t.flow==="password"){let f=n(e+"OAuth2Username");f&&(f.value=t.username||"");let y=n(e+"OAuth2Password");y&&(y.value=t.password||"")}else if(t.flow==="authorization_code"){let f=n(e+"OAuth2AuthorizationUrl");f&&(f.value=t.authorizationUrl||"");let y=n(e+"OAuth2CallbackUrl");y&&(y.value=t.callbackUrl||"")}break}}}var I=acquireVsCodeApi(),E=null,T=!1,g=!1,b=null;function i(t){return document.getElementById(t)}function m(t){if(!t)return"";let l=document.createElement("div");return l.textContent=t,l.innerHTML}var C={},q={};function A(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function $(t){return t.replace(/\{\{(\s*[\w.]+\s*)\}\}/g,(l,e)=>{let n=e.trim(),o=n in C,a=q[n]||"unknown";return"<span class='"+(o?"tk-var tk-src-"+a:"tk-var tk-var-unresolved")+"' data-var='"+A(n)+"'>{{"+A(e)+"}}</span>"})}function k(t){let l=t.parentElement;l.classList.add("var-cell");let e=document.createElement("div");e.className="var-overlay",l.appendChild(e);function n(){e.innerHTML=$(A(t.value))}function o(){l.classList.add("var-overlay-active"),n()}function a(){l.classList.remove("var-overlay-active")}t.addEventListener("input",n),t.addEventListener("focus",a),t.addEventListener("blur",o),e.addEventListener("click",()=>{a(),t.focus()}),document.activeElement!==t&&o()}function B(){document.querySelectorAll(".var-cell").forEach(t=>{let l=t.querySelector('input[type="text"]'),e=t.querySelector(".var-overlay");l&&e&&t.classList.contains("var-overlay-active")&&(e.innerHTML=$(A(l.value)))})}function c(){g||(b&&clearTimeout(b),b=setTimeout(()=>{E&&R()},400))}function R(){let t=JSON.parse(JSON.stringify(E));t.info=t.info||{},t.info.type="folder",t.info.name=i("infoName").value||void 0;let l=i("infoDescription").value;l?t.info.description=l:delete t.info.description;let e=[];document.querySelectorAll("#defaultHeadersBody tr").forEach(s=>{let r=s.querySelectorAll('input[type="text"]'),d=s.querySelector('input[type="checkbox"]');if(r[0]?.value){let p={name:r[0].value,value:r[1]?.value||""};d&&!d.checked&&(p.disabled=!0),e.push(p)}}),t.request||(t.request={}),t.request.headers=e.length>0?e:void 0;let n=i("defaultAuthType").value,o=O(n,"dAuth");o!==void 0?t.request.auth=o:delete t.request.auth;let a=[];document.querySelectorAll("#defaultVarsBody tr").forEach(s=>{let r=s.querySelectorAll('input[type="text"]'),d=s.querySelector('input[type="checkbox"]');if(r[0]?.value){let p={name:r[0].value,value:r[1]?.value||""};d&&!d.checked&&(p.disabled=!0),a.push(p)}}),t.request=t.request||{},t.request.variables=a.length>0?a:void 0,t.request&&Object.keys(t.request).every(s=>t.request[s]===void 0)&&delete t.request,T=!0,I.postMessage({type:"updateDocument",folder:t})}function P(t){let l=i(t);l&&l.querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{let n=e.dataset.tab;l.querySelectorAll(".tab").forEach(s=>s.classList.remove("active")),e.classList.add("active");let o=l.parentElement;o.querySelectorAll(":scope > .tab-content > .tab-panel").forEach(s=>s.classList.remove("active"));let a=o.querySelector(`#panel-${n}`);a&&a.classList.add("active")})})}function V(t){let l=i("defaultHeadersBody");l.innerHTML="",(t||[]).forEach(e=>U(e.name,e.value,e.disabled))}function U(t,l,e){let n=i("defaultHeadersBody"),o=document.createElement("tr");o.innerHTML=`<td><input type="checkbox" ${e?"":"checked"} /></td><td><input type="text" value="${m(t||"")}" placeholder="Header name" /></td><td><input type="text" value="${m(l||"")}" placeholder="Header value" /></td><td><button class="row-delete">\xD7</button></td>`,o.querySelector(".row-delete").addEventListener("click",()=>{o.remove(),c()}),o.querySelectorAll("input").forEach(s=>{s.addEventListener("input",c),s.addEventListener("change",c)});let a=o.querySelectorAll('input[type="text"]')[1];a&&k(a),n.appendChild(o)}function D(t){let l=i("defaultVarsBody");l.innerHTML="",(t||[]).forEach(e=>x(e.name,e.value,e.disabled))}function x(t,l,e){let n=i("defaultVarsBody"),o=document.createElement("tr"),a=typeof l=="string"?l:l&&l.data?l.data:"";o.innerHTML=`<td><input type="checkbox" ${e?"":"checked"} /></td><td><input type="text" value="${m(t||"")}" placeholder="Variable name" /></td><td><input type="text" value="${m(a)}" placeholder="Variable value" /></td><td><button class="row-delete">\xD7</button></td>`,o.querySelector(".row-delete").addEventListener("click",()=>{o.remove(),c()}),o.querySelectorAll("input").forEach(r=>{r.addEventListener("input",c),r.addEventListener("change",c)});let s=o.querySelectorAll('input[type="text"]')[1];s&&k(s),n.appendChild(o)}var _={prefix:"dAuth",get fieldsContainer(){return i("defaultAuthFields")},onChange:()=>c(),showInherit:!0,wrapInputs:!0,showTokenStatus:!0,onFieldsRendered:t=>t.forEach(l=>k(l))};function F(){let t=i("defaultAuthType").value;H(t,_)}function L(){i("headersBadge").textContent=String(document.querySelectorAll("#defaultHeadersBody tr").length),i("variablesBadge").textContent=String(document.querySelectorAll("#defaultVarsBody tr").length)}function N(t){g=!0,E=t,i("infoName").value=t.info?.name||"";let l=t.info?.description;i("infoDescription").value=typeof l=="string"?l:l?.content||"",i("folderName").textContent=t.info?.name||"Folder";let e=t.request?.auth;e==="inherit"?i("defaultAuthType").value="inherit":e?.type?i("defaultAuthType").value=e.type:i("defaultAuthType").value="none",F(),e&&e!=="inherit"&&e.type&&M(e,"dAuth"),V(t.request?.headers||[]),D(t.request?.variables||[]),L(),g=!1}P("mainTabs");i("defaultAuthType").addEventListener("change",F);i("addDefaultHeaderBtn").addEventListener("click",()=>{U(),L(),c()});i("addDefaultVarBtn").addEventListener("click",()=>{x(),L(),c()});i("infoName").addEventListener("input",()=>{i("folderName").textContent=i("infoName").value||"Folder",c()});i("infoDescription").addEventListener("input",c);window.addEventListener("message",t=>{let l=t.data;if(l.type==="folderLoaded"){if(T){T=!1;return}N(l.folder)}l.type==="variablesResolved"&&(C=l.variables||{},q=l.sources||{},B())});I.postMessage({type:"ready"});})();
