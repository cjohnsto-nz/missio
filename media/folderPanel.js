"use strict";(()=>{function T(e,n,t,s="text"){let r=`<input type="${s}" id="${e}" placeholder="${n}" />`;return t?`<span class="auth-input-wrap">${r}</span>`:r}function ye(e,n){let{prefix:t,fieldsContainer:s,onChange:r,wrapInputs:o,showTokenStatus:a}=n;if(s.innerHTML="",e==="bearer")s.innerHTML=`<div class="auth-row"><label>Token</label>${T(t+"Token","{{token}}",o)}</div>`;else if(e==="basic")s.innerHTML=`<div class="auth-row"><label>Username</label>${T(t+"Username","username",o)}</div><div class="auth-row"><label>Password</label>${T(t+"Password","password",o,"password")}</div>`;else if(e==="apikey")s.innerHTML=`<div class="auth-row"><label>Key</label>${T(t+"Key","X-Api-Key",o)}</div><div class="auth-row"><label>Value</label>${T(t+"Value","{{apiKey}}",o)}</div><div class="auth-row"><label>In</label><select id="${t}Placement" class="auth-select"><option value="header">Header</option><option value="query">Query</option></select></div>`;else if(e==="oauth2"){s.innerHTML=`<div class="auth-row"><label>Grant Type</label><select id="${t}OAuth2Flow" class="auth-select"><option value="client_credentials">Client Credentials</option><option value="password">Password</option><option value="authorization_code">Authorization Code</option></select></div><div class="auth-row"><label>Access Token URL</label>${T(t+"OAuth2AccessTokenUrl","{{authUrl}}/token",o)}</div><div class="auth-row"><label>Client ID</label>${T(t+"OAuth2ClientId","{{clientId}}",o)}</div><div class="auth-row"><label>Client Secret</label>${T(t+"OAuth2ClientSecret","{{clientSecret}}",o)}</div><div class="auth-row"><label>Scope</label>${T(t+"OAuth2Scope","openid profile",o)}</div><div id="${t}OAuth2PasswordFields" style="display:none;"><div class="auth-row"><label>Username</label>${T(t+"OAuth2Username","{{username}}",o)}</div><div class="auth-row"><label>Password</label>${T(t+"OAuth2Password","password",o,"password")}</div></div><div id="${t}OAuth2AuthCodeFields" style="display:none;"><div class="auth-row"><label>Auth URL</label>${T(t+"OAuth2AuthorizationUrl","{{authUrl}}/authorize",o)}</div><div class="auth-row"><label>Callback URL</label>${T(t+"OAuth2CallbackUrl","https://localhost/callback",o)}</div></div><div class="auth-row"><label>Refresh URL</label>${T(t+"OAuth2RefreshTokenUrl","(optional)",o)}</div><div class="auth-row"><label>Credentials In</label><select id="${t}OAuth2CredentialsPlacement" class="auth-select"><option value="basic_auth_header">Header</option><option value="body">Body</option></select></div><div class="auth-row"><label>Auto Fetch</label><input type="checkbox" id="${t}OAuth2AutoFetch" checked /></div><div class="auth-row"><label>Auto Refresh</label><input type="checkbox" id="${t}OAuth2AutoRefresh" checked /></div>`+(a?`<div class="oauth2-token-status" id="${t}OAuth2TokenStatus"></div>`:"");let l=document.getElementById(t+"OAuth2Flow"),c=document.getElementById(t+"OAuth2PasswordFields"),u=document.getElementById(t+"OAuth2AuthCodeFields"),p=()=>{let i=l.value;c.style.display=i==="password"?"":"none",u.style.display=i==="authorization_code"?"":"none"};l.addEventListener("change",()=>{p(),r()}),p()}if(s.querySelectorAll("input").forEach(l=>{l.addEventListener("input",r),l.addEventListener("change",r)}),s.querySelectorAll("select").forEach(l=>l.addEventListener("change",r)),n.onFieldsRendered){let l=Array.from(s.querySelectorAll('input[type="text"]'));n.onFieldsRendered(l)}}function te(e,n){let t=n,s=o=>document.getElementById(o),r=o=>document.getElementById(o);switch(e){case"bearer":return{type:"bearer",token:s(t+"Token")?.value||""};case"basic":return{type:"basic",username:s(t+"Username")?.value||"",password:s(t+"Password")?.value||""};case"apikey":return{type:"apikey",key:s(t+"Key")?.value||"",value:s(t+"Value")?.value||"",placement:r(t+"Placement")?.value||"header"};case"oauth2":{let o=r(t+"OAuth2Flow")?.value||"client_credentials",a={type:"oauth2",flow:o,accessTokenUrl:s(t+"OAuth2AccessTokenUrl")?.value||"",clientId:s(t+"OAuth2ClientId")?.value||"",clientSecret:s(t+"OAuth2ClientSecret")?.value||"",scope:s(t+"OAuth2Scope")?.value||"",refreshTokenUrl:s(t+"OAuth2RefreshTokenUrl")?.value||"",credentialsPlacement:r(t+"OAuth2CredentialsPlacement")?.value||"basic_auth_header",autoFetchToken:s(t+"OAuth2AutoFetch")?.checked!==!1,autoRefreshToken:s(t+"OAuth2AutoRefresh")?.checked!==!1};return o==="password"?(a.username=s(t+"OAuth2Username")?.value||"",a.password=s(t+"OAuth2Password")?.value||""):o==="authorization_code"&&(a.authorizationUrl=s(t+"OAuth2AuthorizationUrl")?.value||"",a.callbackUrl=s(t+"OAuth2CallbackUrl")?.value||""),a.refreshTokenUrl||delete a.refreshTokenUrl,a.scope||delete a.scope,a.clientSecret||delete a.clientSecret,a}case"inherit":return"inherit";default:return}}function be(e,n){let t=n,s=o=>document.getElementById(o),r=o=>document.getElementById(o);if(!(!e||e==="inherit")&&!(typeof e!="object"||!e.type))switch(e.type){case"bearer":{let o=s(t+"Token");o&&(o.value=e.token||"");break}case"basic":{let o=s(t+"Username");o&&(o.value=e.username||"");let a=s(t+"Password");a&&(a.value=e.password||"");break}case"apikey":{let o=s(t+"Key");o&&(o.value=e.key||"");let a=s(t+"Value");a&&(a.value=e.value||"");let l=r(t+"Placement");l&&(l.value=e.placement||"header");break}case"oauth2":{let o=r(t+"OAuth2Flow");o&&(o.value=e.flow||"client_credentials",o.dispatchEvent(new Event("change")));let a=s(t+"OAuth2AccessTokenUrl");a&&(a.value=e.accessTokenUrl||"");let l=s(t+"OAuth2ClientId");l&&(l.value=e.clientId||"");let c=s(t+"OAuth2ClientSecret");c&&(c.value=e.clientSecret||"");let u=s(t+"OAuth2Scope");u&&(u.value=e.scope||"");let p=s(t+"OAuth2RefreshTokenUrl");p&&(p.value=e.refreshTokenUrl||"");let i=r(t+"OAuth2CredentialsPlacement");i&&(i.value=e.credentialsPlacement||"basic_auth_header");let d=s(t+"OAuth2AutoFetch");d&&(d.checked=e.autoFetchToken!==!1);let m=s(t+"OAuth2AutoRefresh");if(m&&(m.checked=e.autoRefreshToken!==!1),e.flow==="password"){let g=s(t+"OAuth2Username");g&&(g.value=e.username||"");let E=s(t+"OAuth2Password");E&&(E.value=e.password||"")}else if(e.flow==="authorization_code"){let g=s(t+"OAuth2AuthorizationUrl");g&&(g.value=e.authorizationUrl||"");let E=s(t+"OAuth2CallbackUrl");E&&(E.value=e.callbackUrl||"")}break}}}function Xe(e){if(e<=0)return"expired";let n=Math.floor(e/1e3);if(n<60)return`${n}s`;let t=Math.floor(n/60);return t<60?`${t}m ${n%60}s`:`${Math.floor(t/60)}h ${t%60}m`}function Ee(e){let n=`${e.prefix}OAuth2TokenStatus`,t=null,s=null;function r(){return document.getElementById(n)}function o(){t&&(clearInterval(t),t=null)}function a(){let i=e.buildAuth();!i||i.type!=="oauth2"||!i.accessTokenUrl||e.postMessage({type:"getTokenStatus",auth:i})}function l(i){let d=r();if(!d)return;if(!i?.hasToken){d.innerHTML=`<div class="token-status token-none"><span class="token-dot dot-none"></span> No token<button class="token-btn" id="${n}-get">Get Token</button></div>`,d.querySelector(`#${n}-get`)?.addEventListener("click",()=>{let C=e.buildAuth();e.postMessage({type:"getToken",auth:C})});return}let m=Date.now(),g=i.expiresAt?i.expiresAt-m:void 0,E=g!==void 0&&g<=0,I=E?"dot-expired":"dot-valid",Y=E?"Expired":g!==void 0?`Expires in ${Xe(g)}`:"Valid (no expiry)",h=i.expiresAt?new Date(i.expiresAt).toLocaleTimeString():"";d.innerHTML='<div class="token-status '+(E?"token-expired":"token-valid")+'"><span class="token-dot '+I+'"></span> '+Y+(h?'<span class="token-expiry-time"> ('+e.esc(h)+")</span>":"")+`<button class="token-btn" id="${n}-refresh">${E?"Get Token":"Refresh"}</button></div>`,d.querySelector(`#${n}-refresh`)?.addEventListener("click",()=>{let C=e.buildAuth();e.postMessage({type:"getToken",auth:C})})}function c(i){s=i,o(),l(i),i?.expiresAt&&(t=setInterval(()=>{l(s),s?.expiresAt&&Date.now()>s.expiresAt&&o()},1e3))}function u(i){let d=r();if(!d||!i)return;o();let m=i.startsWith("Error:");d.innerHTML='<div class="token-status '+(m?"token-error":"token-progress")+'">'+(m?'<span class="token-dot dot-expired"></span> ':'<span class="token-spinner"></span> ')+e.esc(i)+"</div>"}function p(){o()}return{requestStatus:a,handleStatus:c,handleProgress:u,dispose:p}}var Je=/\{\{(\s*[\w.$-]+\s*)\}\}/g,Te=/^[\w.$-]*$/;function A(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Qe=new Set(["$guid","$timestamp","$randomInt"]);function Se(e,n){return e.replace(Je,(t,s)=>{let r=s.trim(),o=r in n.resolved,a=Qe.has(r),l=n.secretKeys?.has(r)??!1,c=o||a||l,u=n.sources[r]||(l?"secret":a?"dynamic":"unknown");return n.showResolved&&o?"<span class='"+("tk-var-resolved tk-src-"+u)+"' data-var='"+A(r)+"' title='{{"+A(r)+"}} ("+u+")'>"+A(n.resolved[r])+"</span>":"<span class='"+(c?"tk-var tk-src-"+u:"tk-var tk-var-unresolved")+"' data-var='"+A(r)+"'>{{"+A(s)+"}}</span>"})}var R=[{key:"environment",label:"Environment",badge:"E",badgeClass:"var-scope-badge-E"},{key:"collection",label:"Collection",badge:"C",badgeClass:"var-scope-badge-C"},{key:"global",label:"Globals",badge:"G",badgeClass:"var-scope-badge-G"}];function Ae(e){return e==="environment"||e==="dotenv"?R[0]:e==="collection"||e==="folder"?R[1]:e==="global"?R[2]:R[0]}var k=null,ne=null,P=null,O=!1;function we(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function ke(e){k&&!k.contains(e.target)&&_()}function _(){k&&(k.remove(),k=null),ne=null,document.removeEventListener("click",ke)}function Le(e){if(!k||e.secretRef!==ne)return;let n=k.querySelector(".var-secret-value"),t=k.querySelector('.var-action-btn[data-action="reveal"]');if(e.error){n&&(n.textContent=e.error,n.style.color="#f48771",n.style.fontStyle="normal"),t&&(t.textContent="Reveal Value");return}let s=e.value??"";P=s,n&&(n.textContent=s,n.style.cssText=""),t&&(t.textContent="Hide Value"),O=!0;let r=k.querySelector('.var-action-btn[data-action="copy"]');r&&(r.textContent="Copy Value",r.dataset.secretValue=s)}function se(e,n,t){_(),P=null,O=!1;let s=e.getBoundingClientRect(),r=t.getResolvedVariables(),o=t.getVariableSources(),a=t.getSecretKeys?.()??new Set,l=n in r,c=a.has(n),u=o[n]||(c?"secret":""),p=c&&!l,i=document.createElement("div");i.className="var-tooltip";let d="";if(p)d+="<div class='var-name'>{{"+we(n)+"}}</div><div class='var-source tk-src-secret'>Secret Provider</div><div class='var-secret-value var-value' style='font-style:italic;opacity:0.7'>Value hidden</div><div class='var-actions'>"+(t.postMessage?"<button class='var-action-btn' data-action='reveal'>Reveal Value</button>":"")+"<button class='var-action-btn' data-action='copy'>Copy Name</button></div>";else{let h=l?r[n]:"",C=l?Ae(u):null;d+="<input type='text' class='var-tooltip-value-input' placeholder='Enter value' value='"+we(h).replace(/'/g,"&#39;")+"' />";let M=C||R[0];d+="<div class='var-tooltip-scope-row'><div class='var-scope-dropdown'><button class='var-scope-trigger'><span class='var-scope-badge "+M.badgeClass+"'>"+M.badge+"</span><span>Save to "+M.label+" \u25BE</span></button><div class='var-scope-menu'>"+R.map(b=>"<button class='var-scope-option' data-scope='"+b.key+"'><span class='var-scope-badge "+b.badgeClass+"'>"+b.badge+"</span><span>"+b.label+"</span></button>").join("")+"</div></div></div>"}i.innerHTML=d,i.style.left=s.left+"px",i.style.top=s.bottom+4+"px",document.body.appendChild(i),k=i;let m=(l?Ae(u):R[0]).key,g=i.querySelector(".var-scope-trigger"),E=i.querySelector(".var-scope-menu");g&&E&&(g.addEventListener("click",h=>{h.stopPropagation(),E.classList.toggle("open")}),i.querySelectorAll(".var-scope-option").forEach(h=>{h.addEventListener("click",C=>{C.stopPropagation();let M=h.dataset.scope;m=M;let b=R.find(ee=>ee.key===M)||R[0];g.innerHTML="<span class='var-scope-badge "+b.badgeClass+"'>"+b.badge+"</span><span>Save to "+b.label+" \u25BE</span>",E.classList.remove("open")})}));let I=i.querySelector(".var-tooltip-value-input");I&&(setTimeout(()=>I.focus(),0),I.addEventListener("keydown",h=>{h.key==="Enter"&&(h.preventDefault(),Y()),h.key==="Escape"&&_()}));function Y(){let h=I?.value??"";t.postMessage&&(t.postMessage({type:"updateVariable",varName:n,value:h,scope:m}),_())}i.querySelectorAll(".var-action-btn").forEach(h=>{h.addEventListener("click",C=>{C.stopPropagation();let M=h.dataset.action;if(M==="copy"){let ee=h.dataset.secretValue??(l?r[n]:"{{"+n+"}}");navigator.clipboard.writeText(ee).catch(()=>{}),_()}else if(M==="reveal"){let b=i.querySelector(".var-secret-value");P!==null?(O=!O,b&&(b.textContent=O?P:"\u2022".repeat(Math.min(P.length,20))),h.textContent=O?"Hide Value":"Show Value"):(ne=n,b&&(b.textContent="Resolving\u2026",b.style.cssText="font-style:italic;opacity:0.7"),h.textContent="Resolving\u2026",t.postMessage({type:"resolveSecret",secretRef:n}))}})}),setTimeout(()=>{document.addEventListener("click",ke)},0)}var xe=()=>({});function Ce(e){xe=e}var y=null,w=[],H=0,B=null,L=0,K=!1,re=null,Ze=[{name:"$guid",detail:"Generate a random UUID"},{name:"$timestamp",detail:"Current Unix timestamp"},{name:"$randomInt",detail:"Random integer 0\u20131000"}],oe=[],Me=new Map;function Re(e){oe=e}function He(e,n){Me.set(e,n)}function Ve(e,n){let t=e.substring(0,n),s=t.lastIndexOf("{{");if(s===-1)return null;let r=t.substring(s+2);if(r.includes("}}"))return null;let o=r.trim();return Te.test(o)?o:null}function le(e,n){let t=e.selectionStart??0,s=Ve(e.value,t);if(s===null){x();return}B=e,K=!1,L=e.value.lastIndexOf("{{",t-1),Ie(s,e,n)}function ie(e,n){let t=window.getSelection();if(!t||t.rangeCount===0)return;let s=e.textContent||"",r=t.getRangeAt(0),o=document.createRange();o.selectNodeContents(e),o.setEnd(r.startContainer,r.startOffset);let a=o.toString().length,l=Ve(s,a);if(l===null){x();return}B=e,K=!0,L=s.lastIndexOf("{{",a-1),Ie(l,e,n)}function Ie(e,n,t){re=t;let s=e.toLowerCase(),r=[],o=xe();for(let l of Object.keys(o))r.push({name:l,detail:o[l]});for(let l of Ze)r.push(l);if(s===""||"$secret".startsWith(s))oe.length>0&&r.push({name:"$secret",detail:"Secret provider"});else if(s.startsWith("$secret.")){let l=s.substring(8),c=l.indexOf(".");if(c===-1)for(let u of oe)u.toLowerCase().startsWith(l)&&r.push({name:"$secret."+u,detail:"Key Vault provider"});else{let u=l.substring(0,c),p=l.substring(c+1),i=Me.get(u)||[];for(let d of i)d.toLowerCase().startsWith(p)&&r.push({name:"$secret."+u+"."+d,displayName:d,detail:"Secret"})}}let a=new Set;w=[];for(let l of r)l.name.toLowerCase().startsWith(s)&&!a.has(l.name)&&(a.add(l.name),w.push(l));if(w.length===0){x();return}H=0,y||(y=document.createElement("div"),y.className="var-autocomplete",document.body.appendChild(y)),ae(),et(n)}function ae(){y&&(y.innerHTML=w.map((e,n)=>"<div class='"+(n===H?"var-autocomplete-item selected":"var-autocomplete-item")+"' data-index='"+n+"'><span class='var-ac-name'>"+A(e.displayName||e.name)+"</span><span class='var-ac-value'>"+A(e.detail||"")+"</span></div>").join(""),y.querySelectorAll(".var-autocomplete-item").forEach(e=>{e.addEventListener("mousedown",n=>{n.preventDefault();let t=parseInt(e.dataset.index||"0");_e(w[t].name)})}))}function Ye(e){let n=document.createElement("div"),t=window.getComputedStyle(e);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","paddingTop","paddingLeft","paddingRight","paddingBottom","borderWidth","boxSizing","whiteSpace","wordWrap","overflowWrap","tabSize"].forEach(u=>{n.style[u]=t.getPropertyValue(u.replace(/[A-Z]/g,p=>"-"+p.toLowerCase()))}),n.style.position="absolute",n.style.visibility="hidden",n.style.whiteSpace="pre-wrap",n.style.wordWrap="break-word",n.style.width=e.clientWidth+"px";let r=e.value.substring(0,e.selectionStart??0);n.textContent=r;let o=document.createElement("span");o.textContent="|",n.appendChild(o),document.body.appendChild(n);let a=o.getBoundingClientRect(),l=e.getBoundingClientRect(),c={top:l.top+(a.top-n.getBoundingClientRect().top)-e.scrollTop,left:l.left+(a.left-n.getBoundingClientRect().left)-e.scrollLeft};return document.body.removeChild(n),c}function et(e){if(y){if(K){let n=window.getSelection();if(n&&n.rangeCount>0){let s=n.getRangeAt(0).getBoundingClientRect();y.style.left=s.left+"px",y.style.top=s.bottom+4+"px"}else{let t=e.getBoundingClientRect();y.style.left=t.left+"px",y.style.top=t.bottom+2+"px"}}else{let n=Ye(e);y.style.left=n.left+"px",y.style.top=n.top+18+"px"}y.style.minWidth="220px"}}var Oe=null,$e=null,qe=null,U=null;function Pe(e,n,t,s){Oe=e,$e=n,qe=t,U=s||null}function tt(e){return!!(e==="$secret"||e.startsWith("$secret.")&&e.split(".").length===2)}function _e(e){if(!B)return;let n=tt(e),t=B,s=K,r=re;if(s){let o=t,a=o,l=a._getRawText?a._getRawText():o.textContent||"",c=window.getSelection(),u=l.length;if(c&&c.rangeCount>0){let d=c.getRangeAt(0),m=document.createRange();m.selectNodeContents(o),m.setEnd(d.startContainer,d.startOffset),u=m.toString().length}let p,i;if(n){p="{{"+e+".";let d=u;l.substring(u).startsWith("}}")&&(d+=2);let g=l.substring(0,L)+p+l.substring(d);i=L+p.length,a._setRawText?a._setRawText(g):U&&U(g)}else{p="{{"+e+"}}";let d=u;l.substring(u).startsWith("}}")&&(d+=2);let g=l.substring(0,L)+p+l.substring(d);i=L+p.length,a._setRawText?a._setRawText(g):U&&U(g)}if(r?r():$e?.(),qe?.(o,i),n){x(),setTimeout(()=>{ie(o,r||(()=>{}))},0);return}}else{let o=t,a=o.value,l=o.selectionStart??a.length,c,u;if(n){c="{{"+e+".";let p=l;a.substring(l).startsWith("}}")&&(p+=2),o.value=a.substring(0,L)+c+a.substring(p),u=L+c.length}else{c="{{"+e+"}}";let p=l;a.substring(l).startsWith("}}")&&(p+=2),o.value=a.substring(0,L)+c+a.substring(p),u=L+c.length}if(o.selectionStart=u,o.selectionEnd=u,o.focus(),r?r():Oe?.(),n){x(),setTimeout(()=>{le(o,r||(()=>{}))},0);return}}x()}function x(){y&&(y.remove(),y=null),B=null,w=[],H=0,re=null}function ce(e){return!y||w.length===0?!1:e.key==="ArrowDown"?(e.preventDefault(),H=(H+1)%w.length,ae(),!0):e.key==="ArrowUp"?(e.preventDefault(),H=(H-1+w.length)%w.length,ae(),!0):e.key==="Enter"||e.key==="Tab"?(e.preventDefault(),_e(w[H].name),!0):e.key==="Escape"?(e.preventDefault(),x(),!0):!1}function ue(){return y!==null}var D={},z={},F=!1,G=new Set,nt=null,pe=null;function Ue(e){pe=e}function fe(){return F}function Be(e){F=e}function W(e){return Se(e,{resolved:D,sources:z,showResolved:F,secretKeys:G})}function de(e,n){let t=window.getSelection();if(!t)return;let s=document.createRange(),r=0,o=!1;function a(l){if(l.nodeType===Node.TEXT_NODE){let c=(l.textContent||"").length;if(r+c>=n)return s.setStart(l,n-r),s.collapse(!0),!0;r+=c}else for(let c=0;c<l.childNodes.length;c++)if(a(l.childNodes[c]))return!0;return!1}o=a(e),o||(s.selectNodeContents(e),s.collapse(!1)),t.removeAllRanges(),t.addRange(s)}function $(){document.querySelectorAll(".var-cell").forEach(e=>{let n=e.querySelector('input[type="text"]'),t=e.querySelector(".var-overlay");n&&t&&e.classList.contains("var-overlay-active")&&(t.innerHTML=W(A(n.value)))}),document.querySelectorAll(".val-ce").forEach(e=>{let n=e._getRawText;if(n&&document.activeElement!==e){let t=n();t&&(e.innerHTML=W(A(t)))}})}function Fe(e){let n=e.parentElement;n.classList.add("var-cell");let t=document.createElement("div");t.className="var-overlay",n.appendChild(t);function s(){t.innerHTML=W(A(e.value))}function r(){n.classList.add("var-overlay-active"),s()}function o(){n.classList.remove("var-overlay-active")}e.addEventListener("input",()=>{s(),le(e,s)}),e.addEventListener("focus",o),e.addEventListener("blur",()=>{r(),x()}),e.addEventListener("keydown",a=>{ue()&&ce(a)}),t.addEventListener("click",a=>{let l=a.target.closest(".tk-var, .tk-var-resolved");l&&l.dataset.var?se(l,l.dataset.var,{getResolvedVariables:()=>D,getVariableSources:()=>z,getSecretKeys:()=>G,postMessage:pe??void 0}):(o(),e.focus())}),document.activeElement!==e&&r()}function ve(e,n,t){let s=n||"";e._getRawText=()=>s,e._setRawText=o=>{s=o};function r(){if(!s){e.innerHTML="";return}let o=window.getSelection(),a=0;if(o&&o.rangeCount>0&&e.contains(o.anchorNode)){let l=o.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(l.startContainer,l.startOffset),a=c.toString().length}e.innerHTML=W(A(s)),o&&document.activeElement===e&&de(e,a)}r(),e.addEventListener("input",()=>{if(F){F=!1,$(),nt?.();return}let o=window.getSelection(),a=0;if(o&&o.rangeCount>0&&e.contains(o.anchorNode)){let l=o.getRangeAt(0),c=document.createRange();c.selectNodeContents(e),c.setEnd(l.startContainer,l.startOffset),a=c.toString().length}s=e.textContent||"",r(),de(e,a),t(),ie(e,r)}),e.addEventListener("keydown",o=>{ue()&&ce(o)}),e.addEventListener("blur",()=>{x()}),e.addEventListener("click",o=>{let a=o.target.closest(".tk-var, .tk-var-resolved");a&&a.dataset.var&&se(a,a.dataset.var,{getResolvedVariables:()=>D,getVariableSources:()=>z,getSecretKeys:()=>G,postMessage:pe??void 0})})}function De(e){if(e.type!=="variablesResolved")return!1;D=e.variables||{},z=e.sources||{},Re(e.secretProviderNames||[]);let n=e.secretNames||{},t=new Set;for(let[s,r]of Object.entries(n)){He(s,r);for(let o of r)t.add(`$secret.${s}.${o}`)}return G=t,$(),!0}var Ne=null;function Ke(e){Ne=e}document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&Ne?.()});function We(e){Ce(()=>D),Pe(()=>{$(),e?.extraSyncHighlight?.()},()=>{$(),e?.extraSyncUrlHighlight?.()},de,e?.setRawUrl)}var V=acquireVsCodeApi(),Z=null,ge=!1,X=!1,q=null;function f(e){return document.getElementById(e)}function J(e){if(!e)return"";let n=document.createElement("div");return n.textContent=e,n.innerHTML}var he="secure:";function st(){let e=()=>Math.floor(Math.random()*16).toString(16),n=t=>Array.from({length:t},e).join("");return he+n(8)+"-"+n(4)+"-4"+n(3)+"-"+n(4)+"-"+n(12)}function N(e){if(e&&e.startsWith(he))return e.slice(he.length)}function S(){X||(q&&clearTimeout(q),q=setTimeout(()=>{Z&&ze()},400))}function ze(){let e=JSON.parse(JSON.stringify(Z));e.info=e.info||{},e.info.type="folder",e.info.name=f("infoName").value||void 0;let n=f("infoDescription").value;n?e.info.description=n:delete e.info.description;let t=[];document.querySelectorAll("#defaultHeadersBody tr").forEach(a=>{let l=a.querySelector('input[type="text"]'),c=a.querySelector(".val-ce"),u=a.querySelector('input[type="checkbox"]');if(l?.value){let p={name:l.value,value:c?._getRawText?c._getRawText():c?.textContent||""};u&&!u.checked&&(p.disabled=!0),t.push(p)}}),e.request||(e.request={}),e.request.headers=t.length>0?t:void 0;let s=f("defaultAuthType").value,r=te(s,"dAuth");r!==void 0?e.request.auth=r:delete e.request.auth;let o=v.filter(a=>a.name).map(a=>{let l={name:a.name};return a.value!==void 0&&a.value!==""&&(l.value=a.value),a.secret&&(l.secret=!0),a.secure&&(l.secure=!0),a.disabled&&(l.disabled=!0),l});e.request=e.request||{},e.request.variables=o.length>0?o:void 0,e.request&&Object.keys(e.request).every(a=>e.request[a]===void 0)&&delete e.request,ge=!0,V.postMessage({type:"updateDocument",folder:e})}function ot(e){let n=f(e);n&&n.querySelectorAll(".tab").forEach(t=>{t.addEventListener("click",()=>{let s=t.dataset.tab;n.querySelectorAll(".tab").forEach(a=>a.classList.remove("active")),t.classList.add("active");let r=n.parentElement;r.querySelectorAll(":scope > .tab-content > .tab-panel").forEach(a=>a.classList.remove("active"));let o=r.querySelector(`#panel-${s}`);o&&o.classList.add("active")})})}function at(e){let n=f("defaultHeadersBody");n.innerHTML="",(e||[]).forEach(t=>Ge(t.name,t.value,t.disabled))}function Ge(e,n,t){let s=f("defaultHeadersBody"),r=document.createElement("tr");r.innerHTML=`<td><input type="checkbox" ${t?"":"checked"} /></td><td><input type="text" value="${J(e||"")}" placeholder="Header name" /></td><td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="Header value"></div></td><td><button class="row-delete">\xD7</button></td>`,r.querySelector(".row-delete").addEventListener("click",()=>{r.remove(),S()}),r.querySelector('input[type="text"]').addEventListener("input",S),r.querySelector('input[type="checkbox"]').addEventListener("change",S),ve(r.querySelector(".val-ce"),n||"",S),s.appendChild(r)}var v=[];function Q(e){v=e||[];let n=f("defaultVarsBody");n.innerHTML="",v.forEach((t,s)=>lt(s)),rt()}function rt(){let e=document.getElementById("defaultVarsHiddenWarning");if(!e)return;let n=v.some(t=>t.secret===!0&&!t.secure);e.style.display=n?"block":"none"}function lt(e){let n=f("defaultVarsBody"),t=v[e],s=document.createElement("tr"),r=t.secret===!0,o=r&&t.secure===!0,a=t.disabled?"":"checked",l=r?o?"":t.value||"":typeof t.value=="string"?t.value:t.value&&t.value.data?t.value.data:"";if(s.innerHTML=`<td><input type="checkbox" ${a} data-field="disabled" /></td><td><input type="text" value="${J(t.name||"")}" placeholder="Variable name" data-field="name" /></td>${r?'<td><div class="secret-value-wrap"><input type="password" value="'+(o?"":J(l))+'"'+(o?' placeholder="\u2022\u2022\u2022\u2022\u2022\u2022"':"")+' data-field="value" /><button class="secret-toggle" title="Show/hide">&#9673;</button></div></td>':'<td class="val-cell"><div class="val-ce" contenteditable="true" data-placeholder="Variable value" data-field="value"></div></td>'}<td><select class="type-select select-borderless" data-field="type"><option value="var"${r?"":" selected"}>var</option><option value="hidden"${r&&!o?" selected":""}>hidden</option><option value="secure"${o?" selected":""}>secure</option></select></td><td><button class="row-delete">\xD7</button></td>`,s.querySelectorAll("input[data-field]").forEach(i=>{let d=i.dataset.field;if(i.type==="checkbox")i.addEventListener("change",()=>{v[e].disabled=!i.checked,S()});else if(o&&d==="value"){let m=null;i.addEventListener("input",()=>{m&&clearTimeout(m),m=setTimeout(()=>{let g=N(v[e].value);g&&V.postMessage({type:"storeSecureValue",secureId:g,value:i.value})},500)})}else i.addEventListener("input",()=>{v[e][d]=i.value,S()})}),!r){let i=s.querySelector('.val-ce[data-field="value"]');i&&ve(i,l,()=>{v[e].value=i._getRawText?i._getRawText():i.textContent||"",S()})}let c=s.querySelector(".type-select");c?.addEventListener("change",()=>{let i=c.value;if(i==="hidden")v[e].secret=!0,delete v[e].secure;else if(i==="secure")v[e].secret=!0,v[e].secure=!0,N(v[e].value)||(v[e].value=st());else{let d=N(v[e].value);d&&V.postMessage({type:"deleteSecureValue",secureId:d}),delete v[e].secret,delete v[e].secure,v[e].value=""}Q(v),S()}),s.querySelector(".secret-toggle")?.addEventListener("click",()=>{let i=s.querySelector('input[data-field="value"]');i&&(i.type=i.type==="password"?"text":"password")}),s.querySelector(".row-delete").addEventListener("click",()=>{let i=N(v[e].value);i&&V.postMessage({type:"deleteSecureValue",secureId:i}),v.splice(e,1),Q(v),S()});let p=N(t.value);o&&p&&V.postMessage({type:"getSecureStatus",secureId:p}),n.appendChild(s)}var it={prefix:"dAuth",get fieldsContainer(){return f("defaultAuthFields")},onChange:()=>S(),showInherit:!0,wrapInputs:!0,showTokenStatus:!0,onFieldsRendered:e=>e.forEach(n=>Fe(n))},j=Ee({prefix:"dAuth",buildAuth:()=>te(f("defaultAuthType").value,"dAuth"),postMessage:e=>V.postMessage(e),esc:J});function je(){let e=f("defaultAuthType").value;ye(e,it),e==="oauth2"&&j.requestStatus()}function me(){f("headersBadge").textContent=String(document.querySelectorAll("#defaultHeadersBody tr").length),f("variablesBadge").textContent=String(document.querySelectorAll("#defaultVarsBody tr").length)}function ct(e){X=!0,Z=JSON.parse(JSON.stringify(e)),f("infoName").value=e.info?.name||"";let n=e.info?.description;f("infoDescription").value=typeof n=="string"?n:n?.content||"",f("folderName").textContent=e.info?.name||"Folder";let t=e.request?.auth;t==="inherit"?f("defaultAuthType").value="inherit":t?.type?f("defaultAuthType").value=t.type:f("defaultAuthType").value="none",je(),t&&t!=="inherit"&&t.type&&be(t,"dAuth"),at(e.request?.headers||[]),Q(e.request?.variables||[]),me(),X=!1}We();Ue(e=>V.postMessage(e));Ke(()=>{q&&(clearTimeout(q),q=null),!X&&Z&&ze()});ot("mainTabs");f("defaultAuthType").addEventListener("change",je);f("addDefaultHeaderBtn").addEventListener("click",()=>{Ge(),me(),S()});f("addDefaultVarBtn").addEventListener("click",()=>{v.push({name:"",value:""}),Q(v),me(),S()});f("varToggleBtn").addEventListener("click",()=>{Be(!fe()),f("varToggleBtn").classList.toggle("active",fe()),$()});f("infoName").addEventListener("input",()=>{f("folderName").textContent=f("infoName").value||"Folder",S()});f("infoDescription").addEventListener("input",S);window.addEventListener("message",e=>{let n=e.data;if(n.type==="folderLoaded"){if(ge){ge=!1;return}ct(n.folder)}De(n)&&j.requestStatus(),n.type==="secretValueResolved"&&Le(n),n.type==="oauth2TokenStatus"&&j.handleStatus(n.status),n.type==="oauth2Progress"&&j.handleProgress(n.message)});V.postMessage({type:"ready"});})();
