"use strict";(()=>{function v(e,n,t,a="text"){let l=`<input type="${a}" id="${e}" placeholder="${n}" />`;return t?`<span class="auth-input-wrap">${l}</span>`:l}function R(e,n){let{prefix:t,fieldsContainer:a,onChange:l,wrapInputs:s,showTokenStatus:o}=n;if(a.innerHTML="",e==="bearer")a.innerHTML=`<div class="auth-row"><label>Token</label>${v(t+"Token","{{token}}",s)}</div>`;else if(e==="basic")a.innerHTML=`<div class="auth-row"><label>Username</label>${v(t+"Username","username",s)}</div><div class="auth-row"><label>Password</label>${v(t+"Password","password",s,"password")}</div>`;else if(e==="apikey")a.innerHTML=`<div class="auth-row"><label>Key</label>${v(t+"Key","X-Api-Key",s)}</div><div class="auth-row"><label>Value</label>${v(t+"Value","{{apiKey}}",s)}</div><div class="auth-row"><label>In</label><select id="${t}Placement" class="auth-select"><option value="header">Header</option><option value="query">Query</option></select></div>`;else if(e==="oauth2"){a.innerHTML=`<div class="auth-row"><label>Grant Type</label><select id="${t}OAuth2Flow" class="auth-select"><option value="client_credentials">Client Credentials</option><option value="password">Password</option><option value="authorization_code">Authorization Code</option></select></div><div class="auth-row"><label>Access Token URL</label>${v(t+"OAuth2AccessTokenUrl","{{authUrl}}/token",s)}</div><div class="auth-row"><label>Client ID</label>${v(t+"OAuth2ClientId","{{clientId}}",s)}</div><div class="auth-row"><label>Client Secret</label>${v(t+"OAuth2ClientSecret","{{clientSecret}}",s)}</div><div class="auth-row"><label>Scope</label>${v(t+"OAuth2Scope","openid profile",s)}</div><div id="${t}OAuth2PasswordFields" style="display:none;"><div class="auth-row"><label>Username</label>${v(t+"OAuth2Username","{{username}}",s)}</div><div class="auth-row"><label>Password</label>${v(t+"OAuth2Password","password",s,"password")}</div></div><div id="${t}OAuth2AuthCodeFields" style="display:none;"><div class="auth-row"><label>Auth URL</label>${v(t+"OAuth2AuthorizationUrl","{{authUrl}}/authorize",s)}</div><div class="auth-row"><label>Callback URL</label>${v(t+"OAuth2CallbackUrl","https://localhost/callback",s)}</div></div><div class="auth-row"><label>Refresh URL</label>${v(t+"OAuth2RefreshTokenUrl","(optional)",s)}</div><div class="auth-row"><label>Credentials In</label><select id="${t}OAuth2CredentialsPlacement" class="auth-select"><option value="basic_auth_header">Header</option><option value="body">Body</option></select></div><div class="auth-row"><label>Auto Fetch</label><input type="checkbox" id="${t}OAuth2AutoFetch" checked /></div><div class="auth-row"><label>Auto Refresh</label><input type="checkbox" id="${t}OAuth2AutoRefresh" checked /></div>`+(o?`<div class="oauth2-token-status" id="${t}OAuth2TokenStatus"></div>`:"");let r=document.getElementById(t+"OAuth2Flow"),d=document.getElementById(t+"OAuth2PasswordFields"),c=document.getElementById(t+"OAuth2AuthCodeFields"),h=()=>{let u=r.value;d.style.display=u==="password"?"":"none",c.style.display=u==="authorization_code"?"":"none"};r.addEventListener("change",()=>{h(),l()}),h()}if(a.querySelectorAll("input").forEach(r=>{r.addEventListener("input",l),r.addEventListener("change",l)}),a.querySelectorAll("select").forEach(r=>r.addEventListener("change",l)),n.onFieldsRendered){let r=Array.from(a.querySelectorAll('input[type="text"]'));n.onFieldsRendered(r)}}function H(e,n){let t=n,a=s=>document.getElementById(s),l=s=>document.getElementById(s);switch(e){case"bearer":return{type:"bearer",token:a(t+"Token")?.value||""};case"basic":return{type:"basic",username:a(t+"Username")?.value||"",password:a(t+"Password")?.value||""};case"apikey":return{type:"apikey",key:a(t+"Key")?.value||"",value:a(t+"Value")?.value||"",placement:l(t+"Placement")?.value||"header"};case"oauth2":{let s=l(t+"OAuth2Flow")?.value||"client_credentials",o={type:"oauth2",flow:s,accessTokenUrl:a(t+"OAuth2AccessTokenUrl")?.value||"",clientId:a(t+"OAuth2ClientId")?.value||"",clientSecret:a(t+"OAuth2ClientSecret")?.value||"",scope:a(t+"OAuth2Scope")?.value||"",refreshTokenUrl:a(t+"OAuth2RefreshTokenUrl")?.value||"",credentialsPlacement:l(t+"OAuth2CredentialsPlacement")?.value||"basic_auth_header",autoFetchToken:a(t+"OAuth2AutoFetch")?.checked!==!1,autoRefreshToken:a(t+"OAuth2AutoRefresh")?.checked!==!1};return s==="password"?(o.username=a(t+"OAuth2Username")?.value||"",o.password=a(t+"OAuth2Password")?.value||""):s==="authorization_code"&&(o.authorizationUrl=a(t+"OAuth2AuthorizationUrl")?.value||"",o.callbackUrl=a(t+"OAuth2CallbackUrl")?.value||""),o.refreshTokenUrl||delete o.refreshTokenUrl,o.scope||delete o.scope,o.clientSecret||delete o.clientSecret,o}case"inherit":return"inherit";default:return}}function B(e,n){let t=n,a=s=>document.getElementById(s),l=s=>document.getElementById(s);if(!(!e||e==="inherit")&&!(typeof e!="object"||!e.type))switch(e.type){case"bearer":{let s=a(t+"Token");s&&(s.value=e.token||"");break}case"basic":{let s=a(t+"Username");s&&(s.value=e.username||"");let o=a(t+"Password");o&&(o.value=e.password||"");break}case"apikey":{let s=a(t+"Key");s&&(s.value=e.key||"");let o=a(t+"Value");o&&(o.value=e.value||"");let r=l(t+"Placement");r&&(r.value=e.placement||"header");break}case"oauth2":{let s=l(t+"OAuth2Flow");s&&(s.value=e.flow||"client_credentials",s.dispatchEvent(new Event("change")));let o=a(t+"OAuth2AccessTokenUrl");o&&(o.value=e.accessTokenUrl||"");let r=a(t+"OAuth2ClientId");r&&(r.value=e.clientId||"");let d=a(t+"OAuth2ClientSecret");d&&(d.value=e.clientSecret||"");let c=a(t+"OAuth2Scope");c&&(c.value=e.scope||"");let h=a(t+"OAuth2RefreshTokenUrl");h&&(h.value=e.refreshTokenUrl||"");let u=l(t+"OAuth2CredentialsPlacement");u&&(u.value=e.credentialsPlacement||"basic_auth_header");let p=a(t+"OAuth2AutoFetch");p&&(p.checked=e.autoFetchToken!==!1);let b=a(t+"OAuth2AutoRefresh");if(b&&(b.checked=e.autoRefreshToken!==!1),e.flow==="password"){let y=a(t+"OAuth2Username");y&&(y.value=e.username||"");let m=a(t+"OAuth2Password");m&&(m.value=e.password||"")}else if(e.flow==="authorization_code"){let y=a(t+"OAuth2AuthorizationUrl");y&&(y.value=e.authorizationUrl||"");let m=a(t+"OAuth2CallbackUrl");m&&(m.value=e.callbackUrl||"")}break}}}var A=null;function k(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function P(e){A&&!A.contains(e.target)&&M()}function M(){A&&(A.remove(),A=null),document.removeEventListener("click",P)}function D(e,n,t){M();let a=e.getBoundingClientRect(),l=t.getResolvedVariables(),s=t.getVariableSources(),o=n in l,r=s[n]||"unknown",d=r.charAt(0).toUpperCase()+r.slice(1),c=document.createElement("div");c.className="var-tooltip";let h=[];t.onEditVariable&&h.push("<button class='var-action-btn' data-action='edit'>Edit</button>"),h.push("<button class='var-action-btn' data-action='copy'>"+(o?"Copy Value":"Copy Name")+"</button>"),c.innerHTML="<div class='var-name'>{{"+k(n)+"}}</div>"+(o?"<div class='var-source tk-src-"+k(r)+"'>"+k(d)+"</div><div class='var-value'>"+k(l[n])+"</div>":"<div class='var-unresolved'>Unresolved variable</div>")+"<div class='var-actions'>"+h.join("")+"</div>",c.style.left=a.left+"px",c.style.top=a.bottom+4+"px",document.body.appendChild(c),A=c,c.querySelectorAll(".var-action-btn").forEach(u=>{u.addEventListener("click",()=>{let p=u.dataset.action;if(p==="edit"&&t.onEditVariable)t.onEditVariable(n);else if(p==="copy"){let b=o?l[n]:"{{"+n+"}}";navigator.clipboard.writeText(b).catch(()=>{})}M()})}),setTimeout(()=>{document.addEventListener("click",P)},0)}function W(e){if(e<=0)return"expired";let n=Math.floor(e/1e3);if(n<60)return`${n}s`;let t=Math.floor(n/60);return t<60?`${t}m ${n%60}s`:`${Math.floor(t/60)}h ${t%60}m`}function _(e){let n=`${e.prefix}OAuth2TokenStatus`,t=null,a=null;function l(){return document.getElementById(n)}function s(){t&&(clearInterval(t),t=null)}function o(){let u=e.buildAuth();!u||u.type!=="oauth2"||!u.accessTokenUrl||e.postMessage({type:"getTokenStatus",auth:u})}function r(u){let p=l();if(!p)return;if(!u?.hasToken){p.innerHTML=`<div class="token-status token-none"><span class="token-dot dot-none"></span> No token<button class="token-btn" id="${n}-get">Get Token</button></div>`,p.querySelector(`#${n}-get`)?.addEventListener("click",()=>{let S=e.buildAuth();e.postMessage({type:"getToken",auth:S})});return}let b=Date.now(),y=u.expiresAt?u.expiresAt-b:void 0,m=y!==void 0&&y<=0,J=m?"dot-expired":"dot-valid",Q=m?"Expired":y!==void 0?`Expires in ${W(y)}`:"Valid (no expiry)",F=u.expiresAt?new Date(u.expiresAt).toLocaleTimeString():"";p.innerHTML='<div class="token-status '+(m?"token-expired":"token-valid")+'"><span class="token-dot '+J+'"></span> '+Q+(F?'<span class="token-expiry-time"> ('+e.esc(F)+")</span>":"")+`<button class="token-btn" id="${n}-refresh">${m?"Get Token":"Refresh"}</button></div>`,p.querySelector(`#${n}-refresh`)?.addEventListener("click",()=>{let S=e.buildAuth();e.postMessage({type:"getToken",auth:S})})}function d(u){a=u,s(),r(u),u?.expiresAt&&(t=setInterval(()=>{r(a),a?.expiresAt&&Date.now()>a.expiresAt&&s()},1e3))}function c(u){let p=l();if(!p||!u)return;s();let b=u.startsWith("Error:");p.innerHTML='<div class="token-status '+(b?"token-error":"token-progress")+'">'+(b?'<span class="token-dot dot-expired"></span> ':'<span class="token-spinner"></span> ')+e.esc(u)+"</div>"}function h(){s()}return{requestStatus:o,handleStatus:d,handleProgress:c,dispose:h}}var I=acquireVsCodeApi(),$=null,O=!1,C=!1,x=null;function i(e){return document.getElementById(e)}function T(e){if(!e)return"";let n=document.createElement("div");return n.textContent=e,n.innerHTML}var w={},q={},E=!1;function g(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function z(e){return e.replace(/\{\{(\s*[\w.]+\s*)\}\}/g,(n,t)=>{let a=t.trim(),l=a in w,s=q[a]||"unknown";return E&&l?"<span class='"+("tk-var-resolved tk-src-"+s)+"' data-var='"+g(a)+"' title='{{"+g(a)+"}} ("+s+")'>"+g(w[a])+"</span>":"<span class='"+(l?"tk-var tk-src-"+s:"tk-var tk-var-unresolved")+"' data-var='"+g(a)+"'>{{"+g(t)+"}}</span>"})}function U(e){let n=e.parentElement;n.classList.add("var-cell");let t=document.createElement("div");t.className="var-overlay",n.appendChild(t);function a(){t.innerHTML=z(g(e.value))}function l(){n.classList.add("var-overlay-active"),a()}function s(){n.classList.remove("var-overlay-active")}e.addEventListener("input",a),e.addEventListener("focus",s),e.addEventListener("blur",l),t.addEventListener("click",o=>{let r=o.target.closest(".tk-var, .tk-var-resolved");r&&r.dataset.var?D(r,r.dataset.var,{getResolvedVariables:()=>w,getVariableSources:()=>q}):(s(),e.focus())}),document.activeElement!==e&&l()}function N(){document.querySelectorAll(".var-cell").forEach(e=>{let n=e.querySelector('input[type="text"]'),t=e.querySelector(".var-overlay");n&&t&&e.classList.contains("var-overlay-active")&&(t.innerHTML=z(g(n.value)))})}function f(){C||(x&&clearTimeout(x),x=setTimeout(()=>{$&&X()},400))}function X(){let e=JSON.parse(JSON.stringify($));e.info=e.info||{},e.info.type="folder",e.info.name=i("infoName").value||void 0;let n=i("infoDescription").value;n?e.info.description=n:delete e.info.description;let t=[];document.querySelectorAll("#defaultHeadersBody tr").forEach(o=>{let r=o.querySelectorAll('input[type="text"]'),d=o.querySelector('input[type="checkbox"]');if(r[0]?.value){let c={name:r[0].value,value:r[1]?.value||""};d&&!d.checked&&(c.disabled=!0),t.push(c)}}),e.request||(e.request={}),e.request.headers=t.length>0?t:void 0;let a=i("defaultAuthType").value,l=H(a,"dAuth");l!==void 0?e.request.auth=l:delete e.request.auth;let s=[];document.querySelectorAll("#defaultVarsBody tr").forEach(o=>{let r=o.querySelectorAll('input[type="text"]'),d=o.querySelector('input[type="checkbox"]');if(r[0]?.value){let c={name:r[0].value,value:r[1]?.value||""};d&&!d.checked&&(c.disabled=!0),s.push(c)}}),e.request=e.request||{},e.request.variables=s.length>0?s:void 0,e.request&&Object.keys(e.request).every(o=>e.request[o]===void 0)&&delete e.request,O=!0,I.postMessage({type:"updateDocument",folder:e})}function Y(e){let n=i(e);n&&n.querySelectorAll(".tab").forEach(t=>{t.addEventListener("click",()=>{let a=t.dataset.tab;n.querySelectorAll(".tab").forEach(o=>o.classList.remove("active")),t.classList.add("active");let l=n.parentElement;l.querySelectorAll(":scope > .tab-content > .tab-panel").forEach(o=>o.classList.remove("active"));let s=l.querySelector(`#panel-${a}`);s&&s.classList.add("active")})})}function Z(e){let n=i("defaultHeadersBody");n.innerHTML="",(e||[]).forEach(t=>K(t.name,t.value,t.disabled))}function K(e,n,t){let a=i("defaultHeadersBody"),l=document.createElement("tr");l.innerHTML=`<td><input type="checkbox" ${t?"":"checked"} /></td><td><input type="text" value="${T(e||"")}" placeholder="Header name" /></td><td><input type="text" value="${T(n||"")}" placeholder="Header value" /></td><td><button class="row-delete">\xD7</button></td>`,l.querySelector(".row-delete").addEventListener("click",()=>{l.remove(),f()}),l.querySelectorAll("input").forEach(o=>{o.addEventListener("input",f),o.addEventListener("change",f)});let s=l.querySelectorAll('input[type="text"]')[1];s&&U(s),a.appendChild(l)}function ee(e){let n=i("defaultVarsBody");n.innerHTML="",(e||[]).forEach(t=>j(t.name,t.value,t.disabled))}function j(e,n,t){let a=i("defaultVarsBody"),l=document.createElement("tr"),s=typeof n=="string"?n:n&&n.data?n.data:"";l.innerHTML=`<td><input type="checkbox" ${t?"":"checked"} /></td><td><input type="text" value="${T(e||"")}" placeholder="Variable name" /></td><td><input type="text" value="${T(s)}" placeholder="Variable value" /></td><td><button class="row-delete">\xD7</button></td>`,l.querySelector(".row-delete").addEventListener("click",()=>{l.remove(),f()}),l.querySelectorAll("input").forEach(r=>{r.addEventListener("input",f),r.addEventListener("change",f)});let o=l.querySelectorAll('input[type="text"]')[1];o&&U(o),a.appendChild(l)}var te={prefix:"dAuth",get fieldsContainer(){return i("defaultAuthFields")},onChange:()=>f(),showInherit:!0,wrapInputs:!0,showTokenStatus:!0,onFieldsRendered:e=>e.forEach(n=>U(n))},L=_({prefix:"dAuth",buildAuth:()=>H(i("defaultAuthType").value,"dAuth"),postMessage:e=>I.postMessage(e),esc:T});function G(){let e=i("defaultAuthType").value;R(e,te),e==="oauth2"&&L.requestStatus()}function V(){i("headersBadge").textContent=String(document.querySelectorAll("#defaultHeadersBody tr").length),i("variablesBadge").textContent=String(document.querySelectorAll("#defaultVarsBody tr").length)}function ne(e){C=!0,$=e,i("infoName").value=e.info?.name||"";let n=e.info?.description;i("infoDescription").value=typeof n=="string"?n:n?.content||"",i("folderName").textContent=e.info?.name||"Folder";let t=e.request?.auth;t==="inherit"?i("defaultAuthType").value="inherit":t?.type?i("defaultAuthType").value=t.type:i("defaultAuthType").value="none",G(),t&&t!=="inherit"&&t.type&&B(t,"dAuth"),Z(e.request?.headers||[]),ee(e.request?.variables||[]),V(),C=!1}Y("mainTabs");i("defaultAuthType").addEventListener("change",G);i("addDefaultHeaderBtn").addEventListener("click",()=>{K(),V(),f()});i("addDefaultVarBtn").addEventListener("click",()=>{j(),V(),f()});i("varToggleBtn").addEventListener("click",()=>{E=!E,i("varToggleBtn").classList.toggle("active",E),N()});i("infoName").addEventListener("input",()=>{i("folderName").textContent=i("infoName").value||"Folder",f()});i("infoDescription").addEventListener("input",f);window.addEventListener("message",e=>{let n=e.data;if(n.type==="folderLoaded"){if(O){O=!1;return}ne(n.folder)}n.type==="variablesResolved"&&(w=n.variables||{},q=n.sources||{},N(),L.requestStatus()),n.type==="oauth2TokenStatus"&&L.handleStatus(n.status),n.type==="oauth2Progress"&&L.handleProgress(n.message)});I.postMessage({type:"ready"});})();
